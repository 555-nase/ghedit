{"version":3,"file":"vs/workbench/electron-browser/window.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/workbench/electron-browser/window.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;IAEhG,YAAY,CAAC;IAiBb,IAAM,MAAM,GAAG,iBAAM,CAAC,MAAM,CAAC;IAU7B;QAIC,wBACC,GAA2B,EAC3B,cAA2B,EACO,cAAwC,EACnD,YAA2B,EACzB,cAA+B,EACvB,aAAsC,EAC9C,cAA+B;YAJtB,mBAAc,GAAd,cAAc,CAA0B;YACnD,iBAAY,GAAZ,YAAY,CAAe;YACzB,mBAAc,GAAd,cAAc,CAAiB;YACvB,kBAAa,GAAb,aAAa,CAAyB;YAC9C,mBAAc,GAAd,cAAc,CAAiB;YAExD,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;YACf,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,EAAE,CAAC;YACvB,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1B,CAAC;QAEO,0CAAiB,GAAzB;YAAA,iBA+EC;YA7EA,2CAA2C;YAC3C,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;gBACjD,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,kBAAS,CAAC,oBAAoB,EAAE,UAAC,CAAc;oBAC5E,IAAI,SAAS,GAAG,qBAAqB,CAAC,iBAAiB,CAAC,CAAC,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;oBAC7E,IAAI,mBAAmB,GAAG,EAAE,CAAC;oBAC7B,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;wBACf,mBAAmB,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC;oBACtD,CAAC;oBAED,sBAAG,CAAC,IAAI,CAAC,+BAA+B,EAAE,KAAI,CAAC,QAAQ,EAAE,mBAAmB,CAAC,CAAC;gBAC/E,CAAC,CAAC,CAAC;YACJ,CAAC;YAED,wDAAwD;YACxD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAC,CAAY;gBAC9D,CAAC,CAAC,cAAc,EAAE,CAAC;YACpB,CAAC,CAAC,CAAC;YAEH,2EAA2E;YAC3E,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,UAAC,CAAY;gBAC1D,CAAC,CAAC,cAAc,EAAE,CAAC;gBAEnB,IAAI,UAAU,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,uBAAW,CAAC,WAAW,CAAC,CAAC;gBACzE,EAAE,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;oBAC7C,IAAI,WAAW,GAAG,KAAK,CAAC;oBAExB,iCAAiC;oBACjC,EAAE,CAAC,CAAC,CAAC,CAAC,YAAY,IAAI,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;wBAC5C,IAAI,QAAQ,GAAa,EAAE,CAAC;wBAC5B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;4BACtD,EAAE,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,IAAU,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC,CAAC;gCACpE,QAAQ,CAAC,IAAI,CAAO,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC;4BACpD,CAAC;wBACF,CAAC;wBAED,EAAE,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;4BACrB,WAAW,GAAG,IAAI,CAAC;4BACnB,KAAI,CAAC,KAAK,EAAE,CAAC,CAAC,kFAAkF;4BAChG,KAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;wBACrB,CAAC;oBACF,CAAC;oBAED,8CAA8C;oBAC9C,EAAE,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC,CAAC,YAAY,IAAU,CAAE,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;wBACnE,IAAI,KAAK,GAAmE,CAAE,CAAC,YAAY,CAAC,KAAK,CAAC;wBAClG,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,IAAI,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW,KAAK,UAAU,CAAC,CAAC,CAAC;4BAChE,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,UAAC,GAAG;gCACxB,IAAI,CAAC;oCACJ,IAAI,QAAQ,GAAG,aAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oCAC9B,EAAE,CAAC,CAAC,QAAQ,CAAC,MAAM,KAAK,MAAM,CAAC,CAAC,CAAC;wCAEhC,yFAAyF;wCACzF,uFAAuF;wCACvF,yBAAyB;wCACzB,IAAI,SAAS,GAAG,KAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC;wCACnD,EAAE,CAAC,CAAC,SAAS,IAAI,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,EAAE,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4CACpF,MAAM,CAAC;wCACR,CAAC;wCAED,KAAI,CAAC,KAAK,EAAE,CAAC,CAAC,kFAAkF;wCAChG,KAAI,CAAC,IAAI,CAAC,CAAC,kBAAkB,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oCAClD,CAAC;gCACF,CAAE;gCAAA,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;gCAEjB,CAAC;4BACF,CAAC,CAAC,CAAC;wBACJ,CAAC;oBACF,CAAC;gBACF,CAAC;YACF,CAAC,CAAC,CAAC;YAEH,6BAA6B;YACvB,MAAO,CAAC,IAAI,GAAG,UAAS,GAAW,EAAE,MAAc,EAAE,QAAgB,EAAE,OAAgB;gBAC5F,gBAAK,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;gBAExB,MAAM,CAAC,IAAI,CAAC;YACb,CAAC,CAAC;QACH,CAAC;QAKM,6BAAI,GAAX,UAAY,IAAS;YACpB,IAAI,WAAqB,CAAC;YAC1B,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBACzB,WAAW,GAAG,IAAI,CAAC;YACpB,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACrC,WAAW,GAAG,CAAC,IAAI,CAAC,CAAC;YACtB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,WAAW,GAAG,CAAO,IAAK,CAAC,MAAM,CAAC,CAAC;YACpC,CAAC;YAED,sBAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC,CAAC,+BAA+B;QAC5E,CAAC;QAEM,gCAAO,GAAd;YACC,sBAAG,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC,+BAA+B;QAClE,CAAC;QAEM,8BAAK,GAAZ;YACC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;QAClB,CAAC;QAEM,+BAAM,GAAb;YACC,sBAAG,CAAC,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChD,CAAC;QAEM,uCAAc,GAArB,UAAsB,OAA8C;YACnE,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QACjD,CAAC;QAEM,uCAAc,GAArB,UAAsB,OAA0C,EAAE,QAAqC;YACtG,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACd,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;YAC3D,CAAC;YAED,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,+CAA+C;QACjG,CAAC;QAEM,sCAAa,GAApB,UAAqB,UAAmB;YACvC,sBAAG,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC,+BAA+B;QAC7F,CAAC;QAEM,qCAAY,GAAnB;YACC,sBAAG,CAAC,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,+BAA+B;QAChF,CAAC;QAEM,6CAAoB,GAA3B,UAA4B,OAAgB;YAC3C,sBAAG,CAAC,IAAI,CAAC,6BAA6B,EAAE,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,CAAC,+BAA+B;QACjG,CAAC;QAEM,8BAAK,GAAZ;YACC,sBAAG,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,+BAA+B;QAC/E,CAAC;QAEM,mCAAU,GAAjB;YACC,sBAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,+BAA+B;QAC9E,CAAC;QAtJA;uBAAC,oCAAwB;uBACxB,qBAAa;uBACb,yBAAe;uBACf,uCAAuB;uBACvB,gCAAe;0BAJS;QAuJ3B,qBAAC;IAAD,CAAC,AA9JD,IA8JC;IA9JY,sBAAc,iBA8J1B,CAAA","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport platform = require('vs/base/common/platform');\nimport paths = require('vs/base/common/paths');\nimport uri from 'vs/base/common/uri';\nimport {Identifiers} from 'vs/workbench/common/constants';\nimport {EventType, EditorEvent} from 'vs/workbench/common/events';\nimport workbenchEditorCommon = require('vs/workbench/common/editor');\nimport {IViewletService} from 'vs/workbench/services/viewlet/common/viewletService';\nimport {IWorkbenchEditorService} from 'vs/workbench/services/editor/common/editorService';\nimport dom = require('vs/base/browser/dom');\nimport {IStorageService} from 'vs/platform/storage/common/storage';\nimport {IEventService} from 'vs/platform/event/common/event';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\n\nimport {ipcRenderer as ipc, shell, remote} from 'electron';\n\nconst dialog = remote.dialog;\n\nexport interface IWindowConfiguration {\n\twindow: {\n\t\topenFilesInNewWindow: boolean;\n\t\treopenFolders: string;\n\t\tzoomLevel: number;\n\t};\n}\n\nexport class ElectronWindow {\n\tprivate win: Electron.BrowserWindow;\n\tprivate windowId: number;\n\n\tconstructor(\n\t\twin: Electron.BrowserWindow,\n\t\tshellContainer: HTMLElement,\n\t\t@IWorkspaceContextService private contextService: IWorkspaceContextService,\n\t\t@IEventService private eventService: IEventService,\n\t\t@IStorageService private storageService: IStorageService,\n\t\t@IWorkbenchEditorService private editorService: IWorkbenchEditorService,\n\t\t@IViewletService private viewletService: IViewletService\n\t) {\n\t\tthis.win = win;\n\t\tthis.windowId = win.id;\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// React to editor input changes (Mac only)\n\t\tif (platform.platform === platform.Platform.Mac) {\n\t\t\tthis.eventService.addListener(EventType.EDITOR_INPUT_CHANGED, (e: EditorEvent) => {\n\t\t\t\tlet fileInput = workbenchEditorCommon.asFileEditorInput(e.editorInput, true);\n\t\t\t\tlet representedFilename = '';\n\t\t\t\tif (fileInput) {\n\t\t\t\t\trepresentedFilename = fileInput.getResource().fsPath;\n\t\t\t\t}\n\n\t\t\t\tipc.send('vscode:setRepresentedFilename', this.windowId, representedFilename);\n\t\t\t});\n\t\t}\n\n\t\t// Prevent a dropped file from opening as nw application\n\t\twindow.document.body.addEventListener('dragover', (e: DragEvent) => {\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t// Let a dropped file open inside Monaco (only if dropped over editor area)\n\t\twindow.document.body.addEventListener('drop', (e: DragEvent) => {\n\t\t\te.preventDefault();\n\n\t\t\tlet editorArea = window.document.getElementById(Identifiers.EDITOR_PART);\n\t\t\tif (dom.isAncestor(e.toElement, editorArea)) {\n\t\t\t\tlet pathsOpened = false;\n\n\t\t\t\t// Check for native file transfer\n\t\t\t\tif (e.dataTransfer && e.dataTransfer.files) {\n\t\t\t\t\tlet thepaths: string[] = [];\n\t\t\t\t\tfor (let i = 0; i < e.dataTransfer.files.length; i++) {\n\t\t\t\t\t\tif (e.dataTransfer.files[i] && (<any>e.dataTransfer.files[i]).path) {\n\t\t\t\t\t\t\tthepaths.push((<any>e.dataTransfer.files[i]).path);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (thepaths.length) {\n\t\t\t\t\t\tpathsOpened = true;\n\t\t\t\t\t\tthis.focus(); // make sure this window has focus so that the open call reaches the right window!\n\t\t\t\t\t\tthis.open(thepaths);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Otherwise check for special webkit transfer\n\t\t\t\tif (!pathsOpened && e.dataTransfer && (<any>e).dataTransfer.items) {\n\t\t\t\t\tlet items: { getAsString: (clb: (str: string) => void) => void; }[] = (<any>e).dataTransfer.items;\n\t\t\t\t\tif (items.length && typeof items[0].getAsString === 'function') {\n\t\t\t\t\t\titems[0].getAsString((str) => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tlet resource = uri.parse(str);\n\t\t\t\t\t\t\t\tif (resource.scheme === 'file') {\n\n\t\t\t\t\t\t\t\t\t// Do not allow to drop a child of the currently active workspace. This prevents an issue\n\t\t\t\t\t\t\t\t\t// where one would drop a folder from the explorer by accident into the editor area and\n\t\t\t\t\t\t\t\t\t// loose all the context.\n\t\t\t\t\t\t\t\t\tlet workspace = this.contextService.getWorkspace();\n\t\t\t\t\t\t\t\t\tif (workspace && paths.isEqualOrParent(resource.fsPath, workspace.resource.fsPath)) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tthis.focus(); // make sure this window has focus so that the open call reaches the right window!\n\t\t\t\t\t\t\t\t\tthis.open([decodeURIComponent(resource.fsPath)]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t// not a resource\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Handle window.open() calls\n\t\t(<any>window).open = function(url: string, target: string, features: string, replace: boolean) {\n\t\t\tshell.openExternal(url);\n\n\t\t\treturn null;\n\t\t};\n\t}\n\n\tpublic open(pathsToOpen: string[]): void;\n\tpublic open(fileResource: uri): void;\n\tpublic open(pathToOpen: string): void;\n\tpublic open(arg1: any): void {\n\t\tlet pathsToOpen: string[];\n\t\tif (Array.isArray(arg1)) {\n\t\t\tpathsToOpen = arg1;\n\t\t} else if (typeof arg1 === 'string') {\n\t\t\tpathsToOpen = [arg1];\n\t\t} else {\n\t\t\tpathsToOpen = [(<uri>arg1).fsPath];\n\t\t}\n\n\t\tipc.send('vscode:windowOpen', pathsToOpen); // handled from browser process\n\t}\n\n\tpublic openNew(): void {\n\t\tipc.send('vscode:openNewWindow'); // handled from browser process\n\t}\n\n\tpublic close(): void {\n\t\tthis.win.close();\n\t}\n\n\tpublic reload(): void {\n\t\tipc.send('vscode:reloadWindow', this.windowId);\n\t}\n\n\tpublic showMessageBox(options: Electron.Dialog.ShowMessageBoxOptions): number {\n\t\treturn dialog.showMessageBox(this.win, options);\n\t}\n\n\tpublic showSaveDialog(options: Electron.Dialog.SaveDialogOptions, callback?: (fileName: string) => void): string {\n\t\tif (callback) {\n\t\t\treturn dialog.showSaveDialog(this.win, options, callback);\n\t\t}\n\n\t\treturn dialog.showSaveDialog(this.win, options); // https://github.com/atom/electron/issues/4936\n\t}\n\n\tpublic setFullScreen(fullscreen: boolean): void {\n\t\tipc.send('vscode:setFullScreen', this.windowId, fullscreen); // handled from browser process\n\t}\n\n\tpublic openDevTools(): void {\n\t\tipc.send('vscode:openDevTools', this.windowId); // handled from browser process\n\t}\n\n\tpublic setMenuBarVisibility(visible: boolean): void {\n\t\tipc.send('vscode:setMenuBarVisibility', this.windowId, visible); // handled from browser process\n\t}\n\n\tpublic focus(): void {\n\t\tipc.send('vscode:focusWindow', this.windowId); // handled from browser process\n\t}\n\n\tpublic flashFrame(): void {\n\t\tipc.send('vscode:flashFrame', this.windowId); // handled from browser process\n\t}\n}"]}