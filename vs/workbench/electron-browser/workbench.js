/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(t,e,i,r){var s,n=arguments.length,o=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o},__param=this&&this.__param||function(t,e){return function(i,r){e(i,r,t)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/types","vs/base/common/lifecycle","vs/base/common/strings","vs/base/browser/dom","vs/base/browser/builder","vs/base/common/async","vs/base/common/assert","vs/base/common/timer","vs/base/common/errors","vs/platform/platform","vs/workbench/common/constants","vs/base/common/platform","vs/workbench/common/contributions","vs/workbench/common/editor","vs/workbench/services/history/browser/history","vs/workbench/browser/parts/activitybar/activitybarPart","vs/workbench/browser/parts/editor/editorPart","vs/workbench/browser/parts/sidebar/sidebarPart","vs/workbench/browser/parts/panel/panelPart","vs/workbench/browser/parts/statusbar/statusbarPart","vs/workbench/browser/layout","vs/workbench/browser/actionBarRegistry","vs/workbench/browser/viewlet","vs/workbench/browser/panel","vs/workbench/browser/parts/quickopen/quickOpenController","vs/workbench/common/editor/diffEditorInput","vs/platform/instantiation/common/extensions","vs/workbench/services/untitled/common/untitledEditorService","vs/workbench/services/editor/browser/editorService","vs/workbench/services/part/common/partService","vs/workbench/services/workspace/common/contextService","vs/platform/storage/common/storage","vs/workbench/services/contextview/electron-browser/contextmenuService","vs/workbench/services/keybinding/electron-browser/keybindingService","vs/platform/keybinding/common/keybinding","vs/workbench/services/activity/common/activityService","vs/workbench/services/viewlet/common/viewletService","vs/workbench/services/panel/common/panelService","vs/workbench/services/message/browser/messageService","vs/workbench/services/editor/common/editorService","vs/workbench/services/quickopen/common/quickOpenService","vs/workbench/services/group/common/groupService","vs/workbench/services/history/common/history","vs/platform/event/common/event","vs/platform/instantiation/common/instantiation","vs/platform/instantiation/common/descriptors","vs/platform/lifecycle/common/lifecycle","vs/platform/message/common/message","vs/workbench/services/thread/common/threadService","vs/platform/statusbar/common/statusbar","vs/platform/actions/common/actions","vs/platform/actions/common/menuService","vs/platform/contextview/browser/contextView","vs/css!./media/workbench"],function(t,e,i,r,s,n,o,a,c,h,d,p,u,v,l,b,S,P,m,f,g,w,k,y,C,E,I,T,A,R,B,_,H,D,L,O,x,W,V,K,M,q,F,U,j,$,N,G,Y,Q,z,J,X,Z,tt,et){"use strict";var it=function(){function t(t,e,s,n,o,h,d,p,u,v,l,b,S){var P=this;if(this.instantiationService=h,this.untitledEditorService=d,this.eventService=p,this.contextService=u,this.storageService=v,this.lifecycleService=l,this.messageService=b,this.threadService=S,this.validateParams(t,s,n),r.isString(t)){var m=a.withElementById(t.toString());this.container=m.getHTMLElement()}else this.container=t;this.workbenchParams={workspace:e,configuration:s,options:n||{},serviceCollection:o},this.toDispose=[],this.toShutdown=[],this.editorBackgroundDelayer=new c.Delayer(50),this.creationPromise=new i.TPromise(function(t,e,i){P.creationPromiseComplete=t})}return t.prototype.validateParams=function(t,e,i){if(h.ok(t,"Workbench requires a container to be created with"),r.isString(t)){var s=a.withElementById(t.toString());h.ok(s,n.format("Can not find HTMLElement with id '{0}'.",t))}},t.prototype.startup=function(t){var e=this;h.ok(!this.workbenchStarted,"Can not start a workbench that was already started"),h.ok(!this.workbenchShutdown,"Can not start a workbench that was shutdown");try{this.workbenchStarted=!0,this.callbacks=t,this.createWorkbench(),this.initServices(),this.callbacks&&this.callbacks.onServicesCreated&&this.callbacks.onServicesCreated(),this.messagesVisibleContext=this.keybindingService.createKey("globalMessageVisible",!1),this.editorsVisibleContext=this.keybindingService.createKey("editorIsOpen",!1),this.registerListeners(),this.initSettings(),this.renderWorkbench(),this.createWorkbenchLayout(),this.registerEmitters();var r=[],s=u.Registry.as(E.Extensions.Viewlets),o=s.getDefaultViewletId();if(this.workbenchParams.configuration.env.isBuilt||(o=this.storageService.get(g.SidebarPart.activeViewletSettingsKey,L.StorageScope.WORKSPACE,s.getDefaultViewletId())),!this.sideBarHidden&&o){var a=d.start(d.Topic.STARTUP,n.format("Opening Viewlet: {0}",o));r.push(this.sidebarPart.openViewlet(o,!1).then(function(){return a.stop()}))}var c=u.Registry.as(I.Extensions.Panels),v=this.storageService.get(w.PanelPart.activePanelSettingsKey,L.StorageScope.WORKSPACE,c.getDefaultPanelId());!this.panelHidden&&v&&r.push(this.panelPart.openPanel(v,!1));var l=d.start(d.Topic.STARTUP,n.format("Restoring Editor(s)"));r.push(this.resolveEditorsToOpen().then(function(t){var i;if(t.length){var r=t.map(function(t,e){return{input:t.input,options:t.options,position:H.Position.LEFT}});i=e.editorPart.openEditors(r)}else i=e.editorPart.restoreEditors();return i.then(function(){e.onEditorsChanged(),l.stop()})}));var b=function(t){e.workbenchCreated=!0,e.creationPromiseComplete(!0),e.callbacks&&e.callbacks.onWorkbenchStarted&&e.callbacks.onWorkbenchStarted(e.keybindingService.customKeybindingsCount()),t&&p.onUnexpectedError(t)};i.TPromise.join(r).then(function(){return b()},function(t){return b(t)})}catch(S){throw console.error(p.toErrorMessage(S,!0)),S}},t.prototype.resolveEditorsToOpen=function(){var t=this,e=this.workbenchParams.options;if(e.filesToCreate&&e.filesToCreate.length||e.filesToOpen&&e.filesToOpen.length||e.filesToDiff&&e.filesToDiff.length){var r=e.filesToCreate||[],s=e.filesToOpen||[],n=e.filesToDiff;if(n&&n.length)return i.TPromise.join(n.map(function(e){return t.editorService.createInput(e)})).then(function(e){return[{input:new A.DiffEditorInput(A.toDiffLabel(n[0].resource,n[1].resource,t.contextService),null,e[0],e[1])}]});var o=[],a=[];return o.push.apply(o,r.map(function(e){return t.untitledEditorService.createOrGet(e.resource)})),a.push.apply(a,r.map(function(t){return null})),i.TPromise.join(s.map(function(e){return t.editorService.createInput(e)})).then(function(t){return o.push.apply(o,t),a.push.apply(a,s.map(function(t){return S.TextEditorOptions.from(t)})),o.map(function(t,e){return{input:t,options:a[e]}})})}return this.workbenchParams.workspace?i.TPromise.as([]):i.TPromise.as([{input:this.untitledEditorService.createOrGet()}])},t.prototype.initServices=function(){var t=this.workbenchParams.serviceCollection;this.toDispose.push(this.lifecycleService.onShutdown(this.shutdownComponents,this)),t.set(H.IPartService,this),this.statusbarPart=this.instantiationService.createInstance(k.StatusbarPart,v.Identifiers.STATUSBAR_PART),this.toDispose.push(this.statusbarPart),this.toShutdown.push(this.statusbarPart),t.set(X.IStatusbarService,this.statusbarPart),this.keybindingService=this.instantiationService.createInstance(x.WorkbenchKeybindingService,window),t.set(W.IKeybindingService,this.keybindingService),t.set(et.IContextMenuService,this.instantiationService.createInstance(O.ContextMenuService)),t.set(Z.IMenuService,new Y.SyncDescriptor(tt.MenuService)),this.sidebarPart=this.instantiationService.createInstance(g.SidebarPart,v.Identifiers.SIDEBAR_PART),this.toDispose.push(this.sidebarPart),this.toShutdown.push(this.sidebarPart),t.set(K.IViewletService,this.sidebarPart),this.panelPart=this.instantiationService.createInstance(w.PanelPart,v.Identifiers.PANEL_PART),this.toDispose.push(this.panelPart),this.toShutdown.push(this.panelPart),t.set(M.IPanelService,this.panelPart),this.activitybarPart=this.instantiationService.createInstance(m.ActivitybarPart,v.Identifiers.ACTIVITYBAR_PART),this.toDispose.push(this.activitybarPart),this.toShutdown.push(this.activitybarPart),t.set(V.IActivityService,this.activitybarPart),this.editorPart=this.instantiationService.createInstance(f.EditorPart,v.Identifiers.EDITOR_PART),this.toDispose.push(this.editorPart),this.toShutdown.push(this.editorPart),this.editorService=this.instantiationService.createInstance(_.WorkbenchEditorService,this.editorPart),t.set(F.IWorkbenchEditorService,this.editorService),t.set(j.IEditorGroupService,this.editorPart),t.set($.IHistoryService,this.instantiationService.createInstance(P.HistoryService)),this.quickOpen=this.instantiationService.createInstance(T.QuickOpenController),this.toDispose.push(this.quickOpen),this.toShutdown.push(this.quickOpen),t.set(U.IQuickOpenService,this.quickOpen);for(var e=R.getServices(),i=0,r=e;i<r.length;i++){var s=r[i];t.set(s.id,s.descriptor)}this.keybindingService.setInstantiationService(this.instantiationService),u.Registry.as(C.Extensions.Actionbar).setInstantiationService(this.instantiationService),u.Registry.as(b.Extensions.Workbench).setInstantiationService(this.instantiationService),u.Registry.as(S.Extensions.Editors).setInstantiationService(this.instantiationService)},t.prototype.initSettings=function(){this.sideBarHidden=this.storageService.getBoolean(t.sidebarHiddenSettingKey,L.StorageScope.WORKSPACE,!1),this.workbenchParams.options.singleFileMode&&(this.sideBarHidden=!0);var e=u.Registry.as(E.Extensions.Viewlets);e.getDefaultViewletId()||(this.sideBarHidden=!0);var i=u.Registry.as(I.Extensions.Panels);this.panelHidden=this.storageService.getBoolean(t.panelHiddenSettingKey,L.StorageScope.WORKSPACE,!0),!this.workbenchParams.options.singleFileMode&&i.getDefaultPanelId()||(this.panelHidden=!0);var r=this.storageService.get(t.sidebarPositionSettingKey,L.StorageScope.GLOBAL,"left");this.sideBarPosition="left"===r?H.Position.LEFT:H.Position.RIGHT,this.statusBarHidden=this.storageService.getBoolean(t.statusbarHiddenSettingKey,L.StorageScope.WORKSPACE,!1)},t.prototype.isStarted=function(){return this.workbenchStarted&&!this.workbenchShutdown},t.prototype.isCreated=function(){return this.workbenchCreated&&this.workbenchStarted},t.prototype.joinCreation=function(){return this.creationPromise},t.prototype.hasFocus=function(t){var e=document.activeElement;if(!e)return!1;var i=null;switch(t){case H.Parts.ACTIVITYBAR_PART:i=this.activitybarPart.getContainer();break;case H.Parts.SIDEBAR_PART:i=this.sidebarPart.getContainer();break;case H.Parts.PANEL_PART:i=this.panelPart.getContainer();break;case H.Parts.EDITOR_PART:i=this.editorPart.getContainer();break;case H.Parts.STATUSBAR_PART:i=this.statusbarPart.getContainer()}return o.isAncestor(e,i.getHTMLElement())},t.prototype.isVisible=function(t){switch(t){case H.Parts.SIDEBAR_PART:return!this.sideBarHidden;case H.Parts.PANEL_PART:return!this.panelHidden;case H.Parts.STATUSBAR_PART:return!this.statusBarHidden}return!0},t.prototype.isStatusBarHidden=function(){return this.statusBarHidden},t.prototype.setStatusBarHidden=function(e,i){this.statusBarHidden=e,i||this.workbenchLayout.layout(!0),this.storageService.store(t.statusbarHiddenSettingKey,e?"true":"false",L.StorageScope.WORKSPACE)},t.prototype.isSideBarHidden=function(){return this.sideBarHidden},t.prototype.setSideBarHidden=function(e,i){if(this.sideBarHidden=e,e?this.workbench.addClass("nosidebar"):this.workbench.removeClass("nosidebar"),i||this.workbenchLayout.layout(!0),e&&this.sidebarPart.getActiveViewlet()){this.sidebarPart.hideActiveViewlet();var r=this.editorPart.getActiveEditor();r&&r.focus()}else if(!e&&!this.sidebarPart.getActiveViewlet()){var s=u.Registry.as(E.Extensions.Viewlets),n=this.sidebarPart.getLastActiveViewletId()||s.getDefaultViewletId();n&&this.sidebarPart.openViewlet(n,!0).done(null,p.onUnexpectedError)}this.storageService.store(t.sidebarHiddenSettingKey,e?"true":"false",L.StorageScope.WORKSPACE)},t.prototype.isPanelHidden=function(){return this.panelHidden},t.prototype.setPanelHidden=function(e,i){if(this.panelHidden=e,i||this.workbenchLayout.layout(!0),e&&this.panelPart.getActivePanel()){this.panelPart.hideActivePanel();var r=this.editorPart.getActiveEditor();r&&r.focus()}else if(!e&&!this.panelPart.getActivePanel()){var s=u.Registry.as(I.Extensions.Panels),n=this.panelPart.getLastActivePanelId()||s.getDefaultPanelId();n&&this.panelPart.openPanel(n,!0).done(null,p.onUnexpectedError)}this.storageService.store(t.panelHiddenSettingKey,e?"true":"false",L.StorageScope.WORKSPACE)},t.prototype.getSideBarPosition=function(){return this.sideBarPosition},t.prototype.setSideBarPosition=function(e){this.sideBarHidden&&this.setSideBarHidden(!1,!0);var i=e===H.Position.LEFT?"left":"right",r=this.sideBarPosition===H.Position.LEFT?"left":"right";this.sideBarPosition=e,this.activitybarPart.getContainer().removeClass(r),this.sidebarPart.getContainer().removeClass(r),this.activitybarPart.getContainer().addClass(i),this.sidebarPart.getContainer().addClass(i),this.workbenchLayout.layout(!0),this.storageService.store(t.sidebarPositionSettingKey,e===H.Position.LEFT?"left":"right",L.StorageScope.GLOBAL)},t.prototype.dispose=function(){this.isStarted()&&(this.shutdownComponents(),this.workbenchShutdown=!0),this.toDispose=s.dispose(this.toDispose)},t.prototype.layout=function(){this.isStarted()&&this.workbenchLayout.layout()},t.prototype.shutdownComponents=function(){this.toShutdown.forEach(function(t){return t.shutdown()})},t.prototype.registerEmitters=function(){this.hookPartListeners(this.activitybarPart),this.hookPartListeners(this.editorPart),this.hookPartListeners(this.sidebarPart),this.hookPartListeners(this.panelPart)},t.prototype.hookPartListeners=function(t){this.toDispose.push(this.eventService.addEmitter2(t,t.getId()))},t.prototype.registerListeners=function(){var t=this;this.toDispose.push(this.editorPart.onEditorsChanged(function(){return t.onEditorsChanged()})),this.messageService instanceof q.WorkbenchMessageService&&(this.toDispose.push(this.messageService.onMessagesShowing(function(){return t.messagesVisibleContext.set(!0)})),this.toDispose.push(this.messageService.onMessagesCleared(function(){return t.messagesVisibleContext.reset()})),this.toDispose.push(this.quickOpen.onShow(function(){return t.messageService.suspend()})),this.toDispose.push(this.quickOpen.onHide(function(){return t.messageService.resume()})))},t.prototype.onEditorsChanged=function(){var t=this.editorService.getVisibleEditors().length,e=this.editorPart.getContainer();0===t?(this.editorsVisibleContext.reset(),this.editorBackgroundDelayer.trigger(function(){return e.addClass("empty")})):(this.editorsVisibleContext.set(!0),this.editorBackgroundDelayer.trigger(function(){return e.removeClass("empty")}))},t.prototype.createWorkbenchLayout=function(){var t=new y.LayoutOptions;t.setMargin(new a.Box(0,0,0,0)),this.workbenchLayout=this.instantiationService.createInstance(y.WorkbenchLayout,a.$(this.container),this.workbench,{activitybar:this.activitybarPart,editor:this.editorPart,sidebar:this.sidebarPart,panel:this.panelPart,statusbar:this.statusbarPart},this.quickOpen,t),this.toDispose.push(this.workbenchLayout)},t.prototype.createWorkbench=function(){this.workbenchContainer=a.$(".monaco-workbench-container"),this.workbench=a.$().div({"class":"monaco-workbench "+(l.isWindows?"windows":l.isLinux?"linux":"mac"),id:v.Identifiers.WORKBENCH_CONTAINER}).appendTo(this.workbenchContainer)},t.prototype.renderWorkbench=function(){this.sideBarHidden&&this.workbench.addClass("nosidebar"),this.workbenchParams.workspace||this.workbench.addClass("no-workspace"),this.createActivityBarPart(),this.createSidebarPart(),this.createEditorPart(),this.createPanelPart(),this.createStatusbarPart(),this.workbenchContainer.build(this.container)},t.prototype.createActivityBarPart=function(){var t=a.$(this.workbench).div({"class":["part","activitybar",this.sideBarPosition===H.Position.LEFT?"left":"right"],id:v.Identifiers.ACTIVITYBAR_PART,role:"navigation"});this.activitybarPart.create(t)},t.prototype.createSidebarPart=function(){var t=a.$(this.workbench).div({"class":["part","sidebar",this.sideBarPosition===H.Position.LEFT?"left":"right"],id:v.Identifiers.SIDEBAR_PART,role:"complementary"});this.sidebarPart.create(t)},t.prototype.createPanelPart=function(){var t=a.$(this.workbench).div({"class":["part","panel","monaco-editor-background"],id:v.Identifiers.PANEL_PART,role:"complementary"});this.panelPart.create(t)},t.prototype.createEditorPart=function(){var t=a.$(this.workbench).div({"class":["part","editor","monaco-editor-background"],id:v.Identifiers.EDITOR_PART,role:"main"});this.editorPart.create(t)},t.prototype.createStatusbarPart=function(){var t=a.$(this.workbench).div({"class":["part","statusbar"],id:v.Identifiers.STATUSBAR_PART,role:"contentinfo"});this.statusbarPart.create(t)},t.prototype.getEditorPart=function(){return h.ok(this.workbenchStarted,"Workbench is not started. Call startup() first."),this.editorPart},t.prototype.getSidebarPart=function(){return h.ok(this.workbenchStarted,"Workbench is not started. Call startup() first."),this.sidebarPart},t.prototype.getPanelPart=function(){return h.ok(this.workbenchStarted,"Workbench is not started. Call startup() first."),this.panelPart},t.prototype.getInstantiationService=function(){return h.ok(this.workbenchStarted,"Workbench is not started. Call startup() first."),this.instantiationService},t.prototype.addClass=function(t){this.workbench&&this.workbench.addClass(t)},t.prototype.removeClass=function(t){this.workbench&&this.workbench.removeClass(t)},t.sidebarPositionSettingKey="workbench.sidebar.position",t.statusbarHiddenSettingKey="workbench.statusbar.hidden",t.sidebarHiddenSettingKey="workbench.sidebar.hidden",t.panelHiddenSettingKey="workbench.panel.hidden",t=__decorate([__param(5,G.IInstantiationService),__param(6,B.IUntitledEditorService),__param(7,N.IEventService),__param(8,D.IWorkspaceContextService),__param(9,L.IStorageService),__param(10,Q.ILifecycleService),__param(11,z.IMessageService),__param(12,J.IThreadService)],t)}();e.Workbench=it});