/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,n,o,r){var t,i=arguments.length,c=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,n,o,r);else for(var a=e.length-1;a>=0;a--)(t=e[a])&&(c=(i<3?t(c):i>3?t(n,o,c):t(n,o))||c);return i>3&&c&&Object.defineProperty(n,o,c),c},__param=this&&this.__param||function(e,n){return function(o,r){n(o,r,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/common/errors","vs/base/common/arrays","vs/base/common/severity","vs/base/browser/ui/actionbar/actionbar","vs/base/common/actions","vs/workbench/services/part/common/partService","vs/platform/message/common/message","vs/platform/instantiation/common/instantiation","vs/platform/telemetry/common/telemetry","vs/platform/contextview/browser/contextView","vs/platform/commands/common/commands","vs/platform/keybinding/common/keybinding","vs/workbench/services/workspace/common/contextService","vs/workbench/services/window/electron-browser/windowService","vs/platform/configuration/common/configuration","vs/workbench/electron-browser/window","vs/base/browser/browser","electron"],function(e,n,o,r,t,i,c,a,s,m,d,v,u,l,p,f,w,g,b,S,h,y){"use strict";var _=y.remote.getCurrentWindow(),C=[new s.Action("undo",o.localize("undo","Undo"),null,(!0),function(){return document.execCommand("undo")&&r.TPromise.as(!0)}),new s.Action("redo",o.localize("redo","Redo"),null,(!0),function(){return document.execCommand("redo")&&r.TPromise.as(!0)}),new a.Separator,new s.Action("editor.action.clipboardCutAction",o.localize("cut","Cut"),null,(!0),function(){return document.execCommand("cut")&&r.TPromise.as(!0)}),new s.Action("editor.action.clipboardCopyAction",o.localize("copy","Copy"),null,(!0),function(){return document.execCommand("copy")&&r.TPromise.as(!0)}),new s.Action("editor.action.clipboardPasteAction",o.localize("paste","Paste"),null,(!0),function(){return document.execCommand("paste")&&r.TPromise.as(!0)}),new a.Separator,new s.Action("editor.action.selectAll",o.localize("selectAll","Select All"),null,(!0),function(){return document.execCommand("selectAll")&&r.TPromise.as(!0)})],x=function(){function e(e,n,o,r,t,i,c,a,s,m){this.instantiationService=e,this.windowService=n,this.partService=o,this.contextService=r,this.telemetryService=t,this.configurationService=i,this.commandService=c,this.keybindingService=a,this.messageService=s,this.contextMenuService=m}return e.prototype.integrate=function(e){var n=this,o=this.instantiationService.createInstance(S.ElectronWindow,_,e);this.windowService.registerWindow(o),y.ipcRenderer.on("vscode:runAction",function(e,o){n.commandService.executeCommand(o,{from:"menu"}).done(void 0,function(e){return n.messageService.show(c["default"].Error,e)})}),y.ipcRenderer.on("vscode:optionsChange",function(e,o){var r=JSON.parse(o);for(var t in r)if(r.hasOwnProperty(t)){var i=r[t];n.contextService.updateOptions(t,i)}}),y.ipcRenderer.on("vscode:resolveKeybindings",function(e,o){var r=[];try{r=JSON.parse(o)}catch(i){}n.resolveKeybindings(r).done(function(e){e.length&&y.ipcRenderer.send("vscode:keybindingsResolved",JSON.stringify(e))},function(){return t.onUnexpectedError})}),y.ipcRenderer.on("vscode:telemetry",function(e,o){var r=o.eventName,t=o.data;n.telemetryService.publicLog(r,t)}),y.ipcRenderer.on("vscode:reportError",function(e,n){if(n){var o=JSON.parse(n);o.mainProcess=!0,t.onUnexpectedError(o)}}),this.partService.joinCreation().then(function(){y.ipcRenderer.send("vscode:workbenchLoaded",n.windowService.getWindowId())}),y.ipcRenderer.on("vscode:showInfoMessage",function(e,o){n.messageService.show(c["default"].Info,o)}),h.setZoomLevel(y.webFrame.getZoomLevel());var i;this.configurationService.onDidUpdateConfiguration(function(e){var n=e.config,o=0;if(n.window&&"number"==typeof n.window.zoomLevel){if(o=n.window.zoomLevel,i===o)return;i=o}y.webFrame.getZoomLevel()!==o&&(y.webFrame.setZoomLevel(o),h.setZoomLevel(y.webFrame.getZoomLevel()))}),window.document.addEventListener("contextmenu",function(e){if(e.target instanceof HTMLElement){var o=e.target;!o.nodeName||"input"!==o.nodeName.toLowerCase()&&"textarea"!==o.nodeName.toLowerCase()||(e.preventDefault(),e.stopPropagation(),n.contextMenuService.showContextMenu({getAnchor:function(){return o},getActions:function(){return r.TPromise.as(C)},getKeyBinding:function(e){var o=n.keybindingService.lookupKeybindings(e.id);return o.length>0?o[0]:null}}))}})},e.prototype.resolveKeybindings=function(e){var n=this;return this.partService.joinCreation().then(function(){return i.coalesce(e.map(function(e){for(var o=n.keybindingService.lookupKeybindings(e),r=0;r<o.length;r++){var t=o[r],i=n.keybindingService.getElectronAcceleratorFor(t);if(i)return{id:e,binding:t.value}}return null}))})},e=__decorate([__param(0,v.IInstantiationService),__param(1,g.IWindowService),__param(2,m.IPartService),__param(3,w.IWorkspaceContextService),__param(4,u.ITelemetryService),__param(5,b.IConfigurationService),__param(6,p.ICommandService),__param(7,f.IKeybindingService),__param(8,d.IMessageService),__param(9,l.IContextMenuService)],e)}();n.ElectronIntegration=x});