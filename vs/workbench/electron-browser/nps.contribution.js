/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(s=(a<3?n(s):a>3?n(t,o,s):n(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};define(["require","exports","vs/nls","electron","vs/base/common/winjs.base","vs/base/common/actions","vs/base/common/platform","vs/workbench/common/contributions","vs/platform/platform","vs/platform/message/common/message","vs/platform/instantiation/common/instantiation","vs/platform/telemetry/common/telemetry","vs/platform/storage/common/storage","vs/platform/package","vs/platform/product"],function(e,t,o,r,n,a,s,i,c,p,l,m,u,f,v){"use strict";var S=.15,g="nps/sessionCount",d="nps/lastSessionDate",L="nps/skipVersion",y="nps/isCandidate",A=function(){function e(e,t,s,i){var c=t.get(L,u.StorageScope.GLOBAL,"");if(!c){var l=(new Date).toDateString(),m=t.get(d,u.StorageScope.GLOBAL,new Date(0).toDateString());if(l!==m){var A=t.getInteger(g,u.StorageScope.GLOBAL,0)+1;if(t.store(d,l,u.StorageScope.GLOBAL),t.store(g,A,u.StorageScope.GLOBAL),!(A<9)){var _=t.getBoolean(y,u.StorageScope.GLOBAL,!1)||Math.random()<S;if(t.store(y,_,u.StorageScope.GLOBAL),!_)return void t.store(L,f["default"].version,u.StorageScope.GLOBAL);var O=o.localize("surveyQuestion","Do you mind taking a quick feedback survey?"),h=new a.Action("nps.takeSurvey",o.localize("takeSurvey","Take Survey"),"",(!0),function(){return i.getTelemetryInfo().then(function(e){r.shell.openExternal(v["default"].npsSurveyUrl+"?o="+encodeURIComponent(process.platform)+"&v="+encodeURIComponent(f["default"].version)+"&m="+encodeURIComponent(e.machineId)),t.store(y,!1,u.StorageScope.GLOBAL),t.store(L,f["default"].version,u.StorageScope.GLOBAL)})}),B=new a.Action("nps.later",o.localize("remindLater","Remind Me later"),"",(!0),function(){return t.store(g,A-3,u.StorageScope.GLOBAL),n.TPromise.as(null)}),b=new a.Action("nps.never",o.localize("neverAgain","Never Show Again"),"",(!0),function(){return t.store(y,!1,u.StorageScope.GLOBAL),t.store(L,f["default"].version,u.StorageScope.GLOBAL),n.TPromise.as(null)}),G=[h,B,b];setTimeout(function(){return s.show(p.Severity.Info,{message:O,actions:G})})}}}}return e.prototype.getId=function(){return"nps"},e=__decorate([__param(0,l.IInstantiationService),__param(1,u.IStorageService),__param(2,p.IMessageService),__param(3,m.ITelemetryService)],e)}();if("en"===s.language&&v["default"].npsSurveyUrl){var _=c.Registry.as(i.Extensions.Workbench);_.registerWorkbenchContribution(A)}});