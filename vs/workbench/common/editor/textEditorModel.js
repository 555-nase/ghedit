var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,d=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(d=(n<3?i(d):n>3?i(t,o,d):i(t,o))||d);return n>3&&d&&Object.defineProperty(t,o,d),d},__param=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};define(["require","exports","vs/base/common/winjs.base","vs/editor/common/editorCommon","vs/workbench/common/editor","vs/editor/common/services/modeService","vs/editor/common/services/modelService","vs/editor/common/model/textModel"],function(e,t,o,r,i,n,d,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var l=function(e){function t(t,o,r){var i=this;if(e.call(this),this.modelService=t,this.modeService=o,this.textEditorModelHandle=r,r){var n=t.getModel(r);if(!n)throw new Error("Document with resource "+r.toString()+" does not exist");var d=n.onWillDispose(function(){i.textEditorModelHandle=null,d.dispose(),i.dispose()})}}return __extends(t,e),Object.defineProperty(t.prototype,"textEditorModel",{get:function(){return this.textEditorModelHandle?this.modelService.getModel(this.textEditorModelHandle):null},enumerable:!0,configurable:!0}),t.prototype.createTextEditorModel=function(e,t,r){var i=this,n=this.getFirstLineText(e),d=this.getOrCreateMode(this.modeService,r,n);return o.TPromise.any([o.TPromise.timeout(50),d]).then(function(){return i.doCreateTextEditorModel(e,d,t)})},t.prototype.doCreateTextEditorModel=function(e,t,o){var r=o&&this.modelService.getModel(o);return r?("string"==typeof e?r.setValue(e):r.setValueFromRawText(e),r.setMode(t)):(r=this.modelService.createModel(e,t,o),this.createdEditorModel=!0),this.textEditorModelHandle=r.uri,this},t.prototype.getFirstLineText=function(e){if("string"==typeof e){var t=e.substr(0,100),o=t.indexOf("\r");o<0&&(o=t.length);var r=t.indexOf("\n");return r<0&&(r=t.length),t.substr(0,Math.min(o,r))}return e.lines[0].substr(0,100)},t.prototype.getOrCreateMode=function(e,t,o){return e.getOrCreateMode(t)},t.prototype.updateTextEditorModel=function(e){if(this.textEditorModel){var t;t="string"==typeof e?s.RawText.fromStringWithModelOptions(e,this.textEditorModel):e,this.textEditorModel.equals(t)||this.textEditorModel.setValueFromRawText(t)}},t.prototype.getValue=function(){var e=this.textEditorModel;return e?e.getValue(r.EndOfLinePreference.TextDefined,!0):null},t.prototype.dispose=function(){this.textEditorModelHandle&&this.createdEditorModel&&this.modelService.destroyModel(this.textEditorModelHandle),this.textEditorModelHandle=null,this.createdEditorModel=!1,e.prototype.dispose.call(this)},t.prototype.isResolved=function(){return!!this.textEditorModelHandle},t=__decorate([__param(0,d.IModelService),__param(1,n.IModeService)],t)}(i.EditorModel);t.BaseTextEditorModel=l});