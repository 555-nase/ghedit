var __decorate=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(s=(a<3?n(s):a>3?n(t,o,s):n(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};define(["require","exports","vs/base/common/types","vs/base/common/errors","vs/base/common/strings","vs/platform/storage/common/storage","vs/platform/workspace/common/workspace"],function(e,t,o,r,n,a,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var i=function(){function e(e,t,r){var n=r.getWorkspace();this.globalStorage=e,this.workspaceStorage=t||e,this.workspaceKey=this.getWorkspaceKey(n);var a=n?n.uid:null;o.isNumber(a)&&this.cleanupWorkspaceScope(a,n.name)}return e.prototype.getWorkspaceKey=function(t){var o=null;return t&&t.resource&&(o=t.resource.toString()),o?this.calculateWorkspaceKey(o):e.NO_WORKSPACE_IDENTIFIER},e.prototype.calculateWorkspaceKey=function(e){var t="file:///",o=e.indexOf(t);return 0===o?n.rtrim(e.substr(t.length),"/")+"/":e},e.prototype.cleanupWorkspaceScope=function(t,r){var n=this,s=this.getInteger(e.WORKSPACE_IDENTIFIER,a.StorageScope.WORKSPACE);if(o.isNumber(s)&&t!==s){for(var i=this.toStorageKey("",a.StorageScope.WORKSPACE),c=[],p=this.workspaceStorage.length,g=0;g<p;g++){var l=this.workspaceStorage.key(g);l.indexOf(e.WORKSPACE_PREFIX)<0||0===l.indexOf(i)&&c.push(l)}c.length>0&&console.warn("Clearing previous version of local storage for workspace ",r),c.forEach(function(e){n.workspaceStorage.removeItem(e)})}t!==s&&this.store(e.WORKSPACE_IDENTIFIER,t,a.StorageScope.WORKSPACE)},e.prototype.clear=function(){this.globalStorage.clear(),this.workspaceStorage.clear()},e.prototype.store=function(e,t,n){void 0===n&&(n=a.StorageScope.GLOBAL);var s=n===a.StorageScope.GLOBAL?this.globalStorage:this.workspaceStorage;if(o.isUndefinedOrNull(t))return void this.remove(e,n);var i=this.toStorageKey(e,n);try{s.setItem(i,t)}catch(c){r.onUnexpectedError(c)}},e.prototype.get=function(e,t,r){void 0===t&&(t=a.StorageScope.GLOBAL);var n=t===a.StorageScope.GLOBAL?this.globalStorage:this.workspaceStorage,s=n.getItem(this.toStorageKey(e,t));return o.isUndefinedOrNull(s)?r:s},e.prototype.remove=function(e,t){void 0===t&&(t=a.StorageScope.GLOBAL);var o=t===a.StorageScope.GLOBAL?this.globalStorage:this.workspaceStorage,r=this.toStorageKey(e,t);o.removeItem(r)},e.prototype.swap=function(e,t,r,n,s){void 0===n&&(n=a.StorageScope.GLOBAL);var i=this.get(e,n);o.isUndefinedOrNull(i)&&s?this.store(e,s,n):i===t.toString()?this.store(e,r,n):this.store(e,t,n)},e.prototype.getInteger=function(e,t,r){void 0===t&&(t=a.StorageScope.GLOBAL);var n=this.get(e,t,r);return o.isUndefinedOrNull(n)?r:parseInt(n,10)},e.prototype.getBoolean=function(e,t,r){void 0===t&&(t=a.StorageScope.GLOBAL);var n=this.get(e,t,r);return o.isUndefinedOrNull(n)?r:o.isString(n)?"true"===n.toLowerCase():!!n},e.prototype.toStorageKey=function(t,o){return o===a.StorageScope.GLOBAL?e.GLOBAL_PREFIX+t.toLowerCase():e.WORKSPACE_PREFIX+this.workspaceKey+t.toLowerCase()},e.COMMON_PREFIX="storage://",e.GLOBAL_PREFIX=e.COMMON_PREFIX+"global/",e.WORKSPACE_PREFIX=e.COMMON_PREFIX+"workspace/",e.WORKSPACE_IDENTIFIER="workspaceIdentifier",e.NO_WORKSPACE_IDENTIFIER="__$noWorkspace__",e=__decorate([__param(2,s.IWorkspaceContextService)],e)}();t.Storage=i;var c=function(){function e(){this.store={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.store).length},enumerable:!0,configurable:!0}),e.prototype.key=function(e){var t=Object.keys(this.store);return t.length>e?t[e]:null},e.prototype.clear=function(){this.store={}},e.prototype.setItem=function(e,t){this.store[e]=t.toString()},e.prototype.getItem=function(e){var t=this.store[e];return o.isUndefinedOrNull(t)?null:t},e.prototype.removeItem=function(e){delete this.store[e]},e}();t.InMemoryLocalStorage=c,t.inMemoryLocalStorageInstance=new c});