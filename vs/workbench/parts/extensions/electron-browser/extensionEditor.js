/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/common/marked/marked","vs/base/common/errors","vs/base/common/lifecycle","vs/base/browser/dom","vs/workbench/browser/parts/editor/baseEditor","vs/workbench/services/viewlet/common/viewletService","vs/platform/telemetry/common/telemetry","vs/platform/instantiation/common/instantiation","vs/platform/request/common/request","vs/platform/extensionManagement/common/extensionManagement","vs/workbench/services/themes/common/themeService","./extensions","vs/platform/configuration/common/configuration","./extensionsWidgets","electron","vs/platform/product","vs/base/browser/ui/actionbar/actionbar","./extensionsActions","vs/workbench/parts/html/browser/webview","vs/workbench/services/editor/common/editorService","vs/css!./media/extensionEditor"],function(e,t,n,i,s,r,o,a,c,l,h,p,m,u,d,v,b,f,y,g,x,_,S,w){"use strict";function I(t){return'<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<meta http-equiv="Content-type" content="text/html;charset=UTF-8">\n\t\t\t\t<link rel="stylesheet" type="text/css" href="'+e.toUrl("./media/markdown.css")+'" >\n\t\t\t</head>\n\t\t\t<body>'+t+"</body>\n\t\t</html>"}var E=function(e){function t(n,i,s,r,a,c,l,h,p){e.call(this,t.ID,n),this.galleryService=i,this.configurationService=s,this.instantiationService=r,this.requestService=a,this.viewletService=c,this.extensionsWorkbenchService=l,this.themeService=h,this.editorService=p,this._highlight=null,this.highlightDisposable=o.empty,this.disposables=[],c.onDidActiveViewletChange(this.onActiveViewletChange,this,this.disposables)}return __extends(t,e),t.prototype.createEditor=function(e){var t=e.getHTMLElement(),i=a.append(t,a.emmet(".extension-editor")),s=a.append(i,a.emmet(".header"));this.icon=a.append(s,a.emmet(".icon"));var r=a.append(s,a.emmet(".details")),o=a.append(r,a.emmet(".title"));this.name=a.append(o,a.emmet("a.name")),this.name.href="#";var c=a.append(r,a.emmet(".subtitle"));this.publisher=a.append(c,a.emmet("a.publisher")),this.publisher.href="#",this.installCount=a.append(c,a.emmet("span.install")),this.rating=a.append(c,a.emmet("a.rating")),this.rating.href="#",this.license=a.append(c,a.emmet("a.license")),this.license.href="#",this.license.textContent=n.localize("license","License"),this.description=a.append(r,a.emmet(".description"));var l=a.append(r,a.emmet(".actions"));this.actionBar=new x.ActionBar(l,{animated:!1}),this.disposables.push(this.actionBar),this.body=a.append(i,a.emmet(".body"))},t.prototype.setInput=function(t,r){var c=this;this.transientDisposables=o.dispose(this.transientDisposables);var l=t.extension;if(this.icon.style.backgroundImage='url("'+l.iconUrl+'")',this.name.textContent=l.displayName,this.publisher.textContent=l.publisherDisplayName,this.description.textContent=l.description,g["default"].extensionsGallery){var h=g["default"].extensionsGallery.itemUrl+"?itemName="+l.publisher+"."+l.name,p=g["default"].extensionsGallery.itemUrl+"/"+l.publisher+"."+l.name+"/license";this.name.onclick=a.finalHandler(function(){return y.shell.openExternal(h)}),this.license.onclick=a.finalHandler(function(){return y.shell.openExternal(p)}),this.rating.onclick=a.finalHandler(function(){return y.shell.openExternal(h+"#review-details")}),this.publisher.onclick=a.finalHandler(function(){c.viewletService.openViewlet(v.VIEWLET_ID,!0).then(function(e){return e}).done(function(e){return e.search('publisher:"'+l.publisherDisplayName+'"',!0)})})}var m=this.instantiationService.createInstance(f.InstallWidget,this.installCount,{extension:l});this.transientDisposables.push(m);var u=this.instantiationService.createInstance(f.RatingsWidget,this.rating,{extension:l});this.transientDisposables.push(u);var d=this.instantiationService.createInstance(_.CombinedInstallAction),b=this.instantiationService.createInstance(_.UpdateAction),x=this.instantiationService.createInstance(_.EnableAction);d.extension=l,b.extension=l,x.extension=l,this.actionBar.clear(),this.actionBar.push([x,b,d],{icon:!0,label:!0}),this.transientDisposables.push(x,b,d),this.body.innerHTML="";var w=e.prototype.setInput.call(this,t,r);return w=l.readmeUrl?w.then(function(){return a.addClass(c.body,"loading")}).then(function(){return c.requestService.makeRequest({url:l.readmeUrl})}).then(function(e){return e.responseText}).then(s.marked.parse).then(function(e){var t=new S["default"](c.body,document.querySelector(".monaco-editor-background"),function(e){return y.shell.openExternal(e.toString())});t.style(c.themeService.getTheme()),t.contents=[I(e)];var n=c.themeService.onDidThemeChange(function(e){return t.style(e)});c.transientDisposables.push(t,n)}).then(null,function(){return null}).then(function(){return a.removeClass(c.body,"loading")}):w.then(function(){return a.append(c.body,a.emmet("p"))}).then(function(e){return e.textContent=n.localize("noReadme","No README available.")}),this.transientDisposables.push(o.toDisposable(function(){return w.cancel()})),i.TPromise.as(null)},t.prototype.layout=function(){},t.prototype.onActiveViewletChange=function(e){e&&e.getId()!==v.VIEWLET_ID&&this.editorService.closeEditor(this.position,this.input).done(null,r.onUnexpectedError)},t.prototype.dispose=function(){this._highlight=null,this.transientDisposables=o.dispose(this.transientDisposables),this.disposables=o.dispose(this.disposables),e.prototype.dispose.call(this)},t.ID="workbench.editor.extension",t=__decorate([__param(0,h.ITelemetryService),__param(1,u.IExtensionGalleryService),__param(2,b.IConfigurationService),__param(3,p.IInstantiationService),__param(4,m.IRequestService),__param(5,l.IViewletService),__param(6,v.IExtensionsWorkbenchService),__param(7,d.IThemeService),__param(8,w.IWorkbenchEditorService)],t)}(c.BaseEditor);t.ExtensionEditor=E});