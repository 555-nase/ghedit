var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/common/types","vs/base/common/errors","vs/base/parts/quickopen/common/quickOpen","vs/base/parts/quickopen/browser/quickOpenModel","vs/base/common/keyCodes","vs/workbench/browser/quickopen","vs/workbench/common/editor","vs/workbench/browser/parts/editor/textEditor","vs/editor/common/editorCommon","vs/workbench/services/editor/common/editorService","vs/workbench/services/quickopen/common/quickOpenService"],function(e,t,i,o,n,r,a,c,s,l,u,h,d,p,g){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";t.GOTO_LINE_PREFIX=":";var v=function(e){function i(i,o,n){e.call(this,i,o,t.GOTO_LINE_PREFIX,n)}return __extends(i,e),i.ID="workbench.action.gotoLine",i.LABEL=o.localize("gotoLine","Go to Line..."),i=__decorate([__param(2,g.IQuickOpenService)],i)}(l.QuickOpenAction);t.GotoLineAction=v;var f=function(e){function t(t,i,o){e.call(this,i),this.parseInput(t),this.handler=o}return __extends(t,e),t.prototype.parseInput=function(e){var t=e.split(/,|:|#/).map(function(e){return parseInt(e,10)}).filter(function(e){return!isNaN(e)});this.line=t[0],this.column=t[1]},t.prototype.getLabel=function(){var e=this.getMaxLineNumber();return this.invalidRange(e)?e>0?o.localize("gotoLineLabelEmptyWithLimit","Type a line number between 1 and {0} to navigate to",e):o.localize("gotoLineLabelEmpty","Type a line number to navigate to"):this.column?o.localize("gotoLineColumnLabel","Go to line {0} and column {1}",this.line,this.column):o.localize("gotoLineLabel","Go to line {0}",this.line)},t.prototype.invalidRange=function(e){return void 0===e&&(e=this.getMaxLineNumber()),!this.line||!n.isNumber(this.line)||e>0&&n.isNumber(this.line)&&this.line>e},t.prototype.getMaxLineNumber=function(){var e=this.editorService.getActiveEditor(),t=e.getControl(),i=t.getModel();return i&&i.modified&&i.original&&(i=i.modified),i&&n.isFunction(i.getLineCount)?i.getLineCount():-1},t.prototype.run=function(e,t){return e===a.Mode.OPEN?this.runOpen(t):this.runPreview()},t.prototype.getInput=function(){return this.editorService.getActiveEditorInput()},t.prototype.getOptions=function(){var e=this.toSelection(),t=new u.TextEditorOptions;return t.selection(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn),t},t.prototype.runOpen=function(e){if(this.invalidRange())return!1;var t=e.keymods.indexOf(s.KeyMod.CtrlCmd)>=0;t&&this.editorService.openEditor(this.getInput(),this.getOptions(),!0).done(null,r.onUnexpectedError);var i=this.toSelection(),o=this.editorService.getActiveEditor();if(o){var n=o.getControl();n.setSelection(i),n.revealRangeInCenter(i)}return!0},t.prototype.runPreview=function(){if(this.invalidRange())return this.handler.clearDecorations(),!1;var e=this.toSelection(),t=this.editorService.getActiveEditor();if(t){var i=t.getControl();i.revealRangeInCenter(e),n.isFunction(i.changeDecorations)&&this.handler.decorateOutline(e,i,t.position)}return!1},t.prototype.toSelection=function(){return{startLineNumber:this.line,startColumn:this.column||1,endLineNumber:this.line,endColumn:this.column||1}},t}(l.EditorQuickOpenEntry),m=function(e){function t(t){e.call(this),this.editorService=t}return __extends(t,e),t.prototype.getAriaLabel=function(){return o.localize("gotoLineHandlerAriaLabel","Type a line number to navigate to.")},t.prototype.getResults=function(e){if(e=e.trim(),!this.lastKnownEditorViewState){var t=this.editorService.getActiveEditor();this.lastKnownEditorViewState=t.getControl().saveViewState()}return i.TPromise.as(new c.QuickOpenModel([new f(e,this.editorService,this)]))},t.prototype.canRun=function(){var e=this.editorService.getActiveEditor()instanceof h.BaseTextEditor;return!!e||o.localize("cannotRunGotoLine","Open a text file first to go to a line")},t.prototype.decorateOutline=function(e,t,i){var o=this;t.changeDecorations(function(t){var n=[];o.lineHighlightDecorationId&&(n.push(o.lineHighlightDecorationId.lineDecorationId),n.push(o.lineHighlightDecorationId.lineHighlightId),o.lineHighlightDecorationId=null);var r=[{range:e,options:{className:"lineHighlight",isWholeLine:!0}},{range:e,options:{overviewRuler:{color:"rgba(0, 122, 204, 0.6)",darkColor:"rgba(0, 122, 204, 0.6)",position:d.OverviewRulerLane.Full}}}],a=t.deltaDecorations(n,r),c=a[0],s=a[1];o.lineHighlightDecorationId={lineHighlightId:c,lineDecorationId:s,position:i}})},t.prototype.clearDecorations=function(){var e=this;this.lineHighlightDecorationId&&(this.editorService.getVisibleEditors().forEach(function(t){if(t.position===e.lineHighlightDecorationId.position){var i=t.getControl();i.changeDecorations(function(t){t.deltaDecorations([e.lineHighlightDecorationId.lineDecorationId,e.lineHighlightDecorationId.lineHighlightId],[])})}}),this.lineHighlightDecorationId=null)},t.prototype.onClose=function(e){if(this.clearDecorations(),e&&this.lastKnownEditorViewState){var t=this.editorService.getActiveEditor();if(t){var i=t.getControl();i.restoreViewState(this.lastKnownEditorViewState)}}this.lastKnownEditorViewState=null},t.prototype.getAutoFocus=function(e){return{autoFocusFirstEntry:e.trim().length>0}},t=__decorate([__param(0,p.IWorkbenchEditorService)],t)}(l.QuickOpenHandler);t.GotoLineHandler=m});