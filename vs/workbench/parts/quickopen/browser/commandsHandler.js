/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/common/arrays","vs/base/common/types","vs/base/common/platform","vs/base/common/errors","vs/base/parts/quickopen/common/quickOpen","vs/base/parts/quickopen/browser/quickOpenModel","vs/platform/actions/common/actions","vs/workbench/common/actionRegistry","vs/platform/platform","vs/workbench/browser/quickopen","vs/base/common/filters","vs/workbench/services/editor/common/editorService","vs/platform/instantiation/common/instantiation","vs/platform/message/common/message","vs/platform/telemetry/common/telemetry","vs/platform/keybinding/common/keybinding","vs/workbench/services/quickopen/common/quickOpenService","vs/css!./media/commandsHandler"],function(e,t,n,i,r,o,a,c,s,l,u,m,p,h,d,v,g,f,b,_,y){"use strict";t.ALL_COMMANDS_PREFIX=">",t.EDITOR_COMMANDS_PREFIX="$";var S=d.or(d.matchesPrefix,d.matchesWords,d.matchesContiguousSubString),k=function(e){function n(n,i,r){e.call(this,n,i,t.ALL_COMMANDS_PREFIX,r)}return __extends(n,e),n.ID="workbench.action.showCommands",n.LABEL=i.localize("showTriggerActions","Show All Commands"),n=__decorate([__param(2,y.IQuickOpenService)],n)}(h.QuickOpenAction);t.ShowAllCommandsAction=k;var A=function(e){function t(t,n,i,r,o,a,c,s){e.call(this),this.messageService=c,this.telemetryService=s,this.keyLabel=t,this.keyAriaLabel=n,this.label=i,i!==r?this.alias=r:a=null,this.setHighlights(o,null,a)}return __extends(t,e),t.prototype.getLabel=function(){return this.label},t.prototype.getDetail=function(){return this.alias},t.prototype.getAriaLabel=function(){return this.keyAriaLabel?i.localize("entryAriaLabelWithKey","{0}, {1}, commands",this.getLabel(),this.keyAriaLabel):i.localize("entryAriaLabel","{0}, commands",this.getLabel())},t.prototype.getGroupLabel=function(){return this.keyLabel},t.prototype.onError=function(e){var t,n=e;t=n&&"string"==typeof n.message&&Array.isArray(n.actions)?n:e?c.toErrorMessage(e):i.localize("canNotRun","Command '{0}' can not be run from here.",this.label),this.messageService.show(f.Severity.Error,t)},t.prototype.runAction=function(e){var t=this;n.TPromise.timeout(50).done(function(){if(e&&e.enabled)try{t.telemetryService.publicLog("workbenchActionExecuted",{id:e.id,from:"quick open"}),(e.run()||n.TPromise.as(null)).done(function(){e.dispose()},function(e){return t.onError(e)})}catch(r){t.onError(r)}else t.messageService.show(f.Severity.Info,i.localize("actionNotEnabled","Command '{0}' is not enabled in the current context.",t.getLabel()))},function(e){return t.onError(e)})},t=__decorate([__param(6,f.IMessageService),__param(7,b.ITelemetryService)],t)}(l.QuickOpenEntryGroup),L=function(e){function t(t,n,i,r,o,a,c,s,l,u,m){e.call(this,t,n,i,r,o,a,u,m),this.editorService=s,this.instantiationService=l,this.actionDescriptor=c}return __extends(t,e),t.prototype.run=function(e,t){if(e===s.Mode.OPEN){var n=this.instantiationService.createInstance(this.actionDescriptor.syncDescriptor);return this.runAction(n),!0}return!1},t=__decorate([__param(7,v.IWorkbenchEditorService),__param(8,g.IInstantiationService),__param(9,f.IMessageService),__param(10,b.ITelemetryService)],t)}(A),E=function(e){function t(t,n,i,r,o,a,c,s,l,u){e.call(this,t,n,i,r,o,a,l,u),this.editorService=s,this.action=c}return __extends(t,e),t.prototype.run=function(e,t){return e===s.Mode.OPEN&&(this.runAction(this.action),!0)},t=__decorate([__param(7,v.IWorkbenchEditorService),__param(8,f.IMessageService),__param(9,b.ITelemetryService)],t)}(A),I=function(e){function t(t,n,i,r,o,a,c,s,l){e.call(this,t,n,i,r,o,a,s,l),this.action=c}return __extends(t,e),t.prototype.run=function(e,t){return e===s.Mode.OPEN&&(this.runAction(this.action),!0)},t=__decorate([__param(7,f.IMessageService),__param(8,b.ITelemetryService)],t)}(A),C=function(e){function t(t,n,i,r,o){e.call(this),this.editorService=t,this.instantiationService=n,this.messageService=i,this.keybindingService=r,this.menuService=o}return __extends(t,e),t.prototype.includeWorkbenchCommands=function(){return!0},t.prototype.getResults=function(e){var t=this;e=e.trim();var a=[];if(this.includeWorkbenchCommands()){var c=p.Registry.as(m.Extensions.WorkbenchActions).getWorkbenchActions();a=this.actionDescriptorsToEntries(c,e)}var s=this.editorService.getActiveEditor(),h=s?s.getControl():null,d=[];h&&o.isFunction(h.getActions)&&(d=h.getActions());var v=this.editorActionsToEntries(d,e),g=this.menuService.getCommandActions().map(function(e){return t.instantiationService.createInstance(u.ExecuteCommandAction,e.id,e.category?i.localize("","{0}: {1}",e.category,e.title):e.title)}),f=this.otherActionsToEntries(g,e),b=a.concat(v,f);return b=r.distinct(b,function(e){return e.getLabel()+e.getGroupLabel()}),b=b.sort(function(e,t){return e.getLabel().toLowerCase().localeCompare(t.getLabel().toLowerCase())}),n.TPromise.as(new l.QuickOpenModel(b))},t.prototype.actionDescriptorsToEntries=function(e,t){for(var n=this,r=[],o=p.Registry.as(m.Extensions.WorkbenchActions),c=0;c<e.length;c++){var s=e[c],l=this.keybindingService.lookupKeybindings(s.id),u=l.map(function(e){return n.keybindingService.getLabelFor(e)}),h=l.map(function(e){return n.keybindingService.getAriaLabelFor(e)});if(s.label){var d=s.label,v=o.getCategory(s.id);v&&(d=i.localize("commandLabel","{0}: {1}",v,d));var g=a.language!==a.LANGUAGE_DEFAULT?o.getAlias(s.id):null,f=S(t,d),b=g?S(t,g):null;(f||b)&&r.push(this.instantiationService.createInstance(L,u.length>0?u.join(", "):"",h.length>0?h.join(", "):"",d,g,f,b,s))}}return r},t.prototype.editorActionsToEntries=function(e,t){for(var n=this,i=[],r=0;r<e.length;r++){var o=e[r],c=o;if(c.isSupported()){var s=this.keybindingService.lookupKeybindings(c.id),l=s.map(function(e){return n.keybindingService.getLabelFor(e)}),u=s.map(function(e){return n.keybindingService.getAriaLabelFor(e)}),m=o.label;if(m){var p=a.language!==a.LANGUAGE_DEFAULT?o.getAlias():null,h=S(t,m),d=p?S(t,p):null;(h||d)&&i.push(this.instantiationService.createInstance(E,l.length>0?l.join(", "):"",u.length>0?u.join(", "):"",m,p,h,d,o))}}}return i},t.prototype.otherActionsToEntries=function(e,t){for(var n=this,i=[],r=0,o=e;r<o.length;r++){var a=o[r],c=this.keybindingService.lookupKeybindings(a.id),s=c.map(function(e){return n.keybindingService.getLabelFor(e)}),l=c.map(function(e){return n.keybindingService.getAriaLabelFor(e)}),u=S(t,a.label);u&&i.push(this.instantiationService.createInstance(I,s.join(", "),l.join(", "),a.label,null,u,null,a))}return i},t.prototype.getAutoFocus=function(e){return{autoFocusFirstEntry:!0,autoFocusPrefixMatch:e.trim()}},t.prototype.getClass=function(){return"commands-handler"},t.prototype.getEmptyLabel=function(e){return i.localize("noCommandsMatching","No commands matching")},t=__decorate([__param(0,v.IWorkbenchEditorService),__param(1,g.IInstantiationService),__param(2,f.IMessageService),__param(3,_.IKeybindingService),__param(4,u.IMenuService)],t)}(h.QuickOpenHandler);t.CommandsHandler=C;var w=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.includeWorkbenchCommands=function(){return!1},t}(C);t.EditorCommandsHandler=w});