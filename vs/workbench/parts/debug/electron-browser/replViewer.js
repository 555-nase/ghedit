/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i},__param=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/common/strings","vs/base/common/uri","vs/base/common/platform","vs/base/browser/ui/actionbar/actionbar","vs/base/browser/dom","vs/base/common/errors","vs/base/common/severity","vs/base/browser/mouseEvent","vs/workbench/parts/debug/common/debugModel","vs/workbench/parts/debug/electron-browser/debugViewer","vs/workbench/parts/debug/browser/debugActions","vs/workbench/parts/debug/electron-browser/electronDebugActions","vs/workbench/services/editor/common/editorService","vs/platform/workspace/common/workspace"],function(e,t,n,r,o,a,i,s,u,l,c,p,d,f,h,v,E,m){"use strict";var A=u.emmet,T=function(){function e(e){this.debugService=e}return e.prototype.getId=function(e,t){return t.getId()},e.prototype.hasChildren=function(e,t){return t instanceof d.Model||t.reference>0||t instanceof d.KeyValueOutputElement&&t.getChildren().length>0},e.prototype.getChildren=function(e,t){return t instanceof d.Model?r.TPromise.as(t.getReplElements()):t instanceof d.KeyValueOutputElement?r.TPromise.as(t.getChildren()):t instanceof d.ValueOutputElement?r.TPromise.as(null):t.getChildren(this.debugService)},e.prototype.getParent=function(e,t){return r.TPromise.as(null)},e}();t.ReplExpressionsDataSource=T;var _=function(){function e(e,t){this.editorService=e,this.contextService=t}return e.prototype.getHeight=function(e,t){return this.getHeightForString(t.value)+(t instanceof d.Expression?this.getHeightForString(t.name):0)},e.prototype.getHeightForString=function(e){if(!e||!e.length||!this.width||this.width<=0||!this.characterWidth||this.characterWidth<=0)return 18;for(var t=0,n=0;n<e.length;n++)t+=o.isFullWidthCharacter(e.charCodeAt(n))?2:1;return 18*Math.ceil(t*this.characterWidth/this.width)},e.prototype.setWidth=function(e,t){this.width=e,this.characterWidth=t},e.prototype.getTemplateId=function(t,n){return n instanceof d.Variable?e.VARIABLE_TEMPLATE_ID:n instanceof d.Expression?e.INPUT_OUTPUT_PAIR_TEMPLATE_ID:n instanceof d.ValueOutputElement?e.VALUE_OUTPUT_TEMPLATE_ID:n instanceof d.KeyValueOutputElement?e.KEY_VALUE_OUTPUT_TEMPLATE_ID:null},e.prototype.renderTemplate=function(t,n,r){if(n===e.VARIABLE_TEMPLATE_ID){var o=Object.create(null);return o.expression=u.append(r,A(".expression")),o.name=u.append(o.expression,A("span.name")),o.value=u.append(o.expression,A("span.value")),o}if(n===e.INPUT_OUTPUT_PAIR_TEMPLATE_ID){var o=Object.create(null);return u.addClass(r,"input-output-pair"),o.input=u.append(r,A(".input.expression")),o.output=u.append(r,A(".output.expression")),o.value=u.append(o.output,A("span.value")),o.annotation=u.append(o.output,A("span")),o}if(n===e.VALUE_OUTPUT_TEMPLATE_ID){var o=Object.create(null);u.addClass(r,"output");var a=u.append(r,A(".output.expression"));return o.container=r,o.counter=u.append(a,A("div.counter")),o.value=u.append(a,A("span.value")),o}if(n===e.KEY_VALUE_OUTPUT_TEMPLATE_ID){var o=Object.create(null);return u.addClass(r,"output"),o.container=r,o.expression=u.append(r,A(".output.expression")),o.key=u.append(o.expression,A("span.name")),o.value=u.append(o.expression,A("span.value")),o.annotation=u.append(o.expression,A("span")),o}},e.prototype.renderElement=function(t,n,r,o){r===e.VARIABLE_TEMPLATE_ID?f.renderVariable(t,n,o,!1):r===e.INPUT_OUTPUT_PAIR_TEMPLATE_ID?this.renderInputOutputPair(t,n,o):r===e.VALUE_OUTPUT_TEMPLATE_ID?this.renderOutputValue(n,o):r===e.KEY_VALUE_OUTPUT_TEMPLATE_ID&&this.renderOutputKeyValue(t,n,o)},e.prototype.renderInputOutputPair=function(e,t,r){r.input.textContent=t.name,f.renderExpressionValue(t,r.value,!1),t.reference>0&&(r.annotation.className="annotation octicon octicon-info",r.annotation.title=n.localize("stateCapture","Object state is captured from first evaluation"))},e.prototype.renderOutputValue=function(e,t){e.counter>1?(t.counter.textContent=String(e.counter),t.counter.className=e.severity===c["default"].Warning?"counter warn":e.severity===c["default"].Error?"counter error":"counter info"):(t.counter.textContent="",t.counter.className="counter"),u.clearNode(t.value);var n=this.handleANSIOutput(e.value);"string"==typeof n?t.value.textContent=n:t.value.appendChild(n),t.value.className=e.severity===c["default"].Warning?"warn":e.severity===c["default"].Error?"error":"info"},e.prototype.handleANSIOutput=function(e){for(var t,n,r="",o=0,a=e.length;o<a;o++)if(27===e.charCodeAt(o)){var i=o,s=++i<a?e.charAt(i):null;if(s&&"["===s){var u=null;if(s=++i<a?e.charAt(i):null,s&&s>="0"&&s<="9"&&(u=s,s=++i<a?e.charAt(i):null),s&&s>="0"&&s<="9"&&(u+=s,s=++i<a?e.charAt(i):null),null===u&&(u="0"),"m"===s){var l=parseInt(u,10),c=document.createElement("span");l>=30&&l<=37||l>=90&&l<=97?c.className="code"+l:1===l&&(c.className="code-bold"),t||(t=document.createElement("span")),r&&(this.insert(this.handleLinks(r),n||t),r=""),n=c,t.appendChild(c),o=i}}}else r+=e[o];if(r){var p=this.handleLinks(r);("string"!=typeof p||n)&&(t||(t=document.createElement("span")),this.insert(p,n||t))}return t||r},e.prototype.insert=function(e,t){"string"==typeof e?t.textContent=e:t.appendChild(e)},e.prototype.handleLinks=function(t){for(var r,o=this,s=function(e){e.lastIndex=0;var s=e.exec(t),u=null;try{u=s&&a["default"].file(s[1])}catch(l){}if(u){r=document.createElement("span");var c=t.substr(0,s.index);if(c){var d=document.createElement("span");d.textContent=c,r.appendChild(d)}var f=document.createElement("a");f.textContent=t.substr(s.index,s[0].length),f.title=i.isMacintosh?n.localize("fileLinkMac","Click to follow (Cmd + click opens to the side)"):n.localize("fileLink","Click to follow (Ctrl + click opens to the side)"),r.appendChild(f),f.onclick=function(e){return o.onLinkClick(new p.StandardMouseEvent(e),u,Number(s[3]),Number(s[4]))};var h=t.substr(s.index+s[0].length);if(h){var d=document.createElement("span");d.textContent=h,r.appendChild(d)}return"break"}},u=0,l=e.FILE_LOCATION_PATTERNS;u<l.length;u++){var c=l[u],d=s(c);if("break"===d)break}return r||t},e.prototype.onLinkClick=function(e,t,n,r){var o=window.getSelection();"Range"!==o.type&&(e.preventDefault(),this.editorService.openEditor({resource:t,options:{selection:{startLineNumber:n,startColumn:r}}},e.ctrlKey||e.metaKey).done(null,l.onUnexpectedError))},e.prototype.renderOutputKeyValue=function(e,t,n){t.key?n.key.textContent=t.key+":":n.key.textContent="",f.renderExpressionValue(t.value,n.value,!1),t.annotation?(n.annotation.className="annotation octicon octicon-info",n.annotation.title=t.annotation):(n.annotation.className="",n.annotation.title="")},e.prototype.disposeTemplate=function(e,t,n){},e.VARIABLE_TEMPLATE_ID="variable",e.INPUT_OUTPUT_PAIR_TEMPLATE_ID="inputOutputPair",e.VALUE_OUTPUT_TEMPLATE_ID="outputValue",e.KEY_VALUE_OUTPUT_TEMPLATE_ID="outputKeyValue",e.FILE_LOCATION_PATTERNS=[/((\/|[a-zA-Z]:\\)[^\(\)<>\'\"\[\]]+):(\d+):(\d+)/],e=__decorate([__param(0,E.IWorkbenchEditorService),__param(1,m.IWorkspaceContextService)],e)}();t.ReplExpressionsRenderer=_;var b=function(){function e(){}return e.prototype.getAriaLabel=function(e,t){return t instanceof d.Variable?n.localize("replVariableAriaLabel","Variable {0} has value {1}, read eval print loop, debug",t.name,t.value):t instanceof d.Expression?n.localize("replExpressionAriaLabel","Expression {0} has value {1}, read eval print loop, debug",t.name,t.value):t instanceof d.ValueOutputElement?n.localize("replValueOutputAriaLabel","{0}, read eval print loop, debug",t.value):t instanceof d.KeyValueOutputElement?n.localize("replKeyValueOutputAriaLabel","Output variable {0} has value {1}, read eval print loop, debug",t.key,t.value):null},e}();t.ReplExpressionsAccessibilityProvider=b;var g=function(){function e(e){this.instantiationService=e}return e.prototype.hasActions=function(e,t){return!1},e.prototype.getActions=function(e,t){return r.TPromise.as([])},e.prototype.hasSecondaryActions=function(e,t){return!0},e.prototype.getSecondaryActions=function(e,t){var n=[];return(t instanceof d.Variable||t instanceof d.Expression)&&(n.push(this.instantiationService.createInstance(h.AddToWatchExpressionsAction,h.AddToWatchExpressionsAction.ID,h.AddToWatchExpressionsAction.LABEL,t)),n.push(new s.Separator)),n.push(new v.CopyAction(v.CopyAction.ID,v.CopyAction.LABEL)),n.push(this.instantiationService.createInstance(h.ClearReplAction,h.ClearReplAction.ID,h.ClearReplAction.LABEL)),r.TPromise.as(n)},e.prototype.getActionItem=function(e,t,n){return null},e}();t.ReplExpressionsActionProvider=g;var y=function(e){function t(t,n,r,o,a){void 0===a&&(a=!0),e.call(this,t,n,r,a),this.replInput=o,this.lastSelectedString=null}return __extends(t,e),t.prototype.onLeftClick=function(t,n,r,o){void 0===o&&(o="mouse");var a=r;(n.reference>0||n instanceof d.KeyValueOutputElement&&n.getChildren().length>0)&&a.target.className.indexOf("input expression")===-1&&(e.prototype.onLeftClick.call(this,t,n,r,o),t.clearFocus(),t.deselect(n));var i=window.getSelection();return"Range"===i.type&&this.lastSelectedString!==i.toString()||this.replInput.focus(),this.lastSelectedString=i.toString(),!0},t.prototype.onDown=function(t,n){if(t.getFocus())return e.prototype.onDown.call(this,t,n);var r={origin:"keyboard",originalEvent:n};return t.focusLast(r),t.reveal(t.getFocus()).done(null,l.onUnexpectedError),!0},t}(f.BaseDebugController);t.ReplExpressionsController=y});