/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/common/async","vs/base/common/lifecycle","vs/base/common/platform","vs/base/common/actions","vs/base/common/keyCodes","vs/editor/common/editorCommon","vs/workbench/parts/debug/electron-browser/debugHover","vs/workbench/parts/debug/browser/debugActions","vs/workbench/parts/debug/common/debug","vs/workbench/services/workspace/common/contextService","vs/platform/instantiation/common/instantiation","vs/platform/contextview/browser/contextView"],function(e,t,o,i,n,r,s,a,c,u,d,h,p,g,v,l){"use strict";var b=300,f=function(){function e(e,t,o,i,r){var s=this;this.editor=e,this.debugService=t,this.contextService=o,this.contextMenuService=i,this.instantiationService=r,this.breakpointHintDecoration=[],this.hoverWidget=new d.DebugHoverWidget(this.editor,this.debugService,this.instantiationService),this.toDispose=[this.hoverWidget],this.showHoverScheduler=new n.RunOnceScheduler(function(){return s.showHover(s.hoverRange,s.hoveringOver,!1)},b),this.hideHoverScheduler=new n.RunOnceScheduler(function(){return s.hoverWidget.hide()},b),this.registerListeners()}return e.getDebugEditorContribution=function(e){return e.getContribution(p.EDITOR_CONTRIBUTION_ID)},e.prototype.getContextMenuActions=function(e,t,n){var r=this,s=[];return e?(s.push(this.instantiationService.createInstance(h.RemoveBreakpointAction,h.RemoveBreakpointAction.ID,h.RemoveBreakpointAction.LABEL)),s.push(this.instantiationService.createInstance(h.EditConditionalBreakpointAction,h.EditConditionalBreakpointAction.ID,h.EditConditionalBreakpointAction.LABEL,this.editor,n)),s.push(this.instantiationService.createInstance(h.ToggleEnablementAction,h.ToggleEnablementAction.ID,h.ToggleEnablementAction.LABEL))):(s.push(new a.Action("addBreakpoint",o.localize("addBreakpoint","Add Breakpoint"),null,(!0),function(){return r.debugService.addBreakpoints([{uri:t,lineNumber:n}])})),s.push(this.instantiationService.createInstance(h.AddConditionalBreakpointAction,h.AddConditionalBreakpointAction.ID,h.AddConditionalBreakpointAction.LABEL,this.editor,n))),i.TPromise.as(s)},e.prototype.registerListeners=function(){var e=this;this.toDispose.push(this.editor.onMouseDown(function(t){if(t.target.type===u.MouseTargetType.GUTTER_GLYPH_MARGIN&&!t.target.detail&&e.debugService.getConfigurationManager().canSetBreakpointsIn(e.editor.getModel())){var o=t.target.position.lineNumber,i=e.editor.getModel().uri;if(t.event.rightButton||s.isMacintosh&&t.event.leftButton&&t.event.ctrlKey){var n={x:t.event.posx+1,y:t.event.posy},r=e.debugService.getModel().getBreakpoints().filter(function(e){return e.lineNumber===o&&e.source.uri.toString()===i.toString()}).pop();e.contextMenuService.showContextMenu({getAnchor:function(){return n},getActions:function(){return e.getContextMenuActions(r,i,o)},getActionsContext:function(){return r}})}else{var a=e.debugService.getModel().getBreakpoints().filter(function(e){return e.source.uri.toString()===i.toString()&&e.lineNumber===o}).pop();a?e.debugService.removeBreakpoints(a.getId()):e.debugService.addBreakpoints([{uri:i,lineNumber:o}])}}})),this.toDispose.push(this.editor.onMouseMove(function(t){var o=-1;t.target.type===u.MouseTargetType.GUTTER_GLYPH_MARGIN&&e.debugService.getConfigurationManager().canSetBreakpointsIn(e.editor.getModel())&&(t.target.detail||(o=t.target.position.lineNumber)),e.ensureBreakpointHintDecoration(o)})),this.toDispose.push(this.editor.onMouseLeave(function(t){e.ensureBreakpointHintDecoration(-1)})),this.toDispose.push(this.debugService.onDidChangeState(function(t){return e.onDebugStateUpdate(t)})),this.toDispose.push(this.editor.onMouseDown(function(t){return e.onEditorMouseDown(t)})),this.toDispose.push(this.editor.onMouseMove(function(t){return e.onEditorMouseMove(t)})),this.toDispose.push(this.editor.onMouseLeave(function(t){var o=e.hoverWidget.getDomNode().getBoundingClientRect();(t.event.posx<o.left||t.event.posx>o.right||t.event.posy<o.top||t.event.posy>o.bottom)&&e.hideHoverWidget()})),this.toDispose.push(this.editor.onKeyDown(function(t){return e.onKeyDown(t)})),this.toDispose.push(this.editor.onDidChangeModel(function(){return e.hideHoverWidget()})),this.toDispose.push(this.editor.onDidScrollChange(function(){return e.hideHoverWidget}))},e.prototype.getId=function(){return p.EDITOR_CONTRIBUTION_ID},e.prototype.showHover=function(e,t,o){return this.hoverWidget.showAt(e,t,o)},e.prototype.ensureBreakpointHintDecoration=function(t){var o=[];t!==-1&&o.push({options:e.BREAKPOINT_HELPER_DECORATION,range:{startLineNumber:t,startColumn:1,endLineNumber:t,endColumn:1}}),this.breakpointHintDecoration=this.editor.deltaDecorations(this.breakpointHintDecoration,o)},e.prototype.onDebugStateUpdate=function(e){e!==p.State.Stopped&&this.hideHoverWidget(),this.contextService.updateOptions("editor",{hover:e!==p.State.Stopped})},e.prototype.hideHoverWidget=function(){!this.hideHoverScheduler.isScheduled()&&this.hoverWidget.isVisible&&this.hideHoverScheduler.schedule(),this.showHoverScheduler.cancel(),this.hoveringOver=null},e.prototype.onEditorMouseDown=function(e){e.target.type===u.MouseTargetType.CONTENT_WIDGET&&e.target.detail===d.DebugHoverWidget.ID||this.hideHoverWidget()},e.prototype.onEditorMouseMove=function(e){if(this.debugService.state===p.State.Stopped){var t=e.target.type,o=s.isMacintosh?"metaKey":"ctrlKey";if(t!==u.MouseTargetType.CONTENT_WIDGET||e.target.detail!==d.DebugHoverWidget.ID||e.event[o])if(t===u.MouseTargetType.CONTENT_TEXT){var i=this.editor.getModel().getWordAtPosition(e.target.range.getStartPosition());i&&this.hoveringOver!==i.word&&(this.hoverRange=e.target.range,this.hoveringOver=i.word,this.showHoverScheduler.schedule())}else this.hideHoverWidget()}},e.prototype.onKeyDown=function(e){var t=s.isMacintosh?c.KeyCode.Meta:c.KeyCode.Ctrl;e.keyCode!==t&&this.hideHoverWidget()},e.prototype.dispose=function(){this.toDispose=r.dispose(this.toDispose)},e.BREAKPOINT_HELPER_DECORATION={glyphMarginClassName:"debug-breakpoint-hint-glyph",stickiness:u.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges},e=__decorate([__param(1,p.IDebugService),__param(2,g.IWorkspaceContextService),__param(3,l.IContextMenuService),__param(4,v.IInstantiationService)],e)}();t.DebugEditorContribution=f});