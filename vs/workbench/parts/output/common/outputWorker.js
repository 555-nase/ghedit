var __decorate=this&&this.__decorate||function(e,r,t,n){var s,o=arguments.length,i=o<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(o<3?s(i):o>3?s(r,t,i):s(r,t))||i);return o>3&&i&&Object.defineProperty(r,t,i),i},__param=this&&this.__param||function(e,r){return function(t,n){r(t,n,e)}};define(["require","exports","vs/base/common/winjs.base","vs/editor/common/services/resourceService","vs/base/common/uri","vs/base/common/strings","vs/base/common/arrays","vs/base/common/paths","vs/editor/common/core/range"],function(e,r,t,n,s,o,i,a,c){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var u=function(){function e(e,r){this._modeId=e,this.resourceService=r,this._workspaceResource=null,this.patterns=[]}return e.prototype.configure=function(r){return this._workspaceResource=r,this.patterns=e.createPatterns(this._workspaceResource),t.TPromise.as(void 0)},e.prototype.provideLinks=function(r){var n=this,o=[];if(!this.patterns.length)return t.TPromise.as(o);for(var i=this.resourceService.get(r),c={toResource:function(e){return"string"==typeof e&&n._workspaceResource?s["default"].file(a.join(n._workspaceResource.fsPath,e)):null}},u=1,p=i.getLineCount();u<=p;u++)o.push.apply(o,e.detectLinks(i.getLineContent(u),u,this.patterns,c));return t.TPromise.as(o)},e.createPatterns=function(e){var r=[],t=i.distinct([a.normalize(e.fsPath,!0),a.normalize(e.fsPath,!1)]);return t.forEach(function(e){r.push(new RegExp(o.escapeRegExpCharacters(e)+"(\\S*) on line ((\\d+)(, column (\\d+))?)","gi")),r.push(new RegExp(o.escapeRegExpCharacters(e)+"(\\S*):line ((\\d+)(, column (\\d+))?)","gi")),r.push(new RegExp(o.escapeRegExpCharacters(e)+"([^\\s\\(\\)]*)(\\s?\\((\\d+)(,(\\d+))?)\\)","gi")),r.push(new RegExp(o.escapeRegExpCharacters(e)+"([^:\\s\\(\\)<>'\"\\[\\]]*)(:(\\d+))?(:(\\d+))?","gi"))}),r},e.detectLinks=function(e,r,t,n){var s=[];return t.forEach(function(t){t.lastIndex=0;for(var i,a=0;null!==(i=t.exec(e));){var u=o.rtrim(i[1],".").replace(/\\/g,"/"),p=void 0;try{p=n.toResource(u).toString()}catch(f){continue}if(i[3]){var h=i[3];if(i[5]){var m=i[5];p=o.format("{0}#{1},{2}",p,h,m)}else p=o.format("{0}#{1}",p,h)}var g=o.rtrim(i[0],"."),l=e.indexOf(g,a);a+=l+g.length;var d={startColumn:l+1,startLineNumber:r,endColumn:l+1+g.length,endLineNumber:r};if(s.some(function(e){return c.Range.areIntersectingOrTouching(e.range,d)}))return;s.push({range:d,url:p})}}),s},e=__decorate([__param(1,n.IResourceService)],e)}();r.OutputWorker=u});