/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,u=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(u=(o<3?i(u):o>3?i(e,n,u):i(e,n))||u);return o>3&&u&&Object.defineProperty(e,n,u),u},__param=this&&this.__param||function(t,e){return function(n,r){e(n,r,t)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/strings","vs/base/common/event","vs/platform/event/common/event","vs/platform/lifecycle/common/lifecycle","vs/platform/instantiation/common/instantiation","vs/platform/storage/common/storage","vs/platform/platform","vs/workbench/common/editor","vs/workbench/parts/output/common/output","vs/workbench/parts/output/browser/outputEditorInput","vs/workbench/services/panel/common/panelService"],function(t,e,n,r,i,o,u,c,a,s,p,h,l,v){"use strict";var f="output.activechannel",O=function(){function t(t,e,n,r,o){this.storageService=t,this.instantiationService=e,this.eventService=n,this.lifecycleService=r,this.panelService=o,this._onOutput=new i.Emitter,this._onOutputChannel=new i.Emitter,this._onActiveOutputChannel=new i.Emitter,this.receivedOutput=Object.create(null);var u=s.Registry.as(h.Extensions.OutputChannels).getChannels();this.activeChannelId=this.storageService.get(f,a.StorageScope.WORKSPACE,u&&u.length>0?u[0].id:null)}return Object.defineProperty(t.prototype,"onOutput",{get:function(){return this._onOutput.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onOutputChannel",{get:function(){return this._onOutputChannel.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActiveOutputChannel",{get:function(){return this._onActiveOutputChannel.event},enumerable:!0,configurable:!0}),t.prototype.getChannel=function(t){var e=this,n=s.Registry.as(h.Extensions.OutputChannels).getChannels().filter(function(e){return e.id===t}).pop(),r=this;return{id:t,label:n?n.label:t,get output(){return r.getOutput(t)},append:function(n){return e.append(t,n)},show:function(n){return e.showOutput(t,n)},clear:function(){return e.clearOutput(t)}}},t.prototype.append=function(t,e){this.receivedOutput[t]||(this.receivedOutput[t]="",this._onOutputChannel.fire(t)),e=r.removeAnsiEscapeCodes(e),e&&(this.receivedOutput[t]=r.appendWithLimit(this.receivedOutput[t],e,h.MAX_OUTPUT_LENGTH)),this._onOutput.fire({output:e,channelId:t})},t.prototype.getActiveChannel=function(){return this.getChannel(this.activeChannelId)},t.prototype.getOutput=function(t){return this.receivedOutput[t]||""},t.prototype.clearOutput=function(t){this.receivedOutput[t]="",this._onOutput.fire({channelId:t,output:null})},t.prototype.showOutput=function(t,e){var r=this,i=this.panelService.getActivePanel();return this.activeChannelId===t&&i&&i.getId()===h.OUTPUT_PANEL_ID?n.TPromise.as(i):(this.activeChannelId=t,this.storageService.store(f,this.activeChannelId,a.StorageScope.WORKSPACE),this._onActiveOutputChannel.fire(t),this.panelService.openPanel(h.OUTPUT_PANEL_ID,!e).then(function(n){return n&&n.setInput(l.OutputEditorInput.getInstance(r.instantiationService,r.getChannel(t)),p.EditorOptions.create({preserveFocus:e})).then(function(){return n})}))},t=__decorate([__param(0,a.IStorageService),__param(1,c.IInstantiationService),__param(2,o.IEventService),__param(3,u.ILifecycleService),__param(4,v.IPanelService)],t)}();e.OutputService=O});