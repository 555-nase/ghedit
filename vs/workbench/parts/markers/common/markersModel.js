define(["require","exports","vs/base/common/paths","vs/base/common/types","vs/base/common/map","vs/base/common/severity","vs/base/common/uri","vs/editor/common/core/range","vs/base/common/filters","vs/workbench/parts/markers/common/messages"],function(e,t,r,s,i,n,o,a,u,f){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var l=function(){function e(e,t,s,i){void 0===i&&(i=[]),this.uri=e,this.markers=t,this.statistics=s,this.matches=i,this.path=e.fsPath,this.name=r.basename(e.fsPath)}return e}();t.Resource=l;var c=function(){function e(e,t,r,s){void 0===r&&(r=[]),void 0===s&&(s=[]),this.id=e,this.marker=t,this.labelMatches=r,this.sourceMatches=s}return e}();t.Marker=c;var h=function(){function e(e){void 0===e&&(e=""),this._filterErrors=!1,this._filterWarnings=!1,this._filterInfos=!1,this._filter="",this._completeFilter="",e&&this.parse(e)}return Object.defineProperty(e.prototype,"filterErrors",{get:function(){return this._filterErrors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterWarnings",{get:function(){return this._filterWarnings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterInfos",{get:function(){return this._filterInfos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completeFilter",{get:function(){return this._completeFilter},enumerable:!0,configurable:!0}),e.prototype.hasFilters=function(){return!!this._filter},e.prototype.parse=function(e){this._completeFilter=e,this._filter=e.trim(),this._filterErrors=this.matches(this._filter,f["default"].MARKERS_PANEL_FILTER_ERRORS),this._filterWarnings=this.matches(this._filter,f["default"].MARKERS_PANEL_FILTER_WARNINGS),this._filterInfos=this.matches(this._filter,f["default"].MARKERS_PANEL_FILTER_INFOS)},e.prototype.matches=function(e,t){var r=u.matchesPrefix(e,t);return r&&r.length>0},e._filter=u.or(u.matchesPrefix,u.matchesContiguousSubString),e._fuzzyFilter=u.or(u.matchesPrefix,u.matchesContiguousSubString,u.matchesFuzzy),e}();t.FilterOptions=h;var p=function(){function e(e){void 0===e&&(e=[]),this.markersByResource=new i.SimpleMap,this._filterOptions=new h,this.update(e)}return Object.defineProperty(e.prototype,"filterOptions",{get:function(){return this._filterOptions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteredResources",{get:function(){return this._filteredResources},enumerable:!0,configurable:!0}),e.prototype.hasFilteredResources=function(){return this.filteredResources.length>0},e.prototype.hasResources=function(){return this.markersByResource.size>0},e.prototype.hasResource=function(e){return this.markersByResource.has(e)},Object.defineProperty(e.prototype,"nonFilteredResources",{get:function(){return this._nonFilteredResources},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t){e instanceof h&&(this._filterOptions=e),e instanceof o["default"]&&this.updateResource(e,t),s.isArray(e)&&this.updateMarkers(e),this.refresh()},e.prototype.refresh=function(){this.refreshResources()},e.prototype.refreshResources=function(){var e=this.markersByResource.entries().map(this.toFilteredResource.bind(this));this._nonFilteredResources=e.filter(function(e){return 0===e.markers.length}),this._filteredResources=e.filter(function(e){return e.markers.length>0}),this._filteredResources.sort(function(e,t){return 0===e.statistics.errors&&t.statistics.errors>0?1:0===t.statistics.errors&&e.statistics.errors>0?-1:e.path.localeCompare(t.path)||e.name.localeCompare(t.name)})},e.prototype.updateResource=function(e,t){this.markersByResource.has(e)&&this.markersByResource["delete"](e),t.length>0&&this.markersByResource.set(e,t)},e.prototype.updateMarkers=function(e){var t=this;e.forEach(function(e){var r=e.resource,s=t.markersByResource.get(r);s||(s=[],t.markersByResource.set(r,s)),s.push(e)})},e.prototype.toFilteredResource=function(e){var t=this,s=e.value.filter(this.filterMarker.bind(this)).map(function(e,r){return t.toMarker(e,r)});s.sort(this.compareMarkers.bind(this));var i=h._filter(this._filterOptions.filter,r.basename(e.key.fsPath));return new l(e.key,s,this.getStatistics(e.value),i||[])},e.prototype.toMarker=function(e,t){var r=h._fuzzyFilter(this._filterOptions.filter,e.message),s=e.source?h._filter(this._filterOptions.filter,e.source):[];return new c(e.resource.toString()+t,e,r||[],s||[])},e.prototype.filterMarker=function(e){return!this._filterOptions.filter||(!(!this._filterOptions.filterErrors||n["default"].Error!==e.severity)||(!(!this._filterOptions.filterWarnings||n["default"].Warning!==e.severity)||(!(!this._filterOptions.filterInfos||n["default"].Info!==e.severity)||(!!h._fuzzyFilter(this._filterOptions.filter,e.message)||(!!h._filter(this._filterOptions.filter,r.basename(e.resource.fsPath))||!(!e.source||!h._filter(this._filterOptions.filter,e.source)))))))},e.prototype.compareMarkers=function(e,t){return a.Range.compareRangesUsingStarts({startLineNumber:e.marker.startLineNumber,startColumn:e.marker.startColumn,endLineNumber:e.marker.endLineNumber,endColumn:e.marker.endColumn},{startLineNumber:t.marker.startLineNumber,startColumn:t.marker.startColumn,endLineNumber:t.marker.endLineNumber,endColumn:t.marker.endColumn})},e.prototype.getStatistics=function(e){var t=0,r=0,s=0,i=0;return e.forEach(function(e){switch(e.severity){case n["default"].Error:return void t++;case n["default"].Warning:return void r++;case n["default"].Info:return void s++;default:return void i++}}),{errors:t,warnings:r,infos:s,unknwons:i}},e.prototype.dispose=function(){this.markersByResource.clear(),this._filteredResources=[],this._nonFilteredResources=[]},e.prototype.getTitle=function(t){var r=e.getStatisticsLabel(t);return r?r:f["default"].MARKERS_PANEL_TITLE_NO_PROBLEMS},e.prototype.getMessage=function(){return this.hasFilteredResources()?"":this.hasResources()&&this._filterOptions.hasFilters()?f["default"].MARKERS_PANEL_NO_PROBLEMS_FILTERS:f["default"].MARKERS_PANEL_NO_PROBLEMS_BUILT},e.getStatisticsLabel=function(e,t){void 0===t&&(t=!1);var r=this.getLabel("",e.errors,f["default"].MARKERS_PANEL_SINGLE_ERROR_LABEL,f["default"].MARKERS_PANEL_MULTIPLE_ERRORS_LABEL);return t||(r=this.getLabel(r,e.warnings,f["default"].MARKERS_PANEL_SINGLE_WARNING_LABEL,f["default"].MARKERS_PANEL_MULTIPLE_WARNINGS_LABEL),r=this.getLabel(r,e.infos,f["default"].MARKERS_PANEL_SINGLE_INFO_LABEL,f["default"].MARKERS_PANEL_MULTIPLE_INFOS_LABEL),r=this.getLabel(r,e.unknwons,f["default"].MARKERS_PANEL_SINGLE_UNKNOWN_LABEL,f["default"].MARKERS_PANEL_MULTIPLE_UNKNOWNS_LABEL)),r},e.getLabel=function(e,t,r,s){return t<=0?e:(e=e?e+", ":"",e+=1===t?r:s(t))},e}();t.MarkersModel=p});