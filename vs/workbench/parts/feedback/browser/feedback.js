/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,n){var a,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(r=(s<3?a(r):s>3?a(t,i,r):a(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},__param=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};define(["require","exports","vs/nls","vs/base/browser/builder","vs/base/browser/ui/dropdown/dropdown","vs/platform/telemetry/common/telemetry","vs/workbench/services/workspace/common/contextService","vs/css!./media/feedback"],function(e,t,i,n,a,s,r){"use strict";var o;!function(e){e[e.SENDING=0]="SENDING",e[e.SENT=1]="SENT",e[e.SEND_ERROR=2]="SEND_ERROR"}(o||(o={}));var c=function(e){function t(t,a,s,r){e.call(this,t,{contextViewProvider:a.contextViewProvider,labelRenderer:function(e){return n.$(e).addClass("send-feedback"),null}}),this.telemetryService=s,this.contextService=r,this.$el.addClass("send-feedback"),this.$el.title(i.localize("sendFeedback","Tweet Feedback")),this.feedbackService=a.feedbackService,this.feedback="",this.sentiment=1,this.maxFeedbackCharacters=this.feedbackService.getCharacterLimit(this.sentiment),this.feedbackForm=null,this.feedbackDescriptionInput=null,this.smileyInput=null,this.frownyInput=null,this.sendButton=null;var o=r.getConfiguration().env;this.reportIssueLink=o.sendASmile.reportIssueUrl,this.requestFeatureLink=o.sendASmile.requestFeatureUrl}return __extends(t,e),t.prototype.renderContents=function(e){var t=this,a=n.$("form.feedback-form").attr({action:"javascript:void(0);",tabIndex:"-1"}).appendTo(e);n.$(e).addClass("monaco-menu-container"),this.feedbackForm=a.getHTMLElement(),n.$("h2.title").text(i.localize("label.sendASmile","Tweet us your feedback.")).appendTo(a),this.invoke(n.$("div.cancel").attr("tabindex","0"),function(){t.hide()}).appendTo(a);var s=n.$("div.content").appendTo(a),r=n.$("div").appendTo(s);n.$("span").text(i.localize("sentiment","How was your experience?")).appendTo(r);var o=n.$("div.feedback-sentiment").appendTo(r);this.smileyInput=n.$("div").addClass("sentiment smile").attr({"aria-checked":"false","aria-label":i.localize("smileCaption","Happy"),tabindex:0,role:"checkbox"}),this.invoke(this.smileyInput,function(){t.setSentiment(!0)}).appendTo(o),this.frownyInput=n.$("div").addClass("sentiment frown").attr({"aria-checked":"false","aria-label":i.localize("frownCaption","Sad"),tabindex:0,role:"checkbox"}),this.invoke(this.frownyInput,function(){t.setSentiment(!1)}).appendTo(o),1===this.sentiment?this.smileyInput.addClass("checked").attr("aria-checked","true"):this.frownyInput.addClass("checked").attr("aria-checked","true");var c=n.$("div.contactus").appendTo(s);n.$("span").text(i.localize("other ways to contact us","Other ways to contact us")).appendTo(c);var d=n.$("div.channels").appendTo(c);n.$("div").append(n.$("a").attr("target","_blank").attr("href",this.reportIssueLink).text(i.localize("submit a bug","Submit a bug")).attr("tabindex","0")).appendTo(d),n.$("div").append(n.$("a").attr("target","_blank").attr("href",this.requestFeatureLink).text(i.localize("request a missing feature","Request a missing feature")).attr("tabindex","0")).appendTo(d),this.remainingCharacterCount=n.$("span.char-counter").text(this.getCharCountText(0)),n.$("h3").text(i.localize("tell us why?","Tell us why?")).append(this.remainingCharacterCount).appendTo(a),this.feedbackDescriptionInput=n.$("textarea.feedback-description").attr({rows:3,maxlength:this.maxFeedbackCharacters,"aria-label":i.localize("commentsHeader","Comments")}).text(this.feedback).attr("required","required").on("keyup",function(){t.updateCharCountText()}).appendTo(a).domFocus().getHTMLElement();var u=n.$("div.form-buttons").appendTo(a);return this.sendButton=this.invoke(n.$("input.send").type("submit").attr("disabled","").value(i.localize("tweet","Tweet")).appendTo(u),function(){t.isSendingFeedback||t.onSubmit()}),{dispose:function(){t.feedbackForm=null,t.feedbackDescriptionInput=null,t.smileyInput=null,t.frownyInput=null}}},t.prototype.getCharCountText=function(e){var t=this.maxFeedbackCharacters-e,n=1===t?i.localize("character left","character left"):i.localize("characters left","characters left");return"("+t+" "+n+")"},t.prototype.updateCharCountText=function(){this.remainingCharacterCount.text(this.getCharCountText(this.feedbackDescriptionInput.value.length)),this.feedbackDescriptionInput.value?this.sendButton.removeAttribute("disabled"):this.sendButton.attr("disabled","")},t.prototype.setSentiment=function(e){e?(this.smileyInput.addClass("checked"),this.smileyInput.attr("aria-checked","true"),this.frownyInput.removeClass("checked"),this.frownyInput.attr("aria-checked","false")):(this.frownyInput.addClass("checked"),this.frownyInput.attr("aria-checked","true"),this.smileyInput.removeClass("checked"),this.smileyInput.attr("aria-checked","false")),this.sentiment=e?1:0,this.maxFeedbackCharacters=this.feedbackService.getCharacterLimit(this.sentiment),this.updateCharCountText(),n.$(this.feedbackDescriptionInput).attr({maxlength:this.maxFeedbackCharacters})},t.prototype.invoke=function(e,t){return e.on("click",t),e.on("keypress",function(e){if(e instanceof KeyboardEvent){var i=e;13!==i.keyCode&&32!==i.keyCode||t()}}),e},t.prototype.hide=function(){this.feedbackDescriptionInput&&(this.feedback=this.feedbackDescriptionInput.value),this.autoHideTimeout&&(clearTimeout(this.autoHideTimeout),this.autoHideTimeout=null),e.prototype.hide.call(this)},t.prototype.onEvent=function(e,t){if(e instanceof KeyboardEvent){var i=e;27===i.keyCode&&this.hide()}},t.prototype.onSubmit=function(){this.feedbackForm.checkValidity&&!this.feedbackForm.checkValidity()||(this.changeFormStatus(o.SENDING),this.feedbackService.submitFeedback({feedback:this.feedbackDescriptionInput.value,sentiment:this.sentiment}),this.changeFormStatus(o.SENT))},t.prototype.changeFormStatus=function(e){var t=this;switch(e){case o.SENDING:this.isSendingFeedback=!0,this.sendButton.setClass("send in-progress"),this.sendButton.value(i.localize("feedbackSending","Sending"));break;case o.SENT:this.isSendingFeedback=!1,this.sendButton.setClass("send success").value(i.localize("feedbackSent","Thanks")),this.resetForm(),this.autoHideTimeout=setTimeout(function(){t.hide()},1e3),this.sendButton.off(["click","keypress"]),this.invoke(this.sendButton,function(){t.hide(),t.sendButton.off(["click","keypress"])});break;case o.SEND_ERROR:this.isSendingFeedback=!1,this.sendButton.setClass("send error").value(i.localize("feedbackSendingError","Try again"))}},t.prototype.resetForm=function(){this.feedbackDescriptionInput&&(this.feedbackDescriptionInput.value=""),this.sentiment=1,this.maxFeedbackCharacters=this.feedbackService.getCharacterLimit(this.sentiment),this.aliasEnabled=!1},t=__decorate([__param(2,s.ITelemetryService),__param(3,r.IWorkspaceContextService)],t)}(a.Dropdown);t.FeedbackDropdown=c});