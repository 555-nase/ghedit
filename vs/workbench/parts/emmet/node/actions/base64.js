/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};define(["require","exports","vs/nls","vs/base/node/pfs","fs","vs/base/common/paths","vs/workbench/parts/emmet/node/emmetActions","vs/base/common/actions","vs/editor/common/editorCommonExtensions","vs/platform/configuration/common/configuration","vs/platform/message/common/message","vs/workbench/services/quickopen/common/quickOpenService","vs/workbench/services/workspace/common/contextService","vs/platform/files/common/files"],function(e,t,o,i,r,n,a,c,s,l,m,d,p,u){"use strict";var f=function(e){function t(t,o,i,r,n,a,c){e.call(this,t,o,i),this.workspaceContext=r,this.quickOpenService=n,this.messageService=a,this.fileService=c,this.imageFilePath=null}return __extends(t,e),t.prototype.createPath=function(e,t){var o=r.statSync(e);return o&&!o.isDirectory()&&(e=n.dirname(e)),n.join(e,t)},t.prototype.runEmmetAction=function(e){var t=this,r=this.editorAccessor.getCurrentLine();if(!this.isDataURI(r))return void this.encodeDecode(e);if(!this.workspaceContext.getWorkspace()){var n=o.localize("noWorkspace","Decoding a data:URL image is only available inside a workspace folder.");return void this.messageService.show(m.Severity.Info,n)}var a={prompt:o.localize("enterImagePath","Enter file path (absolute or relative)"),placeHolder:o.localize("path","File path")},s=this.quickOpenService.input(a).then(function(e){t.isValidInput(e)||s.cancel(),t.imageFilePath=e;var o=t.createPath(t.editorAccessor.getFilePath(),e);return i.fileExists(o)}).then(function(i){if(!i)return void t.encodeDecode(e,t.imageFilePath);var r=o.localize("warnEscalation","File **{0}** already exists.  Do you want to overwrite the existing file?",t.imageFilePath),n=[new c.Action("cancel",o.localize("cancel","Cancel"),"",(!0)),new c.Action("ok",o.localize("ok","OK"),"",(!0),function(){return t.encodeDecode(e,t.imageFilePath),null})];t.messageService.show(m.Severity.Warning,{message:r,actions:n})})},t.prototype.encodeDecode=function(e,t){this.editorAccessor.prompt=function(){return t},e.run("encode_decode_data_url",this.editorAccessor)||this.noExpansionOccurred()},t.prototype.isValidInput=function(e){if(void 0===e)return!1;for(var t=!0,i=n.normalize(e).split("/").filter(function(e){return 0!==e.length&&".."!==e}),r=0;r<i.length;r++)if(!n.isValidBasename(i[r])){t=!1;break}if(!t){var a=o.localize("invalidFileNameError","The name **{0}** is not valid as a file or folder name. Please choose a different name.",e);return this.messageService.show(m.Severity.Error,a),!1}return!0},t.prototype.isDataURI=function(e){return/(?:src=|url\()['"]?data:/.test(e)},t.ID="editor.emmet.action.encodeDecodeDataUrl",t=__decorate([__param(2,l.IConfigurationService),__param(3,p.IWorkspaceContextService),__param(4,d.IQuickOpenService),__param(5,m.IMessageService),__param(6,u.IFileService)],t)}(a.EmmetEditorAction);s.CommonEditorRegistry.registerEditorAction(new s.EditorActionDescriptor(f,f.ID,o.localize("encodeDecodeDataUrl","Emmet: Encode\\Decode data:URL image"),(void 0),"Emmet: Encode\\Decode data:URL image"))});