/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};define(["require","exports","vs/base/common/winjs.base","vs/workbench/common/memento","vs/workbench/parts/files/common/files","vs/workbench/browser/viewlet","vs/base/browser/ui/splitview/splitview","vs/platform/configuration/common/configuration","vs/workbench/parts/files/browser/views/explorerViewer","vs/workbench/parts/files/browser/views/explorerView","vs/workbench/parts/files/browser/views/emptyView","vs/workbench/parts/files/browser/views/openEditorsView","vs/platform/storage/common/storage","vs/platform/instantiation/common/instantiation","vs/platform/workspace/common/workspace","vs/platform/telemetry/common/telemetry","vs/workbench/services/editor/browser/editorService","vs/platform/instantiation/common/serviceCollection","vs/workbench/services/editor/common/editorService","vs/workbench/services/group/common/groupService","vs/platform/keybinding/common/keybinding","vs/css!./media/explorerviewlet"],function(e,t,i,o,r,s,n,c,p,a,h,l,u,d,w,v,f,V,m,E,g){"use strict";var y=function(e){function t(t,i,s,n,c,a,h,l){var u=this;e.call(this,r.VIEWLET_ID,t),this.contextService=i,this.storageService=s,this.editorGroupService=n,this.editorService=c,this.configurationService=a,this.instantiationService=h,this.views=[],this.viewletState=new p.FileViewletState,this.viewletVisibleContextKey=l.createKey("explorerViewletVisible",!0),this.viewletSettings=this.getMemento(s,o.Scope.WORKSPACE),this.configurationService.onDidUpdateConfiguration(function(e){return u.onConfigurationUpdated(e.config)})}return __extends(t,e),t.prototype.create=function(t){var i=this;return e.prototype.create.call(this,t),this.viewletContainer=t.div().addClass("explorer-viewlet"),this.configurationService.loadConfiguration().then(function(e){return i.onConfigurationUpdated(e)})},t.prototype.getActions=function(){return this.openEditorsVisible?[]:this.explorerView.getActions()},t.prototype.onConfigurationUpdated=function(e){var t=this;this.delayEditorOpeningInOpenedEditors=!!e.workbench.editor.enablePreview;var o=!this.contextService.getWorkspace()||0!==e.explorer.openEditors.visible;return this.openEditorsVisible!==o?(this.dispose(),this.openEditorsVisible=o,this.views=[],this.viewletContainer.clearChildren(),this.openEditorsVisible&&(this.splitView=new n.SplitView(this.viewletContainer.getHTMLElement()),this.addOpenEditorsView(),this.focusListener=this.splitView.onFocus(function(e){t.lastFocusedView=e})),this.addExplorerView(),this.lastFocusedView=this.explorerView,i.TPromise.join(this.views.map(function(e){return e.create()})).then(function(){}).then(function(){return t.dimension&&t.layout(t.dimension),t.updateTitleArea(),t.setVisible(t.isVisible()).then(function(){return t.focus()})})):i.TPromise.as(null)},t.prototype.addOpenEditorsView=function(){this.openEditorsView=this.instantiationService.createInstance(l.OpenEditorsView,this.getActionRunner(),this.viewletSettings),this.splitView.addView(this.openEditorsView),this.views.push(this.openEditorsView)},t.prototype.addExplorerView=function(){var e,t=this;if(this.contextService.getWorkspace()){var i=this.instantiationService.createInstance(f.DelegatingWorkbenchEditorService,function(e,i,o){if(t.openEditorsView){var r=0;if(t.delayEditorOpeningInOpenedEditors&&(o===!1||"number"!=typeof o)){var s=t.editorGroupService.getStacksModel().activeGroup;s&&s.previewEditor||(r=250)}t.openEditorsView.setStructuralRefreshDelay(r)}var n=function(e){return t.openEditorsView&&t.openEditorsView.setStructuralRefreshDelay(0),e};return t.editorService.openEditor(e,i,o).then(n,n)}),o=this.instantiationService.createChild(new V.ServiceCollection([m.IWorkbenchEditorService,i])),r=this.openEditorsVisible?void 0:0;this.explorerView=e=o.createInstance(a.ExplorerView,this.viewletState,this.getActionRunner(),this.viewletSettings,r)}else e=this.instantiationService.createInstance(h.EmptyView);this.openEditorsVisible?this.splitView.addView(e):e.render(this.viewletContainer.getHTMLElement(),n.Orientation.VERTICAL),this.views.push(e)},t.prototype.getExplorerView=function(){return this.explorerView},t.prototype.getOpenEditorsView=function(){return this.openEditorsView},t.prototype.setVisible=function(t){var o=this;return this.viewletVisibleContextKey.set(t),e.prototype.setVisible.call(this,t).then(function(){return i.TPromise.join(o.views.map(function(e){return e.setVisible(t)})).then(function(){})})},t.prototype.focus=function(){return e.prototype.focus.call(this),this.lastFocusedView&&this.lastFocusedView.isExpanded()&&this.hasSelectionOrFocus(this.lastFocusedView)?void this.lastFocusedView.focusBody():this.hasSelectionOrFocus(this.openEditorsView)?this.openEditorsView.focusBody():this.hasSelectionOrFocus(this.explorerView)?this.explorerView.focusBody():this.openEditorsView&&this.openEditorsView.isExpanded()?this.openEditorsView.focusBody():this.explorerView&&this.explorerView.isExpanded()?this.explorerView.focusBody():this.openEditorsView.focus()},t.prototype.hasSelectionOrFocus=function(e){if(!e)return!1;if(!e.isExpanded())return!1;if(e instanceof a.ExplorerView||e instanceof l.OpenEditorsView){var t=e.getViewer();return!!t&&(!!t.getFocus()||t.getSelection()&&t.getSelection().length>0)}return!1},t.prototype.layout=function(e){this.dimension=e,this.openEditorsVisible?this.splitView.layout(e.height):this.explorerView&&this.explorerView.layout(e.height,n.Orientation.VERTICAL)},t.prototype.getActionRunner=function(){return this.actionRunner||(this.actionRunner=new p.ActionRunner(this.viewletState)),this.actionRunner},t.prototype.getOptimalWidth=function(){var e=16,t=this.openEditorsVisible?this.openEditorsView.getOptimalWidth():0,i=this.getExplorerView(),o=i?i.getOptimalWidth():0,r=Math.max(t,o);return r+e},t.prototype.shutdown=function(){this.views.forEach(function(e){return e.shutdown()}),e.prototype.shutdown.call(this)},t.prototype.dispose=function(){this.splitView&&(this.splitView.dispose(),this.splitView=null),this.explorerView&&(this.explorerView.dispose(),this.explorerView=null),this.openEditorsView&&(this.openEditorsView.dispose(),this.openEditorsView=null),this.focusListener&&(this.focusListener.dispose(),this.focusListener=null)},t=__decorate([__param(0,v.ITelemetryService),__param(1,w.IWorkspaceContextService),__param(2,u.IStorageService),__param(3,E.IEditorGroupService),__param(4,m.IWorkbenchEditorService),__param(5,c.IConfigurationService),__param(6,d.IInstantiationService),__param(7,g.IKeybindingService)],t)}(s.Viewlet);t.ExplorerViewlet=y});