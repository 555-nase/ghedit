/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/winjs.base","vs/base/parts/tree/browser/treeDefaults","vs/base/parts/tree/browser/tree","vs/base/parts/tree/browser/treeDnd","vs/base/browser/ui/actionbar/actionbar","vs/base/browser/dom","vs/platform/instantiation/common/instantiation","vs/platform/telemetry/common/telemetry","vs/workbench/services/group/common/groupService","vs/platform/contextview/browser/contextView","vs/platform/keybinding/common/keybinding","vs/workbench/common/editor","vs/workbench/browser/actionBarRegistry","vs/workbench/parts/files/common/files","vs/workbench/services/editor/common/editorService","vs/workbench/common/editor/editorStacksModel","vs/workbench/parts/files/browser/fileActions","vs/workbench/services/untitled/common/untitledEditorService","vs/workbench/browser/parts/editor/editorActions"],function(e,t,o,r,i,n,s,a,c,p,u,d,l,v,f,E,h,A,S,g,I,_,m){"use strict";var y=p.emmet,D=function(){function e(e,t){this.editor=e,this.group=t}return Object.defineProperty(e.prototype,"editorInput",{get:function(){return this.editor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editorGroup",{get:function(){return this.group},enumerable:!0,configurable:!0}),e.prototype.getId=function(){return"openeditor:"+this.group.id+":"+this.group.indexOf(this.editor)+":"+this.editor.getName()+":"+this.editor.getDescription()},e.prototype.isPreview=function(){return this.group.isPreview(this.editor)},e.prototype.isUntitled=function(){return this.editor instanceof E.UntitledEditorInput},e.prototype.isDirty=function(){return this.editor.isDirty()},e.prototype.getResource=function(){return this.editor instanceof A.FileEditorInput?this.editor.getResource():this.editor instanceof E.UntitledEditorInput?this.editor.getResource():null},e}();t.OpenEditor=D;var G=function(){function e(){}return e.prototype.getId=function(e,t){return t instanceof g.EditorStacksModel?"root":t instanceof g.EditorGroup?t.id.toString():t.getId()},e.prototype.hasChildren=function(e,t){return t instanceof g.EditorStacksModel||t instanceof g.EditorGroup},e.prototype.getChildren=function(e,t){if(t instanceof g.EditorStacksModel)return i.TPromise.as(t.groups);var o=t;return i.TPromise.as(o.getEditors().map(function(e){return new D(e,o)}))},e.prototype.getParent=function(e,t){return i.TPromise.as(null)},e}();t.DataSource=G;var b=function(){function e(e,t,o,r){this.actionProvider=e,this.model=t,this.textFileService=o,this.untitledEditorService=r}return e.prototype.getHeight=function(t,o){return e.ITEM_HEIGHT},e.prototype.getTemplateId=function(t,o){return o instanceof g.EditorGroup?e.EDITOR_GROUP_TEMPLATE_ID:e.OPEN_EDITOR_TEMPLATE_ID},e.prototype.renderTemplate=function(t,o,r){if(o===e.EDITOR_GROUP_TEMPLATE_ID){var i=Object.create(null);return i.root=p.append(r,y(".editor-group")),i.name=p.append(i.root,y("span.name")),i.actionBar=new c.ActionBar(r),i.actionBar.push(this.actionProvider.getEditorGroupActions(),{icon:!0,label:!1}),i}var n=Object.create(null);return n.container=r,n.actionBar=new c.ActionBar(r),n.actionBar.push(this.actionProvider.getOpenEditorActions(),{icon:!0,label:!1}),n.root=p.append(r,y(".open-editor")),n.name=p.append(n.root,y("span.name")),n.description=p.append(n.root,y("span.description")),n},e.prototype.renderElement=function(t,o,r,i){r===e.EDITOR_GROUP_TEMPLATE_ID?this.renderEditorGroup(t,o,i):this.renderOpenEditor(t,o,i)},e.prototype.renderEditorGroup=function(e,t,o){o.name.textContent=t.label,o.actionBar.context={group:t}},e.prototype.renderOpenEditor=function(e,t,o){t.isPreview()?p.addClass(o.root,"preview"):p.removeClass(o.root,"preview"),t.isDirty()?p.addClass(o.container,"dirty"):p.removeClass(o.container,"dirty");var r=t.getResource();o.root.title=r?r.fsPath:"",o.name.textContent=t.editorInput.getName(),o.description.textContent=t.editorInput.getDescription(),o.actionBar.context={group:t.editorGroup,editor:t.editorInput}},e.prototype.disposeTemplate=function(t,o,r){o===e.OPEN_EDITOR_TEMPLATE_ID&&r.actionBar.dispose(),o===e.EDITOR_GROUP_TEMPLATE_ID&&r.actionBar.dispose()},e.ITEM_HEIGHT=22,e.EDITOR_GROUP_TEMPLATE_ID="editorgroup",e.OPEN_EDITOR_TEMPLATE_ID="openeditor",e=__decorate([__param(2,A.ITextFileService),__param(3,_.IUntitledEditorService)],e)}();t.Renderer=b;var O=function(e){function t(t,o,r,i,s,a,c,p){e.call(this,{clickBehavior:n.ClickBehavior.ON_MOUSE_DOWN}),this.actionProvider=t,this.model=o,this.editorService=r,this.editorGroupService=i,this.instantiationService=s,this.contextMenuService=a,this.telemetryService=c,this.keybindingService=p}return __extends(t,e),t.prototype.onClick=function(t,o,i){if(o instanceof D&&i.browserEvent&&1===i.browserEvent.button){var n=this.model.positionOfGroup(o.editorGroup);return this.editorService.closeEditor(n,o.editorInput).done(null,r.onUnexpectedError),!0}return e.prototype.onClick.call(this,t,o,i)},t.prototype.onLeftClick=function(e,t,o,r){void 0===r&&(r="mouse");var i={origin:r},n="mouse"===r&&2===o.detail,s=o&&o.browserEvent&&"mousedown"===o.browserEvent.type;if(s||o.preventDefault(),o.stopPropagation(),!(t instanceof D))return!0;if(e.DOMFocus(),o.shiftKey){var a=e.getSelection();a&&a.length>0&&a[0]===t&&e.clearSelection(i)}else e.setFocus(t,i),n&&o.preventDefault(),e.setSelection([t],i),this.openEditor(t,n);return!0},t.prototype.onLeft=function(e,t){return!0},t.prototype.onRight=function(e,t){return!0},t.prototype.onEnter=function(t,o){var r=t.getFocus();return r instanceof g.EditorGroup?(o.preventDefault(),o.stopPropagation(),!0):(this.openEditor(r,!1),e.prototype.onEnter.call(this,t,o))},t.prototype.onContextMenu=function(e,t,o){var r=this;if(o.target&&o.target.tagName&&"input"===o.target.tagName.toLowerCase())return!1;if(t===e.getInput())return!1;o.preventDefault(),o.stopPropagation(),e.setFocus(t);var i=t instanceof g.EditorGroup?t:t.editorGroup,n=t instanceof D?t.editorInput:void 0,s={x:o.posx+1,y:o.posy};return this.contextMenuService.showContextMenu({getAnchor:function(){return s},getActions:function(){return r.actionProvider.getSecondaryActions(e,t)},getKeyBinding:function(e){var t=r.keybindingService.lookupKeybindings(e.id);return t.length>0?t[0]:I.keybindingForAction(e.id)},onHide:function(t){t&&e.DOMFocus()},getActionsContext:function(){return{group:i,editor:n}}}),!0},t.prototype.openEditor=function(e,t){var o=this;if(e){this.telemetryService.publicLog("workbenchActionExecuted",{id:"workbench.files.openFile",from:"openEditors"});var i=this.model.positionOfGroup(e.editorGroup);t&&this.editorGroupService.pinEditor(e.editorGroup,e.editorInput),this.editorGroupService.activateGroup(e.editorGroup),this.editorService.openEditor(e.editorInput,{preserveFocus:!t},i).done(function(){return o.editorGroupService.activateGroup(e.editorGroup)},r.onUnexpectedError)}},t=__decorate([__param(2,S.IWorkbenchEditorService),__param(3,l.IEditorGroupService),__param(4,u.IInstantiationService),__param(5,v.IContextMenuService),__param(6,d.ITelemetryService),__param(7,f.IKeybindingService)],t)}(n.DefaultController);t.Controller=O;var R=function(){function e(){}return e.prototype.getAriaLabel=function(e,t){return t instanceof g.EditorGroup?o.localize("editorGroupAriaLabel","{0}, Editor Group",t.label):o.localize("openEditorAriaLabel","{0}, Open Editor",t.editorInput.getName())},e}();t.AccessibilityProvider=R;var C=function(e){function t(t,o,r,i){e.call(this),this.model=t,this.instantiationService=o,this.textFileService=r,this.untitledEditorService=i}return __extends(t,e),t.prototype.hasActions=function(e,t){var o=this.model.groups.length>1;return t instanceof D||t instanceof g.EditorGroup&&o},t.prototype.getActions=function(e,t){return t instanceof D?i.TPromise.as(this.getOpenEditorActions()):t instanceof g.EditorGroup?i.TPromise.as(this.getEditorGroupActions()):i.TPromise.as([])},t.prototype.getOpenEditorActions=function(){return[this.instantiationService.createInstance(m.CloseEditorAction,m.CloseEditorAction.ID,m.CloseEditorAction.LABEL)]},t.prototype.getEditorGroupActions=function(){var e=this.instantiationService.createInstance(I.SaveAllInGroupAction,I.SaveAllInGroupAction.ID,I.SaveAllInGroupAction.LABEL);return[e,this.instantiationService.createInstance(m.CloseEditorsInGroupAction,m.CloseEditorsInGroupAction.ID,m.CloseEditorsInGroupAction.LABEL)]},t.prototype.hasSecondaryActions=function(e,t){return t instanceof D||t instanceof g.EditorGroup},t.prototype.getSecondaryActions=function(t,r){var i=this;return e.prototype.getSecondaryActions.call(this,t,r).then(function(e){var n=i.textFileService.getAutoSaveMode()===A.AutoSaveMode.AFTER_SHORT_DELAY;if(r instanceof g.EditorGroup)n||(e.push(i.instantiationService.createInstance(I.SaveAllInGroupAction,I.SaveAllInGroupAction.ID,o.localize("saveAll","Save All"))),e.push(new c.Separator)),e.push(i.instantiationService.createInstance(m.CloseEditorsInGroupAction,m.CloseEditorsInGroupAction.ID,o.localize("closeAll","Close All")));else{var s=r,a=s.getResource();if(a){if(e.unshift(new c.Separator),e.unshift(i.instantiationService.createInstance(I.OpenToSideAction,t,a,!1)),s.isUntitled()){if(e.push(new c.Separator),i.untitledEditorService.hasAssociatedFilePath(a)){var p=i.instantiationService.createInstance(I.SaveFileAction,I.SaveFileAction.ID,I.SaveFileAction.LABEL);p.setResource(a),e.push(p)}var u=i.instantiationService.createInstance(I.SaveFileAsAction,I.SaveFileAsAction.ID,I.SaveFileAsAction.LABEL);u.setResource(a),e.push(u)}else{if(!n){e.push(new c.Separator);var d=i.instantiationService.createInstance(I.SaveFileAction,I.SaveFileAction.ID,I.SaveFileAction.LABEL);d.setResource(a),d.enabled=s.isDirty(),e.push(d);var l=i.instantiationService.createInstance(I.RevertFileAction,I.RevertFileAction.ID,I.RevertFileAction.LABEL);l.setResource(a),l.enabled=s.isDirty(),e.push(l)}e.push(new c.Separator);var v=i.instantiationService.createInstance(I.CompareResourcesAction,a,t);v._isEnabled()&&e.push(v),e.push(i.instantiationService.createInstance(I.SelectResourceForCompareAction,a,t))}e.push(new c.Separator)}e.push(i.instantiationService.createInstance(m.CloseEditorAction,m.CloseEditorAction.ID,o.localize("close","Close")));var f=i.instantiationService.createInstance(m.CloseOtherEditorsInGroupAction,m.CloseOtherEditorsInGroupAction.ID,o.localize("closeOthers","Close Others"));f.enabled=s.editorGroup.count>1,e.push(f),e.push(i.instantiationService.createInstance(m.CloseEditorsInGroupAction,m.CloseEditorsInGroupAction.ID,o.localize("closeAll","Close All")))}return e})},t=__decorate([__param(1,u.IInstantiationService),__param(2,A.ITextFileService),__param(3,_.IUntitledEditorService)],t)}(h.ContributableActionProvider);t.ActionProvider=C;var T=function(e){function t(t,o){e.call(this),this.editorService=t,this.editorGroupService=o}return __extends(t,e),t.prototype.getDragURI=function(e,t){if(!(t instanceof D))return null;var o=t.getResource();return o?o.toString():t.editorInput.getName()},t.prototype.onDragOver=function(e,t,o,r){if(!(o instanceof D||o instanceof g.EditorGroup))return s.DRAG_OVER_REJECT;if(t instanceof a.ExternalElementsDragAndDropData){var i=A.asFileResource(t.getData()[0]);return i?i.isDirectory?s.DRAG_OVER_REJECT:s.DRAG_OVER_ACCEPT:s.DRAG_OVER_REJECT}return t instanceof a.DesktopDragAndDropData?s.DRAG_OVER_REJECT:t instanceof a.ElementsDragAndDropData?s.DRAG_OVER_ACCEPT:s.DRAG_OVER_REJECT},t.prototype.drop=function(e,t,o,i){var n,s=this.editorGroupService.getStacksModel(),c=s.positionOfGroup(o instanceof g.EditorGroup?o:o.editorGroup),p=o instanceof D?o.editorGroup.indexOf(o.editorInput):void 0;if(t instanceof a.ExternalElementsDragAndDropData){var u=A.asFileResource(t.getData()[0]);u.options={index:p,pinned:!0},this.editorService.openEditor(u,c).done(null,r.onUnexpectedError)}else{var d=t.getData();Array.isArray(d)&&(n=d[0])}n&&(n instanceof D?this.editorGroupService.moveEditor(n.editorInput,s.positionOfGroup(n.editorGroup),c,p):this.editorGroupService.moveGroup(s.positionOfGroup(n),c))},t=__decorate([__param(0,S.IWorkbenchEditorService),__param(1,l.IEditorGroupService)],t)}(n.DefaultDragAndDrop);t.DragAndDrop=T});