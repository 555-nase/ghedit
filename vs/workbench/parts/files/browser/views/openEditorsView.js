/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,r){var o,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,i,s):o(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},__param=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/async","vs/base/browser/dom","vs/base/browser/ui/splitview/splitview","vs/base/parts/tree/browser/treeImpl","vs/platform/contextview/browser/contextView","vs/platform/message/common/message","vs/platform/instantiation/common/instantiation","vs/workbench/services/group/common/groupService","vs/platform/event/common/event","vs/platform/configuration/common/configuration","vs/platform/keybinding/common/keybinding","vs/workbench/common/events","vs/workbench/parts/files/browser/fileActions","vs/workbench/browser/viewlet","vs/workbench/parts/files/common/files","vs/workbench/parts/files/browser/views/openEditorsViewer","vs/workbench/services/untitled/common/untitledEditorService","vs/workbench/browser/parts/editor/editorActions"],function(e,t,i,r,o,n,s,a,c,d,l,h,p,u,v,f,E,m,g,S,y,_){"use strict";var I=n.emmet,A=function(e){function t(r,n,s,a,c,d,l,h,p,u,v){var f=this;e.call(this,r,t.computeExpandedBodySize(h.getStacksModel()),!!n[t.MEMENTO_COLLAPSED],i.localize("openEditosrSection","Open Editors Section"),s,u,d),this.eventService=a,this.instantiationService=c,this.textFileService=l,this.editorGroupService=h,this.configurationService=p,this.untitledEditorService=v,this.settings=n,this.model=h.getStacksModel(),this.structuralRefreshDelay=0,this.structuralTreeRefreshScheduler=new o.RunOnceScheduler(function(){return f.structuralTreeUpdate()},this.structuralRefreshDelay)}return __extends(t,e),t.prototype.renderHeader=function(t){var r=n.append(t,I(".title")),o=n.append(r,I("span"));o.textContent=i.localize("openEditors","Open Editors"),this.dirtyCountElement=n.append(r,I(".monaco-count-badge")),this.updateDirtyIndicator(),e.prototype.renderHeader.call(this,t)},t.prototype.getActions=function(){return[this.instantiationService.createInstance(E.SaveAllAction,E.SaveAllAction.ID,E.SaveAllAction.LABEL),this.instantiationService.createInstance(_.CloseAllEditorsAction,_.CloseAllEditorsAction.ID,_.CloseAllEditorsAction.LABEL)]},t.prototype.renderBody=function(t){this.treeContainer=e.prototype.renderViewTree.call(this,t),n.addClass(this.treeContainer,"explorer-open-editors");var r=this.instantiationService.createInstance(S.DataSource),o=this.instantiationService.createInstance(S.ActionProvider,this.model),s=this.instantiationService.createInstance(S.Renderer,o,this.model),c=this.instantiationService.createInstance(S.Controller,o,this.model),d=this.instantiationService.createInstance(S.AccessibilityProvider),l=this.instantiationService.createInstance(S.DragAndDrop);this.tree=new a.Tree(this.treeContainer,{dataSource:r,renderer:s,controller:c,accessibilityProvider:d,dnd:l},{indentPixels:0,twistiePixels:20,ariaLabel:i.localize("treeAriaLabel","Open Editors")}),this.fullRefreshNeeded=!0,this.structuralTreeUpdate()},t.prototype.create=function(){var t=this.configurationService.getConfiguration();return this.onConfigurationUpdated(t),this.registerListeners(),e.prototype.create.call(this)},t.prototype.registerListeners=function(){var e=this;this.toDispose.push(this.model.onModelChanged(function(t){return e.onEditorStacksModelChanged(t)})),this.toDispose.push(this.configurationService.onDidUpdateConfiguration(function(t){return e.onConfigurationUpdated(t.config)})),this.toDispose.push(this.eventService.addListener2(f.EventType.COMPOSITE_OPENED,function(t){t.compositeId===g.VIEWLET_ID&&(e.fullRefreshNeeded=!0,e.structuralTreeUpdate(),e.updateDirtyIndicator())}))},t.prototype.onEditorStacksModelChanged=function(e){var t=this;if(!this.isDisposed&&this.isVisible&&this.tree)if(e.structural)e.editor&&!this.groupToRefresh?this.groupToRefresh=e.group:this.fullRefreshNeeded=!0,this.structuralTreeRefreshScheduler.schedule(this.structuralRefreshDelay);else{var i=e.editor?new S.OpenEditor(e.editor,e.group):e.group;this.updateDirtyIndicator(),this.tree.refresh(i,!1).done(function(){return t.highlightActiveEditor()},r.onUnexpectedError)}},t.prototype.structuralTreeUpdate=function(){var e=this;this.expandedBodySize=this.getExpandedBodySize(this.model);var t=1===this.model.groups.length?this.model.groups[0]:this.model;this.fullRefreshNeeded=!0;var i=this.fullRefreshNeeded?null:this.groupToRefresh;(t!==this.tree.getInput()?this.tree.setInput(t):this.tree.refresh(i)).done(function(){return e.fullRefreshNeeded=!1,e.groupToRefresh=null,e.tree.expandAll(e.model.groups).then(function(){return e.highlightActiveEditor()})},r.onUnexpectedError)},t.prototype.highlightActiveEditor=function(){if(this.model.activeGroup&&this.model.activeGroup.activeEditor){var e=new S.OpenEditor(this.model.activeGroup.activeEditor,this.model.activeGroup);if(this.tree.clearFocus(),this.tree.clearSelection(),e){this.tree.setFocus(e),this.tree.setSelection([e]);var t=this.tree.getRelativeTop(e);(t<=0||t>=1)&&this.tree.reveal(e).done(null,r.onUnexpectedError)}}},t.prototype.onConfigurationUpdated=function(e){var i=e&&e.explorer&&e.explorer.openEditors&&e.explorer.openEditors.visible;"number"==typeof i?this.visibleOpenEditors=i:this.visibleOpenEditors=t.DEFAULT_VISIBLE_OPEN_EDITORS;var r=e&&e.explorer&&e.explorer.openEditors&&e.explorer.openEditors.dynamicHeight;"boolean"==typeof r?this.dynamicHeight=r:this.dynamicHeight=t.DEFAULT_DYNAMIC_HEIGHT,this.expandedBodySize=this.getExpandedBodySize(this.model)},t.prototype.updateDirtyIndicator=function(){var e=this.textFileService.getAutoSaveMode()!==g.AutoSaveMode.AFTER_SHORT_DELAY?this.textFileService.getDirty().length:this.untitledEditorService.getDirty().length;0===e?n.addClass(this.dirtyCountElement,"hidden"):(this.dirtyCountElement.textContent=i.localize("dirtyCounter","{0} unsaved",e),n.removeClass(this.dirtyCountElement,"hidden"))},t.prototype.getExpandedBodySize=function(e){return t.computeExpandedBodySize(e,this.visibleOpenEditors,this.dynamicHeight)},t.computeExpandedBodySize=function(e,i,r){void 0===i&&(i=t.DEFAULT_VISIBLE_OPEN_EDITORS),void 0===r&&(r=t.DEFAULT_DYNAMIC_HEIGHT);var o=e.groups.reduce(function(e,t){return e+t.count},0);e.groups.length>1&&(o+=e.groups.length);var n;return n=r?Math.min(Math.max(i,1),o):Math.max(i,1),n*S.Renderer.ITEM_HEIGHT},t.prototype.setStructuralRefreshDelay=function(e){this.structuralRefreshDelay=e},t.prototype.getOptimalWidth=function(){var e=this.tree.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".monaco-file-label > .file-name"));return n.getLargestChildWidth(e,t)},t.prototype.shutdown=function(){this.settings[t.MEMENTO_COLLAPSED]=this.state===s.CollapsibleState.COLLAPSED,e.prototype.shutdown.call(this)},t.MEMENTO_COLLAPSED="openEditors.memento.collapsed",t.DEFAULT_VISIBLE_OPEN_EDITORS=9,t.DEFAULT_DYNAMIC_HEIGHT=!0,t=__decorate([__param(2,d.IMessageService),__param(3,p.IEventService),__param(4,l.IInstantiationService),__param(5,c.IContextMenuService),__param(6,g.ITextFileService),__param(7,h.IEditorGroupService),__param(8,u.IConfigurationService),__param(9,v.IKeybindingService),__param(10,y.IUntitledEditorService)],t)}(m.AdaptiveCollapsibleViewletView);t.OpenEditorsView=A});