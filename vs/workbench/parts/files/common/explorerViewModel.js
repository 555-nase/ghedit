/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define(["require","exports","vs/base/common/assert","vs/base/common/types","vs/base/common/uri","vs/base/common/platform","vs/base/common/paths","vs/base/common/mime"],function(e,t,r,i,o,n,s,h){"use strict";!function(e){e[e.FILE=0]="FILE",e[e.FOLDER=1]="FOLDER",e[e.ANY=2]="ANY"}(t.StatType||(t.StatType={}));var c=t.StatType,a=function(){function e(e,t,r,i,o,n){void 0===i&&(i=s.basename(e.fsPath)),this.resource=e,this.name=i,this.isDirectory=!!t,this.hasChildren=t&&r,this.mime=t?void 0:h.guessMimeTypes(this.resource.fsPath).join(", "),this.etag=n,this.mtime=o,this.isDirectory&&(this.children=[]),this.isDirectoryResolved=!1}return e.prototype.getId=function(){return this.resource.toString()},e.create=function(t,r){var i=new e(t.resource,t.isDirectory,t.hasChildren,t.name,t.mtime,t.etag);if(i.isDirectory&&(i.isDirectoryResolved=!!t.children||!!r&&r.some(function(e){return s.isEqualOrParent(e.fsPath,i.resource.fsPath)}),t.children))for(var o=0,n=t.children.length;o<n;o++){var h=e.create(t.children[o],r);h.parent=i,i.children.push(h),i.hasChildren=i.children.length>0}return i},e.mergeLocalWithDisk=function(t,i){r.ok(t.resource.toString()===i.resource.toString(),"Merging only supported for stats with the same resource");var o=t.isDirectory||i.isDirectory;if((!o||!i.isDirectoryResolved||t.isDirectoryResolved)&&(i.resource=t.resource,i.name=t.name,i.isDirectory=t.isDirectory,i.hasChildren=t.isDirectory&&t.hasChildren,i.mtime=t.mtime,i.mime=t.mime,i.isDirectoryResolved=t.isDirectoryResolved,o&&t.isDirectoryResolved)){var n=Object.create(null);i.children.forEach(function(e){n[e.resource.toString()]=e}),i.children=[],t.children.forEach(function(t){var r=n[t.resource.toString()];r?(e.mergeLocalWithDisk(t,r),r.parent=i,i.children.push(r)):(t.parent=i,i.children.push(t))})}},e.prototype.clone=function(){var t=new e(o["default"].parse(this.resource.toString()),this.isDirectory,this.hasChildren,this.name,this.mtime,this.etag);return t.isDirectoryResolved=this.isDirectoryResolved,this.parent&&(t.parent=this.parent),this.isDirectory&&this.children.forEach(function(e){t.addChild(e.clone())}),t},e.prototype.addChild=function(e){r.ok(this.isDirectory,"Can only add a child to a folder"),this.removeChild(e),e.parent=this,e.updateResource(!1),this.children.push(e),this.hasChildren=this.children.length>0},e.prototype.hasChild=function(e,t,o){void 0===o&&(o=c.ANY),r.ok(this.isDirectory,"Can only call hasChild on a directory"),r.ok(i.isString(e),"Expected parameter of type String");for(var n=0;n<this.children.length;n++){var s=this.children[n];if(!(o===c.FILE&&s.isDirectory||o===c.FOLDER&&!s.isDirectory)){if(s.name===e)return!0;if(t&&s.name.toLowerCase()===e.toLowerCase())return!0}}return!1},e.prototype.removeChild=function(e){r.ok(this.isDirectory,"Can only remove a child from a directory"),r.ok(!!this.children,"Expected children for directory but found none: "+this.resource.fsPath);for(var t=0;t<this.children.length;t++)if(this.children[t].resource.toString()===e.resource.toString()){this.children.splice(t,1);break}this.hasChildren=this.children.length>0},e.prototype.move=function(e,t,i){var o=this;r.ok(e.isDirectory,"Can only move an element into a directory"),t||(t=function(e){e()}),this.parent.removeChild(this),t(function(){e.addChild(o),o.updateResource(!0),i&&i()})},e.prototype.updateResource=function(e){this.resource=o["default"].file(s.join(this.parent.resource.fsPath,this.name)),e&&this.isDirectory&&this.hasChildren&&this.children&&this.children.forEach(function(e){e.updateResource(!0)})},e.prototype.rename=function(e){this.name=e.name,this.mime=e.mime,this.mtime=e.mtime,this.updateResource(!0)},e.prototype.find=function(e){if(this.fileResourceEquals(e,this.resource))return this;if(!this.hasChildren)return null;for(var t=0;t<this.children.length;t++){var r=this.children[t];if(this.fileResourceEquals(e,r.resource))return r;if(r.isDirectory&&s.isEqualOrParent(e.fsPath,r.resource.fsPath))return r.find(e)}return null},e.prototype.fileResourceEquals=function(e,t){var r=e.toString()===t.toString();return n.isLinux||r?r:e.toString().toLowerCase()===t.toString().toLowerCase()},e}();t.FileStat=a;var l=function(e){function t(r){e.call(this,o["default"].file("")),this.id=t.ID++,this.isDirectoryResolved=r}return __extends(t,e),t.prototype.destroy=function(){this.parent.removeChild(this),this.isDirectoryResolved=void 0,this.name=void 0,this.isDirectory=void 0,this.hasChildren=void 0,this.mtime=void 0,this.mime=void 0},t.prototype.getId=function(){return"new-stat-placeholder:"+this.id+":"+this.parent.resource.toString()},t.prototype.clone=function(){var e=new t(this.isDirectory);return e.parent=this.parent,e},t.prototype.addChild=function(e){throw new Error("Can't perform operations in NewStatPlaceholder.")},t.prototype.hasChild=function(e,t){return!1},t.prototype.removeChild=function(e){throw new Error("Can't perform operations in NewStatPlaceholder.")},t.prototype.move=function(e){throw new Error("Can't perform operations in NewStatPlaceholder.")},t.prototype.rename=function(e){throw new Error("Can't perform operations in NewStatPlaceholder.")},t.prototype.find=function(e){return null},t.addNewStatPlaceholder=function(e,i){r.ok(e.isDirectory,"Can only add a child to a folder");var o=new t(i);return o.parent=e,e.children.push(o),e.hasChildren=e.children.length>0,o},t.ID=0,t}(a);t.NewStatPlaceholder=l});