var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,c=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,n,c):i(t,n))||c);return o>3&&c&&Object.defineProperty(t,n,c),c},__param=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};define(["require","exports","vs/nls","vs/base/common/filters","vs/base/common/winjs.base","vs/base/common/severity","vs/workbench/parts/git/common/git","vs/workbench/browser/quickopen","vs/base/parts/quickopen/common/quickOpen","vs/base/parts/quickopen/browser/quickOpenModel","vs/workbench/services/quickopen/common/quickOpenService","vs/platform/message/common/message"],function(e,t,n,r,i,o,c,a,s,u,h,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var f=function(e){function t(t,n,r,i){e.call(this,i),this.gitService=t,this.messageService=n,this.ref=r}return __extends(t,e),t.prototype.getIcon=function(){return"git"},t.prototype.getLabel=function(){return this.ref.name},t.prototype.getDescription=function(){return""},t.prototype.getAriaLabel=function(){return n.localize("refAriaLabel","{0}, git",this.getLabel())},t.prototype.run=function(e,t){return e!==s.Mode.PREVIEW},t}(u.QuickOpenEntry),g=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getDescription=function(){return n.localize("checkoutBranch","Branch at {0}",this.ref.commit.substr(0,8))},t.prototype.run=function(e,t){var n=this;return e!==s.Mode.PREVIEW&&(this.gitService.checkout(this.ref.name).done(null,function(e){return n.messageService.show(o["default"].Error,e)}),!0)},t}(f),p=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getDescription=function(){return n.localize("checkoutRemoteBranch","Remote branch at {0}",this.ref.commit.substr(0,8))},t.prototype.run=function(e,t){var n=this;if(e===s.Mode.PREVIEW)return!1;var r=/^[^\/]+\/(.*)$/.exec(this.ref.name),i=r?r[1]:this.ref.name;return this.gitService.checkout(i).done(null,function(e){return n.messageService.show(o["default"].Error,e)}),!0},t}(f),m=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getDescription=function(){return n.localize("checkoutTag","Tag at {0}",this.ref.commit.substr(0,8))},t.prototype.run=function(e,t){var n=this;return e!==s.Mode.PREVIEW&&(this.gitService.checkout(this.ref.name).done(null,function(e){return n.messageService.show(o["default"].Error,e)}),!0)},t}(f),v=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getDescription=function(){return n.localize("alreadyCheckedOut","Branch {0} is already the current branch",this.ref.name)},t}(f),d=function(e){function t(t,n,r){e.call(this,[{start:0,end:r.length}]),this.gitService=t,this.messageService=n,this.name=r}return __extends(t,e),t.prototype.getIcon=function(){return"git"},t.prototype.getLabel=function(){return this.name},t.prototype.getAriaLabel=function(){return n.localize({key:"branchAriaLabel",comment:["the branch name"]},"{0}, git branch",this.getLabel())},t.prototype.getDescription=function(){return n.localize("createBranch","Create branch {0}",this.name)},t.prototype.run=function(e,t){var n=this;return e!==s.Mode.PREVIEW&&(this.gitService.branch(this.name,!0).done(null,function(e){return n.messageService.show(o["default"].Error,e)}),!0)},t}(u.QuickOpenEntry),y=function(){function e(e,t){this.gitService=e,this.messageService=t,this.aliases=["checkout","co"],this.icon="git"}return e.prototype.getResults=function(e){var t=this;e=e.trim();var n=this.gitService.getModel(),o=n.getHEAD(),a=n.getRefs(),s=a.filter(function(e){return e.type===c.RefType.Head}),h=a.filter(function(e){return e.type===c.RefType.Tag}),l=a.filter(function(e){return e.type===c.RefType.RemoteHead}),f=s.map(function(t){return{head:t,highlights:r.matchesContiguousSubString(e,t.name)}}).filter(function(e){var t=e.highlights;return!!t}),y=f.filter(function(e){var t=e.head;return t.name!==o.name}).map(function(e){var n=e.head,r=e.highlights;return new g(t.gitService,t.messageService,n,r)}),b=h.map(function(t){return{head:t,highlights:r.matchesContiguousSubString(e,t.name)}}).filter(function(e){var t=e.highlights;return!!t}),S=b.filter(function(e){var t=e.head;return t.name!==o.name}).map(function(e){var n=e.head,r=e.highlights;return new m(t.gitService,t.messageService,n,r)}),_=y.concat(S).sort(function(e,t){return e.getLabel().localeCompare(t.getLabel())}),k=l.map(function(t){return{head:t,highlights:r.matchesContiguousSubString(e,t.name)}}).filter(function(e){var t=e.highlights;return!!t}),w=k.filter(function(e){var t=e.head;return t.name!==o.name}).map(function(e){var n=e.head,r=e.highlights;return new p(t.gitService,t.messageService,n,r)}).sort(function(e,t){return e.getLabel().localeCompare(t.getLabel())});_.length>0&&(_[0]=new u.QuickOpenEntryGroup(_[0],"checkout",(!1))),w.length>0&&(w[0]=new u.QuickOpenEntryGroup(w[0],"checkout remote",_.length>0));var E=_.sort(function(e,t){return e.getLabel().localeCompare(t.getLabel())}).concat(w),O=f.concat(b).concat(k),R=O.filter(function(t){var n=t.head;return n.name===e}),L=R.filter(function(e){var t=e.head;return t.name===o.name});if(L.length>0)E.unshift(new v(this.gitService,this.messageService,L[0].head,L[0].highlights));else if(0===R.length&&c.isValidBranchName(e)){var P=new d(this.gitService,this.messageService,e);E.push(new u.QuickOpenEntryGroup(P,"branch",_.length>0||w.length>0))}return i.TPromise.as(E)},e.prototype.getEmptyLabel=function(e){return n.localize("noBranches","No other branches")},e}(),b=function(){function e(e,t){this.gitService=e,this.messageService=t,this.aliases=["branch"],this.icon="git"}return e.prototype.getResults=function(e){if(e=e.trim(),!c.isValidBranchName(e))return i.TPromise.as([]);var t=this.gitService.getModel(),n=t.getHEAD(),o=t.getRefs().map(function(t){return{head:t,highlights:r.matchesContiguousSubString(e,t.name)}}).filter(function(e){var t=e.highlights;return!!t}),a=o.filter(function(t){var n=t.head;return n.name===e}),s=a.filter(function(e){var t=e.head;return t.name===n.name});if(s.length>0)return i.TPromise.as([new v(this.gitService,this.messageService,s[0].head,s[0].highlights)]);if(a.length>0)return i.TPromise.as([new g(this.gitService,this.messageService,a[0].head,a[0].highlights)]);var h=new d(this.gitService,this.messageService,e);return i.TPromise.as([new u.QuickOpenEntryGroup(h,"branch",(!1))])},e.prototype.getEmptyLabel=function(e){return n.localize("notValidBranchName","Please provide a valid branch name")},e}(),S=function(e){function t(t,n,r){e.call(this,t,{prefix:"git",commands:[new y(n,r),new b(n,r)]})}return __extends(t,e),t=__decorate([__param(0,h.IQuickOpenService),__param(1,c.IGitService),__param(2,l.IMessageService)],t)}(a.CommandQuickOpenHandler);t.GitCommandQuickOpenHandler=S});