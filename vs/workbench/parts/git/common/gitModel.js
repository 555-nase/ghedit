var __extends=this&&this.__extends||function(t,e){function s(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)};define(["require","exports","vs/base/common/lifecycle","vs/base/common/strings","vs/base/common/eventEmitter","vs/workbench/parts/git/common/git"],function(t,e,s,i,n,a){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var u=function(){function t(e,s,i,n,a){this.path=e,this.mimetype=s,this.status=i,this.rename=n,this.id=t.typeOf(i)+":"+e+(n?":"+n:"")+(a?"$":""),this.pathComponents=e.split("/")}return t.prototype.getPath=function(){return this.path},t.prototype.getPathComponents=function(){return this.pathComponents.slice(0)},t.prototype.getMimetype=function(){return this.mimetype},t.prototype.getStatus=function(){return this.status},t.prototype.getRename=function(){return this.rename},t.prototype.getId=function(){return this.id},t.prototype.getType=function(){switch(t.typeOf(this.status)){case"index":return a.StatusType.INDEX;case"workingTree":return a.StatusType.WORKING_TREE;default:return a.StatusType.MERGE}},t.prototype.clone=function(){return new t(this.path,this.mimetype,this.status,this.rename)},t.prototype.update=function(t){this.status=t.getStatus(),this.rename=t.getRename()},t.typeOf=function(t){switch(t){case a.Status.INDEX_MODIFIED:case a.Status.INDEX_ADDED:case a.Status.INDEX_DELETED:case a.Status.INDEX_RENAMED:case a.Status.INDEX_COPIED:return"index";case a.Status.MODIFIED:case a.Status.DELETED:case a.Status.UNTRACKED:case a.Status.IGNORED:return"workingTree";default:return"merge"}},t}();e.FileStatus=u;var r=function(t){function e(e){t.call(this),this.type=e,this.statusSet=Object.create(null),this.statusList=[],this.statusByName=Object.create(null),this.statusByRename=Object.create(null)}return __extends(e,t),e.prototype.getType=function(){return this.type},e.prototype.update=function(t){var e,s,i,n,a=Object.create(null);for(e in this.statusSet)a[e]=this.statusSet[e];for(var u=0;u<t.length;u++)n=t[u],e=n.getId(),s=n.getPath(),i=n.getRename(),a[e]?(this.statusSet[e].update(n),a[e]=null):this.statusSet[e]=n;for(e in a)(n=a[e])&&(this.emit("fileStatus:dispose",n),delete this.statusSet[e]);this.statusList=[],this.statusByName=Object.create(null),this.statusByRename=Object.create(null);for(e in this.statusSet)n=this.statusSet[e],this.statusList.push(n),n.getRename()?this.statusByRename[n.getPath()]=n:this.statusByName[n.getPath()]=n},e.prototype.all=function(){return this.statusList},e.prototype.find=function(t){return this.statusByName[t]||this.statusByRename[t]||null},e.prototype.dispose=function(){this.type=null,this.statusSet=null,this.statusList=null,this.statusByName=null,this.statusByRename=null,t.prototype.dispose.call(this)},e}(n.EventEmitter);e.StatusGroup=r;var o=function(t){function e(){t.call(this),this.indexStatus=new r(a.StatusType.INDEX),this.workingTreeStatus=new r(a.StatusType.WORKING_TREE),this.mergeStatus=new r(a.StatusType.MERGE),this.toDispose=[this.addEmitter2(this.indexStatus),this.addEmitter2(this.workingTreeStatus),this.addEmitter2(this.mergeStatus)]}return __extends(e,t),e.prototype.getSummary=function(){return{hasWorkingTreeChanges:this.getWorkingTreeStatus().all().length>0,hasIndexChanges:this.getIndexStatus().all().length>0,hasMergeChanges:this.getMergeStatus().all().length>0}},e.prototype.update=function(t){var e=[],s=[],i=[];t.forEach(function(t){switch(t.x+t.y){case"??":return s.push(new u(t.path,t.mimetype,a.Status.UNTRACKED));case"!!":return s.push(new u(t.path,t.mimetype,a.Status.IGNORED));case"DD":return i.push(new u(t.path,t.mimetype,a.Status.BOTH_DELETED));case"AU":return i.push(new u(t.path,t.mimetype,a.Status.ADDED_BY_US));case"UD":return i.push(new u(t.path,t.mimetype,a.Status.DELETED_BY_THEM));case"UA":return i.push(new u(t.path,t.mimetype,a.Status.ADDED_BY_THEM));case"DU":return i.push(new u(t.path,t.mimetype,a.Status.DELETED_BY_US));case"AA":return i.push(new u(t.path,t.mimetype,a.Status.BOTH_ADDED));case"UU":return i.push(new u(t.path,t.mimetype,a.Status.BOTH_MODIFIED))}var n=!1;switch(t.x){case"M":e.push(new u(t.path,t.mimetype,a.Status.INDEX_MODIFIED)),n=!0;break;case"A":e.push(new u(t.path,t.mimetype,a.Status.INDEX_ADDED));break;case"D":e.push(new u(t.path,t.mimetype,a.Status.INDEX_DELETED));break;case"R":e.push(new u(t.path,t.mimetype,a.Status.INDEX_RENAMED,t.rename));break;case"C":e.push(new u(t.path,t.mimetype,a.Status.INDEX_COPIED))}switch(t.y){case"M":s.push(new u(t.path,t.mimetype,a.Status.MODIFIED,t.rename,n));break;case"D":s.push(new u(t.path,t.mimetype,a.Status.DELETED,t.rename))}}),this.indexStatus.update(e),this.workingTreeStatus.update(s),this.mergeStatus.update(i),this.emit(a.ModelEvents.STATUS_MODEL_UPDATED)},e.prototype.getIndexStatus=function(){return this.indexStatus},e.prototype.getWorkingTreeStatus=function(){return this.workingTreeStatus},e.prototype.getMergeStatus=function(){return this.mergeStatus},e.prototype.getGroups=function(){return[this.mergeStatus,this.indexStatus,this.workingTreeStatus]},e.prototype.find=function(t,e){var s;switch(e){case a.StatusType.INDEX:s=this.indexStatus;break;case a.StatusType.WORKING_TREE:s=this.workingTreeStatus;break;case a.StatusType.MERGE:s=this.mergeStatus;break;default:return null}return s.find(t)},e.prototype.dispose=function(){this.toDispose=s.dispose(this.toDispose),this.indexStatus&&(this.indexStatus.dispose(),this.indexStatus=null),this.workingTreeStatus&&(this.workingTreeStatus.dispose(),this.workingTreeStatus=null),this.mergeStatus&&(this.mergeStatus.dispose(),this.mergeStatus=null),t.prototype.dispose.call(this)},e}(n.EventEmitter);e.StatusModel=o;var h=function(t){function e(){t.call(this),this.toDispose=[],this.repositoryRoot=null,this.status=new o,this.toDispose.push(this.addEmitter2(this.status)),this.HEAD=null,this.refs=[],this.remotes=[]}return __extends(e,t),e.prototype.getRepositoryRoot=function(){return this.repositoryRoot},e.prototype.getStatus=function(){return this.status},e.prototype.getHEAD=function(){return this.HEAD},e.prototype.getRefs=function(){return this.refs},e.prototype.getRemotes=function(){return this.remotes},e.prototype.update=function(t){t||(t={repositoryRoot:null,status:[],HEAD:null,refs:[],remotes:[]}),this.repositoryRoot=t.repositoryRoot,this.status.update(t.status),this.HEAD=t.HEAD,this.emit(a.ModelEvents.HEAD_UPDATED),this.refs=t.refs,this.emit(a.ModelEvents.REFS_UPDATED),this.remotes=t.remotes,this.emit(a.ModelEvents.REMOTES_UPDATED),this.emit(a.ModelEvents.MODEL_UPDATED)},e.prototype.getStatusSummary=function(){var t=this.getStatus();return{hasWorkingTreeChanges:t.getWorkingTreeStatus().all().length>0,hasIndexChanges:t.getIndexStatus().all().length>0,hasMergeChanges:t.getMergeStatus().all().length>0}},e.prototype.getPS1=function(){if(!this.HEAD)return"";var t=this.HEAD.name||this.HEAD.commit.substr(0,8),e=this.getStatus().getSummary();return i.format("{0}{1}{2}{3}",t,e.hasWorkingTreeChanges?"*":"",e.hasIndexChanges?"+":"",e.hasMergeChanges?"!":"")},e.prototype.dispose=function(){this.toDispose=s.dispose(this.toDispose),t.prototype.dispose.call(this)},e}(n.EventEmitter);e.Model=h});