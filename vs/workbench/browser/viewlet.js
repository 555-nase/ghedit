/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,i,s):n(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/browser/dom","vs/base/common/errors","vs/platform/platform","vs/base/browser/builder","vs/base/common/actions","vs/base/browser/ui/actionbar/actionbar","vs/workbench/browser/actionBarRegistry","vs/base/browser/ui/toolbar/toolbar","vs/base/browser/dnd","vs/base/common/lifecycle","vs/base/browser/ui/splitview/splitview","vs/workbench/services/viewlet/common/viewletService","vs/workbench/services/editor/common/editorService","vs/workbench/browser/composite"],function(e,t,i,o,n,r,s,a,l,c,p,u,h,d,v,f,w,y){"use strict";function g(e){var t=document.createElement("div");return e.appendChild(t),t}function b(e,t){e&&(t?a.$(e.getHTMLElement()).show():a.$(e.getHTMLElement()).hide(),t?e.onVisible():e.onHidden())}function m(e){if(e){var t=e.getSelection();t.length>0&&S(e,t[0],.5).done(null,r.onUnexpectedError),e.DOMFocus()}}function S(e,t,i){return e?e.reveal(t,i):o.TPromise.as(null)}var V=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getOptimalWidth=function(){return null},t}(y.Composite);t.Viewlet=V;var A=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.create=function(t){var i=this;return e.prototype.create.call(this,t),this.viewerContainer=t.div(),this.viewer=this.createViewer(this.viewerContainer),this.toUnbind.push(this.viewer.addListener2("selection",function(e){return i.onSelection(e)})),this.toUnbind.push(this.viewer.addListener2("focus",function(e){return i.onFocus(e)})),o.TPromise.as(null)},t.prototype.getViewer=function(){return this.viewer},t.prototype.setVisible=function(t){var i;return t?(i=e.prototype.setVisible.call(this,t),this.getViewer().onVisible()):(this.getViewer().onHidden(),i=e.prototype.setVisible.call(this,t)),i},t.prototype.focus=function(){if(this.viewer){var e=this.viewer.getSelection();e.length>0&&this.reveal(e[0],.5).done(null,r.onUnexpectedError),this.viewer.DOMFocus()}},t.prototype.reveal=function(e,t){return this.viewer?(this.wasLayouted||this.viewer.layout(),this.viewer.reveal(e,t)):o.TPromise.as(null)},t.prototype.layout=function(e){this.viewer&&(this.wasLayouted=!0,this.viewer.layout(e.height))},t.prototype.getControl=function(){return this.viewer},t.prototype.dispose=function(){this.viewer&&this.viewer.dispose(),e.prototype.dispose.call(this)},t}(V);t.ViewerViewlet=A;var D=function(e){function t(t,i,o,n,r,s,a){e.call(this,t,i,o,n,r,s),this.isGlobal=a||!1}return __extends(t,e),t}(y.CompositeDescriptor);t.ViewletDescriptor=D,t.Extensions={Viewlets:"workbench.contributions.viewlets"};var _=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.registerViewlet=function(t){e.prototype.registerComposite.call(this,t)},t.prototype.getViewlet=function(e){return this.getComposite(e)},t.prototype.getViewlets=function(){return this.getComposits()},t.prototype.setDefaultViewletId=function(e){this.defaultViewletId=e},t.prototype.getDefaultViewletId=function(){return this.defaultViewletId},t}(y.CompositeRegistry);t.ViewletRegistry=_,s.Registry.add(t.Extensions.Viewlets,new _);var C=function(e){function t(t,i,o,n,r){e.call(this,t,i),this.viewletService=n,this.editorService=r,this.viewletId=o,this.enabled=!!this.viewletService&&!!this.editorService}return __extends(t,e),t.prototype.run=function(){if(this.otherViewletShowing()||!this.sidebarHasFocus())return this.viewletService.openViewlet(this.viewletId,!0);var e=this.editorService.getActiveEditor();return e&&e.focus(),o.TPromise.as(!0)},t.prototype.otherViewletShowing=function(){var e=this.viewletService.getActiveViewlet();return!e||e.getId()!==this.viewletId},t.prototype.sidebarHasFocus=function(){var e=this.viewletService.getActiveViewlet(),t=document.activeElement;return e&&t&&n.isAncestor(t,e.getContainer().getHTMLElement())},t=__decorate([__param(3,f.IViewletService),__param(4,w.IWorkbenchEditorService)],t)}(l.Action);t.ToggleViewletAction=C;var E=function(e){function t(t,n,r){e.call(this,"workbench.action.collapse",i.localize("collapse","Collapse All"),r,n,function(e){return t.getHighlight()?o.TPromise.as(null):(t.collapseAll(),t.clearSelection(),t.clearFocus(),t.DOMFocus(),t.focusFirst(),o.TPromise.as(null))})}return __extends(t,e),t}(l.Action);t.CollapseAction=E;var x=function(e){function t(t,i,o,n,r,s,a){e.call(this,{expandedBodySize:i,headerSize:22,initialState:o?v.CollapsibleState.COLLAPSED:v.CollapsibleState.EXPANDED,ariaHeaderLabel:n}),this.viewName=n,this.messageService=r,this.keybindingService=s,this.contextMenuService=a,this.actionRunner=t,this.toDispose=[]}return __extends(t,e),t.prototype.create=function(){return o.TPromise.as(null)},t.prototype.renderHeader=function(e){var t=this;this.toolBar=new u.ToolBar(a.$("div.actions").appendTo(e).getHTMLElement(),this.contextMenuService,{orientation:c.ActionsOrientation.HORIZONTAL,actionItemProvider:function(e){return t.getActionItem(e)},ariaLabel:i.localize("viewToolbarAriaLabel","{0} actions",this.viewName),getKeyBinding:function(e){var i=t.keybindingService.lookupKeybindings(e.id);return i.length>0?i[0]:null}}),this.toolBar.actionRunner=this.actionRunner,this.toolBar.setActions(p.prepareActions(this.getActions()),p.prepareActions(this.getSecondaryActions()))(),this.dragHandler=new h.DelayedDragHandler(e,function(){t.isExpanded()||t.expand()})},t.prototype.changeState=function(t){b(this.tree,t===v.CollapsibleState.EXPANDED),e.prototype.changeState.call(this,t)},t.prototype.renderViewTree=function(e){return g(e)},t.prototype.getViewer=function(){return this.tree},t.prototype.setVisible=function(e){return this.isVisible=e,b(this.tree,e&&this.state===v.CollapsibleState.EXPANDED),o.TPromise.as(null)},t.prototype.focusBody=function(){m(this.tree)},t.prototype.reveal=function(e,t){return S(this.tree,e,t)},t.prototype.layoutBody=function(e){this.treeContainer.style.height=e+"px",this.tree.layout(e)},t.prototype.getActions=function(){return[]},t.prototype.getSecondaryActions=function(){return[]},t.prototype.getActionItem=function(e){return null},t.prototype.shutdown=function(){},t.prototype.dispose=function(){this.isDisposed=!0,this.treeContainer=null,this.tree.dispose(),this.dragHandler.dispose(),this.toDispose=d.dispose(this.toDispose),this.toolBar&&this.toolBar.dispose(),e.prototype.dispose.call(this)},t}(v.FixedCollapsibleView);t.AdaptiveCollapsibleViewletView=x;var T=function(e){function t(t,i,o,n,r,s,a){e.call(this,{minimumSize:44,initialState:i?v.CollapsibleState.COLLAPSED:v.CollapsibleState.EXPANDED,ariaHeaderLabel:o,headerSize:a}),this.viewName=o,this.messageService=n,this.keybindingService=r,this.contextMenuService=s,this.actionRunner=t,this.toDispose=[]}return __extends(t,e),t.prototype.changeState=function(t){b(this.tree,t===v.CollapsibleState.EXPANDED),e.prototype.changeState.call(this,t)},t.prototype.create=function(){return o.TPromise.as(null)},t.prototype.renderHeader=function(e){var t=this;this.toolBar=new u.ToolBar(a.$("div.actions").appendTo(e).getHTMLElement(),this.contextMenuService,{orientation:c.ActionsOrientation.HORIZONTAL,actionItemProvider:function(e){return t.getActionItem(e)},ariaLabel:i.localize("viewToolbarAriaLabel","{0} actions",this.viewName),getKeyBinding:function(e){var i=t.keybindingService.lookupKeybindings(e.id);return i.length>0?i[0]:null}}),this.toolBar.actionRunner=this.actionRunner,this.toolBar.setActions(p.prepareActions(this.getActions()),p.prepareActions(this.getSecondaryActions()))(),this.dragHandler=new h.DelayedDragHandler(e,function(){t.isExpanded()||t.expand()})},t.prototype.renderViewTree=function(e){return g(e)},t.prototype.getViewer=function(){return this.tree},t.prototype.setVisible=function(e){return this.isVisible=e,b(this.tree,e&&this.state===v.CollapsibleState.EXPANDED),o.TPromise.as(null)},t.prototype.focusBody=function(){m(this.tree)},t.prototype.reveal=function(e,t){return S(this.tree,e,t)},t.prototype.layoutBody=function(e){this.treeContainer.style.height=e+"px",this.tree.layout(e)},t.prototype.getActions=function(){return[]},t.prototype.getSecondaryActions=function(){return[]},t.prototype.getActionItem=function(e){return null},t.prototype.shutdown=function(){},t.prototype.dispose=function(){this.isDisposed=!0,this.treeContainer=null,this.tree.dispose(),this.dragHandler&&this.dragHandler.dispose(),this.toDispose=d.dispose(this.toDispose),this.toolBar&&this.toolBar.dispose(),e.prototype.dispose.call(this)},t}(v.CollapsibleView);t.CollapsibleViewletView=T});