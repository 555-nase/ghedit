var __decorate=this&&this.__decorate||function(t,e,i,r){var s,h=arguments.length,n=h<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(h<3?s(n):h>3?s(e,i,n):s(e,i))||n);return h>3&&n&&Object.defineProperty(e,i,n),n},__param=this&&this.__param||function(t,e){return function(i,r){e(i,r,t)}};define(["require","exports","vs/base/browser/builder","vs/base/browser/ui/sash/sash","vs/workbench/services/editor/common/editorService","vs/workbench/services/part/common/partService","vs/workbench/services/workspace/common/contextService","vs/workbench/services/viewlet/common/viewletService","vs/platform/storage/common/storage","vs/platform/contextview/browser/contextView","vs/platform/event/common/event","vs/workbench/services/themes/common/themeService","vs/base/common/lifecycle","vs/workbench/services/group/common/groupService"],function(t,e,i,r,s,h,n,a,o,d,c,p,g,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var S=170,u=77,m=170,b=50,v=50,y=function(){function t(){this.margin=new i.Box(0,0,0,0)}return t.prototype.setMargin=function(t){return this.margin=t,this},t}();e.LayoutOptions=y;var w=function(){function t(e,i,s,h,n,a,d,c,p,g,l,S,u,m){var b=this;this.storageService=a,this.contextViewService=c,this.editorService=p,this.editorGroupService=g,this.contextService=l,this.partService=S,this.viewletService=u,this.parent=e,this.workbenchContainer=i,this.activitybar=s.activitybar,this.editor=s.editor,this.sidebar=s.sidebar,this.panel=s.panel,this.statusbar=s.statusbar,this.quickopen=h,this.options=n||new y,this.toUnbind=[],this.computedStyles=null,this.sashX=new r.Sash(this.workbenchContainer.getHTMLElement(),this,{baseSize:5}),this.sashY=new r.Sash(this.workbenchContainer.getHTMLElement(),this,{baseSize:4,orientation:r.Orientation.HORIZONTAL}),this.sidebarWidth=this.storageService.getInteger(t.sashXWidthSettingsKey,o.StorageScope.GLOBAL,-1),this.panelHeight=this.storageService.getInteger(t.sashYHeightSettingsKey,o.StorageScope.GLOBAL,0),this.toUnbind.push(m.onDidThemeChange(function(t){return b.relayout()})),this.toUnbind.push(g.onEditorsChanged(function(){return b.onEditorsChanged()})),this.registerSashListeners()}return t.prototype.registerSashListeners=function(){var e=this,i=0,r=0;this.sashX.addListener2("start",function(t){e.startSidebarWidth=e.sidebarWidth,i=t.startX}),this.sashY.addListener2("start",function(t){e.startPanelHeight=e.panelHeight,r=t.startY}),this.sashX.addListener2("change",function(t){var r=!1,s=e.partService.getSideBarPosition(),n=e.partService.isSideBarHidden(),a=s===h.Position.LEFT?e.startSidebarWidth+t.currentX-i:e.startSidebarWidth-t.currentX+i;if(n)(s===h.Position.LEFT&&t.currentX-i>=e.computedStyles.sidebar.minWidth||s===h.Position.RIGHT&&i-t.currentX>=e.computedStyles.sidebar.minWidth)&&(e.startSidebarWidth=e.computedStyles.sidebar.minWidth-(s===h.Position.LEFT?t.currentX-i:i-t.currentX),e.sidebarWidth=e.computedStyles.sidebar.minWidth,e.partService.setSideBarHidden(!1));else if(a+b<e.computedStyles.sidebar.minWidth){var o=S-b;e.partService.setSideBarHidden(!0),i=s===h.Position.LEFT?Math.max(e.computedStyles.activitybar.minWidth,t.currentX-o):Math.min(t.currentX+o,e.workbenchSize.width-e.computedStyles.activitybar.minWidth),e.sidebarWidth=e.startSidebarWidth}else e.sidebarWidth=Math.max(e.computedStyles.sidebar.minWidth,a),r=a>=e.computedStyles.sidebar.minWidth;r&&e.layout()}),this.sashY.addListener2("change",function(t){var i=!1,s=e.partService.isPanelHidden(),h=e.partService.isStatusBarHidden(),n=e.startPanelHeight-(t.currentY-r);if(s)r-t.currentY>=e.computedStyles.panel.minHeight&&(e.startPanelHeight=0,e.panelHeight=e.computedStyles.panel.minHeight,e.partService.setPanelHidden(!1));else if(n+v<e.computedStyles.panel.minHeight){var a=u-v;e.partService.setPanelHidden(!0);var o=h?0:e.computedStyles.statusbar.height;r=Math.min(e.sidebarHeight-o,t.currentY+a),e.panelHeight=e.startPanelHeight}else e.panelHeight=Math.max(e.computedStyles.panel.minHeight,n),i=n>=e.computedStyles.panel.minHeight;i&&e.layout()}),this.sashX.addListener2("end",function(){e.storageService.store(t.sashXWidthSettingsKey,e.sidebarWidth,o.StorageScope.GLOBAL)}),this.sashY.addListener2("end",function(){e.storageService.store(t.sashYHeightSettingsKey,e.panelHeight,o.StorageScope.GLOBAL)}),this.sashY.addListener2("reset",function(){e.panelHeight=u,e.storageService.store(t.sashYHeightSettingsKey,e.panelHeight,o.StorageScope.GLOBAL),e.partService.setPanelHidden(!1),e.layout()}),this.sashX.addListener2("reset",function(){var i=e.viewletService.getActiveViewlet(),r=i&&i.getOptimalWidth();e.sidebarWidth=Math.max(S,r||0),e.storageService.store(t.sashXWidthSettingsKey,e.sidebarWidth,o.StorageScope.GLOBAL),e.partService.setSideBarHidden(!1),e.layout()})},t.prototype.onEditorsChanged=function(){if(this.workbenchSize&&this.sidebarWidth){var t=this.editorService.getVisibleEditors().length;t>1&&this.workbenchSize.width-this.sidebarWidth<t*S&&this.layout()}},t.prototype.relayout=function(){this.computeStyle(),this.editor.getLayout().computeStyle(),this.sidebar.getLayout().computeStyle(),this.panel.getLayout().computeStyle(),this.layout()},t.prototype.computeStyle=function(){var t=this.sidebar.getContainer().getComputedStyle(),e=this.panel.getContainer().getComputedStyle(),i=this.editor.getContainer().getComputedStyle(),r=this.activitybar.getContainer().getComputedStyle(),s=this.statusbar.getContainer().getComputedStyle();this.computedStyles={activitybar:{minWidth:parseInt(r.getPropertyValue("min-width"),10)||0},sidebar:{minWidth:parseInt(t.getPropertyValue("min-width"),10)||S},panel:{minHeight:parseInt(e.getPropertyValue("min-height"),10)||u},editor:{minWidth:parseInt(i.getPropertyValue("min-width"),10)||S},statusbar:{height:parseInt(s.getPropertyValue("height"),10)||18}}},t.prototype.layout=function(e){e&&(this.computeStyle(),this.editor.getLayout().computeStyle(),this.sidebar.getLayout().computeStyle(),this.panel.getLayout().computeStyle()),this.computedStyles||this.computeStyle(),this.workbenchSize=this.getWorkbenchArea();var r,s=this.partService.isSideBarHidden(),n=this.partService.isPanelHidden(),a=this.partService.getSideBarPosition(),d=this.partService.isStatusBarHidden();s?r=0:this.sidebarWidth!==-1?r=Math.max(this.computedStyles.sidebar.minWidth,this.sidebarWidth):(r=this.workbenchSize.width/5,this.sidebarWidth=r);var c=d?0:this.computedStyles.statusbar.height;this.sidebarHeight=this.workbenchSize.height-c;var p,g=new i.Dimension(r,this.sidebarHeight),l=this.computedStyles.activitybar.minWidth,u=new i.Dimension(l,g.height);p=n?0:this.panelHeight>0?Math.min(g.height-m,Math.max(this.computedStyles.panel.minHeight,this.panelHeight)):.4*g.height;var b=new i.Dimension(this.workbenchSize.width-g.width-u.width,p);this.panelWidth=b.width;var v={width:0,height:0,remainderLeft:0,remainderRight:0},y=new i.Dimension(b.width,g.height-b.height);v.width=y.width,v.height=y.height,s&&(v.width=Math.min(this.workbenchSize.width-u.width,this.workbenchSize.width-l),a===h.Position.LEFT?(v.remainderLeft=Math.round((this.workbenchSize.width-v.width+u.width)/2),v.remainderRight=this.workbenchSize.width-v.width-v.remainderLeft):(v.remainderRight=Math.round((this.workbenchSize.width-v.width+u.width)/2),v.remainderLeft=this.workbenchSize.width-v.width-v.remainderRight));var w=this.computedStyles.editor.minWidth,f=this.editorService.getVisibleEditors().length;if(f>1&&(w*=f),v.width<w){var H=w-v.width;v.width=w,b.width=w,g.width-=H,g.width=Math.max(S,g.width)}s||(this.sidebarWidth=g.width,this.storageService.store(t.sashXWidthSettingsKey,this.sidebarWidth,o.StorageScope.GLOBAL)),n||(this.panelHeight=b.height,this.storageService.store(t.sashYHeightSettingsKey,this.panelHeight,o.StorageScope.GLOBAL)),this.workbenchContainer.position(this.options.margin.top,this.options.margin.right,this.options.margin.bottom,this.options.margin.left,"relative").size(this.workbenchSize.width,this.workbenchSize.height),this.workbenchContainer.getHTMLElement().scrollTop>0&&(this.workbenchContainer.getHTMLElement().scrollTop=0),this.editor.getContainer().size(v.width,v.height),this.panel.getContainer().size(b.width,b.height);var L=c+b.height;s?(this.editor.getContainer().position(0,v.remainderRight,L,v.remainderLeft),this.panel.getContainer().position(y.height,v.remainderRight,c,v.remainderLeft)):a===h.Position.LEFT?(this.editor.getContainer().position(0,0,L,g.width+u.width),this.panel.getContainer().position(y.height,0,c,g.width+u.width)):(this.editor.getContainer().position(0,g.width,L,0),this.panel.getContainer().position(y.height,g.width,c,0)),this.activitybar.getContainer().size(null,u.height),a===h.Position.LEFT?(this.activitybar.getContainer().getHTMLElement().style.right="",this.activitybar.getContainer().position(0,null,0,0)):(this.activitybar.getContainer().getHTMLElement().style.left="",this.activitybar.getContainer().position(0,0,0,null)),this.sidebar.getContainer().size(g.width,g.height),a===h.Position.LEFT?this.sidebar.getContainer().position(0,v.width,0,u.width):this.sidebar.getContainer().position(0,null,0,v.width),this.statusbar.getContainer().position(this.workbenchSize.height-c),this.quickopen.layout(this.workbenchSize),this.sashX.layout(),this.sashY.layout(),this.editor.layout(new i.Dimension(v.width,v.height)),this.sidebar.layout(g),this.panel.layout(b),this.contextViewService.layout()},t.prototype.getWorkbenchArea=function(){var t=this.parent.getClientArea();return t.substract(this.options.margin)},t.prototype.getVerticalSashTop=function(t){return 0},t.prototype.getVerticalSashLeft=function(t){var e=this.partService.isSideBarHidden(),i=this.partService.getSideBarPosition(),r=this.computedStyles.activitybar.minWidth;return i===h.Position.LEFT?e?r:this.sidebarWidth+r:e?this.workbenchSize.width-r:this.workbenchSize.width-this.sidebarWidth-r},t.prototype.getVerticalSashHeight=function(t){return this.sidebarHeight},t.prototype.getHorizontalSashTop=function(t){return 2+(this.partService.isPanelHidden()?this.sidebarHeight:this.sidebarHeight-this.panelHeight)},t.prototype.getHorizontalSashLeft=function(t){return this.partService.getSideBarPosition()===h.Position.LEFT?this.getVerticalSashLeft(t):0},t.prototype.getHorizontalSashWidth=function(t){return this.panelWidth},t.prototype.dispose=function(){this.toUnbind&&(g.dispose(this.toUnbind),this.toUnbind=null)},t.sashXWidthSettingsKey="workbench.sidebar.width",t.sashYHeightSettingsKey="workbench.panel.height",t=__decorate([__param(5,o.IStorageService),__param(6,c.IEventService),__param(7,d.IContextViewService),__param(8,s.IWorkbenchEditorService),__param(9,l.IEditorGroupService),__param(10,n.IWorkspaceContextService),__param(11,h.IPartService),__param(12,a.IViewletService),__param(13,p.IThemeService)],t)}();e.WorkbenchLayout=w});