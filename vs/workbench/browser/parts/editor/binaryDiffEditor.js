/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},__param=this&&this.__param||function(t,e){return function(i,r){e(i,r,t)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/browser/ui/sash/sash","vs/base/browser/builder","vs/base/browser/ui/resourceviewer/resourceViewer","vs/base/browser/ui/scrollbar/scrollableElement","vs/workbench/browser/parts/editor/baseEditor","vs/workbench/common/editor/binaryEditorModel","vs/workbench/services/editor/common/editorService","vs/platform/telemetry/common/telemetry","vs/base/common/scrollable","vs/css!./media/binarydiffeditor"],function(t,e,i,r,n,o,s,a,h,l,d,c,f){"use strict";var u=function(t){function e(i,r){t.call(this,e.ID,i),this.editorService=r}return __extends(e,t),e.prototype.getTitle=function(){return this.getInput()?this.getInput().getName():r.localize("binaryDiffEditor","Binary Diff Viewer")},e.prototype.createEditor=function(t){var e=this,i=document.createElement("div");i.className="binary-container",this.leftBinaryContainer=o.$(i),this.leftBinaryContainer.tabindex(0),this.leftScrollbar=new a.DomScrollableElement(i,{canUseTranslate3d:!1,horizontal:f.ScrollbarVisibility.Auto,vertical:f.ScrollbarVisibility.Auto}),t.getHTMLElement().appendChild(this.leftScrollbar.getDomNode()),o.$(this.leftScrollbar.getDomNode()).addClass("binarydiff-left"),this.sash=new n.Sash(t.getHTMLElement(),this),this.sash.addListener2("start",function(){return e.onSashDragStart()}),this.sash.addListener2("change",function(t){return e.onSashDrag(t)}),this.sash.addListener2("end",function(){return e.onSashDragEnd()}),this.sash.addListener2("reset",function(){return e.onSashReset()});var r=document.createElement("div");r.className="binary-container",this.rightBinaryContainer=o.$(r),this.rightBinaryContainer.tabindex(0),this.rightScrollbar=new a.DomScrollableElement(r,{canUseTranslate3d:!1,horizontal:f.ScrollbarVisibility.Auto,vertical:f.ScrollbarVisibility.Auto}),t.getHTMLElement().appendChild(this.rightScrollbar.getDomNode()),o.$(this.rightScrollbar.getDomNode()).addClass("binarydiff-right")},e.prototype.setInput=function(e,n){var o=this,s=this.getInput();t.prototype.setInput.call(this,e,n);var a=n&&n.forceOpen;return!a&&e.matches(s)?i.TPromise.as(null):this.editorService.resolveEditorModel(e,!0).then(function(t){if(!(t.originalModel instanceof l.BinaryEditorModel&&t.modifiedModel instanceof l.BinaryEditorModel))return i.TPromise.wrapError(r.localize("cannotDiffTextToBinary","Comparing binary files to non binary files is currently not supported"));if(!o.getInput()||o.getInput()!==e)return null;var n=t.originalModel;o.renderInput(n.getName(),n.getResource(),n.getSize(),!0);var s=t.modifiedModel;o.renderInput(s.getName(),s.getResource(),s.getSize(),!1)})},e.prototype.renderInput=function(t,e,i,r){this.leftContainerWidth&&this.dimension&&this.leftContainerWidth!==this.dimension.width/2&&(this.leftContainerWidth=this.dimension.width/2,this.layoutContainers(),this.sash.layout());var n=r?this.leftBinaryContainer:this.rightBinaryContainer,o=r?this.leftScrollbar:this.rightScrollbar;s.ResourceViewer.show({name:t,resource:e,size:i},n,o)},e.prototype.clearInput=function(){o.$(this.leftBinaryContainer).empty(),o.$(this.rightBinaryContainer).empty(),t.prototype.clearInput.call(this)},e.prototype.layout=function(t){var e=this.dimension;if(this.dimension=t,this.leftContainerWidth&&e){var i=this.leftContainerWidth/e.width;this.leftContainerWidth=this.dimension.width*i}else this.leftContainerWidth=this.dimension.width/2;this.sash.layout(),this.layoutContainers()},e.prototype.layoutContainers=function(){this.leftBinaryContainer.size(this.leftContainerWidth,this.dimension.height),this.leftScrollbar.scanDomNode(),this.rightBinaryContainer.size(this.dimension.width-this.leftContainerWidth,this.dimension.height),this.rightScrollbar.scanDomNode()},e.prototype.onSashDragStart=function(){this.startLeftContainerWidth=this.leftContainerWidth},e.prototype.onSashDrag=function(t){var i=this.startLeftContainerWidth+t.currentX-t.startX;this.leftContainerWidth=Math.max(e.MIN_CONTAINER_WIDTH,i),this.dimension.width-this.leftContainerWidth<e.MIN_CONTAINER_WIDTH&&(this.leftContainerWidth=this.dimension.width-e.MIN_CONTAINER_WIDTH),this.layoutContainers()},e.prototype.onSashDragEnd=function(){this.sash.layout()},e.prototype.onSashReset=function(){this.leftContainerWidth=this.dimension.width/2,this.layoutContainers(),this.sash.layout()},e.prototype.getVerticalSashTop=function(t){return 0},e.prototype.getVerticalSashLeft=function(t){return this.leftContainerWidth},e.prototype.getVerticalSashHeight=function(t){return this.dimension.height},e.prototype.focus=function(){this.rightBinaryContainer.domFocus()},e.prototype.dispose=function(){this.sash.dispose(),this.leftScrollbar.dispose(),this.rightScrollbar.dispose(),this.leftBinaryContainer.destroy(),this.rightBinaryContainer.destroy(),t.prototype.dispose.call(this)},e.ID="workbench.editors.binaryResourceDiffEditor",e.MIN_CONTAINER_WIDTH=100,e=__decorate([__param(0,c.ITelemetryService),__param(1,d.IWorkbenchEditorService)],e)}(h.BaseEditor);e.BinaryResourceDiffEditor=u});