/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,s){var i,n=arguments.length,r=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(r=(n<3?i(r):n>3?i(t,o,r):i(t,o))||r);return n>3&&r&&Object.defineProperty(t,o,r),r},__param=this&&this.__param||function(e,t){return function(o,s){t(o,s,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/browser/dom","vs/base/common/platform","vs/base/common/mime","vs/workbench/common/editor","vs/base/browser/keyboardEvent","vs/base/common/keyCodes","vs/base/browser/ui/actionbar/actionbar","vs/platform/configuration/common/configuration","vs/workbench/services/editor/common/editorService","vs/platform/contextview/browser/contextView","vs/workbench/services/group/common/groupService","vs/workbench/services/untitled/common/untitledEditorService","vs/platform/message/common/message","vs/platform/telemetry/common/telemetry","vs/platform/instantiation/common/instantiation","vs/platform/keybinding/common/keybinding","vs/platform/actions/common/actions","vs/workbench/browser/parts/editor/titleControl","vs/workbench/services/quickopen/common/quickOpenService","vs/base/common/lifecycle","vs/base/browser/ui/scrollbar/scrollableElement","vs/base/common/scrollable","vs/base/browser/dnd","vs/css!./media/tabstitle"],function(e,t,o,s,i,n,r,a,c,l,d,p,b,u,v,h,m,f,E,C,y,D,g,T,_,L,S){"use strict";var R=function(e){function t(t,o,s,i,n,r,a,c,l,d,p){e.call(this,t,o,s,i,n,a,c,l,d,p),this.untitledEditorService=r,this.tabDisposeables=[],this.tabDisposeables=[]}return __extends(t,e),t.prototype.setContext=function(t){e.prototype.setContext.call(this,t),this.editorActionsToolbar.context={group:t}},t.prototype.create=function(t){var o=this;e.prototype.create.call(this,t),this.titleContainer=t,this.tabsContainer=document.createElement("div"),this.tabsContainer.setAttribute("role","tablist"),i.addClass(this.tabsContainer,"tabs-container"),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.SCROLL,function(e){i.hasClass(o.tabsContainer,"scroll")&&o.scrollbar.updateState({scrollLeft:o.tabsContainer.scrollLeft})})),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.DBLCLICK,function(e){var t=e.target;if(t instanceof HTMLElement&&0===t.className.indexOf("tabs-container"))return i.EventHelper.stop(e),o.editorService.openEditor(o.untitledEditorService.createOrGet(),{pinned:!0})})),this.scrollbar=new _.ScrollableElement(this.tabsContainer,{horizontal:L.ScrollbarVisibility.Auto,vertical:L.ScrollbarVisibility.Hidden,scrollYToX:!0,useShadows:!1,canUseTranslate3d:!0,horizontalScrollbarSize:3}),this.scrollbar.onScroll(function(e){o.tabsContainer.scrollLeft=e.scrollLeft}),this.titleContainer.appendChild(this.scrollbar.getDomNode()),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.DRAG_OVER,function(e){i.addClass(o.tabsContainer,"scroll");var t=e.target;t instanceof HTMLElement&&0===t.className.indexOf("tabs-container")&&i.addClass(o.tabsContainer,"dropfeedback")})),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.DRAG_LEAVE,function(e){i.removeClass(o.tabsContainer,"dropfeedback"),i.removeClass(o.tabsContainer,"scroll")})),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.DRAG_END,function(e){i.removeClass(o.tabsContainer,"dropfeedback"),i.removeClass(o.tabsContainer,"scroll")})),this.toDispose.push(i.addDisposableListener(this.tabsContainer,i.EventType.DROP,function(e){i.removeClass(o.tabsContainer,"dropfeedback"),i.removeClass(o.tabsContainer,"scroll");var t=e.target;if(t instanceof HTMLElement&&0===t.className.indexOf("tabs-container")){var s=o.context;if(s){var n=o.stacks.positionOfGroup(s),r=s.count;o.onDrop(e,s,n,r)}}}));var s=document.createElement("div");i.addClass(s,"editor-actions"),this.titleContainer.appendChild(s),this.createEditorActionsToolBar(s)},t.prototype.allowDragging=function(e){return"tabs-container"===e.className},t.prototype.doUpdate=function(){var e=this;if(this.context){var t=this.context,o=this.stacks.isActive(t);o?i.addClass(this.titleContainer,"active"):i.removeClass(this.titleContainer,"active"),this.context.getEditors().forEach(function(o,s){var n=e.tabsContainer.children[s];if(n instanceof HTMLElement){var r=t.isPinned(o),a=t.isActive(o),c=o.isDirty();r?i.addClass(n,"pinned"):i.removeClass(n,"pinned"),a?(i.addClass(n,"active"),n.setAttribute("aria-selected","true"),e.activeTab=n):(i.removeClass(n,"active"),n.setAttribute("aria-selected","false")),c?i.addClass(n,"dirty"):i.removeClass(n,"dirty")}}),this.updateEditorActionsToolbar(),this.layout()}},t.prototype.doRefresh=function(){var e=this.context,t=e&&e.activeEditor;return t?(this.refreshTabs(e),void this.doUpdate()):(this.clearTabs(),void this.clearEditorActionsToolbar())},t.prototype.clearTabs=function(){i.clearNode(this.tabsContainer),T.dispose(this.tabDisposeables),this.tabDisposeables=[]},t.prototype.refreshTabs=function(e){var t=this;this.clearTabs();var s=[];this.context.getEditors().forEach(function(n){var r=n.getDescription(!0)||"",a=document.createElement("div");a.title=r,a.draggable=!0,a.tabIndex=0,a.setAttribute("role","presentation"),a.setAttribute("aria-label","tab, "+n.getName()),i.addClass(a,"tab monaco-editor-background"),s.push(a);var c=document.createElement("div");a.appendChild(c),i.addClass(c,"tab-label");var l=document.createElement("a");l.innerText=n.getName(),c.appendChild(l);var p=document.createElement("div");i.addClass(p,"tab-close"),a.appendChild(p);var b=new d.ActionBar(p,{context:{editor:n,group:e},ariaLabel:o.localize("araLabelTabActions","Tab actions")});b.push(t.closeEditorAction,{icon:!0,label:!1}),t.tabDisposeables.push(b),t.hookTabListeners(a,{editor:n,group:e})}),s.forEach(function(e){return t.tabsContainer.appendChild(e)})},t.prototype.layout=function(){if(this.activeTab){var e=this.tabsContainer.offsetWidth,t=this.tabsContainer.scrollWidth;this.scrollbar.updateState({width:e,scrollWidth:t});var o=this.tabsContainer.scrollLeft,s=this.activeTab.offsetLeft,i=this.activeTab.offsetWidth,n=i<=e;n&&o+e<s+i?this.scrollbar.updateState({scrollLeft:o+(s+i-(o+e))}):(o>s||!n)&&this.scrollbar.updateState({scrollLeft:this.activeTab.offsetLeft})}},t.prototype.hookTabListeners=function(e,t){var o=this,n=t.editor,d=t.group,p=this.stacks.positionOfGroup(d);this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.MOUSE_DOWN,function(t){e.blur(),0!==t.button||i.findParentWithClass(t.target||t.srcElement,"monaco-action-bar","tab")||setTimeout(function(){return o.editorService.openEditor(n,null,p).done(null,s.onUnexpectedError)})})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.MOUSE_UP,function(t){i.EventHelper.stop(t),e.blur(),1===t.button&&o.editorService.closeEditor(p,n).done(null,s.onUnexpectedError)})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.KEY_DOWN,function(s){var n=new c.StandardKeyboardEvent(s);n.shiftKey&&n.keyCode===l.KeyCode.F10&&(i.EventHelper.stop(s),o.onContextMenu(t,s,e))})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.KEY_UP,function(e){var t=new c.StandardKeyboardEvent(e),r=!1;if(t.equals(l.CommonKeybindings.ENTER)||t.equals(l.CommonKeybindings.SPACE))r=!0,o.editorService.openEditor(n,null,p).done(null,s.onUnexpectedError);else if([l.CommonKeybindings.LEFT_ARROW,l.CommonKeybindings.RIGHT_ARROW,l.CommonKeybindings.UP_ARROW,l.CommonKeybindings.DOWN_ARROW,l.CommonKeybindings.HOME,l.CommonKeybindings.END].some(function(e){return t.equals(e)})){var a=d.indexOf(n),b=void 0;b=t.equals(l.CommonKeybindings.LEFT_ARROW)||t.equals(l.CommonKeybindings.UP_ARROW)?a-1:t.equals(l.CommonKeybindings.RIGHT_ARROW)||t.equals(l.CommonKeybindings.DOWN_ARROW)?a+1:t.equals(l.CommonKeybindings.HOME)?0:d.count-1;var u=d.getEditor(b);u&&(r=!0,o.editorService.openEditor(u,{preserveFocus:!0},p).done(null,s.onUnexpectedError),o.tabsContainer.childNodes[b].focus())}r&&i.EventHelper.stop(e,!0),o.scrollbar.updateState({scrollLeft:o.tabsContainer.scrollLeft})})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DBLCLICK,function(e){i.EventHelper.stop(e),o.editorGroupService.pinEditor(d,n)})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.CONTEXT_MENU,function(s){return o.onContextMenu(t,s,e)})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DRAG_START,function(e){o.onEditorDragStart({editor:n,group:d}),e.dataTransfer.effectAllowed="copyMove";var t=a.asFileEditorInput(n,!0);if(t){var s=t.getResource().toString();e.dataTransfer.setData("URL",s),e.dataTransfer.setData("DownloadURL",[r.MIME_BINARY,n.getName(),s].join(":"))}})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DRAG_OVER,function(t){i.addClass(e,"dropfeedback")})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DRAG_LEAVE,function(t){i.removeClass(e,"dropfeedback")})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DRAG_END,function(t){i.removeClass(e,"dropfeedback"),o.onEditorDragEnd()})),this.tabDisposeables.push(i.addDisposableListener(e,i.EventType.DROP,function(t){i.removeClass(e,"dropfeedback");var s=o.stacks.positionOfGroup(d),r=d.indexOf(n);o.onDrop(t,d,s,r)}))},t.prototype.onDrop=function(e,o,n,r){var a=t.getDraggedEditor();a?(i.EventHelper.stop(e,!0),this.isMoveOperation(e,a.group,o)?this.editorGroupService.moveEditor(a.editor,a.group,o,r):this.editorService.openEditor(a.editor,{pinned:!0,index:r},n).done(null,s.onUnexpectedError),this.onEditorDragEnd()):this.handleExternalDrop(e,n,r)},t.prototype.handleExternalDrop=function(e,t,o){var n=this,r=S.extractResources(e).filter(function(e){return"file"===e.scheme||"untitled"===e.scheme});r.length&&(i.EventHelper.stop(e,!0),this.editorService.openEditors(r.map(function(e){return{input:{resource:e,options:{pinned:!0,index:o}},position:t}})).done(function(){n.editorGroupService.focusGroup(t),window.focus()},s.onUnexpectedError))},t.prototype.isMoveOperation=function(e,t,o){var s=e.ctrlKey&&!n.isMacintosh||e.altKey&&n.isMacintosh;return!s||t.id===o.id},t=__decorate([__param(0,u.IContextMenuService),__param(1,E.IInstantiationService),__param(2,p.IConfigurationService),__param(3,b.IWorkbenchEditorService),__param(4,v.IEditorGroupService),__param(5,h.IUntitledEditorService),__param(6,C.IKeybindingService),__param(7,f.ITelemetryService),__param(8,m.IMessageService),__param(9,y.IMenuService),__param(10,g.IQuickOpenService)],t)}(D.TitleControl);t.TabsTitleControl=R});