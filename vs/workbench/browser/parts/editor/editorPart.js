/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,o){function i(){this.constructor=t}for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e]);t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)},__decorate=this&&this.__decorate||function(t,o,i,e){var r,s=arguments.length,n=s<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,o,i,e);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(s<3?r(n):s>3?r(o,i,n):r(o,i))||n);return s>3&&n&&Object.defineProperty(o,i,n),n},__param=this&&this.__param||function(t,o){return function(i,e){o(i,e,t)}};define(["require","exports","vs/base/common/winjs.base","vs/platform/platform","vs/base/common/timer","vs/base/browser/builder","vs/nls","vs/base/common/strings","vs/base/common/arrays","vs/base/common/types","vs/base/common/errors","vs/workbench/common/memento","vs/workbench/browser/part","vs/workbench/browser/parts/editor/baseEditor","vs/workbench/common/editor","vs/workbench/browser/parts/editor/sideBySideEditorControl","vs/workbench/services/progress/browser/progressService","vs/platform/configuration/common/configuration","vs/workbench/services/part/common/partService","vs/platform/editor/common/editor","vs/platform/storage/common/storage","vs/platform/event/common/event","vs/platform/instantiation/common/instantiation","vs/platform/instantiation/common/serviceCollection","vs/platform/message/common/message","vs/platform/telemetry/common/telemetry","vs/platform/progress/common/progress","vs/workbench/browser/parts/editor/textEditor","vs/workbench/common/editor/editorStacksModel","vs/base/common/event","vs/css!./media/editorpart","vs/workbench/browser/parts/editor/editor.contribution"],function(t,o,i,e,r,s,n,a,d,p,c,u,h,l,E,f,v,g,m,y,T,C,P,O,b,k,S,G,_,I){"use strict";var R=function(){function t(t,o){this._token=t,this.progressPromise=o}return Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),t.prototype.cancel=function(){this.progressPromise.cancel()},t}(),A=function(t){function o(o,i,e,r,s,n,a,p){t.call(this,o),this.messageService=i,this.eventService=e,this.telemetryService=r,this.storageService=s,this.partService=n,this.configurationService=a,this.instantiationService=p,this._onEditorsChanged=new I.Emitter,this._onEditorOpening=new I.Emitter,this._onEditorsMoved=new I.Emitter,this._onEditorOpenFail=new I.Emitter,this.visibleEditors=[],this.editorOpenToken=d.fill(y.POSITIONS.length,function(){return 0}),this.instantiatedEditors=d.fill(y.POSITIONS.length,function(){return[]}),this.mapEditorInstantiationPromiseToEditor=d.fill(y.POSITIONS.length,function(){return Object.create(null)}),this.pendingEditorInputsToClose=[],this.pendingEditorInputCloseTimeout=null,this.stacks=this.instantiationService.createInstance(_.EditorStacksModel);var c=a.getConfiguration().workbench.editor;this.previewEditors=c.enablePreview,this.telemetryService.publicLog("workbenchEditorConfiguration",c),this.registerListeners()}return __extends(o,t),o.prototype.registerListeners=function(){var t=this;this.toUnbind.push(this.stacks.onEditorDirty(function(o){return t.onEditorDirty(o)})),this.toUnbind.push(this.stacks.onEditorDisposed(function(o){return t.onEditorDisposed(o)})),this.toUnbind.push(this.configurationService.onDidUpdateConfiguration(function(o){return t.onConfigurationUpdated(o.config)}))},o.prototype.onConfigurationUpdated=function(t){var o=this,i=t.workbench.editor.enablePreview;this.previewEditors===i||i||this.stacks.groups.forEach(function(t){t.previewEditor&&o.pinEditor(t,t.previewEditor)}),this.previewEditors=i},o.prototype.onEditorDirty=function(t){this.pinEditor(t.group,t.editor)},o.prototype.onEditorDisposed=function(t){this.pendingEditorInputsToClose.push(t),this.startDelayedCloseEditorsFromInputDispose()},Object.defineProperty(o.prototype,"onEditorsChanged",{get:function(){return this._onEditorsChanged.event},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onEditorOpening",{get:function(){return this._onEditorOpening.event},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onEditorsMoved",{get:function(){return this._onEditorsMoved.event},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onEditorOpenFail",{get:function(){return this._onEditorOpenFail.event},enumerable:!0,configurable:!0}),o.prototype.openEditor=function(t,o,r,s){o||(o=null);var n=this.findPosition(t,o,r,s);if(!t||null===n||Object.keys(this.mapEditorInstantiationPromiseToEditor[n]).length>0||this.sideBySideControl.isDragging())return i.TPromise.as(null);var d=new E.EditorInputEvent(t);if(this._onEditorOpening.fire(d),d.isPrevented())return i.TPromise.as(null);var p=e.Registry.as(E.Extensions.Editors).getEditor(t);return p?(n!==y.Position.LEFT&&this.telemetryService.publicLog("workbenchSideEditorOpened",{position:n}),this.doOpenEditor(n,p,t,o,s)):i.TPromise.wrapError(new Error(a.format("Can not find a registered editor for the input {0}",t)))},o.prototype.doOpenEditor=function(t,o,e,r,s){var n=this,a=this.ensureGroup(t,!r||!r.preserveFocus),d=!this.previewEditors||r&&(r.pinned||"number"==typeof r.index)||e.isDirty(),p=0===a.count||!r||!r.inactive;if(a.openEditor(e,{active:p,pinned:d,index:r&&r.index}),!p)return i.TPromise.as(null);this.editorOpenToken[t]++;var c=this.editorOpenToken[t],u=new R(c,i.TPromise.timeout(this.partService.isCreated()?800:3200).then(function(){var t=n.stacks.positionOfGroup(a);c===n.editorOpenToken[t]&&n.sideBySideControl.updateProgress(t,f.ProgressState.INFINITE)}));return this.doShowEditor(a,o,e,r,s,u).then(function(t){return t?n.doSetInput(a,t,e,r,u):i.TPromise.as(null)})},o.prototype.doShowEditor=function(t,o,e,s,n,d){var c=this,u=this.stacks.positionOfGroup(t),h=this.visibleEditors[u];if(h&&o.describes(h))return i.TPromise.as(h);h&&this.doHideEditor(u,!1);var l=r.start(r.Topic.WORKBENCH,a.format("Creating Editor: {0}",o.getName()));return this.doCreateEditor(t,o,d).then(function(o){var i=c.stacks.positionOfGroup(t);return o&&c.visibleEditors[i]&&o.getId()===c.visibleEditors[i].getId()?(c.sideBySideControl.show(o,i,s&&s.preserveFocus,n),o.setVisible(!0,i),c.sideBySideControl.layout(i),l.stop(),o):(l.stop(),d.cancel(),null)},function(t){return c.messageService.show(b.Severity.Error,p.isString(t)?new Error(t):t)})},o.prototype.doCreateEditor=function(t,o,i){var e=this;return this.doInstantiateEditor(t,o).then(function(r){var n=e.stacks.positionOfGroup(t);return i.token!==e.editorOpenToken[n]?(i.cancel(),null):(e.visibleEditors[n]=r,r.getContainer()||r.create(s.$().div({"class":"editor-container",role:"tabpanel",id:o.getId()})),r)})},o.prototype.doInstantiateEditor=function(t,o){var e=this,r=this.stacks.positionOfGroup(t),s=this.instantiatedEditors[r].filter(function(t){return o.describes(t)})[0];if(s)return i.TPromise.as(s);var n=this.mapEditorInstantiationPromiseToEditor[r][o.getId()];if(n)return n;var a=new v.WorkbenchProgressService(this.eventService,this.sideBySideControl.getProgressBar(r),o.getId(),(!0)),d=this.sideBySideControl.getInstantiationService(r).createChild(new O.ServiceCollection([S.IProgressService,a])),p=!1,c=function(r){var s=e.stacks.positionOfGroup(t);return p=!0,delete e.mapEditorInstantiationPromiseToEditor[s][o.getId()],r instanceof l.BaseEditor?(e.instantiatedEditors[s].push(r),i.TPromise.as(r)):i.TPromise.wrapError(r)},u=d.createInstance(o).then(c,c);return p||(this.mapEditorInstantiationPromiseToEditor[r][o.getId()]=u),u},o.prototype.doSetInput=function(t,o,i,e,s){var n=this,d=o.getInput(),p=!d||!d.matches(i)||e&&e.forceOpen,c=r.start(r.Topic.WORKBENCH,a.format("Set Editor Input: {0}",i.getName()));return o.setInput(i,e).then(function(){s.cancel();var i=n.stacks.positionOfGroup(t);if(i===-1)return null;var r=!e||!e.preserveFocus;return r&&o.focus(),n.sideBySideControl.updateProgress(i,f.ProgressState.DONE),p&&n._onEditorsChanged.fire(),c.stop(),o},function(r){return n.doHandleSetInputError(r,t,o,i,e,s)})},o.prototype.doHandleSetInputError=function(t,o,i,e,r,s){var a=this.stacks.positionOfGroup(o);if(s.cancel(),this.partService.isCreated()&&!c.isPromiseCanceledError(t)){var d=n.localize("editorOpenError","Unable to open '{0}': {1}.",e.getName(),c.toErrorMessage(t)),u=void 0;u=t&&t.actions&&t.actions.length?c.create(d,{actions:t.actions}):d,this.messageService.show(b.Severity.Error,p.isString(u)?new Error(u):u)}this.sideBySideControl.updateProgress(a,f.ProgressState.DONE),this._onEditorOpenFail.fire(e),o.activeEditor===e&&this.doCloseActiveEditor(o)},o.prototype.closeEditor=function(t,o){var e=this,r=this.stacks.groupAt(t);return r?this.handleDirty([{group:r,editor:o}]).then(function(t){t||e.doCloseEditor(r,o)}):i.TPromise.as(null)},o.prototype.doCloseEditor=function(t,o,i){void 0===i&&(i=this.stacks.isActive(t)),t.activeEditor&&t.activeEditor.matches(o)?this.doCloseActiveEditor(t,i):this.doCloseInactiveEditor(t,o)},o.prototype.doCloseActiveEditor=function(t,o){void 0===o&&(o=!0);var i=this.stacks.positionOfGroup(t);t.closeEditor(t.activeEditor),0===t.count?this.doCloseGroup(t,o):this.openEditor(t.activeEditor,o?null:E.EditorOptions.create({preserveFocus:!0}),i).done(null,c.onUnexpectedError)},o.prototype.doCloseInactiveEditor=function(t,o){t.closeEditor(o)},o.prototype.doCloseGroup=function(t,o){var i=this;void 0===o&&(o=!0);var e=this.stacks.positionOfGroup(t);this.modifyGroups(function(){return i.stacks.closeGroup(t)}),this.doHideEditor(e,!0),this._onEditorsChanged.fire();var r=this.stacks.activeGroup;r&&(o?this.focusGroup(r):this.activateGroup(r),this.onGroupFocusChanged())},o.prototype.doHideEditor=function(t,o){var i=this.visibleEditors[t],e=this.sideBySideControl.hide(i,t,o);this.sideBySideControl.updateProgress(t,f.ProgressState.STOP),i.clearInput(),i.setVisible(!1),this.visibleEditors[t]=null,this.rochade(e),e!==f.Rochade.NONE&&this._onEditorsMoved.fire()},o.prototype.closeAllEditors=function(t){var o=this,i=this.stacks.groups.reverse();"number"==typeof t&&(i=i.filter(function(i){return o.stacks.positionOfGroup(i)!==t}));var e=d.flatten(i.map(function(t){return t.getEditors().map(function(o){return{group:t,editor:o}})}));return this.handleDirty(e).then(function(t){t||i.forEach(function(t){return o.doCloseEditors(t)})})},o.prototype.closeEditors=function(t,o,e){var r=this,s=this.stacks.groupAt(t);if(!s)return i.TPromise.as(null);var n;return n=e?e===y.Direction.LEFT?s.getEditors().slice(0,s.indexOf(o)):s.getEditors().slice(s.indexOf(o)+1):s.getEditors().filter(function(t){return!o||!t.matches(o)}),this.handleDirty(n.map(function(t){return{group:s,editor:t}})).then(function(t){t||r.doCloseEditors(s,o,e)})},o.prototype.doCloseEditors=function(t,o,i){var e=this;o?o.matches(t.activeEditor)?t.closeEditors(t.activeEditor,i):this.openEditor(o,null,this.stacks.positionOfGroup(t)).done(function(){e.doCloseEditors(t,o,i)},c.onUnexpectedError):(t.closeEditors(t.activeEditor),this.doCloseActiveEditor(t))},o.prototype.handleDirty=function(t){var o=this;return t.length?this.doHandleDirty(t.shift()).then(function(i){return i?i:o.handleDirty(t)}):i.TPromise.as(!1)},o.prototype.doHandleDirty=function(t){if(!t||!t.editor||!t.editor.isDirty())return i.TPromise.as(!1);var o=t.editor,e=o.confirmSave();switch(e){case E.ConfirmResult.SAVE:return o.save().then(function(t){return!t});case E.ConfirmResult.DONT_SAVE:return o.revert().then(function(t){return!t});case E.ConfirmResult.CANCEL:return i.TPromise.as(!0)}},o.prototype.getStacksModel=function(){return this.stacks},o.prototype.getActiveEditorInput=function(){var t=this.getActiveEditor();return t?t.input:null},o.prototype.getActiveEditor=function(){return this.sideBySideControl?this.sideBySideControl.getActiveEditor():null},o.prototype.getVisibleEditors=function(){return this.visibleEditors?this.visibleEditors.filter(function(t){return!!t}):[]},o.prototype.moveGroup=function(t,o){var i=this,e="number"==typeof t?this.stacks.groupAt(t):t,r="number"==typeof o?this.stacks.groupAt(o):o;if(e&&r&&e!==r){var s=this.stacks.positionOfGroup(e),n=this.stacks.positionOfGroup(r);this.modifyGroups(function(){return i.stacks.moveGroup(e,n)}),this.sideBySideControl.move(s,n),d.move(this.visibleEditors,s,n),d.move(this.editorOpenToken,s,n),d.move(this.mapEditorInstantiationPromiseToEditor,s,n),d.move(this.instantiatedEditors,s,n),this.focusGroup(e),this._onEditorsMoved.fire()}},o.prototype.moveEditor=function(t,o,i,e){var r="number"==typeof o?this.stacks.groupAt(o):o;if(r)if(o===i)this.doMoveEditorInsideGroups(t,r,e);else{var s="number"==typeof i?i:this.stacks.positionOfGroup(i);this.doMoveEditorAcrossGroups(t,r,s,e)}},o.prototype.doMoveEditorInsideGroups=function(t,o,i){if("number"==typeof i){var e=o.indexOf(t);e!==i&&(o.moveEditor(t,i),o.pin(t))}},o.prototype.doMoveEditorAcrossGroups=function(t,o,i,e){var r=E.EditorOptions.create({pinned:!0,index:e}),s=this.getActiveEditor();s instanceof G.BaseTextEditor&&s.position===this.stacks.positionOfGroup(o)&&t.matches(s.input)&&(r=E.TextEditorOptions.create({pinned:!0,index:e}),r.viewState(s.getControl().saveViewState())),this.openEditor(t,r,i).done(null,c.onUnexpectedError),this.doCloseEditor(o,t,!1)},o.prototype.arrangeGroups=function(t){this.sideBySideControl.arrangeGroups(t)},o.prototype.createContentArea=function(t){var o=this,i=s.$(t).div().addClass("content");return this.sideBySideControl=this.instantiationService.createInstance(f.SideBySideEditorControl,i),this.toUnbind.push(this.sideBySideControl.onGroupFocusChanged(function(){return o.onGroupFocusChanged()})),this.memento=this.getMemento(this.storageService,u.Scope.WORKSPACE),i},o.prototype.onGroupFocusChanged=function(){var t=this.sideBySideControl.getActivePosition();"number"==typeof t&&this.stacks.setActive(this.stacks.groupAt(t));var o=this.sideBySideControl.getActiveEditor();o&&this._onEditorsChanged.fire()},o.prototype.replaceEditors=function(t){var o=this,i=[],e=[];t.forEach(function(t){t.toReplace.isDirty()||o.stacks.groups.forEach(function(o){var r=o.indexOf(t.toReplace);if(r>=0){t.options?t.options.index=r:t.options=E.EditorOptions.create({index:r});var s={group:o,editor:t.toReplace,replaceWith:t.replaceWith,options:t.options};o.activeEditor.matches(t.toReplace)?i.push(s):e.push(s)}})}),e.forEach(function(t){var o=t.group;o.openEditor(t.replaceWith,{active:!1,pinned:!0,index:t.options.index}),o.closeEditor(t.editor)});var r=this.openEditors(i.map(function(t){var i=t.group;return{input:t.replaceWith,position:o.stacks.positionOfGroup(i),options:t.options}}));return i.forEach(function(t){o.doCloseEditor(t.group,t.editor,!1)}),r},o.prototype.openEditors=function(t){if(!t.length)return i.TPromise.as([]);var o;this.stacks.activeGroup&&(o=this.stacks.positionOfGroup(this.stacks.activeGroup));var e=this.sideBySideControl.getWidthRatios();return this.doOpenEditors(t,o,e)},o.prototype.restoreEditors=function(){var t=this.stacks.groups.map(function(t,o){return{input:t.activeEditor,position:o,options:t.isPinned(t.activeEditor)?E.EditorOptions.create({pinned:!0}):void 0}});if(!t.length)return i.TPromise.as([]);var e;this.stacks.groups.length&&(e=this.stacks.positionOfGroup(this.stacks.activeGroup));var r=this.memento[o.EDITOR_PART_UI_STATE_STORAGE_KEY];return this.doOpenEditors(t,e,r&&r.widthRatio)},o.prototype.doOpenEditors=function(t,o,e){var r=this,s=t.filter(function(t){return t.position===y.Position.LEFT}),n=t.filter(function(t){return t.position===y.Position.CENTER}),a=t.filter(function(t){return t.position===y.Position.RIGHT}),d=this.stacks.groupAt(y.Position.LEFT),p=this.stacks.groupAt(y.Position.CENTER),c=this.stacks.groupAt(y.Position.RIGHT),u=s.length+(d?d.count:0),h=n.length+(p?p.count:0),l=a.length+(c?c.count:0);(!u&&(h||l)||!h&&l)&&(s.push.apply(s,n),s.push.apply(s,a),n.splice(0,n.length),a.splice(0,a.length)),"number"!=typeof o&&(o=y.Position.LEFT);var f=a.length?3:n.length?2:1;e&&e.length===f||(e=this.getVisibleEditors().length?void 0:3===f?[.33,.33,.34]:2===f?[.5,.5]:[1]);var v=[];return[s.shift(),n.shift(),a.shift()].forEach(function(t,i){if(t){var s,n=t.input,a=o!==i;t.options?(s=t.options,"boolean"!=typeof s.preserveFocus&&(s.preserveFocus=a)):s=E.EditorOptions.create({preserveFocus:a}),v.push(r.openEditor(n,s,i,e))}}),i.TPromise.join(v).then(function(t){return r.focusGroup(o),[s,n,a].forEach(function(t,o){var i=r.stacks.groupAt(o);i&&t.forEach(function(t){return i.openEditor(t.input,{pinned:!0})})}),r.sideBySideControl.layout(r.dimension),t})},o.prototype.activateGroup=function(t){var o="number"==typeof t?this.stacks.groupAt(t):t;if(o){this.stacks.setActive(o);var i=this.visibleEditors[this.stacks.positionOfGroup(o)];i&&this.sideBySideControl.setActive(i)}},o.prototype.focusGroup=function(t){var o="number"==typeof t?this.stacks.groupAt(t):t;if(o){this.activateGroup(o);var i=this.visibleEditors[this.stacks.positionOfGroup(o)];i&&i.focus()}},o.prototype.pinEditor=function(t,o){var i="number"==typeof t?this.stacks.groupAt(t):t;if(i){if(i.isPinned(o))return;i.pin(o)}},o.prototype.unpinEditor=function(t,o){var e=this;if(!o.isDirty()){var r="number"==typeof t?this.stacks.groupAt(t):t;if(r){if(r.isPreview(o))return;var s=i.TPromise.as(!1);r.previewEditor&&(s=this.handleDirty([{group:r,editor:r.previewEditor}])),s.done(function(t){t||(r.isPreview(r.activeEditor)&&!r.activeEditor.matches(o)&&e.doCloseActiveEditor(r),r.unpin(o))})}}},o.prototype.layout=function(o){var i=t.prototype.layout.call(this,o);return this.dimension=i[1],this.sideBySideControl.layout(this.dimension),i},o.prototype.shutdown=function(){var i={widthRatio:this.sideBySideControl.getWidthRatios()};this.memento[o.EDITOR_PART_UI_STATE_STORAGE_KEY]=i;for(var e=0;e<this.instantiatedEditors.length;e++)for(var r=0;r<this.instantiatedEditors[e].length;r++)this.instantiatedEditors[e][r].shutdown();t.prototype.shutdown.call(this)},o.prototype.dispose=function(){var o=this;this._onEditorsChanged.dispose(),this._onEditorOpening.dispose(),this._onEditorsMoved.dispose(),this._onEditorOpenFail.dispose(),this.editorOpenToken=[];for(var i=0;i<y.POSITIONS.length;i++)this.editorOpenToken[i]=0;this.sideBySideControl.dispose(),this.visibleEditors.forEach(function(t){t&&t.dispose()});for(var e=function(t){for(var i=function(i){return r.visibleEditors.some(function(e){return e===o.instantiatedEditors[t][i]})?"continue":void r.instantiatedEditors[t][i].dispose()},e=0;e<r.instantiatedEditors[t].length;e++){i(e)}},r=this,i=0;i<this.instantiatedEditors.length;i++)e(i);this.visibleEditors=null,t.prototype.dispose.call(this)},o.prototype.findPosition=function(t,o,i,e){if(e&&p.isNumber(i))return i;var r=this.getVisibleEditors(),s=this.getActiveEditor();if(0===r.length||!s)return y.Position.LEFT;if(o&&o.revealIfVisible){var n=[];s&&n.push(s),r.forEach(function(t){t!==s&&n.push(t)});for(var a=0;a<n.length;a++){var d=n[a];if(t.matches(d.input))return d.position}}if(p.isUndefinedOrNull(i)||i===!1){var c=this.sideBySideControl.getActivePosition();return c||y.Position.LEFT}if(i===!0){switch(s.position){case y.Position.LEFT:return y.Position.CENTER;case y.Position.CENTER:return y.Position.RIGHT;case y.Position.RIGHT:return null}return null}return i===y.Position.RIGHT&&1===r.length?y.Position.CENTER:i},o.prototype.startDelayedCloseEditorsFromInputDispose=function(){var t=this;null===this.pendingEditorInputCloseTimeout&&(this.pendingEditorInputCloseTimeout=setTimeout(function(){var o=[],i=[];t.pendingEditorInputsToClose.forEach(function(t){var e=t.group,r=t.editor;e.isActive(r)?o.push(t):e.contains(r)&&i.push(t)}),i.forEach(function(o){return t.doCloseEditor(o.group,o.editor,!1)}),o.sort(function(o,i){return t.stacks.positionOfGroup(i.group)-t.stacks.positionOfGroup(o.group)}).forEach(function(o){return t.doCloseEditor(o.group,o.editor,!1)}),t.pendingEditorInputCloseTimeout=null,t.pendingEditorInputsToClose=[]},0))},o.prototype.rochade=function(t,o){if(p.isUndefinedOrNull(o)){var i=t;switch(i){case f.Rochade.CENTER_TO_LEFT:this.rochade(y.Position.CENTER,y.Position.LEFT);break;case f.Rochade.RIGHT_TO_CENTER:this.rochade(y.Position.RIGHT,y.Position.CENTER);break;case f.Rochade.CENTER_AND_RIGHT_TO_LEFT:this.rochade(y.Position.CENTER,y.Position.LEFT),this.rochade(y.Position.RIGHT,y.Position.CENTER)}}else{var e=t,r=o;this.doRochade(this.visibleEditors,e,r,null),this.doRochade(this.editorOpenToken,e,r,null),this.doRochade(this.mapEditorInstantiationPromiseToEditor,e,r,Object.create(null)),this.doRochade(this.instantiatedEditors,e,r,[])}},o.prototype.doRochade=function(t,o,i,e){t[i]=t[o],t[o]=e},o.prototype.ensureGroup=function(t,o){var i=this;void 0===o&&(o=!0);var e=this.stacks.groupAt(t);return e?this.renameGroups():this.modifyGroups(function(){for(var r=0;r<t;r++)i.hasGroup(r)||i.stacks.openGroup("",!1,r);e=i.stacks.openGroup("",o,t)}),o&&this.stacks.setActive(e),e},o.prototype.modifyGroups=function(t){t(),this.renameGroups()},o.prototype.renameGroups=function(){var t=this.stacks.groups;t.length>0&&(t.length>2?(this.stacks.renameGroup(this.stacks.groupAt(y.Position.LEFT),o.GROUP_LEFT_LABEL),this.stacks.renameGroup(this.stacks.groupAt(y.Position.CENTER),o.GROUP_CENTER_LABEL),this.stacks.renameGroup(this.stacks.groupAt(y.Position.RIGHT),o.GROUP_RIGHT_LABEL)):t.length>1?(this.stacks.renameGroup(this.stacks.groupAt(y.Position.LEFT),o.GROUP_LEFT_LABEL),this.stacks.renameGroup(this.stacks.groupAt(y.Position.CENTER),o.GROUP_RIGHT_LABEL)):this.stacks.renameGroup(this.stacks.groupAt(y.Position.LEFT),o.GROUP_LEFT_LABEL))},o.prototype.hasGroup=function(t){return!!this.stacks.groupAt(t)},o.GROUP_LEFT_LABEL=n.localize("leftGroup","Left"),o.GROUP_CENTER_LABEL=n.localize("centerGroup","Center"),o.GROUP_RIGHT_LABEL=n.localize("rightGroup","Right"),o.EDITOR_PART_UI_STATE_STORAGE_KEY="editorpart.uiState",o=__decorate([__param(1,b.IMessageService),__param(2,C.IEventService),__param(3,k.ITelemetryService),__param(4,T.IStorageService),__param(5,m.IPartService),__param(6,g.IConfigurationService),__param(7,P.IInstantiationService)],o)}(h.Part);o.EditorPart=A});