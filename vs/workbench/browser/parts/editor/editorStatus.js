/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var o,c=arguments.length,r=c<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(c<3?o(r):c>3?o(t,n,r):o(t,n))||r);return c>3&&r&&Object.defineProperty(t,n,r),r},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define(["require","exports","vs/nls","vs/base/common/winjs.base","vs/base/browser/dom","vs/base/common/strings","vs/base/common/paths","vs/base/common/types","vs/base/common/errors","vs/base/common/actions","vs/base/common/platform","vs/workbench/common/editor/untitledEditorInput","vs/workbench/common/editor","vs/base/common/lifecycle","vs/platform/message/common/message","vs/workbench/browser/actions/openSettings","vs/editor/contrib/linesOperations/common/linesOperations","vs/editor/common/editorCommon","vs/editor/contrib/indentation/common/indentation","vs/workbench/common/events","vs/workbench/browser/parts/editor/textEditor","vs/workbench/services/editor/common/editorService","vs/workbench/services/quickopen/common/quickOpenService","vs/platform/configuration/common/configuration","vs/platform/event/common/event","vs/platform/files/common/files","vs/platform/instantiation/common/instantiation","vs/editor/common/services/modeService","vs/base/browser/styleMutator","vs/workbench/services/group/common/groupService","vs/editor/common/config/commonEditorConfig","vs/css!./media/editorstatus"],function(e,t,n,i,o,c,r,a,s,d,l,u,h,g,p,m,f,E,v,S,b,O,_,C,L,y,k,I,M,F,A){"use strict";function T(e){if(e){if(e.getEditorType()===E.EditorType.IDiffEditor)return e.getModifiedEditor();if(e.getEditorType()===E.EditorType.ICodeEditor)return e}return null}function D(e){var t,n=e.getModel();return t=n&&n.modified?n.modified:n}function z(e){return e instanceof u.UntitledEditorInput?e:h.asFileEditorInput(e,!0)}function R(e){M.StyleMutator.setDisplay(e,"")}function x(e){M.StyleMutator.setDisplay(e,"none")}function w(e){var t=e.getControl();return t.getEditorType()===E.EditorType.IDiffEditor&&(t=t.getModifiedEditor()),t.getEditorType()===E.EditorType.ICodeEditor&&!t.getConfiguration().readOnly}var N=function(){function e(){this.indentation=!1,this.selectionStatus=!1,this.mode=!1,this.encoding=!1,this.EOL=!1,this.tabFocusMode=!1}return e.prototype.combine=function(e){this.indentation=this.indentation||e.indentation,this.selectionStatus=this.selectionStatus||e.selectionStatus,this.mode=this.mode||e.mode,this.encoding=this.encoding||e.encoding,this.EOL=this.EOL||e.EOL,this.tabFocusMode=this.tabFocusMode||e.tabFocusMode},e}(),P=function(){function e(){this._selectionStatus=null,this._mode=null,this._encoding=null,this._EOL=null,this._tabFocusMode=!1}return Object.defineProperty(e.prototype,"selectionStatus",{get:function(){return this._selectionStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encoding",{get:function(){return this._encoding},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EOL",{get:function(){return this._EOL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indentation",{get:function(){return this._indentation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabFocusMode",{get:function(){return this._tabFocusMode},enumerable:!0,configurable:!0}),e.prototype.update=function(e){var t=new N,n=!1;return"undefined"!=typeof e.selectionStatus&&this._selectionStatus!==e.selectionStatus&&(this._selectionStatus=e.selectionStatus,n=!0,t.selectionStatus=!0),"undefined"!=typeof e.indentation&&this._indentation!==e.indentation&&(this._indentation=e.indentation,n=!0,t.indentation=!0),"undefined"!=typeof e.mode&&this._mode!==e.mode&&(this._mode=e.mode,n=!0,t.mode=!0),"undefined"!=typeof e.encoding&&this._encoding!==e.encoding&&(this._encoding=e.encoding,n=!0,t.encoding=!0),"undefined"!=typeof e.EOL&&this._EOL!==e.EOL&&(this._EOL=e.EOL,n=!0,t.EOL=!0),"undefined"!=typeof e.tabFocusMode&&this._tabFocusMode!==e.tabFocusMode&&(this._tabFocusMode=e.tabFocusMode,n=!0,t.tabFocusMode=!0),n?t:null},e}(),q=n.localize("singleSelectionRange","Ln {0}, Col {1} ({2} selected)"),U=n.localize("singleSelection","Ln {0}, Col {1}"),B=n.localize("multiSelectionRange","{0} selections ({1} characters selected)"),G=n.localize("multiSelection","{0} selections"),j=n.localize("endOfLineLineFeed","LF"),W=n.localize("endOfLineCarriageReturnLineFeed","CRLF"),H=n.localize("tabFocusModeEnabled","Tab moves focus"),Q=function(){function e(e,t,n,i,o,c,r){this.editorService=e,this.editorGroupService=t,this.quickOpenService=n,this.instantiationService=i,this.eventService=o,this.modeService=c,this.configurationService=r,this.toDispose=[],this.activeEditorListeners=[],this.state=new P}return e.prototype.render=function(e){var t=this;return this.element=o.append(e,o.emmet(".editor-statusbar-item")),this.tabFocusModeElement=o.append(this.element,o.emmet("a.editor-status-tabfocusmode")),this.tabFocusModeElement.title=n.localize("disableTabMode","Disable Accessibility Mode"),this.tabFocusModeElement.onclick=function(){return t.onTabFocusModeClick()},this.tabFocusModeElement.textContent=H,x(this.tabFocusModeElement),this.selectionElement=o.append(this.element,o.emmet("a.editor-status-selection")),this.selectionElement.title=n.localize("gotoLine","Go to Line"),this.selectionElement.onclick=function(){return t.onSelectionClick()},x(this.selectionElement),this.indentationElement=o.append(this.element,o.emmet("a.editor-status-indentation")),this.indentationElement.title=n.localize("indentation","Indentation"),this.indentationElement.onclick=function(){return t.onIndentationClick()},x(this.indentationElement),this.encodingElement=o.append(this.element,o.emmet("a.editor-status-encoding")),this.encodingElement.title=n.localize("selectEncoding","Select Encoding"),this.encodingElement.onclick=function(){return t.onEncodingClick()},x(this.encodingElement),this.eolElement=o.append(this.element,o.emmet("a.editor-status-eol")),this.eolElement.title=n.localize("selectEOL","Select End of Line Sequence"),this.eolElement.onclick=function(){return t.onEOLClick()},x(this.eolElement),this.modeElement=o.append(this.element,o.emmet("a.editor-status-mode")),this.modeElement.title=n.localize("selectLanguageMode","Select Language Mode"),this.modeElement.onclick=function(){return t.onModeClick()},x(this.modeElement),this.delayedRender=null,this.toRender=null,this.toDispose.push({dispose:function(){t.delayedRender&&(t.delayedRender.dispose(),t.delayedRender=null)}},this.editorGroupService.onEditorsChanged(function(){return t.onEditorsChanged()}),this.eventService.addListener2(S.EventType.RESOURCE_ENCODING_CHANGED,function(e){return t.onResourceEncodingChange(e.resource)}),A.TabFocus.onDidChangeTabFocus(function(e){return t.onTabFocusModeChange()})),g.combinedDisposable(this.toDispose)},e.prototype.updateState=function(e){var t=this,n=this.state.update(e);n&&(this.toRender?this.toRender.combine(n):(this.toRender=n,this.delayedRender=o.runAtThisOrScheduleAtNextAnimationFrame(function(){t.delayedRender=null;var e=t.toRender;t.toRender=null,t._renderNow(e)})))},e.prototype._renderNow=function(e){e.tabFocusMode&&(this.state.tabFocusMode&&this.state.tabFocusMode===!0?R(this.tabFocusModeElement):x(this.tabFocusModeElement)),e.indentation&&(this.state.indentation?(this.indentationElement.textContent=this.state.indentation,R(this.indentationElement)):x(this.indentationElement)),e.selectionStatus&&(this.state.selectionStatus?(this.selectionElement.textContent=this.state.selectionStatus,R(this.selectionElement)):x(this.selectionElement)),e.encoding&&(this.state.encoding?(this.encodingElement.textContent=this.state.encoding,R(this.encodingElement)):x(this.encodingElement)),e.EOL&&(this.state.EOL?(this.eolElement.textContent="\r\n"===this.state.EOL?W:j,R(this.eolElement)):x(this.eolElement)),e.mode&&(this.state.mode?(this.modeElement.textContent=this.state.mode,R(this.modeElement)):x(this.modeElement))},e.prototype.getSelectionLabel=function(e){return e&&e.selections?1===e.selections.length?e.charactersSelected?c.format(q,e.selections[0].positionLineNumber,e.selections[0].positionColumn,e.charactersSelected):c.format(U,e.selections[0].positionLineNumber,e.selections[0].positionColumn):e.charactersSelected?c.format(B,e.selections.length,e.charactersSelected):c.format(G,e.selections.length):null},e.prototype.onModeClick=function(){var e=this.instantiationService.createInstance(V,V.ID,V.LABEL);e.run().done(null,s.onUnexpectedError),e.dispose()},e.prototype.onIndentationClick=function(){var e=this.instantiationService.createInstance(Y,Y.ID,Y.LABEL);e.run().done(null,s.onUnexpectedError),e.dispose()},e.prototype.onSelectionClick=function(){this.quickOpenService.show(":")},e.prototype.onEOLClick=function(){var e=this.instantiationService.createInstance(J,J.ID,J.LABEL);e.run().done(null,s.onUnexpectedError),e.dispose()},e.prototype.onEncodingClick=function(){var e=this.instantiationService.createInstance(K,K.ID,K.LABEL);e.run().done(null,s.onUnexpectedError),e.dispose()},e.prototype.onTabFocusModeClick=function(){A.TabFocus.setTabFocusMode(!1)},e.prototype.onEditorsChanged=function(){var e,t=this,n=this.editorService.getActiveEditor();if(n instanceof b.BaseTextEditor&&(e=n.getControl()),this.onSelectionChange(e),this.onModeChange(e),this.onEOLChange(e),this.onEncodingChange(n),this.onIndentationChange(e),g.dispose(this.activeEditorListeners),n instanceof b.BaseTextEditor){var i=n.getControl();this.activeEditorListeners.push(i.onDidChangeCursorPosition(function(e){t.onSelectionChange(i)})),this.activeEditorListeners.push(i.onDidChangeModelMode(function(e){t.onModeChange(i)})),this.activeEditorListeners.push(i.onDidChangeModelRawContent(function(e){t.onEOLChange(i)})),this.activeEditorListeners.push(i.onDidChangeModelOptions(function(e){t.onIndentationChange(i)}))}},e.prototype.onModeChange=function(e){var t={mode:null};if(e){var n=D(e);if(n&&n.getMode){var i=n.getMode();i&&(t={mode:this.modeService.getLanguageName(i.getId())})}}this.updateState(t)},e.prototype.onIndentationChange=function(e){var t={indentation:null};if(e){e.getEditorType()===E.EditorType.IDiffEditor&&(e=e.getModifiedEditor());var i=e.getModel();if(i){var o=i.getOptions();t.indentation=o.insertSpaces?n.localize("spacesSize","Spaces: {0}",o.tabSize):n.localize({key:"tabSize",comment:["Tab corresponds to the tab key"]},"Tab Size: {0}",o.tabSize)}}this.updateState(t)},e.prototype.onSelectionChange=function(e){var t={};if(e){t.selections=e.getSelections()||[],t.charactersSelected=0;var n=D(e);if(n&&t.selections.forEach(function(e){t.charactersSelected+=n.getValueLengthInRange(e)}),1===t.selections.length){var i=e.getVisibleColumnFromPosition(e.getPosition()),o=t.selections[0].clone();o.positionColumn=i,t.selections[0]=o}}this.updateState({selectionStatus:this.getSelectionLabel(t)})},e.prototype.onEOLChange=function(e){var t={EOL:null},n=T(e);if(n&&!n.getConfiguration().readOnly){var i=n.getModel();i&&(t.EOL=i.getEOL())}this.updateState(t)},e.prototype.onEncodingChange=function(e){if(!e||this.isActiveEditor(e)){var t={encoding:null};if(e instanceof b.BaseTextEditor){var n=z(e.input);if(n&&a.isFunction(n.getEncoding)){var i=n.getEncoding(),o=y.SUPPORTED_ENCODINGS[i];o?t.encoding=o.labelShort:t.encoding=i}}this.updateState(t)}},e.prototype.onResourceEncodingChange=function(e){var t=this.editorService.getActiveEditor();if(t){var n=h.getUntitledOrFileResource(t.input,!0);if(n&&n.toString()===e.toString())return this.onEncodingChange(t)}},e.prototype.onTabFocusModeChange=function(){var e={tabFocusMode:A.TabFocus.getTabFocusMode()};this.updateState(e)},e.prototype.isActiveEditor=function(e){var t=this.editorService.getActiveEditor();return t&&e&&t===e},e=__decorate([__param(0,O.IWorkbenchEditorService),__param(1,F.IEditorGroupService),__param(2,_.IQuickOpenService),__param(3,k.IInstantiationService),__param(4,L.IEventService),__param(5,I.IModeService),__param(6,C.IConfigurationService)],e)}();t.EditorStatus=Q;var V=function(e){function t(t,n,i,o,c,r,a){e.call(this,t,n),this.modeService=i,this.editorService=o,this.messageService=c,this.instantiationService=r,this.quickOpenService=a}return __extends(t,e),t.prototype.run=function(){var e=this,t=this.modeService.getRegisteredLanguageNames(),i=this.editorService.getActiveEditor();if(!(i instanceof b.BaseTextEditor))return this.quickOpenService.pick([{label:n.localize("noEditor","No text editor active at this time")}]);var o,c=i.getControl(),a=D(c),d=h.asFileEditorInput(i.input,!0);if(a.getMode){var l=a.getMode();l&&(o=this.modeService.getLanguageName(l.getId()))}var u=t.sort().map(function(e,t){return{label:e,description:o===e?n.localize("configuredLanguage","Configured Language"):void 0}});u[0].separator={border:!0,label:n.localize("languagesPicks","languages")};var g=n.localize("configureAssociations","Configure File Associations...");if(d){var f=d.getResource(),E=r.extname(f.fsPath)||r.basename(f.fsPath);E&&(g=n.localize("configureAssociationsExt","Configure File Association for '{0}'...",E))}var v={label:g};u.unshift(v);var S={label:n.localize("autoDetect","Auto Detect")};return d&&u.unshift(S),this.quickOpenService.pick(u,{placeHolder:n.localize("pickLanguage","Select Language Mode")}).then(function(t){if(t&&(i=e.editorService.getActiveEditor(),i instanceof b.BaseTextEditor)){var o=i.getControl(),c=[],r=D(o);c.push(r);var a=o.getModel();a&&a.original&&c.push(a.original);var d;if(t===S)d=e.modeService.getOrCreateModeByFilenameOrFirstLine(h.getUntitledOrFileResource(i.input,!0).fsPath,r.getLineContent(1));else if(t===v){var l=e.instantiationService.createInstance(m.OpenGlobalSettingsAction,m.OpenGlobalSettingsAction.ID,m.OpenGlobalSettingsAction.LABEL);l.run().done(function(){return l.dispose()},s.onUnexpectedError),e.messageService.show(p.Severity.Info,n.localize("persistFileAssociations","You can configure filename to language associations in the **files.associations** section. The changes may need a restart to take effect on already opened files."))}else d=e.modeService.getOrCreateModeByLanguageName(t.label);c.forEach(function(e){e.getMode&&e.setMode(d)})}})},t.ID="workbench.action.editor.changeLanguageMode",t.LABEL=n.localize("changeMode","Change Language Mode"),t=__decorate([__param(2,I.IModeService),__param(3,O.IWorkbenchEditorService),__param(4,p.IMessageService),__param(5,k.IInstantiationService),__param(6,_.IQuickOpenService)],t)}(d.Action);t.ChangeModeAction=V;var Y=function(e){function t(t,n,i,o){e.call(this,t,n),this.editorService=i,this.quickOpenService=o}return __extends(t,e),t.prototype.run=function(){var e=this.editorService.getActiveEditor();if(!(e instanceof b.BaseTextEditor))return this.quickOpenService.pick([{label:n.localize("noEditor","No text editor active at this time")}]);if(!w(e))return this.quickOpenService.pick([{label:n.localize("noWritableCodeEditor","The active code editor is read-only.")}]);var t=e.getControl(),i=[t.getAction(v.IndentUsingSpaces.ID),t.getAction(v.IndentUsingTabs.ID),t.getAction(v.DetectIndentation.ID),t.getAction(v.IndentationToSpacesAction.ID),t.getAction(v.IndentationToTabsAction.ID),t.getAction(f.TrimTrailingWhitespaceAction.ID)].map(function(e){return{id:e.id,label:e.label,detail:l.language===l.LANGUAGE_DEFAULT?null:e.getAlias(),run:function(){return e.run()}}});return i[0].separator={label:n.localize("indentView","change view")},i[3].separator={label:n.localize("indentConvert","convert file"),border:!0},this.quickOpenService.pick(i,{placeHolder:n.localize("pickAction","Select Action"),matchOnDetail:!0}).then(function(e){return e&&e.run()})},t.ID="workbench.action.editor.changeIndentation",t.LABEL=n.localize("changeIndentation","Change Indentation"),t=__decorate([__param(2,O.IWorkbenchEditorService),__param(3,_.IQuickOpenService)],t)}(d.Action),J=function(e){function t(t,n,i,o){e.call(this,t,n),this.editorService=i,this.quickOpenService=o}return __extends(t,e),t.prototype.run=function(){var e=this,t=this.editorService.getActiveEditor();if(!(t instanceof b.BaseTextEditor))return this.quickOpenService.pick([{label:n.localize("noEditor","No text editor active at this time")}]);if(!w(t))return this.quickOpenService.pick([{label:n.localize("noWritableCodeEditor","The active code editor is read-only.")}]);var i=t.getControl(),o=D(i),c=[{label:j,eol:E.EndOfLineSequence.LF},{label:W,eol:E.EndOfLineSequence.CRLF}],r="\n"===o.getEOL()?0:1;return this.quickOpenService.pick(c,{placeHolder:n.localize("pickEndOfLine","Select End of Line Sequence"),autoFocus:{autoFocusIndex:r}}).then(function(n){if(n&&(t=e.editorService.getActiveEditor(),t instanceof b.BaseTextEditor&&w(t))){var i=t.getControl(),o=D(i);o.setEOL(n.eol)}})},t.ID="workbench.action.editor.changeEOL",t.LABEL=n.localize("changeEndOfLine","Change End of Line Sequence"),t=__decorate([__param(2,O.IWorkbenchEditorService),__param(3,_.IQuickOpenService)],t)}(d.Action);t.ChangeEOLAction=J;var K=function(e){function t(t,n,i,o,c){e.call(this,t,n),this.editorService=i,this.quickOpenService=o,this.configurationService=c}return __extends(t,e),t.prototype.run=function(){var e=this,t=this.editorService.getActiveEditor();if(!(t instanceof b.BaseTextEditor&&t.input))return this.quickOpenService.pick([{label:n.localize("noEditor","No text editor active at this time")}]);var o=z(t.input);if(!a.areFunctions(o.setEncoding,o.getEncoding))return this.quickOpenService.pick([{label:n.localize("noFileEditor","No file active at this time")}]);var c,r,s;return l.language===l.LANGUAGE_DEFAULT?(r={label:n.localize("saveWithEncoding","Save with Encoding")},s={label:n.localize("reopenWithEncoding","Reopen with Encoding")}):(r={label:n.localize("saveWithEncoding","Save with Encoding"),detail:"Save with Encoding"},s={label:n.localize("reopenWithEncoding","Reopen with Encoding"),detail:"Reopen with Encoding"}),c=o instanceof u.UntitledEditorInput?i.TPromise.as(r):w(t)?this.quickOpenService.pick([s,r],{placeHolder:n.localize("pickAction","Select Action"),matchOnDetail:!0}):i.TPromise.as(s),c.then(function(c){if(c)return i.TPromise.timeout(50).then(function(){var i,r,d=e.configurationService.getConfiguration(),l=c===s,u=d&&d.files&&d.files.encoding,g=Object.keys(y.SUPPORTED_ENCODINGS).sort(function(e,t){return e===u?-1:t===u?1:y.SUPPORTED_ENCODINGS[e].order-y.SUPPORTED_ENCODINGS[t].order}).filter(function(e){return!l||!y.SUPPORTED_ENCODINGS[e].encodeOnly}).map(function(e,t){return e===o.getEncoding()?i=t:y.SUPPORTED_ENCODINGS[e].alias===o.getEncoding()&&(r=t),{id:e,label:y.SUPPORTED_ENCODINGS[e].labelLong}});return e.quickOpenService.pick(g,{placeHolder:l?n.localize("pickEncodingForReopen","Select File Encoding to Reopen File"):n.localize("pickEncodingForSave","Select File Encoding to Save with"),autoFocus:{autoFocusIndex:"number"==typeof i?i:"number"==typeof r?r:void 0}}).then(function(n){n&&(t=e.editorService.getActiveEditor(),o=z(t.input),o&&a.areFunctions(o.setEncoding,o.getEncoding)&&o.getEncoding()!==n.id&&o.setEncoding(n.id,l?h.EncodingMode.Decode:h.EncodingMode.Encode))})})})},t.ID="workbench.action.editor.changeEncoding",t.LABEL=n.localize("changeEncoding","Change File Encoding"),t=__decorate([__param(2,O.IWorkbenchEditorService),__param(3,_.IQuickOpenService),__param(4,C.IConfigurationService)],t)}(d.Action);t.ChangeEncodingAction=K});