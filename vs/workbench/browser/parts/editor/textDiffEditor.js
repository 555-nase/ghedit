/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},__param=this&&this.__param||function(t,e){return function(i,o){e(i,o,t)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/common/actions","vs/base/common/errors","vs/base/common/types","vs/workbench/browser/parts/editor/textEditor","vs/workbench/common/editor","vs/workbench/common/editor/stringEditorInput","vs/workbench/common/editor/resourceEditorInput","vs/workbench/common/editor/diffEditorInput","vs/editor/contrib/diffNavigator/common/diffNavigator","vs/editor/browser/widget/diffEditorWidget","vs/workbench/common/editor/textDiffEditorModel","vs/workbench/services/editor/browser/editorService","vs/platform/files/common/files","vs/platform/telemetry/common/telemetry","vs/workbench/services/workspace/common/contextService","vs/platform/storage/common/storage","vs/platform/configuration/common/configuration","vs/platform/event/common/event","vs/platform/instantiation/common/instantiation","vs/platform/instantiation/common/serviceCollection","vs/platform/message/common/message","vs/workbench/services/editor/common/editorService","vs/editor/common/services/modeService","vs/platform/keybinding/common/keybinding","vs/workbench/services/themes/common/themeService","vs/css!./media/textdiffeditor"],function(t,e,i,o,r,n,a,s,c,f,p,d,l,u,v,m,h,g,y,E,b,I,_,x,D,S,w,N,C){"use strict";var A=function(t){function e(i,o,r,n,a,s,c,f,p,d,l){t.call(this,e.ID,i,o,r,n,a,s,c,f,p,l),this.textDiffEditorVisible=d.createKey("textCompareEditorVisible",!1)}return __extends(e,t),e.prototype.getTitle=function(){return this.input?this.input.getName():o.localize("textDiffEditor","Text Diff Editor")},e.prototype.createEditorControl=function(t){var e=this;this.nextDiffAction=new k(this,(!0)),this.previousDiffAction=new k(this,(!1));var o=this.instantiationService.createInstance(m.DelegatingWorkbenchEditorService,function(t,o,r){if(a.isUndefinedOrNull(r)||r===!1||r===e.position){var n=e.getInput();if(t&&o&&n){if(t.matches(n.modifiedInput))return e.setInput(e.getInput(),o).then(function(){return e});if(t.matches(n.originalInput)){var s=e.getControl().getOriginalEditor();if(o instanceof c.TextEditorOptions)return o.apply(s),i.TPromise.as(e)}}}return i.TPromise.as(null)}),r=this.instantiationService.createChild(new x.ServiceCollection([S.IWorkbenchEditorService,o]));return r.createInstance(u.DiffEditorWidget,t.getHTMLElement(),this.getCodeEditorOptions())},e.prototype.setInput=function(e,o){var r=this,n=this.getInput();t.prototype.setInput.call(this,e,o);var s=o&&o.forceOpen;if(!s&&e.matches(n)){var f=o;return f&&a.isFunction(f.apply)&&f.apply(this.getControl()),i.TPromise.as(null)}return this.diffNavigator&&this.diffNavigator.dispose(),this.editorService.resolveEditorModel(e,!0).then(function(t){if(!(t instanceof v.TextDiffEditorModel)&&r.openAsBinary(e,o))return null;if(!r.getInput()||r.getInput()!==e)return null;var i=r.getControl();i.setModel(t.textDiffEditorModel);var n=!0;if(o instanceof c.TextDiffEditorOptions){var s=o;n=a.isUndefinedOrNull(s.autoRevealFirstChange)?n:s.autoRevealFirstChange}r.diffNavigator=new l.DiffNavigator(i,{alwaysRevealFirst:n}),r.diffNavigator.addListener2(l.DiffNavigator.Events.UPDATED,function(){r.nextDiffAction.updateEnablement(),r.previousDiffAction.updateEnablement()}),o&&a.isFunction(o.apply)&&o.apply(i),i.updateOptions(r.getCodeEditorOptions())},function(t){return r.isFileBinaryError(t)&&r.openAsBinary(e,o)?null:i.TPromise.wrapError(t)})},e.prototype.openAsBinary=function(t,e){if(t instanceof d.DiffEditorInput){var i=t.originalInput,o=t.modifiedInput,r=new d.DiffEditorInput(t.getName(),t.getDescription(),i,o,(!0));return this.editorService.openEditor(r,e,this.position).done(null,n.onUnexpectedError),!0}return!1},e.prototype.getCodeEditorOptions=function(){var e=t.prototype.getCodeEditorOptions.call(this),i=this.input;if(i instanceof d.DiffEditorInput){var r=i.modifiedInput,n=r instanceof f.StringEditorInput||r instanceof p.ResourceEditorInput;e.readOnly=n;var a=void 0,s=i&&i.getName();a=n?s?o.localize("readonlyEditorWithInputAriaLabel","{0}. Readonly text compare editor.",s):o.localize("readonlyEditorAriaLabel","Readonly text compare editor."):s?o.localize("editableEditorWithInputAriaLabel","{0}. Text file compare editor.",s):o.localize("editableEditorAriaLabel","Text file compare editor."),e.ariaLabel=a}return e},e.prototype.isFileBinaryError=function(t){var e=this;if(a.isArray(t)){var i=t;return i.some(function(t){return e.isFileBinaryError(t)})}return t.fileOperationResult===h.FileOperationResult.FILE_IS_BINARY},e.prototype.clearInput=function(){this.diffNavigator&&this.diffNavigator.dispose(),this.getControl().setModel(null),t.prototype.clearInput.call(this)},e.prototype.setEditorVisible=function(e,i){this.textDiffEditorVisible.set(e),t.prototype.setEditorVisible.call(this,e,i)},e.prototype.getDiffNavigator=function(){return this.diffNavigator},e.prototype.getActions=function(){return[this.previousDiffAction,this.nextDiffAction]},e.prototype.getSecondaryActions=function(){var e=this,n=t.prototype.getSecondaryActions.call(this),a=this.getControl(),s=a&&!a.renderSideBySide,c=o.localize("inlineDiffLabel","Switch to Inline View"),f=o.localize("sideBySideDiffLabel","Switch to Side by Side View"),p=new r.Action("toggle.diff.editorMode",s?f:c,null,(!0),function(){return e.getControl().updateOptions({renderSideBySide:s}),s=!s,p.label=s?f:c,i.TPromise.as(!0)});return p.order=50,n.push.apply(n,[p]),n},e.prototype.getControl=function(){return t.prototype.getControl.call(this)},e.prototype.dispose=function(){this.diffNavigator&&this.diffNavigator.dispose(),t.prototype.dispose.call(this)},e.ID="workbench.editors.textDiffEditor",e=__decorate([__param(0,g.ITelemetryService),__param(1,_.IInstantiationService),__param(2,y.IWorkspaceContextService),__param(3,E.IStorageService),__param(4,D.IMessageService),__param(5,b.IConfigurationService),__param(6,I.IEventService),__param(7,S.IWorkbenchEditorService),__param(8,w.IModeService),__param(9,N.IKeybindingService),__param(10,C.IThemeService)],e)}(s.BaseTextEditor);e.TextDiffEditor=A;var k=function(t){function e(i,r){t.call(this,r?e.ID_NEXT:e.ID_PREV),this.editor=i,this.next=r,this.label=this.next?o.localize("navigate.next.label","Next Change"):o.localize("navigate.prev.label","Previous Change"),this["class"]=this.next?"textdiff-editor-action next":"textdiff-editor-action previous",this.enabled=!1}return __extends(e,t),e.prototype.run=function(){return this.next?this.editor.getDiffNavigator().next():this.editor.getDiffNavigator().previous(),null},e.prototype.updateEnablement=function(){this.enabled=this.editor.getDiffNavigator().canNavigate()},e.ID_NEXT="workbench.action.compareEditor.nextChange",e.ID_PREV="workbench.action.compareEditor.previousChange",e}(r.Action)});