/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var s,o=arguments.length,i=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},__param=this&&this.__param||function(t,e){return function(r,n){e(r,n,t)}};define(["require","exports","vs/base/browser/dom","vs/base/common/types","vs/nls","vs/base/common/errors","vs/base/common/winjs.base","vs/base/common/lifecycle","vs/base/browser/builder","vs/base/browser/ui/octiconLabel/octiconLabel","vs/platform/platform","vs/platform/commands/common/commands","vs/workbench/services/editor/common/editorService","vs/workbench/browser/part","vs/workbench/common/actionRegistry","vs/workbench/browser/parts/statusbar/statusbar","vs/platform/instantiation/common/instantiation","vs/platform/telemetry/common/telemetry","vs/platform/message/common/message","vs/css!./media/statusbarpart"],function(t,e,r,n,s,o,i,a,c,m,u,p,d,l,v,h,f,y,b){"use strict";var g=function(t){function e(e,r){t.call(this,e),this.instantiationService=r,this.toDispose=[]}return __extends(e,t),e.prototype.addEntry=function(t,r,n){void 0===n&&(n=0);for(var s=this.doCreateStatusItem(r,n),o=this.instantiationService.createInstance(S,t),i=o.render(s),a=this.statusItemsContainer.getHTMLElement(),m=this.getEntries(r),u=!1,p=0;p<m.length;p++){var d=m[p],l=c.$(d).getProperty(e.PRIORITY_PROP);if(r===h.StatusbarAlignment.LEFT&&l<n||r===h.StatusbarAlignment.RIGHT&&l>n){a.insertBefore(s,d),u=!0;break}}return u||a.appendChild(s),{dispose:function(){c.$(s).destroy(),i&&i.dispose()}}},e.prototype.getEntries=function(t){for(var r=[],n=this.statusItemsContainer.getHTMLElement(),s=n.children,o=0;o<s.length;o++){var i=s.item(o);c.$(i).getProperty(e.ALIGNMENT_PROP)===t&&r.push(i)}return r},e.prototype.createContentArea=function(t){var e=this;this.statusItemsContainer=c.$(t);var r=u.Registry.as(h.Extensions.Statusbar),n=r.items.filter(function(t){return t.alignment===h.StatusbarAlignment.LEFT}).sort(function(t,e){return e.priority-t.priority}),s=r.items.filter(function(t){return t.alignment===h.StatusbarAlignment.RIGHT}).sort(function(t,e){return t.priority-e.priority}),o=s.concat(n);return(i=this.toDispose).push.apply(i,o.map(function(t){var r=e.instantiationService.createInstance(t.syncDescriptor),n=e.doCreateStatusItem(t.alignment,t.priority),s=r.render(n);return e.statusItemsContainer.append(n),s})),this.statusItemsContainer;var i},e.prototype.doCreateStatusItem=function(t,n){void 0===n&&(n=0);var s=document.createElement("div");return r.addClass(s,"statusbar-item"),t===h.StatusbarAlignment.RIGHT?r.addClass(s,"right"):r.addClass(s,"left"),c.$(s).setProperty(e.PRIORITY_PROP,n),c.$(s).setProperty(e.ALIGNMENT_PROP,t),s},e.prototype.setStatusMessage=function(t,e,r){var n=this;void 0===e&&(e=-1),void 0===r&&(r=0),this.statusMsgDispose&&this.statusMsgDispose.dispose();var s,o,i=setTimeout(function(){s=n.addEntry({text:t},h.StatusbarAlignment.LEFT,Number.MIN_VALUE),i=null},r),a={dispose:function(){i&&clearTimeout(i),o&&clearTimeout(o),s&&s.dispose()}};return this.statusMsgDispose=a,"number"==typeof e&&e>0&&(o=setTimeout(function(){return a.dispose()},e)),a},e.prototype.dispose=function(){this.toDispose=a.dispose(this.toDispose),t.prototype.dispose.call(this)},e.PRIORITY_PROP="priority",e.ALIGNMENT_PROP="alignment",e=__decorate([__param(1,f.IInstantiationService)],e)}(l.Part);e.StatusbarPart=g;var S=function(){function t(t,e,r,n,s,o){this.commandService=e,this.instantiationService=r,this.messageService=n,this.telemetryService=s,this.editorService=o,this.entry=t}return t.prototype.render=function(t){var e=this,n=[];r.addClass(t,"statusbar-entry");var s;return this.entry.command?(s=document.createElement("a"),c.$(s).on("click",function(){return e.executeCommand(e.entry.command)},n)):s=document.createElement("span"),new m.OcticonLabel(s).text=this.entry.text,this.entry.tooltip&&c.$(s).title(this.entry.tooltip),this.entry.color&&c.$(s).color(this.entry.color),t.appendChild(s),{dispose:function(){n=a.dispose(n)}}},t.prototype.executeCommand=function(t){var e,r=this,a=this.editorService.getActiveEditor(),c=u.Registry.as(v.Extensions.WorkbenchActions).getWorkbenchAction(t);if(c&&(e=this.instantiationService.createInstance(c.syncDescriptor)),!e){var m=a?a.getControl():null;m&&n.isFunction(m.getAction)&&(e=m.getAction(t))}a&&a.focus(),e?e.enabled?(this.telemetryService.publicLog("workbenchActionExecuted",{id:e.id,from:"status bar"}),(e.run()||i.TPromise.as(null)).done(function(){e.dispose()},function(t){return r.messageService.show(b.Severity.Error,o.toErrorMessage(t))})):this.messageService.show(b.Severity.Warning,s.localize("canNotRun","Command '{0}' can not be run from here.",e.label||t)):this.commandService.executeCommand(t).done(void 0,function(t){return r.messageService.show(b.Severity.Error,o.toErrorMessage(t))})},t=__decorate([__param(1,p.ICommandService),__param(2,f.IInstantiationService),__param(3,b.IMessageService),__param(4,y.ITelemetryService),__param(5,d.IWorkbenchEditorService)],t)}()});