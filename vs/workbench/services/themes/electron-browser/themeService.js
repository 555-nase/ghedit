var __decorate=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},__param=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/common/paths","vs/base/common/json","vs/platform/extensions/common/extensions","vs/platform/extensions/common/extensionsRegistry","vs/platform/theme/common/themes","vs/workbench/services/window/electron-browser/windowService","vs/platform/storage/common/storage","vs/platform/telemetry/common/telemetry","vs/base/browser/builder","vs/base/common/event","vs/base/node/plist","vs/base/node/pfs"],function(e,t,r,n,o,i,s,a,c,h,l,u,d,m,p,v){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function f(e){switch(e){case"vs":return"vs "+j+"-themes-light_vs-json";case"vs-dark":return"vs-dark "+j+"-themes-dark_vs-json";case"hc-black":return"hc-black "+j+"-themes-hc_black-json";case"vs "+P+"-themes-light_plus-tmTheme":return"vs "+j+"-themes-light_plus-json";case"vs-dark "+P+"-themes-dark_plus-tmTheme":return"vs-dark "+j+"-themes-dark_plus-json"}return e}function g(e){return e=e.replace(/[^_\-a-zA-Z0-9]/g,"-"),e.charAt(0).match(/[0-9\-]/)&&(e="_"+e),e}function b(e,t){return e.styleSheetContent?(w(e.styleSheetContent),t(e),r.TPromise.as(!0)):y(e.path).then(function(r){var n=T(e.id,r);return e.styleSheetContent=n,w(n),t(e),!0},function(t){return r.TPromise.wrapError(n.localize("error.cannotloadtheme","Unable to load {0}",e.path))})}function y(e){return v.readFile(e).then(function(t){if(".json"===o.extname(e)){var s=[],a=i.parse(t.toString(),s);return s.length>0?r.TPromise.wrapError(new Error(n.localize("error.cannotparsejson","Problems parsing JSON theme file: {0}",s.map(function(e){return i.getParseErrorMessage(e.error)}).join(", ")))):a.include?y(o.join(o.dirname(e),a.include)).then(function(e){return a.settings=e.settings.concat(a.settings),r.TPromise.as(a)}):r.TPromise.as(a)}var c=p.parse(t.toString());return c.errors&&c.errors.length?r.TPromise.wrapError(new Error(n.localize("error.cannotparse","Problems parsing plist file: {0}",c.errors.join(", ")))):r.TPromise.as(c.value)})}function T(e,t){var r=[],n=t.settings,o={background:void 0,foreground:void 0,caret:void 0,invisibles:void 0,lineHighlight:void 0,selection:void 0},i=c.getBaseThemeId(e)+"."+c.getSyntaxThemeId(e);if(Array.isArray(n)&&n.forEach(function(e,t,n){if(0!==t||e.scope){var s=e.scope,a=e.settings;if(s&&a){var c=Array.isArray(s)?s:s.split(","),h=k(a);c.forEach(function(e){e=e.trim().replace(/ /g,"."),r.push(".monaco-editor."+i+" .token."+e+" { "+h+" }")})}}else o=e.settings}),o.background){var s=new I(o.background);r.push(".monaco-editor."+i+" .monaco-editor-background { background-color: "+s+"; }"),r.push(".monaco-editor."+i+" .glyph-margin { background-color: "+s+"; }"),r.push("."+i+" .monaco-workbench .monaco-editor-background { background-color: "+s+"; }")}if(o.foreground){var a=new I(o.foreground);r.push(".monaco-editor."+i+" .token { color: "+a+"; }")}if(o.selection){var h=new I(o.selection);r.push(".monaco-editor."+i+" .focused .selected-text { background-color: "+h+"; }"),r.push(".monaco-editor."+i+" .selected-text { background-color: "+h.transparent(.5)+"; }")}if(o.lineHighlight){var l=new I(o.lineHighlight);r.push(".monaco-editor."+i+" .current-line { background-color: "+l+"; border:0; }")}if(o.caret){var u=new I(o.caret),d=u.opposite();r.push(".monaco-editor."+i+" .cursor { background-color: "+u+"; border-color: "+u+"; color: "+d+"; }")}if(o.invisibles){var m=new I(o.invisibles);r.push(".monaco-editor."+i+" .token.whitespace { color: "+m+" !important; }"),r.push(".monaco-editor."+i+" .lines-content .cigr { background: "+m+"; }")}return r.join("\n")}function k(e){var t=[],r=function(r){var n=e[r];switch(r){case"foreground":var o=new I(n);t.push("color: "+o+";");break;case"background":break;case"fontStyle":var i=n.split(" ");i.forEach(function(e){switch(n){case"italic":t.push("font-style: italic;");break;case"bold":t.push("font-weight: bold;");break;case"underline":t.push("text-decoration: underline;")}})}};for(var n in e)r(n);return t.join(" ")}function w(e){var t=document.head.getElementsByClassName(z);if(0===t.length){var r=document.createElement("style");r.type="text/css",r.className=z,r.innerHTML=e,document.head.appendChild(r)}else t[0].innerHTML=e}var S="vs-dark vscode-theme-defaults-themes-dark_plus-json",x="vscode:changeTheme",_="workbench.theme",E=c.getBaseThemeId(S),j="vscode-theme-defaults",P="vscode-theme-colorful-defaults",A=a.ExtensionsRegistry.registerExtensionPoint("themes",{description:n.localize("vscode.extension.contributes.themes","Contributes textmate color themes."),type:"array",defaultSnippets:[{body:[{label:"{{label}}",uiTheme:"vs-dark",path:"./themes/{{id}}.tmTheme."}]}],items:{type:"object",defaultSnippets:[{body:{label:"{{label}}",uiTheme:"vs-dark",path:"./themes/{{id}}.tmTheme."}}],properties:{label:{description:n.localize("vscode.extension.contributes.themes.label","Label of the color theme as shown in the UI."),type:"string"},uiTheme:{description:n.localize("vscode.extension.contributes.themes.uiTheme","Base theme defining the colors around the editor: 'vs' is the light color theme, 'vs-dark' is the dark color theme."),"enum":["vs","vs-dark","hc-black"]},path:{description:n.localize("vscode.extension.contributes.themes.path","Path of the tmTheme file. The path is relative to the extension folder and is typically './themes/themeFile.tmTheme'."),type:"string"}}}}),C=function(){function e(e,t,r,n){var o=this;this.extensionService=e,this.windowService=t,this.storageService=r,this.telemetryService=n,this.themeExtensionsActivated={},this.knownThemes=[],this.onThemeChange=new m.Emitter,A.setHandler(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];o.onThemes(n.description.extensionFolderPath,n.description.id,n.value,n.collector)}}),t.onBroadcast(function(e){e.channel===x&&"string"==typeof e.payload&&o.setTheme(e.payload,!1)})}return Object.defineProperty(e.prototype,"onDidThemeChange",{get:function(){return this.onThemeChange.event},enumerable:!0,configurable:!0}),e.prototype.initialize=function(e){this.container=e;var t=this.storageService.get(_,l.StorageScope.GLOBAL,null);return t||(t=S,this.storageService.store(_,t,l.StorageScope.GLOBAL)),this.setTheme(t,!1)},e.prototype.setTheme=function(e,t){var n=this;if(!e)return r.TPromise.as(!1);if(e===this.currentTheme)return t&&this.windowService.broadcast({channel:x,payload:e}),r.TPromise.as(!0);e=f(e);var o=function(e){var r=e.id;n.container&&(n.currentTheme&&d.$(n.container).removeClass(n.currentTheme),n.currentTheme=r,d.$(n.container).addClass(r)),n.storageService.store(_,r,l.StorageScope.GLOBAL),t?n.windowService.broadcast({channel:x,payload:r}):n.sendTelemetry(e),n.onThemeChange.fire(r)};return this.applyThemeCSS(e,S,o)},e.prototype.getTheme=function(){return this.currentTheme||this.storageService.get(_,l.StorageScope.GLOBAL,S)},e.prototype.loadTheme=function(e,t){return this.getThemes().then(function(r){var n=r.filter(function(t){return t.id===e});if(n.length>0)return n[0];if(t){var o=r.filter(function(e){return e.id===t});if(o.length>0)return o[0]}return null})},e.prototype.applyThemeCSS=function(e,t,r){return this.loadTheme(e,t).then(function(e){return!!e&&b(e,r)})},e.prototype.getThemes=function(){var e=this;return this.extensionService.onReady().then(function(t){return e.knownThemes})},e.prototype.onThemes=function(e,t,r,i){var s=this;return Array.isArray(r)?void r.forEach(function(r){if(!r.path||"string"!=typeof r.path)return void i.error(n.localize("reqpath","Expected string in `contributes.{0}.path`. Provided value: {1}",A.name,String(r.path)));var a=o.normalize(o.join(e,r.path));0!==a.indexOf(e)&&i.warn(n.localize("invalid.path.1","Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",A.name,a,e));var c=g(t+"-"+o.normalize(r.path));s.knownThemes.push({id:(r.uiTheme||E)+" "+c,label:r.label||o.basename(r.path),description:r.description,path:a,extensionId:t})}):void i.error(n.localize("reqarray","Extension point `{0}` must be an array.",A.name))},e.prototype.sendTelemetry=function(e){if(!this.themeExtensionsActivated[e.extensionId]){var t=a.ExtensionsRegistry.getExtensionDescription(e.extensionId);t&&(this.telemetryService.publicLog("activatePlugin",{id:t.id,name:t.name,isBuiltin:t.isBuiltin,publisherDisplayName:t.publisher,themeId:e.id}),this.themeExtensionsActivated[e.extensionId]=!0)}},e=__decorate([__param(0,s.IExtensionService),__param(1,h.IWindowService),__param(2,l.IStorageService),__param(3,u.ITelemetryService)],e)}();t.ThemeService=C;var z="contributedColorTheme",I=function(){function e(t){"string"==typeof t?this.parsed=e.parse(t):this.parsed=t,this.str=null}return e.parse=function(e){function t(e){return parseInt("0x"+e)}if("#"===e.charAt(0)&&e.length>=7){var r=t(e.substr(1,2)),n=t(e.substr(3,2)),o=t(e.substr(5,2)),i=9===e.length?t(e.substr(7,2))/255:1;return{r:r,g:n,b:o,a:i}}return{r:255,g:0,b:0,a:1}},e.prototype.toString=function(){if(!this.str){var e=this.parsed;this.str="rgba("+e.r+", "+e.g+", "+e.b+", "+ +e.a.toFixed(2)+")"}return this.str},e.prototype.transparent=function(t){var r=this.parsed;return new e({r:r.r,g:r.g,b:r.b,a:r.a*t})},e.prototype.opposite=function(){return new e({r:255-this.parsed.r,g:255-this.parsed.g,b:255-this.parsed.b,a:this.parsed.a})},e}()});