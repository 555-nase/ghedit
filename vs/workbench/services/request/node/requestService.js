/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var s,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(n<3?s(i):n>3?s(t,r,i):s(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/network","vs/platform/configuration/common/configurationRegistry","vs/base/common/strings","vs/nls","vs/base/common/lifecycle","vs/platform/platform","vs/platform/configuration/common/configuration","vs/platform/request/common/baseRequestService","vs/platform/telemetry/common/telemetry","vs/platform/workspace/common/workspace","vs/base/common/objects","vs/base/node/request","vs/base/node/proxy"],function(e,t,r,o,s,n,i,a,p,c,u,l,f,h,d,m){"use strict";var v=function(e){function t(t,r,o){var s=this;e.call(this,t,o),this.proxyUrl=null,this.strictSSL=!0,this.disposables=[];var n=r.getConfiguration();this.configure(n);var i=r.onDidUpdateConfiguration(function(e){return s.configure(e.config)});this.disposables.push(i)}return __extends(t,e),t.prototype.configure=function(e){this.proxyUrl=e.http&&e.http.proxy,this.strictSSL=e.http&&e.http.proxyStrictSSL},t.prototype.makeRequest=function(t){var s=t.url;if(!s)throw new Error("IRequestService.makeRequest: Url is required.");return n.startsWith(s,"file://")?o.xhr(t).then(null,function(e){return 0===e.status&&e.responseText?e:r.Promise.wrapError({status:404,responseText:i.localize("localFileNotFound","File not found.")})}):e.prototype.makeRequest.call(this,t)},t.prototype.makeCrossOriginRequest=function(e){var t=this,s=t.proxyUrl,n=t.strictSSL,i=m.getProxyAgent(e.url,{proxyUrl:s,strictSSL:n});return e=h.assign({},e),e=h.assign(e,{agent:i,strictSSL:n}),d.request(e).then(function(t){return new r.TPromise(function(r,s,n){var i=t.res,a=t.stream,p=[];a.on("data",function(e){return p.push(e)}),a.on("end",function(){var t=i.statusCode;if(e.followRedirects>0&&(t>=300&&t<=303||307===t)){var a=i.headers.location;if(a){var c={type:e.type,url:a,user:e.user,password:e.password,responseType:e.responseType,headers:e.headers,timeout:e.timeout,followRedirects:e.followRedirects-1,data:e.data};return void o.xhr(c).done(r,s,n)}}var u={responseText:p.join(""),status:t,getResponseHeader:function(e){return i.headers[e]},readyState:4};t>=200&&t<300||1223===t?r(u):s(u)})},function(t){var o;return o=i?"Unable to to connect to "+e.url+" through a proxy . Error: "+t.message:"Unable to to connect to "+e.url+". Error: "+t.message,r.TPromise.wrapError({responseText:o,status:404})})})},t.prototype.dispose=function(){this.disposables=a.dispose(this.disposables)},t=__decorate([__param(0,f.IWorkspaceContextService),__param(1,c.IConfigurationService),__param(2,l.ITelemetryService)],t)}(u.BaseRequestService);t.RequestService=v;var y=p.Registry.as(s.Extensions.Configuration);y.registerConfiguration({id:"http",order:15,title:i.localize("httpConfigurationTitle","HTTP"),type:"object",properties:{"http.proxy":{type:"string",pattern:"^https?://([^:]*(:[^@]*)?@)?([^:]+)(:\\d+)?/?$|^$",description:i.localize("proxy","The proxy setting to use. If not set will be taken from the http_proxy and https_proxy environment variables")},"http.proxyStrictSSL":{type:"boolean","default":!0,description:i.localize("strictSSL","Whether the proxy server certificate should be verified against the list of supplied CAs.")}}})});