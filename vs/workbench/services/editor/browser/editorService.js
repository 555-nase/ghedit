var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,o){var i,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,r,s):i(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s},__param=this&&this.__param||function(t,e){return function(r,o){e(r,o,t)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/uri","vs/base/common/network","vs/base/common/mime","vs/platform/platform","vs/base/common/paths","vs/base/common/types","vs/editor/common/editorCommon","vs/workbench/common/editor","vs/workbench/common/editor/resourceEditorInput","vs/workbench/common/editor/untitledEditorInput","vs/workbench/common/editor/diffEditorInput","vs/workbench/services/untitled/common/untitledEditorService","vs/workbench/services/editor/common/editorService","vs/platform/instantiation/common/instantiation"],function(t,e,r,o,i,n,s,c,u,a,p,d,f,l,m,h,v){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var E=function(){function t(t,e,r){this.untitledEditorService=e,this.instantiationService=r,this.editorPart=t,this.fileInputDescriptor=s.Registry.as(p.Extensions.Editors).getDefaultFileInput()}return t.prototype.getActiveEditor=function(){return this.editorPart.getActiveEditor()},t.prototype.getActiveEditorInput=function(){return this.editorPart.getActiveEditorInput()},t.prototype.getVisibleEditors=function(){return this.editorPart.getVisibleEditors()},t.prototype.isVisible=function(t,e){return!!t&&this.getVisibleEditors().some(function(r){if(!r.input)return!1;if(t.matches(r.input))return!0;if(e&&r.input instanceof l.DiffEditorInput){var o=r.input;return t.matches(o.modifiedInput)||t.matches(o.originalInput)}return!1})},t.prototype.openEditor=function(t,e,n){var s=this;if(!t)return r.TPromise.as(null);if(t instanceof p.EditorInput)return this.doOpenEditor(t,this.toOptions(e),n);var c=t;if(c.resource instanceof o["default"]){var u=c.resource.scheme;if(u===i.Schemas.http||u===i.Schemas.https)return window.open(c.resource.toString(!0)),r.TPromise.as(null)}var a=t;return this.createInput(a).then(function(t){return t?s.doOpenEditor(t,p.TextEditorOptions.from(a),e):r.TPromise.as(null)})},t.prototype.toOptions=function(t){if(!t||t instanceof p.EditorOptions)return t;var e=t;return e.selection?p.TextEditorOptions.create(t):p.EditorOptions.create(t)},t.prototype.doOpenEditor=function(t,e,r){return this.editorPart.openEditor(t,e,r)},t.prototype.openEditors=function(t){var e=this;return r.TPromise.join(t.map(function(t){return e.createInput(t.input)})).then(function(r){var o=r.map(function(r,o){var i=t[o].input instanceof p.EditorInput?e.toOptions(t[o].options):p.TextEditorOptions.from(t[o].input);return{input:r,options:i,position:t[o].position}});return e.editorPart.openEditors(o)})},t.prototype.replaceEditors=function(t){var e=this;return r.TPromise.join(t.map(function(t){return e.createInput(t.toReplace)})).then(function(o){return r.TPromise.join(t.map(function(t){return e.createInput(t.replaceWith)})).then(function(r){var i=t.map(function(t,i){var n=t.toReplace instanceof p.EditorInput?e.toOptions(t.options):p.TextEditorOptions.from(t.replaceWith);return{toReplace:o[i],replaceWith:r[i],options:n}});return e.editorPart.replaceEditors(i)})})},t.prototype.closeEditor=function(t,e){return this.editorPart.closeEditor(t,e)},t.prototype.closeEditors=function(t,e,r){return this.editorPart.closeEditors(t,e,r)},t.prototype.closeAllEditors=function(t){return this.editorPart.closeAllEditors(t)},t.prototype.resolveEditorModel=function(t,e){return this.createInput(t).then(function(t){return t&&t instanceof p.EditorInput?t.resolve(!!e):r.TPromise.as(null)})},t.prototype.createInput=function(t){if(t instanceof p.EditorInput)return r.TPromise.as(t);var e=t;if(e.resource instanceof o["default"]&&e.resource.scheme===i.Schemas.inMemory){var n=this.getActiveEditor();if(n){var s=n.getControl();if(u.isFunction(s.getEditorType))if(s.getEditorType()===a.EditorType.ICodeEditor){var l=s,m=this.findModel(l,t);if(m)return r.TPromise.as(n.input)}else if(s.getEditorType()===a.EditorType.IDiffEditor){var h=n.input,v=s,E=this.findModel(v.getOriginalEditor(),t);if(E)return r.TPromise.as(h.originalInput);var I=this.findModel(v.getModifiedEditor(),t);if(I)return r.TPromise.as(h.modifiedInput)}}}else{if(e.resource instanceof o["default"]&&e.resource.scheme===f.UntitledEditorInput.SCHEMA)return r.TPromise.as(this.untitledEditorService.createOrGet(e.resource));if(this.fileInputDescriptor&&e.resource instanceof o["default"]&&e.resource.scheme===i.Schemas.file)return this.createFileInput(e.resource,e.mime,e.encoding);if(e.resource instanceof o["default"])return r.TPromise.as(this.instantiationService.createInstance(d.ResourceEditorInput,c.basename(e.resource.fsPath),c.dirname(e.resource.fsPath),e.resource))}return r.TPromise.as(null)},t.prototype.createFileInput=function(t,e,r){return this.instantiationService.createInstance(this.fileInputDescriptor).then(function(o){return o.setResource(t),o.setMime(e||n.guessMimeTypes(t.fsPath).join(", ")),o.setPreferredEncoding(r),o})},t.prototype.findModel=function(t,e){var r=t.getModel();return r&&r.uri.toString()===e.resource.toString()?r:null},t=__decorate([__param(1,m.IUntitledEditorService),__param(2,v.IInstantiationService)],t)}();e.WorkbenchEditorService=E;var I=function(t){function e(e,r,o,i){t.call(this,i,r,o),this.handler=e}return __extends(e,t),e.prototype.doOpenEditor=function(e,o,i){var n=this;return this.handler(e,o,i).then(function(s){return s?r.TPromise.as(s):t.prototype.doOpenEditor.call(n,e,o,i)})},e=__decorate([__param(1,m.IUntitledEditorService),__param(2,v.IInstantiationService),__param(3,h.IWorkbenchEditorService)],e)}(E);e.DelegatingWorkbenchEditorService=I});