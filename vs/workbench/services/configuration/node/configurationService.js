/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)};define(["require","exports","vs/base/common/winjs.base","vs/base/common/uri","vs/base/common/strings","vs/base/common/platform","vs/base/common/paths","vs/base/node/extfs","vs/base/common/objects","vs/platform/configuration/common/configurationService","vs/workbench/common/events","vs/base/node/pfs","vs/base/common/jsonFormatter","vs/base/common/jsonEdit"],function(t,e,o,n,r,i,s,a,c,p,u,f,l,h){"use strict";var v=function(t){function e(e,o){t.call(this,e,o),this.registerListeners()}return __extends(e,t),e.prototype.registerListeners=function(){var e=this;t.prototype.registerListeners.call(this),this.toDispose=this.eventService.addListener2(u.EventType.WORKBENCH_OPTIONS_CHANGED,function(t){return e.onOptionsChanged(t)})},e.prototype.onOptionsChanged=function(t){"globalSettings"===t.key&&this.handleConfigurationChange()},e.prototype.resolveContents=function(t){var e=this,n=[];return o.TPromise.join(t.map(function(t){return e.resolveContent(t).then(function(t){n.push(t)})})).then(function(){return n})},e.prototype.resolveContent=function(t){return f.readFile(t.fsPath).then(function(e){return{resource:t,value:e.toString()}})},e.prototype.resolveStat=function(t){return new o.TPromise(function(e,o){a.readdir(t.fsPath,function(a,c){a?"ENOTDIR"===a.code?e({resource:t,isDirectory:!1}):o(a):e({resource:t,isDirectory:!0,children:c.map(function(e){return i.isMacintosh&&(e=r.normalizeNFC(e)),{resource:n["default"].file(s.join(t.fsPath,e))}})})})})},e.prototype.loadWorkspaceConfiguration=function(e){return this.contextService.getWorkspace()?t.prototype.loadWorkspaceConfiguration.call(this,e):o.TPromise.as({})},e.prototype.loadGlobalConfiguration=function(){var e=t.prototype.loadGlobalConfiguration.call(this),o=this.contextService.getOptions().globalSettings;return{contents:c.mixin(c.clone(e.contents),o.settings,!0),parseErrors:o.settingsParseErrors}},e.prototype.setUserConfiguration=function(t,e){var o=this,n=this.contextService.getConfiguration().env.appSettingsPath;return f.readFile(n,"utf8").then(function(r){var i=o.getConfiguration("editor"),s=i.tabSize,a=i.insertSpaces,c="string"==typeof t?t.split("."):t,p=h.setProperty(r,c,e,{insertSpaces:a,tabSize:s,eol:"\n"});return r=l.applyEdits(r,p),f.writeFile(n,r,"utf8")})},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.toDispose.dispose()},e}(p.ConfigurationService);e.ConfigurationService=v});