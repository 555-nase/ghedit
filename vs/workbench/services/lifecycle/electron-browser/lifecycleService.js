var __decorate=this&&this.__decorate||function(e,n,t,r){var o,i=arguments.length,s=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,t,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(n,t,s):o(n,t))||s);return i>3&&s&&Object.defineProperty(n,t,s),s},__param=this&&this.__param||function(e,n){return function(t,r){n(t,r,e)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/severity","vs/base/common/errors","vs/platform/message/common/message","vs/workbench/services/window/electron-browser/windowService","electron","vs/base/common/event"],function(e,n,t,r,o,i,s,c,a){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var u=function(){function e(e,n){this.messageService=e,this.windowService=n,this._onWillShutdown=new a.Emitter,this._onShutdown=new a.Emitter,this.registerListeners()}return Object.defineProperty(e.prototype,"onWillShutdown",{get:function(){return this._onWillShutdown.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onShutdown",{get:function(){return this._onShutdown.event},enumerable:!0,configurable:!0}),e.prototype.registerListeners=function(){var e=this,n=this.windowService.getWindowId();c.ipcRenderer.on("vscode:beforeUnload",function(t,r){e.onBeforeUnload().done(function(t){t?c.ipcRenderer.send(r.cancelChannel,n):(e._onShutdown.fire(),c.ipcRenderer.send(r.okChannel,n))})})},e.prototype.onBeforeUnload=function(){var e=this,n=[];if(this._onWillShutdown.fire({veto:function(e){n.push(e)}}),0===n.length)return t.TPromise.as(!1);for(var i=[],s=!1,c=0,a=n;c<a.length;c++){var u=a[c];if(u===!0)return t.TPromise.as(!0);t.TPromise.is(u)&&i.push(u.then(function(e){e&&(s=!0)},function(n){e.messageService.show(r["default"].Error,o.toErrorMessage(n)),s=!0}))}return t.TPromise.join(i).then(function(){return s})},e=__decorate([__param(0,i.IMessageService),__param(1,s.IWindowService)],e)}();n.LifecycleService=u});