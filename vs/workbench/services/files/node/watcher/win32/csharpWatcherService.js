/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","child_process","vs/platform/files/common/files","vs/base/node/decoder","vs/base/common/glob","vs/base/common/uri"],function(e,t,r,n,o,i,a){"use strict";var s=function(){function t(e,t,r,n,o){this.watchedFolder=e,this.ignored=t,this.eventCallback=r,this.errorCallback=n,this.verboseLogging=o,this.startWatcher()}return t.prototype.startWatcher=function(){var n=this,s=[this.watchedFolder];this.verboseLogging&&s.push("-verbose"),this.handle=r.spawn(a["default"].parse(e.toUrl("vs/workbench/services/files/node/watcher/win32/CodeHelper.exe")).fsPath,s);var h=new o.LineDecoder;this.handle.stdout.on("data",function(e){var r=[];h.write(e).forEach(function(e){var o=e.split("|");if(2===o.length){var a=Number(o[0]),s=o[1];if(a>=0&&a<3){if(n.ignored&&n.ignored.some(function(e){return i.match(e,s)}))return;r.push({type:t.changeTypeMap[a],path:s})}else console.log("%c[File Watcher]","color: darkgreen",o[1])}}),r.length>0&&n.eventCallback(r)}),this.handle.on("error",function(e){return n.onError(e)}),this.handle.stderr.on("data",function(e){return n.onError(e)}),this.handle.on("exit",function(e,t){return n.onExit(e,t)})},t.prototype.onError=function(e){this.errorCallback("[FileWatcher] process error: "+e.toString())},t.prototype.onExit=function(e,t){this.handle&&(this.errorCallback("[FileWatcher] terminated unexpectedly (code: "+e+", signal: "+t+")"),this.startWatcher())},t.prototype.dispose=function(){this.handle&&(this.handle.kill(),this.handle=null)},t.changeTypeMap=[n.FileChangeType.UPDATED,n.FileChangeType.ADDED,n.FileChangeType.DELETED],t}();t.OutOfProcessWin32FolderWatcher=s});