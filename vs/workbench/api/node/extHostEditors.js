var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};define(["require","exports","vs/base/common/errors","vs/base/common/idGenerator","vs/base/common/event","vs/base/common/winjs.base","./extHostTypes","./extHostTypeConverters","./extHost.protocol"],function(t,e,o,i,n,r,s,c,d){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function a(t,e){return void 0===e&&(e="Refer to the documentation for further details."),function(o,i,n){var r=n.value;return n.value=function(){for(var o=[],i=0;i<arguments.length;i++)o[i-0]=arguments[i];return console.warn("[Deprecation Warning] method '"+t+"' is deprecated and should no longer be used. "+e),r.apply(this,o)},n}}var u=function(t){function e(e,o){t.call(this),this._onDidChangeTextEditorSelection=new n.Emitter,this.onDidChangeTextEditorSelection=this._onDidChangeTextEditorSelection.event,this._onDidChangeTextEditorOptions=new n.Emitter,this.onDidChangeTextEditorOptions=this._onDidChangeTextEditorOptions.event,this._onDidChangeTextEditorViewColumn=new n.Emitter,this.onDidChangeTextEditorViewColumn=this._onDidChangeTextEditorViewColumn.event,this._extHostDocuments=o,this._proxy=e.get(d.MainContext.MainThreadEditors),this._onDidChangeActiveTextEditor=new n.Emitter,this._editors=Object.create(null),this._visibleEditorIds=[]}return __extends(e,t),e.prototype.getActiveTextEditor=function(){return this._editors[this._activeEditorId]},e.prototype.getVisibleTextEditors=function(){var t=this;return this._visibleEditorIds.map(function(e){return t._editors[e]})},Object.defineProperty(e.prototype,"onDidChangeActiveTextEditor",{get:function(){return this._onDidChangeActiveTextEditor&&this._onDidChangeActiveTextEditor.event},enumerable:!0,configurable:!0}),e.prototype.showTextDocument=function(t,e,o){var i=this;return this._proxy.$tryShowTextDocument(t.uri,c.fromViewColumn(e),o).then(function(e){var o=i._editors[e];if(o)return o;throw new Error("Failed to show text document "+t.uri.toString()+", should show in editor #"+e)})},e.prototype.createTextEditorDecorationType=function(t){return new p(this._proxy,t)},e.prototype.$acceptTextEditorAdd=function(t){var e=this._extHostDocuments.getDocumentData(t.document),o=new l(this._proxy,t.id,e,t.selections.map(c.toSelection),t.options,c.toViewColumn(t.editorPosition));this._editors[t.id]=o},e.prototype.$acceptOptionsChanged=function(t,e){var o=this._editors[t];o._acceptOptions(e),this._onDidChangeTextEditorOptions.fire({textEditor:o,options:e})},e.prototype.$acceptSelectionsChanged=function(t,e){var o=e.selections.map(c.toSelection),i=this._editors[t];i._acceptSelections(o),this._onDidChangeTextEditorSelection.fire({textEditor:i,selections:o})},e.prototype.$acceptActiveEditorAndVisibleEditors=function(t,e){this._visibleEditorIds=e,this._activeEditorId!==t&&(this._activeEditorId=t,this._onDidChangeActiveTextEditor.fire(this.getActiveTextEditor()))},e.prototype.$acceptEditorPositionData=function(t){for(var e in t){var o=this._editors[e],i=c.toViewColumn(t[e]);o.viewColumn!==i&&(o._acceptViewColumn(i),this._onDidChangeTextEditorViewColumn.fire({textEditor:o,viewColumn:i}))}},e.prototype.$acceptTextEditorRemove=function(t){var e=this._visibleEditorIds.filter(function(e){return e!==t});this._activeEditorId===t?this.$acceptActiveEditorAndVisibleEditors(void 0,e):this.$acceptActiveEditorAndVisibleEditors(this._activeEditorId,e);var o=this._editors[t];o.dispose(),delete this._editors[t]},e}(d.ExtHostEditorsShape);e.ExtHostEditors=u;var p=function(){function t(e,o){this.key=t._Keys.nextId(),this._proxy=e,this._proxy.$registerTextEditorDecorationType(this.key,o)}return t.prototype.dispose=function(){this._proxy.$removeTextEditorDecorationType(this.key)},t._Keys=new i.IdGenerator("TextEditorDecorationType"),t}(),h=function(){function t(t){this._documentVersionId=t.version,this._collectedEdits=[],this._setEndOfLine=0}return t.prototype.finalize=function(){return{documentVersionId:this._documentVersionId,edits:this._collectedEdits,setEndOfLine:this._setEndOfLine}},t.prototype.replace=function(t,e){var o=null;if(t instanceof s.Position)o=new s.Range(t,t);else if(t instanceof s.Range)o=t;else{if(!(t instanceof s.Selection))throw new Error("Unrecognized location");o=new s.Range(t.start,t.end)}this._collectedEdits.push({range:o,text:e,forceMoveMarkers:!1})},t.prototype.insert=function(t,e){this._collectedEdits.push({range:new s.Range(t,t),text:e,forceMoveMarkers:!0})},t.prototype["delete"]=function(t){var e=null;if(t instanceof s.Range)e=t;else{if(!(t instanceof s.Selection))throw new Error("Unrecognized location");e=new s.Range(t.start,t.end)}this._collectedEdits.push({range:e,text:null,forceMoveMarkers:!0})},t.prototype.setEndOfLine=function(t){if(t!==s.EndOfLine.LF&&t!==s.EndOfLine.CRLF)throw o.illegalArgument("endOfLine");this._setEndOfLine=t},t}();e.TextEditorEdit=h;var l=function(){function t(t,e,o,i,n,r){this._proxy=t,this._id=e,this._documentData=o,this._selections=i,this._options=n,this._viewColumn=r}return t.prototype.dispose=function(){this._documentData=null},t.prototype.show=function(t){this._proxy.$tryShowEditor(this._id,c.fromViewColumn(t))},t.prototype.hide=function(){this._proxy.$tryHideEditor(this._id)},Object.defineProperty(t.prototype,"document",{get:function(){return this._documentData.document},set:function(t){throw o.readonly("document")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(t){var e=this;this._options=t,this._runOnProxy(function(){return e._proxy.$trySetOptions(e._id,e._options)},!0)},enumerable:!0,configurable:!0}),t.prototype._acceptOptions=function(t){this._options=t},Object.defineProperty(t.prototype,"viewColumn",{get:function(){return this._viewColumn},set:function(t){throw o.readonly("viewColumn")},enumerable:!0,configurable:!0}),t.prototype._acceptViewColumn=function(t){this._viewColumn=t},Object.defineProperty(t.prototype,"selection",{get:function(){return this._selections&&this._selections[0]},set:function(t){if(!(t instanceof s.Selection))throw o.illegalArgument("selection");this._selections=[t],this._trySetSelection(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selections",{get:function(){return this._selections},set:function(t){if(!Array.isArray(t)||t.some(function(t){return!(t instanceof s.Selection)}))throw o.illegalArgument("selections");this._selections=t,this._trySetSelection(!0)},enumerable:!0,configurable:!0}),t.prototype.setDecorations=function(t,e){var o=this;this._runOnProxy(function(){return o._proxy.$trySetDecorations(o._id,t.key,c.fromRangeOrRangeWithMessage(e))},!0)},t.prototype.revealRange=function(t,e){var o=this;this._runOnProxy(function(){return o._proxy.$tryRevealRange(o._id,c.fromRange(t),e||s.TextEditorRevealType.Default)},!0)},t.prototype._trySetSelection=function(t){var e=this,o=this._selections.map(c.fromSelection);return this._runOnProxy(function(){return e._proxy.$trySetSelections(e._id,o)},t)},t.prototype._acceptSelections=function(t){this._selections=t},t.prototype.edit=function(t){var e=new h(this._documentData.document);return t(e),this._applyEdit(e)},t.prototype._applyEdit=function(t){var e=t.finalize(),o=e.edits.map(function(t){return{range:c.fromRange(t.range),text:t.text,forceMoveMarkers:t.forceMoveMarkers}});return this._proxy.$tryApplyEdits(this._id,e.documentVersionId,o,e.setEndOfLine)},t.prototype._runOnProxy=function(t,e){var o=this;return t().then(function(){return o},function(t){return e?void console.warn(t):r.TPromise.wrapError(e)})},__decorate([a("TextEditor.show")],t.prototype,"show",null),__decorate([a("TextEditor.hide")],t.prototype,"hide",null),t}()});