{"version":3,"file":"vs/workbench/api/node/extHostWorkspace.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/workbench/api/node/extHostWorkspace.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {isPromiseCanceledError} from 'vs/base/common/errors';\nimport URI from 'vs/base/common/uri';\nimport {ISearchService, QueryType} from 'vs/platform/search/common/search';\nimport {IWorkspaceContextService, IWorkspace} from 'vs/platform/workspace/common/workspace';\nimport {Remotable, IThreadService} from 'vs/platform/thread/common/thread';\nimport {IEventService} from 'vs/platform/event/common/event';\nimport {IWorkbenchEditorService} from 'vs/workbench/services/editor/common/editorService';\nimport {ITextFileService} from 'vs/workbench/parts/files/common/files';\nimport {ICommonCodeEditor} from 'vs/editor/common/editorCommon';\nimport {bulkEdit, IResourceEdit} from 'vs/editor/common/services/bulkEdit';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {fromRange} from 'vs/workbench/api/node/extHostTypeConverters';\nimport {Uri, CancellationToken} from 'vscode';\n\nexport class ExtHostWorkspace {\n\n\tprivate static _requestIdPool = 0;\n\n\tprivate _proxy: MainThreadWorkspace;\n\tprivate _workspacePath: string;\n\n\tconstructor( @IThreadService threadService: IThreadService, workspacePath:string) {\n\t\tthis._proxy = threadService.getRemotable(MainThreadWorkspace);\n\t\tthis._workspacePath = workspacePath;\n\t}\n\n\tgetPath(): string {\n\t\treturn this._workspacePath;\n\t}\n\n\tgetRelativePath(pathOrUri: string|Uri): string {\n\n\t\tlet path: string;\n\t\tif (typeof pathOrUri === 'string') {\n\t\t\tpath = pathOrUri;\n\t\t} else {\n\t\t\tpath = pathOrUri.fsPath;\n\t\t}\n\n\t\tif (this._workspacePath && this._workspacePath.length < path.length) {\n\t\t\t// return relative(workspacePath, path);\n\t\t\treturn path.substring(this._workspacePath.length);\n\t\t}\n\n\t\treturn path;\n\t}\n\n\tfindFiles(include: string, exclude: string, maxResults?: number, token?: CancellationToken): Thenable<Uri[]> {\n\t\tconst requestId = ExtHostWorkspace._requestIdPool++;\n\t\tconst result = this._proxy.$startSearch(include, exclude, maxResults, requestId);\n\t\tif (token) {\n\t\t\ttoken.onCancellationRequested(() => this._proxy.$cancelSearch(requestId));\n\t\t}\n\t\treturn result;\n\t}\n\n\tsaveAll(includeUntitled?: boolean): Thenable<boolean> {\n\t\treturn this._proxy.$saveAll(includeUntitled);\n\t}\n\n\tappyEdit(edit: vscode.WorkspaceEdit): TPromise<boolean> {\n\n\t\tlet resourceEdits: IResourceEdit[] = [];\n\n\t\tlet entries = edit.entries();\n\t\tfor (let entry of entries) {\n\t\t\tlet [uri, edits] = entry;\n\n\t\t\tfor (let edit of edits) {\n\t\t\t\tresourceEdits.push({\n\t\t\t\t\tresource: <URI>uri,\n\t\t\t\t\tnewText: edit.newText,\n\t\t\t\t\trange: fromRange(edit.range)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this._proxy.$applyWorkspaceEdit(resourceEdits);\n\t}\n}\n\n@Remotable.MainContext('MainThreadWorkspace')\nexport class MainThreadWorkspace {\n\n\tprivate _activeSearches: { [id: number]: TPromise<Uri[]> } = Object.create(null);\n\tprivate _searchService: ISearchService;\n\tprivate _workspace: IWorkspace;\n\tprivate _textFileService: ITextFileService;\n\tprivate _editorService:IWorkbenchEditorService;\n\tprivate _eventService:IEventService;\n\n\tconstructor( @ISearchService searchService: ISearchService,\n\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t@ITextFileService textFileService,\n\t\t@IWorkbenchEditorService editorService,\n\t\t@IEventService eventService) {\n\n\t\tthis._searchService = searchService;\n\t\tthis._workspace = contextService.getWorkspace();\n\t\tthis._textFileService = textFileService;\n\t\tthis._editorService = editorService;\n\t\tthis._eventService = eventService;\n\t}\n\n\t$startSearch(include: string, exclude: string, maxResults: number, requestId: number): Thenable<Uri[]> {\n\n\t\tif (!this._workspace) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst search = this._searchService.search({\n\t\t\tfolderResources: [this._workspace.resource],\n\t\t\ttype: QueryType.File,\n\t\t\tmaxResults,\n\t\t\tincludePattern: { [include]: true },\n\t\t\texcludePattern: { [exclude]: true },\n\t\t}).then(result => {\n\t\t\treturn result.results.map(m => m.resource);\n\t\t}, err => {\n\t\t\tif (!isPromiseCanceledError(err)) {\n\t\t\t\treturn TPromise.wrapError(err);\n\t\t\t}\n\t\t});\n\n\t\tthis._activeSearches[requestId] = search;\n\t\tconst onDone = () => delete this._activeSearches[requestId];\n\t\tsearch.done(onDone, onDone);\n\n\t\treturn search;\n\t}\n\n\t$cancelSearch(requestId: number): Thenable<boolean> {\n\t\tconst search = this._activeSearches[requestId];\n\t\tif (search) {\n\t\t\tdelete this._activeSearches[requestId];\n\t\t\tsearch.cancel();\n\t\t\treturn TPromise.as(true);\n\t\t}\n\t}\n\n\t$saveAll(includeUntitled?: boolean): Thenable<boolean> {\n\t\treturn this._textFileService.saveAll(includeUntitled).then(result => {\n\t\t\treturn result.results.every(each => each.success === true);\n\t\t});\n\t}\n\n\t$applyWorkspaceEdit(edits: IResourceEdit[]): TPromise<boolean> {\n\n\t\tlet codeEditor: ICommonCodeEditor;\n\t\tlet editor = this._editorService.getActiveEditor();\n\t\tif (editor) {\n\t\t\tlet candidate = <ICommonCodeEditor> editor.getControl();\n\t\t\tif (typeof candidate.getEditorType === 'function') {\n\t\t\t\t// enough proof\n\t\t\t\tcodeEditor = candidate;\n\t\t\t}\n\t\t}\n\n\t\treturn bulkEdit(this._eventService, this._editorService, codeEditor, edits)\n\t\t\t.then(() => true);\n\t}\n}"]}