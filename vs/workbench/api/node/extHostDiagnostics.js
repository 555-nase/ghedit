var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};define(["require","exports","vs/base/common/uri","vs/base/common/severity","./extHost.protocol"],function(t,e,i,o,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var r=function(){function t(t,e){this._isDisposed=!1,this._data=Object.create(null),this._name=t,this._proxy=e}return t.prototype.dispose=function(){this._isDisposed||(this._proxy.$clear(this.name),this._proxy=void 0,this._data=void 0,this._isDisposed=!0)},Object.defineProperty(t.prototype,"name",{get:function(){return this._checkDisposed(),this._name},enumerable:!0,configurable:!0}),t.prototype.set=function(e,o){if(!e)return void this.clear();this._checkDisposed();var s;if(e instanceof i["default"]){if(!o)return void this["delete"](e);this._data[e.toString()]=o,s=[e]}else if(Array.isArray(e)){s=[];for(var r=0,n=e;r<n.length;r++){var a=n[r],c=a[0],h=a[1];if(s.push(c),h){var p=this._data[c.toString()];p?p.push.apply(p,h):this._data[c.toString()]=h}else delete this._data[c.toString()]}}for(var l=[],d=0,u=s;d<u.length;d++){var c=u[d],_=void 0,f=this._data[c.toString()];f&&(f.length>t._maxDiagnosticsPerFile&&(console.warn("diagnostics for %s will be capped to %d (actually is %d)",c.toString(),t._maxDiagnosticsPerFile,f.length),f=f.slice(0,t._maxDiagnosticsPerFile)),_=f.map(t._toMarkerData)),l.push([c,_])}this._proxy.$changeMany(this.name,l)},t.prototype["delete"]=function(t){this._checkDisposed(),delete this._data[t.toString()],this._proxy.$changeMany(this.name,[[t,void 0]])},t.prototype.clear=function(){this._checkDisposed(),this._data=Object.create(null),this._proxy.$clear(this.name)},t.prototype.forEach=function(t,e){this._checkDisposed();for(var o in this._data){var s=i["default"].parse(o);t.apply(e,[s,this.get(s),this])}},t.prototype.get=function(t){this._checkDisposed();var e=this._data[t.toString()];if(Array.isArray(e))return Object.freeze(e.slice(0))},t.prototype.has=function(t){return this._checkDisposed(),Array.isArray(this._data[t.toString()])},t.prototype._checkDisposed=function(){if(this._isDisposed)throw new Error("illegal state - object is disposed")},t._toMarkerData=function(e){var i=e.range;return{startLineNumber:i.start.line+1,startColumn:i.start.character+1,endLineNumber:i.end.line+1,endColumn:i.end.character+1,message:e.message,source:e.source,severity:t._convertDiagnosticsSeverity(e.severity),code:String(e.code)}},t._convertDiagnosticsSeverity=function(t){switch(t){case 0:return o["default"].Error;case 1:return o["default"].Warning;case 2:return o["default"].Info;case 3:return o["default"].Ignore;default:return o["default"].Error}},t._maxDiagnosticsPerFile=250,t}();e.DiagnosticCollection=r;var n=function(t){function e(e){t.call(this),this._proxy=e.get(s.MainContext.MainThreadDiagnostics),this._collections=[]}return __extends(e,t),e.prototype.createDiagnosticCollection=function(t){t||(t="_generated_diagnostic_collection_name_#"+e._idPool++);var i=this,o=i._collections,s=i._proxy,n=new(function(e){function i(){e.call(this,t,s),o.push(this)}return __extends(i,e),i.prototype.dispose=function(){e.prototype.dispose.call(this);var t=o.indexOf(this);t!==-1&&o.splice(t,1)},i}(r));return n},e.prototype.forEach=function(t){this._collections.forEach(t)},e._idPool=0,e}(s.ExtHostDiagnosticsShape);e.ExtHostDiagnostics=n});