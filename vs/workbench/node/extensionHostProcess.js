/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/errors","vs/base/common/winjs.base","vs/workbench/node/extensionHostMain","vs/base/parts/ipc/node/ipc.net","vs/platform/extensions/common/ipcRemoteCom","vs/base/common/marshalling"],function(e,n,o,t,s,r,i,c){"use strict";function a(){return new t.TPromise(function(e,n){var t=[];process.once("message",function(n){var s=c.parse(n),r=i.create(function(e){process.send(e),t.push(e.length)});process.on("message",function(e){return"__$terminate"===e.type?void d():void r.handle(e)});var a=[];process.on("unhandledRejection",function(e,n){a.push(n),setTimeout(function(){var t=a.indexOf(n);t>=0&&(a.splice(t,1),console.warn("rejected promise not handled with 1 second"),o.onUnexpectedError(e))},1e3)}),process.on("rejectionHandled",function(e){var n=a.indexOf(e);n>=0&&a.splice(n,1)}),process.on("uncaughtException",function(e){o.onUnexpectedError(e)}),setInterval(function(){try{process.kill(s.parentPid,0)}catch(e){d()}},5e3),setInterval(function(){if(t.length>=250){var e=t.reduce(function(e,n){return e+n},0);console.warn("MANY messages are being SEND FROM the extension host!"),console.warn("SEND during 1sec: message_count="+t.length+", total_len="+e)}t.length=0},1e3),process.send("initialized"),e({remoteCom:r,initData:s})}),process.send("ready")})}function u(){return r.connect(process.env.VSCODE_SHARED_IPC_HOOK)}var d=function(){s.exit()};t.TPromise.join([a(),u()]).done(function(e){var n=e[0],o=e[1],t=new s.ExtensionHostMain(n.remoteCom,n.initData,o);d=function(){t.terminate()},t.start().done(null,function(e){return console.error(e)})})});