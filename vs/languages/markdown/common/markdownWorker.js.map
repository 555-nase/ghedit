{"version":3,"file":"vs/languages/markdown/common/markdownWorker.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/languages/markdown/common/markdownWorker.ts"],"names":[],"mappings":";;;;;;;;;;IAAA;;;oGAGgG;IAChG,YAAY,CAAC;IAcb,IAAK,KAIJ;IAJD,WAAK,KAAK;QACT,mCAAK,CAAA;QACL,iCAAI,CAAA;QACJ,yCAAQ,CAAA;IACT,CAAC,EAJI,KAAK,KAAL,KAAK,QAIT;IAED;QA4EC,wBACC,MAAc,EACI,eAAiC,EACnC,aAA6B,EAC/B,WAAyB;YA3EhC,UAAK,GAAU,KAAK,CAAC,IAAI,CAAC;YA6EjC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;YACtB,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;YACvC,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;YACnC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAChC,CAAC;QAED,qCAAY,GAAZ,UAAa,OAAY;YACxB,EAAE,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,KAAK,GAAG,CAAC,OAAO,CAAC,KAAK,KAAK,SAAS,CAAC,GAAG,KAAK,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC;YACnH,CAAC;YAED,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC9C,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,MAAM,CAAC;YAChC,CAAC;YAED,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;QAClC,CAAC;QAEM,sCAAa,GAApB,UAAqB,QAAa,EAAE,2BAAmC;YAAvE,iBA0FC;YAzFA,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAC/C,IAAI,QAAQ,GAAa,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC;YAE7C,wCAAwC;YACxC,IAAI,QAAQ,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;YAC5C,IAAI,KAAK,GAAG,IAAI,CAAC;YACjB,QAAQ,CAAC,KAAK,GAAG,UAAS,IAAY,EAAE,KAAa,EAAE,IAAY;gBAClE,IAAI,GAAG,GAAG,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,GAAG,SAAS,GAAG,IAAI,GAAG,GAAG,CAAC;gBAChF,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;oBACX,GAAG,IAAI,UAAU,GAAG,KAAK,GAAG,GAAG,CAAC;gBACjC,CAAC;gBAED,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,IAAI,GAAG,GAAG,CAAC;gBAEzD,MAAM,CAAC,GAAG,CAAC;YACZ,CAAC,CAAC;YAEF,oDAAoD;YACpD,IAAI,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC;YACpC,QAAQ,CAAC,IAAI,GAAG,UAAS,IAAY,EAAE,KAAa,EAAE,IAAY;gBACjE,IAAI,IAAI,GAAG,eAAe,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBAEzD,wFAAwF;gBACxF,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;oBAC7B,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;gBAC5C,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;gBACjD,CAAC;gBAED,MAAM,CAAC,IAAI,CAAC;YACb,CAAC,CAAC;YAEF,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;YAEnC,qDAAqD;YACrD,IAAI,WAAW,GAAG,UAAS,IAAY,EAAE,IAAY,EAAE,QAAiD;gBAEvG,wDAAwD;gBACxD,IAAI,WAAW,GAAG,WAAW,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,cAAc,CAAC,YAAY,CAAC;gBACpG,WAAW,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI;oBAClD,QAAQ,CAAC,IAAI,EAAE,sCAAgB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;gBAC9C,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC;YAEF,MAAM,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,UAAC,CAAC,EAAE,CAAC;gBAE7B,wCAAwC;gBACxC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE;oBAC/B,GAAG,EAAE,IAAI;oBACT,QAAQ,EAAE,QAAQ;oBAClB,SAAS,EAAE,WAAW;iBACtB,EAAE,UAAC,KAAY,EAAE,UAAkB;oBAEnC,eAAe;oBACf,IAAI,IAAI,GAAG;wBACV,iBAAiB;wBACjB,QAAQ;wBACR,QAAQ;wBACR,oEAAoE;wBACpE,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,+BAA+B,GAAG,2BAA2B,GAAG,gDAAgD,GAAG,EAAE;wBAC/I,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,+BAA+B,GAAG,2BAA2B,GAAG,8CAA8C,GAAG,EAAE;wBAC7I,CAAC,KAAI,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,CAAC,GAAG,cAAc,CAAC,mBAAmB,GAAG,CAAC,KAAI,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,kBAAkB,GAAG,cAAc,CAAC,sBAAsB;wBAC3K,QAAQ,CAAC,GAAG,CAAC,UAAC,KAAK;4BAClB,MAAM,CAAC,+BAA+B,GAAG,KAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,KAAK,CAAC,GAAG,mCAAmC,CAAC;wBAC9G,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;wBACb,SAAS;wBACT,sBAAW,GAAG,oBAAoB,GAAG,QAAQ;qBAC7C,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAEb,eAAe;oBACf,IAAI,IAAI,GAAG;wBACV,CAAC,KAAI,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,CAAC,GAAG,gCAAgC,GAAG,CAAC,KAAI,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,GAAG,qCAAqC,GAAG,sCAAsC;wBAC9K,UAAU;wBACV,QAAQ;qBACR,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAEb,OAAO;oBACP,IAAI,IAAI,GAAG;wBACV,SAAS;wBACT,SAAS;qBACT,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAEb,CAAC,CAAC;wBACD,IAAI,EAAE,IAAI;wBACV,IAAI,EAAE,IAAI;wBACV,IAAI,EAAE,IAAI;qBACV,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,gCAAO,GAAf,UAAgB,QAAa,EAAE,IAAY;YAC1C,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBAEV,wCAAwC;gBACxC,EAAE,CAAC,CAAC,aAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC5B,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;gBAED,iFAAiF;gBACjF,MAAM,CAAC,aAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC;YAC9E,CAAC;YAED,MAAM,CAAC,IAAI,CAAC;QACb,CAAC;QA3Mc,2BAAY,GAAG,YAAY,CAAC;QAK3C,4FAA4F;QAC7E,kCAAmB,GAAW;YAC5C,yBAAyB;YACzB,wBAAwB;YACxB,gBAAgB;YAChB,iBAAiB;YACjB,IAAI;YACJ,EAAE;YACF,8BAA8B;YAC9B,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,oCAAoC;YACpC,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,qCAAqC;YACrC,yCAAyC;YACzC,IAAI;YACJ,UAAU;SACV,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEE,iCAAkB,GAAW;YAC3C,yBAAyB;YACzB,wBAAwB;YACxB,gBAAgB;YAChB,iBAAiB;YACjB,IAAI;YACJ,EAAE;YACF,8BAA8B;YAC9B,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,oCAAoC;YACpC,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,qCAAqC;YACrC,4CAA4C;YAC5C,IAAI;YACJ,UAAU;SACV,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEE,qCAAsB,GAAW;YAC/C,yBAAyB;YACzB,wBAAwB;YACxB,gBAAgB;YAChB,iBAAiB;YACjB,IAAI;YACJ,EAAE;YACF,8BAA8B;YAC9B,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,oCAAoC;YACpC,+CAA+C;YAC/C,IAAI;YACJ,EAAE;YACF,qCAAqC;YACrC,+CAA+C;YAC/C,IAAI;YACJ,UAAU;SACV,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QASZ;uBAAC,kCAAgB;uBAChB,wBAAc;uBACd,0BAAY;0BAFI;QAgInB,qBAAC;IAAD,CAAC,AA9MD,IA8MC;IA9MY,sBAAc,iBA8M1B,CAAA","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport WinJS = require('vs/base/common/winjs.base');\nimport URI from 'vs/base/common/uri';\nimport Types = require('vs/base/common/types');\nimport Modes = require('vs/editor/common/modes');\nimport Paths = require('vs/base/common/paths');\nimport Marked = require('vs/base/common/marked/marked');\nimport {tokenizeToString} from 'vs/editor/common/modes/textToHtmlTokenizer';\nimport {isMacintosh} from 'vs/base/common/platform';\nimport {IModeService} from 'vs/editor/common/services/modeService';\nimport {IResourceService} from 'vs/editor/common/services/resourceService';\nimport {IMarkerService} from 'vs/platform/markers/common/markers';\n\nenum Theme {\n\tLIGHT,\n\tDARK,\n\tHC_BLACK\n}\n\nexport class MarkdownWorker {\n\n\tprivate static DEFAULT_MODE = 'text/plain';\n\n\tprivate cssLinks: string[];\n\tprivate theme: Theme = Theme.DARK;\n\n\t// Custom Scrollbar CSS (inlined because of pseudo elements that cannot be made theme aware)\n\tprivate static LIGHT_SCROLLBAR_CSS: string = [\n\t\t'<style type=\"text/css\">',\n\t\t'\t::-webkit-scrollbar {',\n\t\t'\t\twidth: 14px;',\n\t\t'\t\theight: 14px;',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb {',\n\t\t'\t\tbackground-color: rgba(100, 100, 100, 0.4);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:hover {',\n\t\t'\t\tbackground-color: rgba(100, 100, 100, 0.7);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:active {',\n\t\t'\t\tbackground-color: rgba(0, 0, 0, 0.6);',\n\t\t'\t}',\n\t\t'</style>'\n\t].join('\\n');\n\n\tprivate static DARK_SCROLLBAR_CSS: string = [\n\t\t'<style type=\"text/css\">',\n\t\t'\t::-webkit-scrollbar {',\n\t\t'\t\twidth: 14px;',\n\t\t'\t\theight: 14px;',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb {',\n\t\t'\t\tbackground-color: rgba(121, 121, 121, 0.4);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:hover {',\n\t\t'\t\tbackground-color: rgba(100, 100, 100, 0.7);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:active {',\n\t\t'\t\tbackground-color: rgba(85, 85, 85, 0.8);',\n\t\t'\t}',\n\t\t'</style>'\n\t].join('\\n');\n\n\tprivate static HC_BLACK_SCROLLBAR_CSS: string = [\n\t\t'<style type=\"text/css\">',\n\t\t'\t::-webkit-scrollbar {',\n\t\t'\t\twidth: 14px;',\n\t\t'\t\theight: 14px;',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb {',\n\t\t'\t\tbackground-color: rgba(111, 195, 223, 0.3);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:hover {',\n\t\t'\t\tbackground-color: rgba(111, 195, 223, 0.4);',\n\t\t'\t}',\n\t\t'',\n\t\t'\t::-webkit-scrollbar-thumb:active {',\n\t\t'\t\tbackground-color: rgba(111, 195, 223, 0.4);',\n\t\t'\t}',\n\t\t'</style>'\n\t].join('\\n');\n\n\tprivate modeService: IModeService;\n\tprivate resourceService:IResourceService;\n\tprivate markerService: IMarkerService;\n\tprivate _modeId: string;\n\n\tconstructor(\n\t\tmodeId: string,\n\t\t@IResourceService resourceService: IResourceService,\n\t\t@IMarkerService markerService: IMarkerService,\n\t\t@IModeService modeService: IModeService\n\t) {\n\t\tthis._modeId = modeId;\n\t\tthis.resourceService = resourceService;\n\t\tthis.markerService = markerService;\n\t\tthis.modeService = modeService;\n\t}\n\n\t_doConfigure(options: any): WinJS.TPromise<void> {\n\t\tif (options && options.theme) {\n\t\t\tthis.theme = (options.theme === 'vs-dark') ? Theme.DARK : (options.theme === 'vs') ? Theme.LIGHT : Theme.HC_BLACK;\n\t\t}\n\n\t\tif (options && Types.isArray(options.styles)) {\n\t\t\tthis.cssLinks = options.styles;\n\t\t}\n\n\t\treturn WinJS.TPromise.as(void 0);\n\t}\n\n\tpublic getEmitOutput(resource: URI, absoluteWorkersResourcePath: string): WinJS.TPromise<Modes.IEmitOutput> { // TODO@Ben technical debt: worker cannot resolve paths absolute\n\t\tlet model = this.resourceService.get(resource);\n\t\tlet cssLinks: string[] = this.cssLinks || [];\n\n\t\t// Custom Renderer to fix href in images\n\t\tlet renderer = new Marked.marked.Renderer();\n\t\tlet $this = this;\n\t\trenderer.image = function(href: string, title: string, text: string): string {\n\t\t\tlet out = '<img src=\"' + $this.fixHref(resource, href) + '\" alt=\"' + text + '\"';\n\t\t\tif (title) {\n\t\t\t\tout += ' title=\"' + title + '\"';\n\t\t\t}\n\n\t\t\tout += (this.options && this.options.xhtml) ? '/>' : '>';\n\n\t\t\treturn out;\n\t\t};\n\n\t\t// Custom Renderer to open links always in a new tab\n\t\tlet superRenderLink = renderer.link;\n\t\trenderer.link = function(href: string, title: string, text: string): string {\n\t\t\tlet link = superRenderLink.call(this, href, title, text);\n\n\t\t\t// We cannot support local anchor tags because the iframe editor does not have a src set\n\t\t\tif (href && href[0] === '#') {\n\t\t\t\tlink = link.replace('href=', 'localhref=');\n\t\t\t} else {\n\t\t\t\tlink = link.replace('<a', '<a target=\"_blank\"');\n\t\t\t}\n\n\t\t\treturn link;\n\t\t};\n\n\t\tlet modeService = this.modeService;\n\n\t\t// Custom highlighter to use our modes to render code\n\t\tlet highlighter = function(code: string, lang: string, callback?: (error: Error, result: string) => void) {\n\n\t\t\t// Lookup the mode and use the tokenizer to get the HTML\n\t\t\tlet mimeForLang = modeService.getModeIdForLanguageName(lang) || lang || MarkdownWorker.DEFAULT_MODE;\n\t\t\tmodeService.getOrCreateMode(mimeForLang).then((mode) => {\n\t\t\t\tcallback(null, tokenizeToString(code, mode));\n\t\t\t});\n\t\t};\n\n\t\treturn new WinJS.Promise((c, e) => {\n\n\t\t\t// Render markdown file contents to HTML\n\t\t\tMarked.marked(model.getValue(), {\n\t\t\t\tgfm: true, // GitHub flavored markdown\n\t\t\t\trenderer: renderer,\n\t\t\t\thighlight: highlighter\n\t\t\t}, (error: Error, htmlResult: string) => {\n\n\t\t\t\t// Compute head\n\t\t\t\tlet head = [\n\t\t\t\t\t'<!DOCTYPE html>',\n\t\t\t\t\t'<html>',\n\t\t\t\t\t'<head>',\n\t\t\t\t\t'<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">',\n\t\t\t\t\t(cssLinks.length === 0) ? '<link rel=\"stylesheet\" href=\"' + absoluteWorkersResourcePath + '/markdown.css\" type=\"text/css\" media=\"screen\">' : '',\n\t\t\t\t\t(cssLinks.length === 0) ? '<link rel=\"stylesheet\" href=\"' + absoluteWorkersResourcePath + '/tokens.css\" type=\"text/css\" media=\"screen\">' : '',\n\t\t\t\t\t(this.theme === Theme.LIGHT) ? MarkdownWorker.LIGHT_SCROLLBAR_CSS : (this.theme === Theme.DARK) ? MarkdownWorker.DARK_SCROLLBAR_CSS : MarkdownWorker.HC_BLACK_SCROLLBAR_CSS,\n\t\t\t\t\tcssLinks.map((style) => {\n\t\t\t\t\t\treturn '<link rel=\"stylesheet\" href=\"' + this.fixHref(resource, style) + '\" type=\"text/css\" media=\"screen\">';\n\t\t\t\t\t}).join('\\n'),\n\t\t\t\t\t'</head>',\n\t\t\t\t\tisMacintosh ? '<body class=\"mac\">' : '<body>'\n\t\t\t\t].join('\\n');\n\n\t\t\t\t// Compute body\n\t\t\t\tlet body = [\n\t\t\t\t\t(this.theme === Theme.LIGHT) ? '<div class=\"monaco-editor vs\">' : (this.theme === Theme.DARK) ? '<div class=\"monaco-editor vs-dark\">' : '<div class=\"monaco-editor hc-black\">',\n\t\t\t\t\thtmlResult,\n\t\t\t\t\t'</div>',\n\t\t\t\t].join('\\n');\n\n\t\t\t\t// Tail\n\t\t\t\tlet tail = [\n\t\t\t\t\t'</body>',\n\t\t\t\t\t'</html>'\n\t\t\t\t].join('\\n');\n\n\t\t\t\tc({\n\t\t\t\t\thead: head,\n\t\t\t\t\tbody: body,\n\t\t\t\t\ttail: tail\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate fixHref(resource: URI, href: string): string {\n\t\tif (href) {\n\n\t\t\t// Return early if href is already a URL\n\t\t\tif (URI.parse(href).scheme) {\n\t\t\t\treturn href;\n\t\t\t}\n\n\t\t\t// Otherwise convert to a file URI by joining the href with the resource location\n\t\t\treturn URI.file(Paths.join(Paths.dirname(resource.fsPath), href)).toString();\n\t\t}\n\n\t\treturn href;\n\t}\n}"]}