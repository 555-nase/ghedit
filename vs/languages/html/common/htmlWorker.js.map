{"version":3,"file":"vs/languages/html/common/htmlWorker.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/languages/html/common/htmlWorker.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport winjs = require('vs/base/common/winjs.base');\nimport beautifyHTML = require('vs/languages/lib/common/beautify-html');\nimport htmlTags = require('vs/languages/html/common/htmlTags');\nimport network = require('vs/base/common/network');\nimport EditorCommon = require('vs/editor/common/editorCommon');\nimport Modes = require('vs/editor/common/modes');\nimport strings = require('vs/base/common/strings');\nimport {Position} from 'vs/editor/common/core/position';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\nimport {IMarkerService} from 'vs/platform/markers/common/markers';\nimport {IResourceService} from 'vs/editor/common/services/resourceService';\nimport {getScanner, IHTMLScanner} from 'vs/languages/html/common/htmlScanner';\nimport {isTag, DELIM_END, DELIM_START, DELIM_ASSIGN, ATTRIB_NAME, ATTRIB_VALUE} from 'vs/languages/html/common/htmlTokenTypes';\nimport {isEmptyElement} from 'vs/languages/html/common/htmlEmptyTagsShared';\nimport {filterSuggestions} from 'vs/editor/common/modes/supports/suggestSupport';\nimport paths = require('vs/base/common/paths');\n\nenum LinkDetectionState {\n\tLOOKING_FOR_HREF_OR_SRC = 1,\n\tAFTER_HREF_OR_SRC = 2\n}\n\ninterface IColorRange {\n\trange:EditorCommon.IRange;\n\tvalue:string;\n}\n\nexport class HTMLWorker {\n\n\tprivate _contextService: IWorkspaceContextService;\n\tprivate resourceService:IResourceService;\n\tprivate markerService: IMarkerService;\n\tprivate _modeId: string;\n\tprivate _tagProviders: htmlTags.IHTMLTagProvider[];\n\tprivate formatSettings: any;\n\n\tconstructor(\n\t\tmodeId: string,\n\t\t@IResourceService resourceService: IResourceService,\n\t\t@IMarkerService markerService: IMarkerService,\n\t\t@IWorkspaceContextService contextService:IWorkspaceContextService\n\t) {\n\n\t\tthis._modeId = modeId;\n\t\tthis.resourceService = resourceService;\n\t\tthis.markerService = markerService;\n\t\tthis._contextService = contextService;\n\n\t\tthis._tagProviders = [];\n\t\tthis._tagProviders.push(htmlTags.getHTML5TagProvider());\n\n\t\tthis.addCustomTagProviders(this._tagProviders);\n\t}\n\n\tprotected addCustomTagProviders(providers: htmlTags.IHTMLTagProvider[]): void {\n\t\tproviders.push(htmlTags.getAngularTagProvider());\n\t\tproviders.push(htmlTags.getIonicTagProvider());\n\t}\n\n\tpublic format(resource: URI, range: EditorCommon.IRange, options: Modes.IFormattingOptions): winjs.TPromise<EditorCommon.ISingleEditOperation[]> {\n\t\treturn this._delegateToModeAtPosition(resource, Position.startPosition(range), (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().formattingSupport) {\n\t\t\t\treturn model.getMode().formattingSupport.formatRange(model.getAssociatedResource(), range, options);\n\t\t\t}\n\n\t\t\treturn this.formatHTML(resource, range, options);\n\t\t});\n\t}\n\n\tprivate formatHTML(resource: URI, range: EditorCommon.IRange, options: Modes.IFormattingOptions): winjs.TPromise<EditorCommon.ISingleEditOperation[]> {\n\t\tlet model = this.resourceService.get(resource);\n\t\tlet value = range ? model.getValueInRange(range) : model.getValue();\n\n\t\tlet htmlOptions : beautifyHTML.IBeautifyHTMLOptions = {\n\t\t\tindent_size: options.insertSpaces ? options.tabSize : 1,\n\t\t\tindent_char: options.insertSpaces ? ' ' : '\\t',\n\t\t\twrap_line_length: this.getFormatOption('wrapLineLength', 120),\n\t\t\tunformatted: this.getTagsFormatOption('unformatted', void 0),\n\t\t\tindent_inner_html: this.getFormatOption('indentInnerHtml', false),\n\t\t\tpreserve_newlines: this.getFormatOption('preserveNewLines', false),\n\t\t\tmax_preserve_newlines: this.getFormatOption('maxPreserveNewLines', void 0),\n\t\t\tindent_handlebars: this.getFormatOption('indentHandlebars', false),\n\t\t\tend_with_newline: this.getFormatOption('endWithNewline', false),\n\t\t\textra_liners: this.getTagsFormatOption('extraLiners', void 0),\n\t\t};\n\n\t\tlet result = beautifyHTML.html_beautify(value, htmlOptions);\n\n\t\treturn winjs.TPromise.as([{\n\t\t\trange: range,\n\t\t\ttext: result\n\t\t}]);\n\t}\n\n\tprivate getFormatOption(key: string, dflt: any): any {\n\t\tif (this.formatSettings && this.formatSettings.hasOwnProperty(key)) {\n\t\t\tlet value = this.formatSettings[key];\n\t\t\tif (value !== null) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t\treturn dflt;\n\t}\n\n\tprivate getTagsFormatOption(key: string, dflt: string[]): string[] {\n\t\tlet list = <string> this.getFormatOption(key, null);\n\t\tif (list) {\n\t\t\treturn list.split(',').map(t => t.trim().toLowerCase());\n\t\t}\n\t\treturn dflt;\n\t}\n\n\t_doConfigure(options: any): winjs.TPromise<void> {\n\t\tthis.formatSettings = options && options.format;\n\t\treturn winjs.TPromise.as(null);\n\t}\n\n\t_delegateToModeAtPosition<T>(resource:URI, position:EditorCommon.IPosition, callback:(isEmbeddedMode:boolean, model:EditorCommon.IMirrorModel) => T): T {\n\t\tlet model = this.resourceService.get(resource);\n\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet modelAtPosition = model.getEmbeddedAtPosition(position);\n\n\t\tif (!modelAtPosition) {\n\t\t\treturn callback(false, model);\n\t\t}\n\n\t\tlet modeAtPosition = modelAtPosition.getMode();\n\n\t\treturn callback(modeAtPosition.getId() !== this._modeId, modelAtPosition);\n\t}\n\n\t_delegateToAllModes<T>(resource:URI, callback:(models:EditorCommon.IMirrorModel[]) => T): T {\n\t\tlet model = this.resourceService.get(resource);\n\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn callback(model.getAllEmbedded());\n\t}\n\n\tpublic computeInfo(resource:URI, position:EditorCommon.IPosition): winjs.TPromise<Modes.IComputeExtraInfoResult> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().extraInfoSupport) {\n\t\t\t\treturn model.getMode().extraInfoSupport.computeInfo(model.getAssociatedResource(), position);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic findReferences(resource:URI, position:EditorCommon.IPosition, includeDeclaration:boolean): winjs.TPromise<Modes.IReference[]> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().referenceSupport) {\n\t\t\t\treturn model.getMode().referenceSupport.findReferences(model.getAssociatedResource(), position, includeDeclaration);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getRangesToPosition(resource:URI, position:EditorCommon.IPosition):winjs.TPromise<Modes.ILogicalSelectionEntry[]> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().logicalSelectionSupport) {\n\t\t\t\treturn model.getMode().logicalSelectionSupport.getRangesToPosition(model.getAssociatedResource(), position);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic findDeclaration(resource:URI, position:EditorCommon.IPosition):winjs.TPromise<Modes.IReference> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().declarationSupport) {\n\t\t\t\treturn model.getMode().declarationSupport.findDeclaration(model.getAssociatedResource(), position);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic findColorDeclarations(resource:URI):winjs.TPromise<{range:EditorCommon.IRange; value:string; }[]> {\n\t\treturn this._delegateToAllModes(resource, (models) => {\n\t\t\tlet allPromises: winjs.TPromise<IColorRange[]>[] = [];\n\n\t\t\tallPromises = models\n\t\t\t\t.filter((model) => (typeof model.getMode()['findColorDeclarations'] === 'function'))\n\t\t\t\t.map((model) => model.getMode()['findColorDeclarations'](model.getAssociatedResource()));\n\n\t\t\treturn winjs.TPromise.join(allPromises).then((results:IColorRange[][]) => {\n\t\t\t\tlet result:IColorRange[] = [];\n\n\t\t\t\tresults.forEach((oneResult) => result = result.concat(oneResult));\n\n\t\t\t\treturn result;\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getParameterHints(resource:URI, position:EditorCommon.IPosition):winjs.TPromise<Modes.IParameterHints> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().parameterHintsSupport) {\n\t\t\t\treturn model.getMode().parameterHintsSupport.getParameterHints(model.getAssociatedResource(), position);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate findMatchingOpenTag(scanner: IHTMLScanner) : string {\n\t\tlet closedTags : { [name:string]: number } = {};\n\t\tlet tagClosed = false;\n\t\twhile (scanner.scanBack()) {\n\t\t\tif (isTag(scanner.getTokenType()) && !tagClosed) {\n\t\t\t\tlet tag = scanner.getTokenContent();\n\t\t\t\tscanner.scanBack();\n\t\t\t\tif (scanner.getTokenType() === DELIM_END) {\n\t\t\t\t\tclosedTags[tag] = (closedTags[tag] || 0) + 1;\n\t\t\t\t} else if (!isEmptyElement(tag)) {\n\t\t\t\t\tif (closedTags[tag]) {\n\t\t\t\t\t\tclosedTags[tag]--;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn tag;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (scanner.getTokenType() === DELIM_START) {\n\t\t\t\ttagClosed = scanner.getTokenContent() === '/>';\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate collectTagSuggestions(scanner: IHTMLScanner, position: EditorCommon.IPosition, suggestions: Modes.ISuggestResult): void {\n\t\tlet model = scanner.getModel();\n\t\tlet contentAfter = model.getLineContent(position.lineNumber).substr(position.column - 1);\n\t\tlet closeTag = isWhiteSpace(contentAfter) || strings.startsWith(contentAfter, '<') ? '>' : '';\n\n\t\tlet collectClosingTagSuggestion = (overwriteBefore: number) => {\n\t\t\tlet endPosition = scanner.getTokenPosition();\n\t\t\tlet matchingTag = this.findMatchingOpenTag(scanner);\n\t\t\tif (matchingTag) {\n\t\t\t\tlet suggestion : Modes.ISuggestion = {\n\t\t\t\t\tlabel: '/' + matchingTag,\n\t\t\t\t\tcodeSnippet: '/' + matchingTag + closeTag,\n\t\t\t\t\toverwriteBefore: overwriteBefore,\n\t\t\t\t\ttype: 'property'\n\t\t\t\t};\n\t\t\t\tsuggestions.suggestions.push(suggestion);\n\n\t\t\t\t// use indent from start tag\n\t\t\t\tlet startPosition = scanner.getTokenPosition();\n\t\t\t\tif (endPosition.lineNumber !== startPosition.lineNumber) {\n\t\t\t\t\tlet startIndent = model.getLineContent(startPosition.lineNumber).substring(0, startPosition.column - 1);\n\t\t\t\t\tlet endIndent = model.getLineContent(endPosition.lineNumber).substring(0, endPosition.column - 1);\n\t\t\t\t\tif (isWhiteSpace(startIndent) && isWhiteSpace(endIndent)) {\n\t\t\t\t\t\tsuggestion.overwriteBefore = position.column - 1; // replace from start of line\n\t\t\t\t\t\tsuggestion.codeSnippet = startIndent + '</' + matchingTag + closeTag;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\n\t\tif (scanner.getTokenType() === DELIM_END) {\n\t\t\tlet hasClose = collectClosingTagSuggestion(suggestions.currentWord.length + 1);\n\t\t\tif (!hasClose) {\n\t\t\t\tthis._tagProviders.forEach((provider) => {\n\t\t\t\t\tprovider.collectTags((tag, label) => {\n\t\t\t\t\t\tsuggestions.suggestions.push({\n\t\t\t\t\t\t\tlabel: '/' + tag,\n\t\t\t\t\t\t\toverwriteBefore: suggestions.currentWord.length + 1,\n\t\t\t\t\t\t\tcodeSnippet: '/' + tag + closeTag,\n\t\t\t\t\t\t\ttype: 'property',\n\t\t\t\t\t\t\tdocumentationLabel: label\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tcollectClosingTagSuggestion(suggestions.currentWord.length);\n\n\t\t\tthis._tagProviders.forEach((provider) => {\n\t\t\t\tprovider.collectTags((tag, label) => {\n\t\t\t\t\tsuggestions.suggestions.push({\n\t\t\t\t\t\tlabel: tag,\n\t\t\t\t\t\tcodeSnippet: tag,\n\t\t\t\t\t\ttype: 'property',\n\t\t\t\t\t\tdocumentationLabel: label\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t}\n\n\tprivate collectContentSuggestions(suggestions: Modes.ISuggestResult): void {\n\t\t// disable the simple snippets in favor of the emmet templates\n\t}\n\n\tprivate collectAttributeSuggestions(scanner: IHTMLScanner, suggestions: Modes.ISuggestResult): void {\n\t\tlet parentTag: string = null;\n\t\tdo {\n\t\t\tif (isTag(scanner.getTokenType())) {\n\t\t\t\tparentTag = scanner.getTokenContent();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (scanner.getTokenType() === DELIM_START) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (scanner.scanBack());\n\n\t\tthis._tagProviders.forEach((provider) => {\n\t\t\tprovider.collectAttributes(parentTag,(attribute, type) => {\n\t\t\t\tlet codeSnippet = attribute;\n\t\t\t\tif (type !== 'v') {\n\t\t\t\t\tcodeSnippet = codeSnippet + '=\"{{}}\"';\n\t\t\t\t}\n\t\t\t\tsuggestions.suggestions.push({\n\t\t\t\t\tlabel: attribute,\n\t\t\t\t\tcodeSnippet: codeSnippet,\n\t\t\t\t\ttype: type === 'handler' ? 'function' : 'value'\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate collectAttributeValueSuggestions(scanner: IHTMLScanner, suggestions:  Modes.ISuggestResult): void {\n\t\tlet needsQuotes = scanner.getTokenType() === DELIM_ASSIGN;\n\n\t\tlet attribute: string = null;\n\t\tlet parentTag: string = null;\n\t\twhile (scanner.scanBack()) {\n\t\t\tif (scanner.getTokenType() === ATTRIB_NAME) {\n\t\t\t\tattribute = scanner.getTokenContent();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\twhile (scanner.scanBack()) {\n\t\t\tif (isTag(scanner.getTokenType())) {\n\t\t\t\tparentTag = scanner.getTokenContent();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (scanner.getTokenType() === DELIM_START) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._tagProviders.forEach((provider) => {\n\t\t\tprovider.collectValues(parentTag, attribute,(value) => {\n\t\t\t\tsuggestions.suggestions.push({\n\t\t\t\t\tlabel: value,\n\t\t\t\t\tcodeSnippet: needsQuotes ? '\"' + value + '\"' : value,\n\t\t\t\t\ttype: 'unit'\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic suggest(resource:URI, position:EditorCommon.IPosition, triggerCharacter?:string):winjs.TPromise<Modes.ISuggestResult[]> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().suggestSupport) {\n\t\t\t\treturn model.getMode().suggestSupport.suggest(model.getAssociatedResource(), position, triggerCharacter);\n\t\t\t}\n\n\t\t\treturn this.suggestHTML(resource, position);\n\t\t});\n\t}\n\n\tprivate suggestHTML(resource:URI, position:EditorCommon.IPosition):winjs.TPromise<Modes.ISuggestResult[]> {\n\t\treturn this.doSuggest(resource, position).then(value => filterSuggestions(value));\n\t}\n\n\tprivate doSuggest(resource: URI, position: EditorCommon.IPosition): winjs.TPromise<Modes.ISuggestResult> {\n\n\t\tlet model = this.resourceService.get(resource),\n\t\t\tcurrentWord = model.getWordUntilPosition(position).word;\n\n\t\tlet suggestions: Modes.ISuggestResult = {\n\t\t\tcurrentWord: currentWord,\n\t\t\tsuggestions: [],\n\t\t};\n\n\t\tlet scanner = getScanner(model, position);\n\t\tswitch (scanner.getTokenType()) {\n\t\t\tcase DELIM_START:\n\t\t\tcase DELIM_END:\n\t\t\t\tif (scanner.isOpenBrace()) {\n\t\t\t\t\tthis.collectTagSuggestions(scanner, position, suggestions);\n\t\t\t\t} else {\n\t\t\t\t\tthis.collectContentSuggestions(suggestions);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ATTRIB_NAME:\n\t\t\t\tthis.collectAttributeSuggestions(scanner, suggestions);\n\t\t\t\tbreak;\n\t\t\tcase ATTRIB_VALUE:\n\t\t\t\tthis.collectAttributeValueSuggestions(scanner, suggestions);\n\t\t\t\tbreak;\n\t\t\tcase DELIM_ASSIGN:\n\t\t\t\tif (scanner.isAtTokenEnd()) {\n\t\t\t\t\tthis.collectAttributeValueSuggestions(scanner, suggestions);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tif (isWhiteSpace(scanner.getTokenContent()) && scanner.scanBack()) { // go one back\n\t\t\t\t\tswitch (scanner.getTokenType()) {\n\t\t\t\t\t\tcase ATTRIB_VALUE:\n\t\t\t\t\t\tcase ATTRIB_NAME:\n\t\t\t\t\t\t\tthis.collectAttributeSuggestions(scanner, suggestions);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DELIM_ASSIGN:\n\t\t\t\t\t\t\tthis.collectAttributeValueSuggestions(scanner, suggestions);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DELIM_START:\n\t\t\t\t\t\tcase DELIM_END:\n\t\t\t\t\t\t\tif (scanner.isOpenBrace()) {\n\t\t\t\t\t\t\t\tthis.collectTagSuggestions(scanner, position, suggestions);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.collectContentSuggestions(suggestions);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tif (isTag(scanner.getTokenType())) {\n\t\t\t\t\t\t\t\tthis.collectAttributeSuggestions(scanner, suggestions);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.collectContentSuggestions(suggestions);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (isTag(scanner.getTokenType())) {\n\t\t\t\t\tscanner.scanBack(); // one back to the end/start bracket\n\t\t\t\t\tthis.collectTagSuggestions(scanner, position, suggestions);\n\t\t\t\t}\n\t\t}\n\t\treturn winjs.TPromise.as(suggestions);\n\t}\n\n\tprivate findMatchingBracket(tagname: string, scanner: IHTMLScanner) : EditorCommon.IRange {\n\t\tif (isEmptyElement(tagname)) {\n\t\t\treturn null;\n\t\t}\n\t\tlet tagCount = 0;\n\t\tscanner.scanBack(); // one back to the end/start bracket\n\t\tif (scanner.getTokenType() === DELIM_END) {\n\t\t\t// find the opening tag\n\t\t\tlet tagClosed = false;\n\t\t\twhile (scanner.scanBack()) {\n\t\t\t\tif (isTag(scanner.getTokenType()) && scanner.getTokenContent() === tagname && !tagClosed) {\n\t\t\t\t\tlet range = scanner.getTokenRange();\n\t\t\t\t\tscanner.scanBack(); // one back to the end/start bracket\n\t\t\t\t\tif (scanner.getTokenType() === DELIM_START) {\n\t\t\t\t\t\tif (tagCount === 0) {\n\t\t\t\t\t\t\treturn range;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttagCount--;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttagCount++;\n\t\t\t\t\t}\n\t\t\t\t} else if (scanner.getTokenType() === DELIM_START) {\n\t\t\t\t\ttagClosed = scanner.getTokenContent() === '/>';\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tlet isTagEnd = false;\n\t\t\twhile (scanner.scanForward()) {\n\t\t\t\tif (isTag(scanner.getTokenType()) && scanner.getTokenContent() === tagname) {\n\t\t\t\t\tif (!isTagEnd) {\n\t\t\t\t\t\tscanner.scanForward();\n\t\t\t\t\t\tif (scanner.getTokenType() === DELIM_START && scanner.getTokenContent() === '/>') {\n\t\t\t\t\t\t\tif (tagCount <= 0) {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttagCount++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttagCount--;\n\t\t\t\t\t\tif (tagCount <= 0) {\n\t\t\t\t\t\t\treturn scanner.getTokenRange();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (scanner.getTokenType() === DELIM_START) {\n\t\t\t\t\tisTagEnd = false;\n\t\t\t\t} else if (scanner.getTokenType() === DELIM_END) {\n\t\t\t\t\tisTagEnd = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\n\t}\n\n\tpublic findOccurrences(resource:URI, position:EditorCommon.IPosition, strict:boolean = false): winjs.TPromise<Modes.IOccurence[]> {\n\t\treturn this._delegateToModeAtPosition(resource, position, (isEmbeddedMode, model) => {\n\t\t\tif (isEmbeddedMode && model.getMode().occurrencesSupport) {\n\t\t\t\treturn model.getMode().occurrencesSupport.findOccurrences(model.getAssociatedResource(), position, strict);\n\t\t\t}\n\n\t\t\treturn this.findOccurrencesHTML(resource, position, strict);\n\t\t});\n\t}\n\n\tpublic findOccurrencesHTML(resource:URI, position:EditorCommon.IPosition, strict?:boolean):winjs.TPromise<Modes.IOccurence[]> {\n\n\t\tlet model = this.resourceService.get(resource),\n\t\t\twordAtPosition = model.getWordAtPosition(position),\n\t\t\tcurrentWord = (wordAtPosition ? wordAtPosition.word : ''),\n\t\t\tresult:Modes.IOccurence[] = [];\n\n\n\t\tlet scanner = getScanner(model, position);\n\t\tif (isTag(scanner.getTokenType())) {\n\t\t\tlet tagname = scanner.getTokenContent();\n\t\t\tresult.push({\n\t\t\t\trange: scanner.getTokenRange()\n\t\t\t});\n\t\t\tlet range = this.findMatchingBracket(tagname, scanner);\n\t\t\tif (range) {\n\t\t\t\tresult.push({\n\t\t\t\t\trange: range\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tlet words = model.getAllWordsWithRange(),\n\t\t\t\tupperBound = Math.min(1000, words.length); // Limit find occurences to 1000 occurences\n\n\t\t\tfor(let i = 0; i < upperBound; i++) {\n\t\t\t\tif(words[i].text === currentWord) {\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\trange: words[i].range\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn winjs.TPromise.as(result);\n\t}\n\n\tprivate static _stripQuotes(url: string): string {\n\t\treturn url\n\t\t\t.replace(/^'([^']+)'$/,(substr, match1) => match1)\n\t\t\t.replace(/^\"([^\"]+)\"$/,(substr, match1) => match1);\n\t}\n\n\tpublic static _getWorkspaceUrl(modelAbsoluteUri: URI, rootAbsoluteUri: URI, tokenContent: string): string {\n\t\ttokenContent = HTMLWorker._stripQuotes(tokenContent);\n\n\t\tif (/^\\s*javascript\\:/i.test(tokenContent) || /^\\s*\\#/i.test(tokenContent)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (/^\\s*https?:\\/\\//i.test(tokenContent) || /^\\s*file:\\/\\//i.test(tokenContent)) {\n\t\t\t// Absolute link that needs no treatment\n\t\t\treturn tokenContent.replace(/^\\s*/g, '');\n\t\t}\n\n\t\tif (/^\\s*\\/\\//i.test(tokenContent)) {\n\t\t\t// Absolute link (that does not name the protocol)\n\t\t\tlet pickedScheme = network.Schemas.http;\n\t\t\tif (modelAbsoluteUri.scheme === network.Schemas.https) {\n\t\t\t\tpickedScheme = network.Schemas.https;\n\t\t\t}\n\t\t\treturn pickedScheme + ':' + tokenContent.replace(/^\\s*/g, '');\n\t\t}\n\n\t\tlet modelPath = paths.dirname(modelAbsoluteUri.path);\n\t\tlet alternativeResultPath: string = null;\n\t\tif (tokenContent.length > 0 && tokenContent.charAt(0) === '/') {\n\t\t\talternativeResultPath = tokenContent;\n\t\t} else {\n\t\t\talternativeResultPath = paths.join(modelPath, tokenContent);\n\t\t\talternativeResultPath = alternativeResultPath.replace(/^(\\/\\.\\.)+/, '');\n\t\t}\n\t\tlet potentialResult = modelAbsoluteUri.withPath(alternativeResultPath).toString();\n\n\t\tlet rootAbsoluteUrlStr = (rootAbsoluteUri ? rootAbsoluteUri.toString() : null);\n\t\tif (rootAbsoluteUrlStr && strings.startsWith(modelAbsoluteUri.toString(), rootAbsoluteUrlStr)) {\n\t\t\t// The `rootAbsoluteUrl` is set and matches our current model\n\t\t\t// We need to ensure that this `potentialResult` does not escape `rootAbsoluteUrl`\n\n\t\t\tlet commonPrefixLength = strings.commonPrefixLength(rootAbsoluteUrlStr, potentialResult);\n\t\t\tif (strings.endsWith(rootAbsoluteUrlStr, '/')) {\n\t\t\t\tcommonPrefixLength = potentialResult.lastIndexOf('/', commonPrefixLength) + 1;\n\t\t\t}\n\t\t\treturn rootAbsoluteUrlStr + potentialResult.substr(commonPrefixLength);\n\t\t}\n\n\t\treturn potentialResult;\n\t}\n\n\tprivate createLink(modelAbsoluteUrl: URI, rootAbsoluteUrl: URI, tokenContent: string, lineNumber: number, startColumn: number, endColumn: number): Modes.ILink {\n\t\tlet workspaceUrl = HTMLWorker._getWorkspaceUrl(modelAbsoluteUrl, rootAbsoluteUrl, tokenContent);\n\t\tif (!workspaceUrl) {\n\t\t\treturn null;\n\t\t}\n\t\t//\t\tconsole.info('workspaceUrl: ' + workspaceUrl);\n\n\t\treturn {\n\t\t\trange: {\n\t\t\t\tstartLineNumber: lineNumber,\n\t\t\t\tstartColumn: startColumn,\n\t\t\t\tendLineNumber: lineNumber,\n\t\t\t\tendColumn: endColumn\n\t\t\t},\n\t\t\turl: workspaceUrl\n\t\t};\n\t}\n\n\tprivate _computeHTMLLinks(model: EditorCommon.IMirrorModel): Modes.ILink[] {\n\t\tlet lineCount = model.getLineCount(),\n\t\t\tnewLinks: Modes.ILink[] = [],\n\t\t\tstate: LinkDetectionState = LinkDetectionState.LOOKING_FOR_HREF_OR_SRC,\n\t\t\tmodelAbsoluteUrl = model.getAssociatedResource(),\n\t\t\tlineNumber: number,\n\t\t\tlineContent: string,\n\t\t\tlineContentLength: number,\n\t\t\ttokens: EditorCommon.ILineTokens,\n\t\t\ttokenType: string,\n\t\t\ttokensLength: number,\n\t\t\ti: number,\n\t\t\tnextTokenEndIndex: number,\n\t\t\ttokenContent: string,\n\t\t\tlink: Modes.ILink;\n\n\t\tlet rootAbsoluteUrl: URI = null;\n\t\tlet workspace = this._contextService.getWorkspace();\n\t\tif (workspace) {\n\t\t\t// The workspace can be null in the no folder opened case\n\t\t\tlet strRootAbsoluteUrl = String(workspace.resource);\n\t\t\tif (strRootAbsoluteUrl.charAt(strRootAbsoluteUrl.length - 1) === '/') {\n\t\t\t\trootAbsoluteUrl = URI.parse(strRootAbsoluteUrl);\n\t\t\t} else {\n\t\t\t\trootAbsoluteUrl = URI.parse(strRootAbsoluteUrl + '/');\n\t\t\t}\n\t\t}\n\n\t\tfor (lineNumber = 1; lineNumber <= lineCount; lineNumber++) {\n\t\t\tlineContent = model.getLineContent(lineNumber);\n\t\t\tlineContentLength = lineContent.length;\n\t\t\ttokens = model.getLineTokens(lineNumber);\n\n\t\t\tfor (i = 0, tokensLength = tokens.getTokenCount(); i < tokensLength; i++) {\n\n\t\t\t\ttokenType = tokens.getTokenType(i);\n\n\t\t\t\tswitch (tokenType) {\n\t\t\t\t\tcase DELIM_ASSIGN:\n\t\t\t\t\tcase '':\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ATTRIB_NAME:\n\t\t\t\t\t\tnextTokenEndIndex = tokens.getTokenEndIndex(i, lineContentLength);\n\t\t\t\t\t\ttokenContent = lineContent.substring(tokens.getTokenStartIndex(i), nextTokenEndIndex).toLowerCase();\n\n\t\t\t\t\t\tif (tokenContent === 'src' || tokenContent === 'href') {\n\t\t\t\t\t\t\tstate = LinkDetectionState.AFTER_HREF_OR_SRC;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate = LinkDetectionState.LOOKING_FOR_HREF_OR_SRC;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ATTRIB_VALUE:\n\t\t\t\t\t\tif (state === LinkDetectionState.AFTER_HREF_OR_SRC) {\n\t\t\t\t\t\t\tnextTokenEndIndex = tokens.getTokenEndIndex(i, lineContentLength);\n\t\t\t\t\t\t\ttokenContent = lineContent.substring(tokens.getTokenStartIndex(i), nextTokenEndIndex);\n\n\t\t\t\t\t\t\tlink = this.createLink(modelAbsoluteUrl, rootAbsoluteUrl, tokenContent, lineNumber, tokens.getTokenStartIndex(i) + 2, nextTokenEndIndex);\n\t\t\t\t\t\t\tif (link) {\n\t\t\t\t\t\t\t\tnewLinks.push(link);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = LinkDetectionState.LOOKING_FOR_HREF_OR_SRC;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (isTag(tokenType)) {\n\t\t\t\t\t\t\tstate = LinkDetectionState.LOOKING_FOR_HREF_OR_SRC;\n\t\t\t\t\t\t} else if (state === LinkDetectionState.AFTER_HREF_OR_SRC) {\n\t\t\t\t\t\t\tstate = LinkDetectionState.LOOKING_FOR_HREF_OR_SRC;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn newLinks;\n\t}\n\n\tpublic computeLinks(resource: URI): winjs.TPromise<Modes.ILink[]> {\n\t\tlet model = this.resourceService.get(resource);\n\t\treturn winjs.TPromise.as(this._computeHTMLLinks(model));\n\t}\n}\n\nfunction isWhiteSpace(s:string) : boolean {\n\treturn /^\\s*$/.test(s);\n}\n"]}