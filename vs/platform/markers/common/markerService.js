define(["require","exports","vs/base/common/arrays","vs/base/common/network","vs/base/common/strings","vs/base/common/collections","vs/base/common/uri","vs/base/common/event","vs/base/common/severity"],function(e,t,r,n,s,a,o,i,u){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var c;!function(e){function t(e){var t=/^(.*)→(.*)$/.exec(e);return{owner:t[1],resource:o["default"].parse(t[2])}}function r(e){return e.owner+"→"+e.resource}function n(e,t){return new RegExp(s.format(i,e?s.escapeRegExpCharacters(e):".*",t?s.escapeRegExpCharacters(t.toString()):".*"))}function a(e,t){return e+"→"+t}e.fromValue=t,e.valueOf=r;var i="^({0})→({1})$";e.selector=n,e.raw=a}(c||(c={}));var f=function(){function e(){this._data=Object.create(null),this._stats=this._emptyStats(),this._onMarkerChanged=new i.Emitter}return e.prototype.getStatistics=function(){return this._stats},Object.defineProperty(e.prototype,"onMarkerChanged",{get:function(){return this._onMarkerChanged?this._onMarkerChanged.event:null},enumerable:!0,configurable:!0}),e.prototype.changeOne=function(e,t,r){this._doChangeOne(e,t,r)&&this._onMarkerChanged.fire([t])},e.prototype.remove=function(e,t){if(!r.isFalsyOrEmpty(t)){for(var n,s=0,a=t;s<a.length;s++){var o=a[s];this._doChangeOne(e,o,void 0)&&(n||(n=[]),n.push(o))}n&&this._onMarkerChanged.fire(n)}},e.prototype._doChangeOne=function(e,t,n){var s=c.raw(e,t),a=this._data[s],o=!r.isFalsyOrEmpty(a),i=!r.isFalsyOrEmpty(n),u=this._computeStats(a),f=this._computeStats(n);if(o||i)return i?this._data[s]=n:o&&delete this._data[s],this._isStatRelevant(t)&&(this._updateStatsMinus(u),this._updateStatsPlus(f)),!0},e.prototype.changeAll=function(e,t){var n=this,s=Object.create(null),o=this._emptyStats();if(this._forEach(e,void 0,void 0,-1,function(e,t){var r=c.fromValue(e.key).resource;n._isStatRelevant(r)&&n._updateStatsPlus(o,n._computeStats(e.value)),s[r.toString()]=r,t()}),this._updateStatsMinus(o),!r.isFalsyOrEmpty(t)){var i=this._emptyStats();t.forEach(function(t){s[t.resource.toString()]=t.resource,a.lookupOrInsert(n._data,c.raw(e,t.resource),[]).push(t.marker),n._isStatRelevant(t.resource)&&n._updateStatsMarker(i,t.marker)}),this._updateStatsPlus(i)}this._onMarkerChanged.fire(a.values(s))},e.prototype.read=function(e){var t=this;void 0===e&&(e=Object.create(null));var r=[];return this._forEach(e.owner,e.resource,e.selector,e.take,function(e){return t._fromEntry(e,r)}),r},e.prototype._isStatRelevant=function(e){return e.scheme!==n.Schemas.inMemory},e.prototype._forEach=function(e,t,r,n,s){var o=r||c.selector(e,t),i=0;a.forEach(this._data,function(e,t){if(o.test(e.key)&&(s(e,t),n>0&&i++>=n))return!1})},e.prototype._fromEntry=function(t,r){var n=c.fromValue(t.key);t.value.forEach(function(t){var s=e._sanitize(t);s&&r.push({owner:n.owner,resource:n.resource,code:t.code,message:t.message,source:t.source,severity:t.severity,startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn})})},e.prototype._computeStats=function(e){var t=0,r=0,n=0,s=0;if(e)for(var a=0;a<e.length;a++){var o=e[a];if(o.severity)switch(o.severity){case u["default"].Error:t++;break;case u["default"].Warning:r++;break;case u["default"].Info:n++;break;default:s++}else s++}return{errors:t,warnings:r,infos:n,unknwons:s}},e.prototype._emptyStats=function(){return{errors:0,warnings:0,infos:0,unknwons:0}},e.prototype._updateStatsPlus=function(e,t){t||(t=e,e=this._stats),e.errors+=t.errors,e.warnings+=t.warnings,e.infos+=t.infos,e.unknwons+=t.unknwons},e.prototype._updateStatsMinus=function(e,t){t||(t=e,e=this._stats),e.errors-=t.errors,e.warnings-=t.warnings,e.infos-=t.infos,e.unknwons-=t.unknwons},e.prototype._updateStatsMarker=function(e,t){switch(t.severity){case u["default"].Error:e.errors++;break;case u["default"].Warning:e.warnings++;break;case u["default"].Info:e.infos++;break;default:e.unknwons++}},e._sanitize=function(e){return!!e.message&&(e.code=e.code||null,e.startLineNumber=e.startLineNumber>0?e.startLineNumber:1,e.startColumn=e.startColumn>0?e.startColumn:1,e.endLineNumber=e.endLineNumber>=e.startLineNumber?e.endLineNumber:e.startLineNumber,e.endColumn=e.endColumn>0?e.endColumn:e.startColumn,!0)},e}();t.MarkerService=f});