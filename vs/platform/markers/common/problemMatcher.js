var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define(["require","exports","vs/nls","vs/base/common/objects","vs/base/common/strings","vs/base/common/assert","vs/base/common/paths","vs/base/common/types","vs/base/common/severity","vs/base/common/uri","vs/base/common/parsers"],function(e,t,r,n,i,o,a,s,l,c,p){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function d(e){return!!s.isString(e.name)}function u(e,t){var r,n=t.fileLocation;return n===m.Absolute?r=e:n===m.Relative&&(r=a.join(t.filePrefix,e)),r=r.replace(/\\/g,"/"),"/"!==r[0]&&(r="/"+r),c["default"].parse("file://"+r)}function f(e){var t=e.pattern;return s.isArray(t)?new P(e):new b(e)}function h(e){return x[e]}!function(e){e[e.Auto=0]="Auto",e[e.Relative=1]="Relative",e[e.Absolute=2]="Absolute"}(t.FileLocationKind||(t.FileLocationKind={}));var m,m=t.FileLocationKind;!function(e){function t(t){return t=t.toLowerCase(),"absolute"===t?e.Absolute:"relative"===t?e.Relative:void 0}e.fromString=t}(m=t.FileLocationKind||(t.FileLocationKind={})),t.problemPatternProperties=["file","message","location","line","column","endLine","endColumn","code","severity","loop","mostSignifikant"],function(e){e[e.allDocuments=0]="allDocuments",e[e.openDocuments=1]="openDocuments",e[e.closedDocuments=2]="closedDocuments"}(t.ApplyToKind||(t.ApplyToKind={}));var g,g=t.ApplyToKind;!function(e){function t(t){return t=t.toLowerCase(),"alldocuments"===t?e.allDocuments:"opendocuments"===t?e.openDocuments:"closeddocuments"===t?e.closedDocuments:void 0}e.fromString=t}(g=t.ApplyToKind||(t.ApplyToKind={})),t.isNamedProblemMatcher=d;var v={E:"error",W:"warning",I:"info"};t.getResource=u,t.createLineMatcher=f;var y=function(){function e(e){this.matcher=e}return e.prototype.handle=function(e,t){return void 0===t&&(t=0),{match:null,"continue":!1}},e.prototype.next=function(e){return null},Object.defineProperty(e.prototype,"matchLength",{get:function(){throw new Error("Subclass reponsibility")},enumerable:!0,configurable:!0}),e.prototype.fillProblemData=function(e,t,r){this.fillProperty(e,"file",t,r,!0),this.fillProperty(e,"message",t,r,!0),this.fillProperty(e,"code",t,r,!0),this.fillProperty(e,"severity",t,r,!0),this.fillProperty(e,"location",t,r,!0),this.fillProperty(e,"line",t,r),this.fillProperty(e,"column",t,r),this.fillProperty(e,"endLine",t,r),this.fillProperty(e,"endColumn",t,r)},e.prototype.fillProperty=function(e,t,r,n,o){if(void 0===o&&(o=!1),s.isUndefined(e[t])&&!s.isUndefined(r[t])&&r[t]<n.length){var a=n[r[t]];o&&(a=i.trim(a)),e[t]=a}},e.prototype.getMarkerMatch=function(e){var t=this.getLocation(e);if(e.file&&t&&e.message){var r={severity:this.getSeverity(e),startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.startLineNumber,endColumn:t.endColumn,message:e.message};return s.isUndefined(e.code)||(r.code=e.code),{description:this.matcher,resource:this.getResource(e.file),marker:r}}},e.prototype.getResource=function(e){return u(e,this.matcher)},e.prototype.getLocation=function(e){if(e.location)return this.parseLocationInfo(e.location);if(!e.line)return null;var t=parseInt(e.line),r=e.column?parseInt(e.column):void 0,n=e.endLine?parseInt(e.endLine):void 0,i=e.endColumn?parseInt(e.endColumn):void 0;return this.createLocation(t,r,n,i)},e.prototype.parseLocationInfo=function(e){if(!e||!e.match(/(\d+|\d+,\d+|\d+,\d+,\d+,\d+)/))return null;var t=e.split(","),r=parseInt(t[0]),n=t.length>1?parseInt(t[1]):void 0;return t.length>3?this.createLocation(r,n,parseInt(t[2]),parseInt(t[3])):this.createLocation(r,n,void 0,void 0)},e.prototype.createLocation=function(e,t,r,n){return e&&t&&n?{startLineNumber:e,startColumn:t,endLineNumber:r||e,endColumn:n}:e&&t?{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}:{startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:Number.MAX_VALUE}},e.prototype.getSeverity=function(e){var t=null;if(e.severity){var r=e.severity;r&&r.length>0&&(1===r.length&&v[r[0]]&&(r=v[r[0]]),t=l["default"].fromValue(r))}return null!==t&&t!==l["default"].Ignore||(t=this.matcher.severity||l["default"].Error),t},e}(),b=function(e){function t(t){e.call(this,t),this.pattern=t.pattern}return __extends(t,e),Object.defineProperty(t.prototype,"matchLength",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.handle=function(e,t){void 0===t&&(t=0),o.ok(e.length-t===1);var r=Object.create(null),n=this.pattern.regexp.exec(e[t]);if(n){this.fillProblemData(r,this.pattern,n);var i=this.getMarkerMatch(r);if(i)return{match:i,"continue":!1}}return{match:null,"continue":!1}},t.prototype.next=function(e){return null},t}(y),P=function(e){function t(t){e.call(this,t),this.patterns=t.pattern}return __extends(t,e),Object.defineProperty(t.prototype,"matchLength",{get:function(){return this.patterns.length},enumerable:!0,configurable:!0}),t.prototype.handle=function(e,t){void 0===t&&(t=0),o.ok(e.length-t===this.patterns.length),this.data=Object.create(null);for(var r=this.data,i=0;i<this.patterns.length;i++){var a=this.patterns[i],s=a.regexp.exec(e[i+t]);if(!s)return{match:null,"continue":!1};a.loop&&i===this.patterns.length-1&&(r=n.clone(r)),this.fillProblemData(r,a,s)}var l=this.patterns[this.patterns.length-1].loop;return l||(this.data=null),{match:this.getMarkerMatch(r),"continue":l}},t.prototype.next=function(e){var t=this.patterns[this.patterns.length-1];o.ok(t.loop===!0&&null!==this.data);var r=t.regexp.exec(e);if(!r)return this.data=null,null;var i=n.clone(this.data);return this.fillProblemData(i,t,r),this.getMarkerMatch(i)},t}(y),x=Object.create(null);x.msCompile={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(error|warning|info)\s+(\w{1,2}\d+)\s*:\s*(.*)$/,file:1,location:2,severity:3,code:4,message:5},x["gulp-tsc"]={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(\d+)\s+(.*)$/,file:1,location:2,code:3,message:4},x.tsc={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(error|warning|info)\s+(TS\d+)\s*:\s*(.*)$/,file:1,location:2,severity:3,code:4,message:5},x.cpp={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(error|warning|info)\s+(C\d+)\s*:\s*(.*)$/,file:1,location:2,severity:3,code:4,message:5},x.csc={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(error|warning|info)\s+(CS\d+)\s*:\s*(.*)$/,file:1,location:2,severity:3,code:4,message:5},x.vb={regexp:/^([^\s].*)\((\d+|\d+,\d+|\d+,\d+,\d+,\d+)\):\s+(error|warning|info)\s+(BC\d+)\s*:\s*(.*)$/,file:1,location:2,severity:3,code:4,message:5},x.lessCompile={regexp:/^\s*(.*) in file (.*) line no. (\d+)$/,message:1,file:2,line:3},x.jshint={regexp:/^(.*):\s+line\s+(\d+),\s+col\s+(\d+),\s(.+?)(?:\s+\((\w)(\d+)\))?$/,file:1,line:2,column:3,message:4,severity:5,code:6},x["jshint-stylish"]=[{regexp:/^(.+)$/,file:1},{regexp:/^\s+line\s+(\d+)\s+col\s+(\d+)\s+(.+?)(?:\s+\((\w)(\d+)\))?$/,line:1,column:2,message:3,severity:4,code:5,loop:!0}],x["eslint-compact"]={regexp:/^(.+):\sline\s(\d+),\scol\s(\d+),\s(Error|Warning|Info)\s-\s(.+)\s\((.+)\)$/,file:1,line:2,column:3,severity:4,message:5,code:6},x["eslint-stylish"]=[{regexp:/^([^\s].*)$/,file:1},{regexp:/^\s+(\d+):(\d+)\s+(error|warning|info)\s+(.+?)\s\s+(.*)$/,line:1,column:2,severity:3,message:4,code:5,loop:!0}],x.go={regexp:/^([^:]*: )?((.:)?[^:]*):(\d+)(:(\d+))?: (.*)$/,file:2,line:4,column:6,message:7},t.defaultPattern=h;var w;!function(e){function t(e){return s.isString(e.name)}var r;!function(e){e.Error="error",e.Warning="warning",e.Info="info"}(r=e.ProblemSeverity||(e.ProblemSeverity={})),e.isNamedProblemMatcher=t}(w=t.Config||(t.Config={}));var L=function(e){function i(t,r,n){void 0===n&&(n=new p.ValidationStatus),e.call(this,r,n),this.resolver=t}return __extends(i,e),i.prototype.parse=function(e){var t=this.createProblemMatcher(e);return this.checkProblemMatcherValid(e,t)?(this.addWatchingMatcher(e,t),t):null},i.prototype.checkProblemMatcherValid=function(e,t){return!(!(t&&t.pattern&&t.owner)||s.isUndefined(t.fileLocation))||(this.status.state=p.ValidationState.Fatal,this.log(r.localize("ProblemMatcherParser.invalidMarkerDescription","Error: Invalid problemMatcher description. A matcher must at least define a pattern, owner and a file location. The problematic matcher is:\n{0}\n",JSON.stringify(e,null,4))),!1)},i.prototype.createProblemMatcher=function(e){var t=null,i=e.owner?e.owner:"external",o=s.isString(e.applyTo)?g.fromString(e.applyTo):g.allDocuments;o||(o=g.allDocuments);var a,c=void 0,d=void 0;if(s.isUndefined(e.fileLocation))c=m.Relative,d="${cwd}";else if(s.isString(e.fileLocation))a=m.fromString(e.fileLocation),a&&(c=a,a===m.Relative&&(d="${cwd}"));else if(s.isStringArray(e.fileLocation)){var u=e.fileLocation;u.length>0&&(a=m.fromString(u[0]),1===u.length&&a===m.Absolute?c=a:2===u.length&&a===m.Relative&&u[1]&&(c=a,d=u[1]))}var f=e.pattern?this.createProblemPattern(e.pattern):void 0,h=e.severity?l["default"].fromValue(e.severity):void 0;if(h===l["default"].Ignore&&(this.status.state=p.ValidationState.Info,this.log(r.localize("ProblemMatcherParser.unknownSeverity","Info: unknown severity {0}. Valid values are error, warning and info.\n",e.severity)),h=l["default"].Error),s.isString(e.base)){var v=e.base;if(v.length>1&&"$"===v[0]){var y=this.resolver.get(v.substring(1));y&&(t=n.clone(y),e.owner&&(t.owner=i),c&&(t.fileLocation=c),d&&(t.filePrefix=d),e.pattern&&(t.pattern=f),e.severity&&(t.severity=h))}}else c&&(t={owner:i,applyTo:o,fileLocation:c,pattern:f},d&&(t.filePrefix=d),h&&(t.severity=h));return w.isNamedProblemMatcher(e)&&(t.name=e.name),t},i.prototype.createProblemPattern=function(e){var t;if(!s.isString(e)){if(s.isArray(e)){for(var n=e,i=[],o=0;o<n.length;o++)t=this.createSingleProblemPattern(n[o],!1),o<n.length-1&&!s.isUndefined(t.loop)&&t.loop&&(t.loop=!1,this.status.state=p.ValidationState.Error,this.log(r.localize("ProblemMatcherParser.loopProperty.notLast","The loop property is only supported on the last line matcher."))),i.push(t);return this.validateProblemPattern(i),i}return t=this.createSingleProblemPattern(e,!0),!s.isUndefined(t.loop)&&t.loop&&(t.loop=!1,this.status.state=p.ValidationState.Error,this.log(r.localize("ProblemMatcherParser.loopProperty.notMultiLine","The loop property is only supported on multi line matchers."))),this.validateProblemPattern([t]),t}var a=e;return a.length>1&&"$"===a[0]?h(a.substring(1)):null},i.prototype.createSingleProblemPattern=function(e,r){var i={regexp:this.createRegularExpression(e.regexp)};return t.problemPatternProperties.forEach(function(t){s.isUndefined(e[t])||(i[t]=e[t])}),r&&(i=i.location?n.mixin(i,{file:1,message:0},!1):n.mixin(i,{file:1,line:2,column:3,message:0},!1)),i},i.prototype.validateProblemPattern=function(e){var t,n,i,o,a=0;e.forEach(function(e){t=t||!s.isUndefined(e.file),n=n||!s.isUndefined(e.message),i=i||!s.isUndefined(e.location),o=o||!s.isUndefined(e.line),e.regexp&&a++}),a!==e.length&&(this.status.state=p.ValidationState.Error,this.log(r.localize("ProblemMatcherParser.problemPattern.missingRegExp","The problem pattern is missing a regular expression."))),t&&n&&(i||o)||(this.status.state=p.ValidationState.Error,this.log(r.localize("ProblemMatcherParser.problemPattern.missingProperty","The problem pattern is invalid. It must have at least a file, message and line or location match group.")))},i.prototype.addWatchingMatcher=function(e,t){var n=this.createRegularExpression(e.watchedTaskBeginsRegExp),i=this.createRegularExpression(e.watchedTaskEndsRegExp);if(n&&i)return void(t.watching={activeOnStart:!1,beginsPattern:{regexp:n},endsPattern:{regexp:i}});if(!s.isUndefinedOrNull(e.watching)){var o=e.watching,a=this.createWatchingPattern(o.beginsPattern),l=this.createWatchingPattern(o.endsPattern);return a&&l?void(t.watching={activeOnStart:!!s.isBoolean(o.activeOnStart)&&o.activeOnStart,beginsPattern:a,endsPattern:l}):void((a||l)&&(this.status.state=p.ValidationState.Error,this.log(r.localize("ProblemMatcherParser.problemPattern.watchingMatcher","A problem matcher must define both a begin pattern and an end pattern for watching."))))}},i.prototype.createWatchingPattern=function(e){if(s.isUndefinedOrNull(e))return null;var t,r;return s.isString(e)?t=this.createRegularExpression(e):(t=this.createRegularExpression(e.regexp),s.isNumber(e.file)&&(r=e.file)),t?r?{regexp:t,file:r}:{regexp:t}:null},i.prototype.createRegularExpression=function(e){var t=null;if(!e)return t;try{t=new RegExp(e)}catch(n){this.status.state=p.ValidationState.Fatal,this.log(r.localize("ProblemMatcherParser.invalidRegexp","Error: The string {0} is not a valid regular expression.\n",e))}return t},i}(p.Parser);t.ProblemMatcherParser=L;var S=function(){function e(){this.matchers=Object.create(null)}return e.prototype.add=function(e,t){this.matchers[e]=t},e.prototype.get=function(e){return this.matchers[e]},e.prototype.exists=function(e){return!!this.matchers[e]},e.prototype.remove=function(e){delete this.matchers[e]},e}();t.ProblemMatcherRegistry=S,t.registry=new S,t.registry.add("msCompile",{owner:"msCompile",applyTo:g.allDocuments,fileLocation:m.Absolute,pattern:h("msCompile")}),t.registry.add("lessCompile",{owner:"lessCompile",applyTo:g.allDocuments,fileLocation:m.Absolute,pattern:h("lessCompile"),severity:l["default"].Error}),t.registry.add("tsc",{owner:"typescript",applyTo:g.closedDocuments,fileLocation:m.Relative,filePrefix:"${cwd}",pattern:h("tsc")});var M={owner:"typescript",applyTo:g.closedDocuments,fileLocation:m.Relative,filePrefix:"${cwd}",pattern:h("tsc"),watching:{activeOnStart:!0,beginsPattern:{regexp:/^\s*(?:message TS6032:|\d{1,2}:\d{1,2}:\d{1,2}(?: AM| PM)? -) File change detected\. Starting incremental compilation\.\.\./},endsPattern:{regexp:/^\s*(?:message TS6042:|\d{1,2}:\d{1,2}:\d{1,2}(?: AM| PM)? -) Compilation complete\. Watching for file changes\./}}};M.tscWatch=!0,t.registry.add("tsc-watch",M),t.registry.add("gulp-tsc",{owner:"typescript",applyTo:g.closedDocuments,fileLocation:m.Relative,filePrefix:"${cwd}",pattern:h("gulp-tsc")}),t.registry.add("jshint",{owner:"jshint",applyTo:g.allDocuments,fileLocation:m.Absolute,pattern:h("jshint")}),t.registry.add("jshint-stylish",{owner:"jshint",applyTo:g.allDocuments,fileLocation:m.Absolute,pattern:h("jshint-stylish")}),t.registry.add("eslint-compact",{owner:"eslint",applyTo:g.allDocuments,fileLocation:m.Relative,filePrefix:"${cwd}",pattern:h("eslint-compact")}),t.registry.add("eslint-stylish",{owner:"eslint",applyTo:g.allDocuments,fileLocation:m.Absolute,pattern:h("eslint-stylish")}),t.registry.add("go",{owner:"go",applyTo:g.allDocuments,fileLocation:m.Relative,filePrefix:"${cwd}",pattern:h("go")})});