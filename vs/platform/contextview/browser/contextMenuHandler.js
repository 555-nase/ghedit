/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/browser/builder","vs/base/common/lifecycle","vs/base/browser/mouseEvent","vs/base/common/actions","vs/base/browser/ui/menu/menu","vs/base/common/events","vs/base/common/severity","vs/css!./contextMenuHandler"],function(e,t,n,i,o,s,r,c,u){"use strict";var a=function(){function e(e,t,n,i){var o=this;this.setContainer(e),this.contextViewService=t,this.telemetryService=n,this.messageService=i,this.actionRunner=new s.ActionRunner,this.menuContainerElement=null,this.toDispose=[];var r=!1;this.toDispose.push(this.actionRunner.addListener2(c.EventType.BEFORE_RUN,function(e){o.telemetryService&&o.telemetryService.publicLog("workbenchActionExecuted",{id:e.action.id,from:"contextMenu"}),r=!!e.retainActionItem,r||o.contextViewService.hideContextView(!1)})),this.toDispose.push(this.actionRunner.addListener2(c.EventType.RUN,function(e){r&&o.contextViewService.hideContextView(!1),r=!1,e.error&&o.messageService&&o.messageService.show(u["default"].Error,e.error)}))}return e.prototype.setContainer=function(e){var t=this;this.$el&&(this.$el.off(["click","mousedown"]),this.$el=null),e&&(this.$el=n.$(e),this.$el.on("mousedown",function(e){return t.onMouseDown(e)}))},e.prototype.showContextMenu=function(e){var t=this;e.getActions().done(function(n){t.contextViewService.showContextView({getAnchor:function(){return e.getAnchor()},canRelayout:!1,render:function(o){t.menuContainerElement=o;var s=e.getMenuClassName?e.getMenuClassName():"";s&&(o.className+=" "+s);var u=new r.Menu(o,n,{actionItemProvider:e.getActionItem,context:e.getActionsContext?e.getActionsContext():null,actionRunner:t.actionRunner}),a=u.addListener2(c.EventType.CANCEL,function(e){t.contextViewService.hideContextView(!0)}),m=u.addListener2(c.EventType.BLUR,function(e){t.contextViewService.hideContextView(!0)});return u.focus(),i.combinedDisposable(a,m,u)},onHide:function(n){e.onHide&&e.onHide(n),t.menuContainerElement=null}})})},e.prototype.onMouseDown=function(e){if(this.menuContainerElement){for(var t=new o.StandardMouseEvent(e),n=t.target;n;){if(n===this.menuContainerElement)return;n=n.parentElement}this.contextViewService.hideContextView()}},e.prototype.dispose=function(){this.setContainer(null)},e}();t.ContextMenuHandler=a});