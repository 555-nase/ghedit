define(["require","exports","vs/base/common/uri","vs/base/common/winjs.base","vs/base/common/network","vs/base/common/strings","vs/base/common/timer","vs/base/common/async","vs/base/common/objects","vs/platform/telemetry/common/telemetry"],function(e,t,i,s,r,n,o,u,a,m){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var c=function(){function e(e,t){void 0===t&&(t=m.NullTelemetryService);var i=null,s=e.getWorkspace();this._serviceMap=s||Object.create(null),this._telemetryService=t,s&&(i=n.rtrim(s.resource.toString(),"/")+"/"),this.computeOrigin(i)}return e.prototype.computeOrigin=function(e){if(e){this._origin=e;var t=i["default"].parse(this._origin).path;t&&t.length>0&&(this._origin=this._origin.substring(0,this._origin.length-t.length+1)),n.endsWith(this._origin,"/")||(this._origin+="/")}else this._origin="/"},e.prototype.makeCrossOriginRequest=function(e){return null},e.prototype.makeRequest=function(e){var t=o.nullEvent,i=!1,m=e.url;if(!m)throw new Error("IRequestService.makeRequest: Url is required");if((n.startsWith(m,"http://")||n.startsWith(m,"https://"))&&this._origin&&!n.startsWith(m,this._origin)){var c=this.makeCrossOriginRequest(e);if(c)return c;i=!0}var h=e,l=s.TPromise.as(void 0);return i||(h=this._telemetryService.getTelemetryInfo().then(function(e){var t={};t["X-TelemetrySession"]=e.sessionId,t["X-Requested-With"]="XMLHttpRequest",h.headers=a.mixin(h.headers,t)})),e.timeout&&(h.customRequestInitializer=function(t){t.timeout=e.timeout}),l.then(function(){return u.always(r.xhr(h),function(e){t.data&&(t.data.status=e.status),t.stop()})})},e}();t.BaseRequestService=c});