/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,t,r,o){var s,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(n<3?s(i):n>3?s(t,r,i):s(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(["require","exports","vs/base/common/winjs.base","vs/base/common/network","vs/base/common/lifecycle","vs/platform/configuration/common/configuration","vs/base/common/objects","vs/base/node/request","vs/base/node/proxy"],function(e,t,r,o,s,n,i,a,c){"use strict";var u=function(){function e(e){var t=this;this.proxyUrl=null,this.strictSSL=!0,this.disposables=[];var r=e.getConfiguration();this.configure(r);var o=e.onDidUpdateConfiguration(function(e){return t.configure(e.config)});this.disposables.push(o)}return e.prototype.configure=function(e){this.proxyUrl=e.http&&e.http.proxy,this.strictSSL=e.http&&e.http.proxyStrictSSL},e.prototype.makeRequest=function(e){var t=e.url;if(!t)throw new Error("IRequestService.makeRequest: Url is required.");var s=this,n=s.proxyUrl,u=s.strictSSL,p=c.getProxyAgent(e.url,{proxyUrl:n,strictSSL:u});return e=i.assign({},e),e=i.assign(e,{agent:p,strictSSL:u}),a.request(e).then(function(t){return new r.TPromise(function(r,s,n){var i=t.res,a=t.stream,c=[];a.on("data",function(e){return c.push(e)}),a.on("end",function(){var t=i.statusCode;if(e.followRedirects>0&&(t>=300&&t<=303||307===t)){var a=i.headers.location;if(a){var u={type:e.type,url:a,user:e.user,password:e.password,responseType:e.responseType,headers:e.headers,timeout:e.timeout,followRedirects:e.followRedirects-1,data:e.data};return void o.xhr(u).done(r,s,n)}}var p={responseText:c.join(""),status:t,getResponseHeader:function(e){return i.headers[e]},readyState:4};t>=200&&t<300||1223===t?r(p):s(p)})},function(t){var o;return o=p?"Unable to to connect to "+e.url+" through a proxy . Error: "+t.message:"Unable to to connect to "+e.url+". Error: "+t.message,r.TPromise.wrapError({responseText:o,status:404})})})},e.prototype.dispose=function(){this.disposables=s.dispose(this.disposables)},e=__decorate([__param(0,n.IConfigurationService)],e)}();t.NodeRequestService=u});