var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/lifecycle","vs/base/common/severity","vs/base/common/arrays","vs/base/browser/dom","vs/base/browser/keyboardEvent","vs/platform/commands/common/commands","vs/platform/keybinding/common/keybindingResolver","vs/platform/keybinding/common/keybinding","vs/platform/keybinding/common/keybindingsRegistry","vs/base/common/event","vs/css!./keybindings"],function(t,e,n,o,i,r,s,a,u,c,h,d,p,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var _="data-keybinding-context",y=function(){function t(t,e){this._id=t,this._parent=e,this._value=Object.create(null),this._value._contextId=t}return t.prototype.setValue=function(t,e){if(this._value[t]!==e)return this._value[t]=e,!0},t.prototype.removeValue=function(t){return delete this._value[t]},t.prototype.getValue=function(t){var e=this._value[t];return"undefined"==typeof e&&this._parent?this._parent.getValue(t):e},t.prototype.fillInContext=function(t){this._parent&&this._parent.fillInContext(t);for(var e in this._value)t[e]=this._value[e]},t}();e.KeybindingContext=y;var f=function(t){function e(e,n,o){var i=this;t.call(this,e,null),this._emitter=o,this._subscription=n.onDidUpdateConfiguration(function(t){return i._updateConfigurationContext(t.config)}),this._updateConfigurationContext(n.getConfiguration())}return __extends(e,t),e.prototype.dispose=function(){this._subscription.dispose()},e.prototype._updateConfigurationContext=function(t){var e=this;for(var n in this._value)0===n.indexOf("config.")&&delete this._value[n];var o=function(t,n){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){n.push(i);var r=t[i];if("boolean"==typeof r){var s=n.join(".");e._value[s]=r,e._emitter.fire(s)}else"object"==typeof r&&o(r,n);n.pop()}};o(t,["config"])},e}(y),g=function(){function t(t,e,n){this._parent=t,this._key=e,this._defaultValue=n,this.reset()}return t.prototype.set=function(t){this._parent.setContext(this._key,t)},t.prototype.reset=function(){"undefined"==typeof this._defaultValue?this._parent.removeContext(this._key):this._parent.setContext(this._key,this._defaultValue)},t}(),C=function(){function t(t){this._myContextId=t,this._onDidChangeContextKey=new l.Emitter,this._instantiationService=null}return t.prototype.createKey=function(t,e){return new g(this,t,e)},Object.defineProperty(t.prototype,"onDidChangeContext",{get:function(){return this._onDidChangeContext||(this._onDidChangeContext=l.debounceEvent(this._onDidChangeContextKey.event,function(t,e){return t?t.indexOf(e)<0&&t.push(e):t=[e],t},25)),this._onDidChangeContext},enumerable:!0,configurable:!0}),t.prototype.setInstantiationService=function(t){this._instantiationService=t},t.prototype.createScoped=function(t){return new v(this,this._onDidChangeContextKey,t)},t.prototype.contextMatchesRules=function(t){var e=Object.create(null);this.getContext(this._myContextId).fillInContext(e);var n=h.KeybindingResolver.contextMatchesRules(e,t);return n},t.prototype.getContextValue=function(t){return this.getContext(this._myContextId).getValue(t)},t.prototype.setContext=function(t,e){this.getContext(this._myContextId).setValue(t,e)&&this._onDidChangeContextKey.fire(t)},t.prototype.removeContext=function(t){this.getContext(this._myContextId).removeValue(t)&&this._onDidChangeContextKey.fire(t)},t}();e.AbstractKeybindingService=C;var m=function(t){function e(e,n,o,i){t.call(this,0),this._toDispose=[],this._lastContextId=0,this._contexts=Object.create(null);var r=new f(this._myContextId,n,this._onDidChangeContextKey);this._contexts[String(this._myContextId)]=r,this._toDispose.push(r),this._cachedResolver=null,this._firstTimeComputingResolver=!0,this._currentChord=0,this._currentChordStatusMessage=null,this._commandService=e,this._statusService=i,this._messageService=o}return __extends(e,t),e.prototype._beginListening=function(t){var e=this;this._toDispose.push(a.addDisposableListener(t,a.EventType.KEY_DOWN,function(t){var n=new u.StandardKeyboardEvent(t);e._dispatch(n)}))},e.prototype._getResolver=function(){return this._cachedResolver||(this._cachedResolver=new h.KeybindingResolver(p.KeybindingsRegistry.getDefaultKeybindings(),this._getExtraKeybindings(this._firstTimeComputingResolver)),this._firstTimeComputingResolver=!1),this._cachedResolver},e.prototype.dispose=function(){this._toDispose=i.dispose(this._toDispose)},e.prototype.getLabelFor=function(t){return t._toUSLabel()},e.prototype.getHTMLLabelFor=function(t){return t._toUSHTMLLabel()},e.prototype.getAriaLabelFor=function(t){return t._toUSAriaLabel()},e.prototype.getElectronAcceleratorFor=function(t){return t._toElectronAccelerator()},e.prototype.updateResolver=function(){this._cachedResolver=null},e.prototype._getExtraKeybindings=function(t){return[]},e.prototype.getDefaultKeybindings=function(){return this._getResolver().getDefaultKeybindings()+"\n\n"+this._getAllCommandsAsComment()},e.prototype.customKeybindingsCount=function(){return 0},e.prototype.lookupKeybindings=function(t){return this._getResolver().lookupKeybinding(t)},e.prototype._getAllCommandsAsComment=function(){var t=c.CommandsRegistry.getCommands(),e=[],o=this._getResolver().getDefaultBoundCommands();for(var i in t)"_"!==i[0]&&0!==i.indexOf("vscode.")&&("object"!=typeof t[i].description||s.isFalsyOrEmpty(t[i].description.args))&&(o[i]||e.push(i));var r=e.sort().join("\n// - ");return"// "+n.localize("unboundCommands","Here are other available commands: ")+"\n// - "+r},e.prototype._getCommandHandler=function(t){return c.CommandsRegistry.getCommand(t).handler},e.prototype._dispatch=function(t){var e=this,i=t.keyCode===o.KeyCode.Ctrl||t.keyCode===o.KeyCode.Shift||t.keyCode===o.KeyCode.Alt||t.keyCode===o.KeyCode.Meta;if(!i){var s=Object.create(null);this.getContext(this._findContextAttr(t.target)).fillInContext(s);var a=this._getResolver().resolve(s,this._currentChord,t.asKeybinding());if(a&&a.enterChord){if(t.preventDefault(),this._currentChord=a.enterChord,this._statusService){var u=this.getLabelFor(new o.Keybinding(this._currentChord));this._currentChordStatusMessage=this._statusService.setStatusMessage(n.localize("first.chord","({0}) was pressed. Waiting for second key of chord...",u))}}else{if(this._statusService&&this._currentChord&&(!a||!a.commandId)){var u=this.getLabelFor(new o.Keybinding(this._currentChord)),c=this.getLabelFor(new o.Keybinding(t.asKeybinding()));this._statusService.setStatusMessage(n.localize("missing.chord","The key combination ({0}, {1}) is not a command.",u,c),1e4),t.preventDefault()}if(this._currentChordStatusMessage&&(this._currentChordStatusMessage.dispose(),this._currentChordStatusMessage=null),this._currentChord=0,a&&a.commandId){/^\^/.test(a.commandId)||t.preventDefault();var h=a.commandId.replace(/^\^/,"");this._commandService.executeCommand(h,{}).done(void 0,function(t){e._messageService.show(r["default"].Warning,t)})}}}},e.prototype._findContextAttr=function(t){for(;t;){if(t.hasAttribute(_))return parseInt(t.getAttribute(_),10);t=t.parentElement}return this._myContextId},e.prototype.getContext=function(t){return this._contexts[String(t)]},e.prototype.createChildContext=function(t){void 0===t&&(t=this._myContextId);var e=++this._lastContextId;return this._contexts[String(e)]=new y(e,this.getContext(t)),e},e.prototype.disposeContext=function(t){delete this._contexts[String(t)]},e}(C);e.KeybindingService=m,c.CommandsRegistry.registerCommand(d.SET_CONTEXT_COMMAND_ID,function(t,e,n){t.get(d.IKeybindingService).createKey(String(e),n)});var v=function(t){function e(e,n,o){t.call(this,e.createChildContext()),this._parent=e,this._onDidChangeContextKey=n,this._domNode=o,this._domNode.setAttribute(_,String(this._myContextId))}return __extends(e,t),e.prototype.dispose=function(){this._parent.disposeContext(this._myContextId),this._domNode.removeAttribute(_)},Object.defineProperty(e.prototype,"onDidChangeContext",{get:function(){return this._parent.onDidChangeContext},enumerable:!0,configurable:!0}),e.prototype.getLabelFor=function(t){return this._parent.getLabelFor(t)},e.prototype.getHTMLLabelFor=function(t){return this._parent.getHTMLLabelFor(t)},e.prototype.getAriaLabelFor=function(t){return this._parent.getAriaLabelFor(t)},e.prototype.getElectronAcceleratorFor=function(t){return this._parent.getElectronAcceleratorFor(t)},e.prototype.getDefaultKeybindings=function(){return this._parent.getDefaultKeybindings()},e.prototype.customKeybindingsCount=function(){return this._parent.customKeybindingsCount()},e.prototype.lookupKeybindings=function(t){return this._parent.lookupKeybindings(t)},e.prototype.getContext=function(t){return this._parent.getContext(t)},e.prototype.createChildContext=function(t){return void 0===t&&(t=this._myContextId),this._parent.createChildContext(t)},e.prototype.disposeContext=function(t){this._parent.disposeContext(t)},e}(C)});