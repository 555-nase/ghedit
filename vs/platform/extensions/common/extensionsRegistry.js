define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/paths","vs/base/common/severity","vs/platform/jsonschemas/common/jsonContributionRegistry","vs/platform/platform"],function(e,t,n,i,s,o,r,a){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function p(e,t,i){if(!t)return i.push(n.localize("extensionDescription.empty","Got empty extension description")),!1;if("string"!=typeof t.publisher)return i.push(n.localize("extensionDescription.publisher","property `{0}` is mandatory and must be of type `string`","publisher")),!1;if("string"!=typeof t.name)return i.push(n.localize("extensionDescription.name","property `{0}` is mandatory and must be of type `string`","name")),!1;if("string"!=typeof t.version)return i.push(n.localize("extensionDescription.version","property `{0}` is mandatory and must be of type `string`","version")),!1;if(!t.engines)return i.push(n.localize("extensionDescription.engines","property `{0}` is mandatory and must be of type `object`","engines")),!1;if("string"!=typeof t.engines.vscode)return i.push(n.localize("extensionDescription.engines.vscode","property `{0}` is mandatory and must be of type `string`","engines.vscode")),!1;if("undefined"!=typeof t.extensionDependencies&&!c(t.extensionDependencies))return i.push(n.localize("extensionDescription.extensionDependencies","property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")),!1;if("undefined"!=typeof t.activationEvents){if(!c(t.activationEvents))return i.push(n.localize("extensionDescription.activationEvents1","property `{0}` can be omitted or must be of type `string[]`","activationEvents")),!1;if("undefined"==typeof t.main)return i.push(n.localize("extensionDescription.activationEvents2","properties `{0}` and `{1}` must both be specified or must both be omitted","activationEvents","main")),!1}if("undefined"!=typeof t.main){if("string"!=typeof t.main)return i.push(n.localize("extensionDescription.main1","property `{0}` can be omitted or must be of type `string`","main")),!1;var o=s.normalize(s.join(e,t.main));if(o.indexOf(e)&&i.push(n.localize("extensionDescription.main2","Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",o,e)),"undefined"==typeof t.activationEvents)return i.push(n.localize("extensionDescription.main3","properties `{0}` and `{1}` must both be specified or must both be omitted","activationEvents","main")),!1}return!0}function c(e){if(!Array.isArray(e))return!1;for(var t=0,n=e.length;t<n;t++)if("string"!=typeof e[t])return!1;return!0}var l=function(){function e(e,t){this._messageHandler=e,this._source=t}return e.prototype._msg=function(e,t){this._messageHandler({type:e,message:t,source:this._source})},e.prototype.error=function(e){this._msg(o["default"].Error,e)},e.prototype.warn=function(e){this._msg(o["default"].Warning,e)},e.prototype.info=function(e){this._msg(o["default"].Info,e)},e}();t.isValidExtensionDescription=p;var h=Object.hasOwnProperty,d=a.Registry.as(r.Extensions.JSONContribution),u=function(){function e(e,t){this.name=e,this._registry=t,this._handler=null,this._messageHandler=null}return e.prototype.setHandler=function(e){if(this._handler)throw new Error("Handler already set!");this._handler=e,this._handle()},e.prototype.handle=function(e){this._messageHandler=e,this._handle()},e.prototype._handle=function(){var e=this;this._handler&&this._messageHandler&&this._registry.registerPointListener(this.name,function(t){var n=t.map(function(t){return{description:t,value:t.contributes[e.name],collector:new l(e._messageHandler,t.extensionFolderPath)}});e._handler(n)})},e}(),f="vscode://schemas/vscode-extensions",y={"default":{name:"{{name}}",description:"{{description}}",author:"{{author}}",version:"{{1.0.0}}",main:"{{pathToMain}}",dependencies:{}},properties:{displayName:{description:n.localize("vscode.extension.displayName","The display name for the extension used in the VS Code gallery."),type:"string"},categories:{description:n.localize("vscode.extension.categories","The categories used by the VS Code gallery to categorize the extension."),type:"array",items:{type:"string","enum":["Languages","Snippets","Linters","Themes","Debuggers","Productivity","Other"]}},galleryBanner:{type:"object",description:n.localize("vscode.extension.galleryBanner","Banner used in the VS Code marketplace."),properties:{color:{description:n.localize("vscode.extension.galleryBanner.color","The banner color on the VS Code marketplace page header."),type:"string"},theme:{description:n.localize("vscode.extension.galleryBanner.theme","The color theme for the font used in the banner."),type:"string","enum":["dark","light"]}}},publisher:{description:n.localize("vscode.extension.publisher","The publisher of the VS Code extension."),type:"string"},activationEvents:{description:n.localize("vscode.extension.activationEvents","Activation events for the VS Code extension."),type:"array",items:{type:"string",defaultSnippets:[{label:"onLanguage",body:"onLanguage:{{languageId}}"},{label:"onCommand",body:"onCommand:{{commandId}}"},{label:"onDebug",body:"onDebug:{{type}}"},{label:"workspaceContains",body:"workspaceContains:{{fileName}}"}]}},extensionDependencies:{description:n.localize("vscode.extension.extensionDependencies","Dependencies to other extensions. The identifier of an extension is always ${publisher}.${name}. For example: vscode.csharp."),type:"array",items:{type:"string"}},scripts:{type:"object",properties:{"vscode:prepublish":{description:n.localize("vscode.extension.scripts.prepublish","Script executed before the package is published as a VS Code extension."),type:"string"}}},contributes:{description:n.localize("vscode.extension.contributes","All contributions of the VS Code extension represented by this package."),type:"object",properties:{},"default":{}}}},m=function(){function e(){this._extensionsMap={},this._extensionsArr=[],this._activationMap={},this._pointListeners=[],this._extensionPoints={},this._oneTimeActivationEventListeners={}}return e.prototype.registerPointListener=function(t,n){var i={extensionPoint:t,listener:n};this._pointListeners.push(i),this._triggerPointListener(i,e._filterWithExtPoint(this.getAllExtensionDescriptions(),t))},e.prototype.registerExtensionPoint=function(e,t){if(h.call(this._extensionPoints,e))throw new Error("Duplicate extension point: "+e);var n=new u(e,this);return this._extensionPoints[e]=n,y.properties.contributes.properties[e]=t,d.registerSchema(f,y),n},e.prototype.handleExtensionPoints=function(e){var t=this;Object.keys(this._extensionPoints).forEach(function(n){t._extensionPoints[n].handle(e)})},e.prototype._triggerPointListener=function(e,t){if(t&&0!==t.length)try{e.listener(t)}catch(n){i.onUnexpectedError(n)}},e.prototype.registerExtensions=function(t){for(var n=0,i=t.length;n<i;n++){var s=t[n];if(h.call(this._extensionsMap,s.id))console.error("Extension `"+s.id+"` is already registered");else if(this._extensionsMap[s.id]=s,this._extensionsArr.push(s),Array.isArray(s.activationEvents))for(var o=0,r=s.activationEvents.length;o<r;o++){var a=s.activationEvents[o];this._activationMap[a]=this._activationMap[a]||[],this._activationMap[a].push(s)}}for(var n=0,i=this._pointListeners.length;n<i;n++){var p=this._pointListeners[n],c=e._filterWithExtPoint(t,p.extensionPoint);this._triggerPointListener(p,c)}},e._filterWithExtPoint=function(e,t){return e.filter(function(e){return e.contributes&&h.call(e.contributes,t)})},e.prototype.getExtensionDescriptionsForActivationEvent=function(e){return h.call(this._activationMap,e)?this._activationMap[e].slice(0):[]},e.prototype.getAllExtensionDescriptions=function(){return this._extensionsArr.slice(0)},e.prototype.getExtensionDescription=function(e){return h.call(this._extensionsMap,e)?this._extensionsMap[e]:null},e.prototype.registerOneTimeActivationEventListener=function(e,t){h.call(this._oneTimeActivationEventListeners,e)||(this._oneTimeActivationEventListeners[e]=[]),this._oneTimeActivationEventListeners[e].push(t)},e.prototype.triggerActivationEventListeners=function(e){if(h.call(this._oneTimeActivationEventListeners,e)){var t=this._oneTimeActivationEventListeners[e];delete this._oneTimeActivationEventListeners[e];for(var n=0,s=t.length;n<s;n++){var o=t[n];try{o()}catch(r){i.onUnexpectedError(r)}}}},e}(),g={ExtensionsRegistry:"ExtensionsRegistry"};a.Registry.add(g.ExtensionsRegistry,new m),t.ExtensionsRegistry=a.Registry.as(g.ExtensionsRegistry),d.registerSchema(f,y)});