define(["require","exports","vs/nls","vs/base/common/severity","vs/base/common/winjs.base","vs/platform/extensions/common/extensionsRegistry"],function(t,e,n,i,s,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var a=Object.hasOwnProperty,r=function(){function t(t){this.activationFailed=t}return t}();e.ActivatedExtension=r;var c=function(){function t(t){var e=this;t?(this._onReady=s.TPromise.as(!0),this._onReadyC=function(t){}):this._onReady=new s.TPromise(function(t,n,i){e._onReadyC=t},function(){console.warn("You should really not try to cancel this ready promise!")}),this._activatingExtensions={},this._activatedExtensions={}}return t.prototype._triggerOnReady=function(){this._onReadyC(!0)},t.prototype.onReady=function(){return this._onReady},t.prototype.getExtensionsStatus=function(){return null},t.prototype.isActivated=function(t){return a.call(this._activatedExtensions,t)},t.prototype.activateByEvent=function(t){var e=this;return this._onReady.then(function(){o.ExtensionsRegistry.triggerActivationEventListeners(t);var n=o.ExtensionsRegistry.getExtensionDescriptionsForActivationEvent(t);return e._activateExtensions(n,0)})},t.prototype.activateById=function(t){var e=this;return this._onReady.then(function(){var n=o.ExtensionsRegistry.getExtensionDescription(t);if(!n)throw new Error("Extension `"+t+"` is not known");return e._activateExtensions([n],0)})},t.prototype._handleActivateRequest=function(t,e,s){for(var r="undefined"==typeof t.extensionDependencies?[]:t.extensionDependencies,c=!0,d=0,v=r.length;d<v;d++){var l=r[d],u=o.ExtensionsRegistry.getExtensionDescription(l);if(!u)return this._showMessage(i["default"].Error,n.localize("unknownDep","Extension `{1}` failed to activate. Reason: unknown dependency `{0}`.",l,t.id)),void(this._activatedExtensions[t.id]=this._createFailedExtension());if(a.call(this._activatedExtensions,l)){var h=this._activatedExtensions[l];if(h.activationFailed)return this._showMessage(i["default"].Error,n.localize("failedDep1","Extension `{1}` failed to activate. Reason: dependency `{0}` failed to activate.",l,t.id)),void(this._activatedExtensions[t.id]=this._createFailedExtension())}else c=!1,e[l]=u}c?e[t.id]=t:s.push(t)},t.prototype._activateExtensions=function(t,e){var o=this;if(0===t.length)return s.TPromise.as(void 0);if(t=t.filter(function(t){return!a.call(o._activatedExtensions,t.id)}),0===t.length)return s.TPromise.as(void 0);if(e>10){for(var r=0,c=t.length;r<c;r++)this._showMessage(i["default"].Error,n.localize("failedDep2","Extension `{0}` failed to activate. Reason: more than 10 levels of dependencies (most likely a dependency loop).",t[r].id)),this._activatedExtensions[t[r].id]=this._createFailedExtension();return s.TPromise.as(void 0)}for(var d=Object.create(null),v=[],r=0,c=t.length;r<c;r++)this._handleActivateRequest(t[r],d,v);for(var r=0,c=v.length;r<c;r++)d[v[r].id]&&delete d[v[r].id];var l=Object.keys(d).map(function(t){return d[t]});return 0===v.length?s.TPromise.join(l.map(function(t){return o._activateExtension(t)})).then(function(t){}):this._activateExtensions(l,e+1).then(function(t){return o._activateExtensions(v,e+1)})},t.prototype._activateExtension=function(t){var e=this;return a.call(this._activatedExtensions,t.id)?s.TPromise.as(void 0):a.call(this._activatingExtensions,t.id)?this._activatingExtensions[t.id]:(this._activatingExtensions[t.id]=this._actualActivateExtension(t).then(null,function(s){return e._showMessage(i["default"].Error,n.localize("activationError","Activating extension `{0}` failed: {1}.",t.id,s.message)),console.error("Activating extension `"+t.id+"` failed: ",s.message),console.log("Here is the error stack: ",s.stack),e._createFailedExtension()}).then(function(n){e._activatedExtensions[t.id]=n,delete e._activatingExtensions[t.id]}),this._activatingExtensions[t.id])},t}();e.AbstractExtensionService=c});