/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","path","vs/base/common/mime","vs/base/node/stream","vs/base/node/encoding"],function(n,e,t,i,r,u){"use strict";function o(n,e){r.readExactlyByStream(n,l,function(n,t,i){f(n,t,i,e)})}function c(n,e){return t.extname(n)===E?e(null,{encoding:u.UTF8,mimes:[i.MIME_BINARY]}):void r.readExactlyByFile(n,l,function(n,t,i){f(n,t,i,e)})}function f(n,e,t,i){return n?i(n,null):i(null,m(e,t))}function m(n,e){var t=u.detectEncodingByBOMFromBuffer(n,e),r=!0;if(t!==u.UTF16be&&t!==u.UTF16le)for(var o=0;o<e&&o<l;o++)if(0===n.readInt8(o)){r=!1;break}return{mimes:r?[i.MIME_TEXT]:[i.MIME_BINARY],encoding:t}}function M(n,e){var t=n,r=e[0];r!==i.MIME_BINARY&&r!==i.MIME_UNKNOWN&&t.unshift(r);var u=t.filter(function(n,e){return n&&t.indexOf(n)===e}).sort(function(n,e){return n===i.MIME_BINARY?1:e===i.MIME_BINARY?-1:n===i.MIME_TEXT?1:e===i.MIME_TEXT?-1:0});return u}function a(n,e,t){o(n,function(n,i){d(e,n,i,t)})}function s(n,e){c(n,function(t,i){d(n,t,i,e)})}function d(n,e,t,r){if(e)return r(e,null);var u=M(t.mimes,i.guessMimeTypes(n));t.mimes=u,r(null,t)}var l=512,E=".asar";e.detectMimeAndEncodingFromBuffer=m,e.detectMimesFromStream=a,e.detectMimesFromFile=s});