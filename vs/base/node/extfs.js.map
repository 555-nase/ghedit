{"version":3,"file":"extfs.js","sourceRoot":"","sources":["../../../../src/vs/base/node/extfs.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport uuid = require('vs/base/common/uuid');\nimport strings = require('vs/base/common/strings');\nimport platform = require('vs/base/common/platform');\n\nimport flow = require('vs/base/node/flow');\n\nimport fs = require('fs');\nimport paths = require('path');\n\nconst loop = flow.loop;\n\nexport function readdir(path: string, callback: (error: Error, files: string[]) => void): void {\n\n\t// Mac: uses NFD unicode form on disk, but we want NFC\n\t// See also https://github.com/nodejs/node/issues/2165\n\tif (platform.isMacintosh) {\n\t\treturn readdirNormalize(path, (error, children) => {\n\t\t\tif (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t}\n\n\t\t\treturn callback(null, children.map(c => strings.normalizeNFC(c)));\n\t\t});\n\t}\n\n\treturn readdirNormalize(path, callback);\n}\n\nfunction readdirNormalize(path: string, callback: (error: Error, files: string[]) => void): void {\n\tfs.readdir(path, (error, children) => {\n\t\tif (error) {\n\t\t\treturn callback(error, null);\n\t\t}\n\n\t\t// Bug in node: In some environments we get \".\" and \"..\" as entries from the call to readdir().\n\t\t// For example Sharepoint via WebDav on Windows includes them. We never want those\n\t\t// entries in the result set though because they are not valid children of the folder\n\t\t// for our concerns.\n\t\t// See https://github.com/nodejs/node/issues/4002\n\t\treturn callback(null, children.filter(c => c !== '.' && c !== '..'));\n\t});\n}\n\nexport function mkdirp(path: string, mode: number, callback: (error: Error) => void): void {\n\tfs.exists(path, (exists) => {\n\t\tif (exists) {\n\t\t\treturn isDirectory(path, (err: Error, itIs?: boolean) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn callback(err);\n\t\t\t\t}\n\n\t\t\t\tif (!itIs) {\n\t\t\t\t\treturn callback(new Error('\"' + path + '\" is not a directory.'));\n\t\t\t\t}\n\n\t\t\t\tcallback(null);\n\t\t\t});\n\t\t}\n\n\t\tmkdirp(paths.dirname(path), mode, (err: Error) => {\n\t\t\tif (err) { callback(err); return; }\n\n\t\t\tif (mode) {\n\t\t\t\tfs.mkdir(path, mode, (error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn callback(error);\n\t\t\t\t\t}\n\n\t\t\t\t\tfs.chmod(path, mode, callback); // we need to explicitly chmod because of https://github.com/nodejs/node/issues/1104\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfs.mkdir(path, null, callback);\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction isDirectory(path: string, callback: (error: Error, isDirectory?: boolean) => void): void {\n\tfs.stat(path, (error: Error, stat: fs.Stats) => {\n\t\tif (error) { return callback(error); }\n\n\t\tcallback(null, stat.isDirectory());\n\t});\n}\n\nexport function copy(source: string, target: string, callback: (error: Error) => void, copiedSources?: { [path: string]: boolean }): void {\n\tif (!copiedSources) {\n\t\tcopiedSources = Object.create(null);\n\t}\n\n\tfs.stat(source, (error, stat) => {\n\t\tif (error) { return callback(error); }\n\t\tif (!stat.isDirectory()) { return pipeFs(source, target, stat.mode & 511, callback); }\n\n\t\tif (copiedSources[source]) {\n\t\t\treturn callback(null); // escape when there are cycles (can happen with symlinks)\n\t\t} else {\n\t\t\tcopiedSources[source] = true; // remember as copied\n\t\t}\n\n\t\tmkdirp(target, stat.mode & 511, (err) => {\n\t\t\treaddir(source, (err, files) => {\n\t\t\t\tloop(files, (file: string, clb: (error: Error) => void) => {\n\t\t\t\t\tcopy(paths.join(source, file), paths.join(target, file), clb, copiedSources);\n\t\t\t\t}, callback);\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction pipeFs(source: string, target: string, mode: number, callback: (error: Error) => void): void {\n\tlet callbackHandled = false;\n\n\tlet readStream = fs.createReadStream(source);\n\tlet writeStream = fs.createWriteStream(target, { mode: mode });\n\n\tlet onError = (error: Error) => {\n\t\tif (!callbackHandled) {\n\t\t\tcallbackHandled = true;\n\t\t\tcallback(error);\n\t\t}\n\t};\n\n\treadStream.on('error', onError);\n\twriteStream.on('error', onError);\n\n\treadStream.on('end', () => {\n\t\t(<any>writeStream).end(() => { // In this case the write stream is known to have an end signature with callback\n\t\t\tif (!callbackHandled) {\n\t\t\t\tcallbackHandled = true;\n\n\t\t\t\tfs.chmod(target, mode, callback); // we need to explicitly chmod because of https://github.com/nodejs/node/issues/1104\n\t\t\t}\n\t\t});\n\t});\n\n\t// In node 0.8 there is no easy way to find out when the pipe operation has finished. As such, we use the end property = false\n\t// so that we are in charge of calling end() on the write stream and we will be notified when the write stream is really done.\n\t// We can do this because file streams have an end() method that allows to pass in a callback.\n\t// In node 0.10 there is an event 'finish' emitted from the write stream that can be used. See\n\t// https://groups.google.com/forum/?fromgroups=#!topic/nodejs/YWQ1sRoXOdI\n\treadStream.pipe(writeStream, { end: false });\n}\n\n// Deletes the given path by first moving it out of the workspace. This has two benefits. For one, the operation can return fast because\n// after the rename, the contents are out of the workspace although not yet deleted. The greater benefit however is that this operation\n// will fail in case any file is used by another process. fs.unlink() in node will not bail if a file unlinked is used by another process.\n// However, the consequences are bad as outlined in all the related bugs from https://github.com/joyent/node/issues/7164\nexport function del(path: string, tmpFolder: string, callback: (error: Error) => void, done?: (error: Error) => void): void {\n\tfs.exists(path, (exists) => {\n\t\tif (!exists) {\n\t\t\treturn callback(null);\n\t\t}\n\n\t\tfs.stat(path, (err, stat) => {\n\t\t\tif (err || !stat) {\n\t\t\t\treturn callback(err);\n\t\t\t}\n\n\t\t\t// Special windows workaround: A file or folder that ends with a \".\" cannot be moved to another place\n\t\t\t// because it is not a valid file name. In this case, we really have to do the deletion without prior move.\n\t\t\tif (path[path.length - 1] === '.' || strings.endsWith(path, './') || strings.endsWith(path, '.\\\\')) {\n\t\t\t\treturn rmRecursive(path, callback);\n\t\t\t}\n\n\t\t\tlet pathInTemp = paths.join(tmpFolder, uuid.generateUuid());\n\t\t\tfs.rename(path, pathInTemp, (error: Error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn rmRecursive(path, callback); // if rename fails, delete without tmp dir\n\t\t\t\t}\n\n\t\t\t\t// Return early since the move succeeded\n\t\t\t\tcallback(null);\n\n\t\t\t\t// do the heavy deletion outside the callers callback\n\t\t\t\trmRecursive(pathInTemp, (error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (done) {\n\t\t\t\t\t\tdone(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction rmRecursive(path: string, callback: (error: Error) => void): void {\n\tif (path === '\\\\' || path === '/') {\n\t\treturn callback(new Error('Will not delete root!'));\n\t}\n\n\tfs.exists(path, (exists) => {\n\t\tif (!exists) {\n\t\t\tcallback(null);\n\t\t} else {\n\t\t\tfs.lstat(path, (err, stat) => {\n\t\t\t\tif (err || !stat) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t} else if (!stat.isDirectory() || stat.isSymbolicLink() /* !!! never recurse into links when deleting !!! */) {\n\t\t\t\t\tlet mode = stat.mode;\n\t\t\t\t\tif (!(mode & 128)) { // 128 === 0200\n\t\t\t\t\t\tfs.chmod(path, mode | 128, (err: Error) => { // 128 === 0200\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfs.unlink(path, callback);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfs.unlink(path, callback);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treaddir(path, (err, children) => {\n\t\t\t\t\t\tif (err || !children) {\n\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t} else if (children.length === 0) {\n\t\t\t\t\t\t\tfs.rmdir(path, callback);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet firstError: Error = null;\n\t\t\t\t\t\t\tlet childrenLeft = children.length;\n\t\t\t\t\t\t\tchildren.forEach((child) => {\n\t\t\t\t\t\t\t\trmRecursive(paths.join(path, child), (err: Error) => {\n\t\t\t\t\t\t\t\t\tchildrenLeft--;\n\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\tfirstError = firstError || err;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (childrenLeft === 0) {\n\t\t\t\t\t\t\t\t\t\tif (firstError) {\n\t\t\t\t\t\t\t\t\t\t\tcallback(firstError);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfs.rmdir(path, callback);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\nexport function mv(source: string, target: string, callback: (error: Error) => void): void {\n\tif (source === target) {\n\t\treturn callback(null);\n\t}\n\n\tfunction updateMtime(err: Error): void {\n\t\tif (err) {\n\t\t\treturn callback(err);\n\t\t}\n\n\t\tfs.stat(target, (error: Error, stat: fs.Stats) => {\n\t\t\tif (error) {\n\t\t\t\treturn callback(error);\n\t\t\t}\n\n\t\t\tif (stat.isDirectory()) {\n\t\t\t\treturn callback(null);\n\t\t\t}\n\n\t\t\tfs.open(target, 'a', null, (err: Error, fd: number) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn callback(err);\n\t\t\t\t}\n\n\t\t\t\tfs.futimes(fd, stat.atime, new Date(), (err: Error) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn callback(err);\n\t\t\t\t\t}\n\n\t\t\t\t\tfs.close(fd, callback);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t// Try native rename()\n\tfs.rename(source, target, (err: Error) => {\n\t\tif (!err) {\n\t\t\treturn updateMtime(null);\n\t\t}\n\n\t\t// In two cases we fallback to classic copy and delete:\n\t\t//\n\t\t// 1.) The EXDEV error indicates that source and target are on different devices\n\t\t// In this case, fallback to using a copy() operation as there is no way to\n\t\t// rename() between different devices.\n\t\t//\n\t\t// 2.) The user tries to rename a file/folder that ends with a dot. This is not\n\t\t// really possible to move then, at least on UNC devices.\n\t\tif (err && source.toLowerCase() !== target.toLowerCase() && ((<any>err).code === 'EXDEV') || strings.endsWith(source, '.')) {\n\t\t\treturn copy(source, target, (err: Error) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn callback(err);\n\t\t\t\t}\n\n\t\t\t\trmRecursive(source, updateMtime);\n\t\t\t});\n\t\t}\n\n\t\treturn callback(err);\n\t});\n}"]}