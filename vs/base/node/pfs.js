/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/winjs.base","vs/base/node/extfs","vs/base/common/paths","path","vs/base/common/async","fs"],function(n,r,t,e,i,u,o,c){"use strict";function f(n){return n===u.dirname(n)}function l(n){return o.nfcall(e.readdir,n)}function s(n){return new t.Promise(function(r){return c.exists(n,r)})}function a(n,r){return o.nfcall(c.chmod,n,r)}function m(n,r){var e=function(){return o.nfcall(c.mkdir,n,r).then(null,function(r){return"EEXIST"===r.code?o.nfcall(c.stat,n).then(function(r){return r.isDirectory?null:t.Promise.wrapError(new Error("'"+n+"' exists and is not a directory."))}):t.TPromise.wrapError(r)})};return f(n)?t.TPromise.as(!0):e().then(null,function(i){return"ENOENT"===i.code?m(u.dirname(n),r).then(e):t.TPromise.wrapError(i)})}function d(n){return E(n).then(function(r){return r.isDirectory()&&!r.isSymbolicLink()?l(n).then(function(r){return t.TPromise.join(r.map(function(r){return d(u.join(n,r))}))}).then(function(){return P(n)}):k(n)},function(n){if("ENOENT"!==n.code)return t.TPromise.wrapError(n)})}function h(n){return o.nfcall(c.realpath,n,null)}function p(n){return o.nfcall(c.stat,n)}function E(n){return o.nfcall(c.lstat,n)}function T(n){return y(n.slice(0))}function w(n,r){return o.nfcall(c.rename,n,r)}function P(n){return o.nfcall(c.rmdir,n)}function k(n){return o.nfcall(c.unlink,n)}function v(n,r,t){return o.nfcall(c.symlink,n,r,t)}function x(n){return o.nfcall(c.readlink,n)}function y(n){var r=n.shift();return p(r).then(function(n){return{path:r,stats:n}},function(r){return 0===n.length?r:T(n)})}function j(n,r){return o.nfcall(c.readFile,n,r)}function b(n,r,t){return void 0===t&&(t="utf8"),o.nfcall(c.writeFile,n,r,t)}function F(n){return l(n).then(function(r){return t.TPromise.join(r.map(function(r){return D(i.join(n,r),r)})).then(function(n){return S(n)})})}function D(n,r){return N(n).then(function(n){return n?r:null})}function N(n){return p(n).then(function(n){return n.isDirectory()},function(){return!1})}function I(n){return p(n).then(function(n){return n.isFile()},function(){return!1})}function O(n,r){return l(n).then(function(e){e=e.filter(function(n){return r.test(n)});var u=e.map(function(r){return R(i.join(n,r),r)});return t.TPromise.join(u).then(function(n){return S(n)})})}function R(n,r){return I(n).then(function(n){return n?r:null},function(n){return t.TPromise.wrapError(n)})}function S(n){return n.filter(function(n){return null!==n})}r.isRoot=f,r.readdir=l,r.exists=s,r.chmod=a,r.mkdirp=m,r.rimraf=d,r.realpath=h,r.stat=p,r.lstat=E,r.mstat=T,r.rename=w,r.rmdir=P,r.unlink=k,r.symlink=v,r.readlink=x,r.readFile=j,r.writeFile=b,r.readDirsInDir=F,r.dirExists=N,r.fileExists=I,r.readFiles=O,r.fileExistsWithResult=R});