/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/winjs.base","vs/base/common/types","https","http","url","fs","vs/base/common/objects","zlib"],function(e,t,r,n,s,o,a,u,i,c){"use strict";function d(e){var t;return new r.TPromise(function(r,u){var f=a.parse(e.url),p={hostname:f.hostname,port:f.port?parseInt(f.port):"https:"===f.protocol?443:80,path:f.path,method:e.type||"GET",headers:e.headers,agent:e.agent,rejectUnauthorized:!n.isBoolean(e.strictSSL)||e.strictSSL};e.user&&e.password&&(p.auth=e.user+":"+e.password);var l="https:"===f.protocol?s:o;t=l.request(p,function(n){if(n.statusCode>=300&&n.statusCode<400&&e.followRedirects&&e.followRedirects>0&&n.headers.location)r(d(i.assign({},e,{url:n.headers.location,followRedirects:e.followRedirects-1})));else{var s=n;"gzip"===n.headers["content-encoding"]&&(s=s.pipe(c.createGunzip())),r({req:t,res:n,stream:s})}}),t.on("error",u),e.timeout&&t.setTimeout(e.timeout),e.data&&t.write(e.data),t.end()},function(){return t&&t.abort()})}function f(e,t){return d(i.assign(t,{followRedirects:3})).then(function(t){return new r.TPromise(function(r,n){var s=u.createWriteStream(e);s.once("finish",function(){return r(null)}),t.stream.once("error",n),t.stream.pipe(s)})})}function p(e){return d(e).then(function(e){return new r.Promise(function(t,r){if(!(e.res.statusCode>=200&&e.res.statusCode<300||1223===e.res.statusCode))return r("Server returned "+e.res.statusCode);if(204===e.res.statusCode)return t(null);var n=[];e.stream.on("data",function(e){return n.push(e)}),e.stream.on("end",function(){return t(n.join(""))}),e.stream.on("error",r)})})}function l(e){return d(e).then(function(e){return new r.Promise(function(t,r){if(!(e.res.statusCode>=200&&e.res.statusCode<300||1223===e.res.statusCode))return r("Server returned "+e.res.statusCode);if(204===e.res.statusCode)return t(null);if(!/application\/json/.test(e.res.headers["content-type"]))return r("Response doesn't appear to be JSON");var n=[];e.stream.on("data",function(e){return n.push(e)}),e.stream.on("end",function(){return t(JSON.parse(n.join("")))}),e.stream.on("error",r)})})}t.request=d,t.download=f,t.text=p,t.json=l});