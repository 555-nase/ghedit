define(["require","exports","vs/base/common/flags","vs/base/common/lifecycle","vs/base/common/worker/workerClient","vs/base/browser/dom"],function(e,r,t,s,i,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function n(r,t){return e.toUrl("./"+r)}var a=t.getCrossOriginWorkerScriptUrl||n,f=function(){function e(e,r,t,s,i){this.id=r,this.worker=new Worker(a("workerMain.js",t)),this.postMessage(e),this.worker.onmessage=function(e){s(e.data)},"function"==typeof this.worker.addEventListener&&this.worker.addEventListener("error",i)}return e.prototype.getId=function(){return this.id},e.prototype.postMessage=function(e){this.worker.postMessage(e)},e.prototype.dispose=function(){this.worker.terminate(),this.worker=null},e}(),h=function(){function r(r,t,s){var i=this;this.id=t,this._listeners=[],this.loaded=!1,this.beforeLoadMessages=[],this.postMessage(r),this.iframe=document.createElement("iframe"),this.iframe.id=this.iframeId(),this.iframe.src=e.toUrl("./workerMainCompatibility.html"),this.iframe.frameborder=this.iframe.height=this.iframe.width="0",this.iframe.style.display="none",this._listeners.push(o.addDisposableListener(this.iframe,"load",function(){return i.onLoaded()})),this.onMessage=function(e){s(e.data)},this._listeners.push(o.addDisposableListener(window,"message",this.onMessage)),document.body.appendChild(this.iframe)}return r.prototype.dispose=function(){this._listeners=s.dispose(this._listeners),window.removeEventListener("message",this.onMessage),window.frames[this.iframeId()].close()},r.prototype.iframeId=function(){return"worker_iframe_"+this.id},r.prototype.onLoaded=function(){for(this.loaded=!0;this.beforeLoadMessages.length>0;)this.postMessage(this.beforeLoadMessages.shift())},r.prototype.getId=function(){return this.id},r.prototype.postMessage=function(e){if(this.loaded===!0){var r=window.frames[this.iframeId()];r.postMessage?r.postMessage(e,"*"):r.contentWindow.postMessage(e,"*")}else this.beforeLoadMessages.push(e)},r}(),d=function(){function e(e){this._fallbackToIframe=e,this._webWorkerFailedBeforeError=!1}return e.prototype.create=function(r,t,s){var o=this,n=++e.LAST_WORKER_ID;if(this._fallbackToIframe){if(this._webWorkerFailedBeforeError)return new h(r,n,t);try{return new f(r,n,"service"+n,t,function(e){i.logOnceWebWorkerWarning(e),o._webWorkerFailedBeforeError=e,s(e)})}catch(a){return i.logOnceWebWorkerWarning(a),new h(r,n,t)}}if(this._webWorkerFailedBeforeError)throw this._webWorkerFailedBeforeError;return new f(r,n,"service"+n,t,function(e){i.logOnceWebWorkerWarning(e),o._webWorkerFailedBeforeError=e,s(e)})},e.LAST_WORKER_ID=0,e}();r.DefaultWorkerFactory=d});