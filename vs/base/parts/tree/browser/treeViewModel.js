/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var h in e)e.hasOwnProperty(h)&&(t[h]=e[h]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};define(["require","exports","vs/base/common/eventEmitter","vs/base/common/iterator"],function(t,e,i,h){"use strict";var n=function(t){function e(){t.call(this),this.heightMap=[],this.indexes={}}return __extends(e,t),e.prototype.getTotalHeight=function(){var t=this.heightMap[this.heightMap.length-1];return t?t.top+t.height:0},e.prototype.onInsertItems=function(t,e){void 0===e&&(e=null);var i,h,n,o,r,s=0;if(null===e)n=0,r=0;else{if(n=this.indexes[e]+1,h=this.heightMap[n-1],!h)return void console.error("view item doesnt exist");r=h.top+h.height}for(var p=this.heightMap.splice.bind(this.heightMap,n,0),a=[];i=t.next();)h=this.createViewItem(i),h.top=r+s,this.emit("viewItem:create",{item:h.model}),this.indexes[i.id]=n++,a.push(h),s+=h.height;for(p.apply(this.heightMap,a),o=n;o<this.heightMap.length;o++)h=this.heightMap[o],h.top+=s,this.indexes[h.model.id]=o;for(o=a.length-1;o>=0;o--)this.onInsertItem(a[o]);for(o=this.heightMap.length-1;o>=n;o--)this.onRefreshItem(this.heightMap[o]);return s},e.prototype.onInsertItem=function(t){},e.prototype.onRemoveItems=function(t){for(var e,i,h,n=null,o=0;e=t.next();){if(h=this.indexes[e],i=this.heightMap[h],!i)return void console.error("view item doesnt exist");o-=i.height,delete this.indexes[e],this.onRemoveItem(i),null===n&&(n=h)}if(0!==o)for(this.heightMap.splice(n,h-n+1),h=n;h<this.heightMap.length;h++)i=this.heightMap[h],i.top+=o,this.indexes[i.model.id]=h,this.onRefreshItem(i)},e.prototype.onRemoveItem=function(t){},e.prototype.onRefreshItemSet=function(t){var e=this,i=t.sort(function(t,i){return e.indexes[t.id]-e.indexes[i.id]});this.onRefreshItems(new h.ArrayIterator(i))},e.prototype.onRefreshItems=function(t){for(var e,i,h,n,o=null,r=0;e=t.next();){for(n=this.indexes[e.id];0!==r&&null!==o&&o<n;o++)i=this.heightMap[o],i.top+=r,this.onRefreshItem(i);i=this.heightMap[n],h=e.getHeight(),i.top+=r,r+=h-i.height,i.height=h,this.onRefreshItem(i,!0),o=n+1}if(0!==r&&null!==o)for(;o<this.heightMap.length;o++)i=this.heightMap[o],i.top+=r,this.onRefreshItem(i)},e.prototype.onRefreshItem=function(t,e){void 0===e&&(e=!1)},e.prototype.itemsCount=function(){return this.heightMap.length},e.prototype.itemAt=function(t){return this.heightMap[this.indexAt(t)].model.id},e.prototype.withItemsInRange=function(t,e,i){t=this.indexAt(t),e=this.indexAt(e);for(var h=t;h<=e;h++)i(this.heightMap[h].model.id)},e.prototype.indexAt=function(t){for(var e,i,h=0,n=this.heightMap.length;h<n;)if(e=Math.floor((h+n)/2),i=this.heightMap[e],t<i.top)n=e;else{if(!(t>=i.top+i.height))return e;if(h===e)break;h=e}return this.heightMap.length},e.prototype.indexAfter=function(t){return Math.min(this.indexAt(t)+1,this.heightMap.length)},e.prototype.itemAtIndex=function(t){return this.heightMap[t]},e.prototype.itemAfter=function(t){return this.heightMap[this.indexes[t.model.id]+1]||null},e.prototype.createViewItem=function(t){throw new Error("not implemented")},e.prototype.dispose=function(){this.heightMap=null,this.indexes=null},e}(i.EventEmitter);e.HeightMap=n});