var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define(["require","exports","vs/base/common/platform","vs/base/browser/browser","vs/base/common/winjs.base","vs/base/common/lifecycle","vs/base/browser/dom","vs/base/common/diff/diff","vs/base/browser/touch","vs/base/common/strings","vs/base/browser/mouseEvent","vs/base/browser/keyboardEvent","./treeDnd","vs/base/common/iterator","vs/base/browser/ui/scrollbar/scrollableElement","vs/base/common/scrollable","vs/base/parts/tree/browser/treeViewModel","vs/base/parts/tree/browser/tree","vs/base/common/keyCodes"],function(e,t,r,o,i,n,s,a,l,h,d,p,c,u,m,g,f,v,D){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function w(e){var t=e.getAttribute("last-scroll-time");return t?parseInt(t,10):0}function b(e){try{e.parentElement.removeChild(e)}catch(t){}}function y(e,t){return!e&&!t||!(!e||!t)&&(e.accept===t.accept&&(e.bubble===t.bubble&&e.effect===t.effect))}var T=function(){function e(e){this.context=e,this._cache={"":[]},this.scrollingRow=null}return e.prototype.alloc=function(e){var t=this.cache(e).pop();if(!t){var r=document.createElement("div");r.className="content";var o=document.createElement("div");o.appendChild(r),t={element:o,templateId:e,templateData:this.context.renderer.renderTemplate(this.context.tree,e,r)}}return t},e.prototype.release=function(e,t){var r=w(t.element);if(!r)return b(t.element),void this.cache(e).push(t);if(this.scrollingRow){var o=w(this.scrollingRow.element);if(o>r)return b(t.element),void this.cache(e).push(t);this.scrollingRow.element.parentElement&&(b(this.scrollingRow.element),s.removeClass(this.scrollingRow.element,"scrolling"),this.cache(this.scrollingRow.templateId).push(this.scrollingRow))}this.scrollingRow=t,s.addClass(this.scrollingRow.element,"scrolling")},e.prototype.cache=function(e){return this._cache[e]||(this._cache[e]=[])},e.prototype.garbageCollect=function(){var e=this;this._cache&&Object.keys(this._cache).forEach(function(t){e._cache[t].forEach(function(r){e.context.renderer.disposeTemplate(e.context.tree,t,r.templateData),r.element=null,r.templateData=null}),delete e._cache[t]}),this.scrollingRow&&(this.context.renderer.disposeTemplate(this.context.tree,this.scrollingRow.templateId,this.scrollingRow.templateData),this.scrollingRow=null)},e.prototype.dispose=function(){this.garbageCollect(),this._cache=null,this.context=null},e}();t.RowCache=T;var I=function(){function e(e,t){var r=this;this.context=e,this.model=t,this.id=this.model.id,this.row=null,this.top=0,this.height=t.getHeight(),this._styles={},t.getAllTraits().forEach(function(e){return r._styles[e]=!0}),t.isExpanded()&&this.addClass("expanded")}return Object.defineProperty(e.prototype,"expanded",{set:function(e){e?this.addClass("expanded"):this.removeClass("expanded")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{set:function(e){e?this.addClass("loading"):this.removeClass("loading")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"draggable",{get:function(){return this._draggable},set:function(e){this._draggable=e,this.render(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropTarget",{set:function(e){e?this.addClass("drop-target"):this.removeClass("drop-target")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.row&&this.row.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templateId",{get:function(){return this._templateId||(this._templateId=this.context.renderer.getTemplateId&&this.context.renderer.getTemplateId(this.context.tree,this.model.getElement()))},enumerable:!0,configurable:!0}),e.prototype.addClass=function(e){this._styles[e]=!0,this.render(!0)},e.prototype.removeClass=function(e){delete this._styles[e],this.render(!0)},e.prototype.render=function(e){var t=this;if(void 0===e&&(e=!1),this.model&&this.element){var r=["monaco-tree-row"];if(r.push.apply(r,Object.keys(this._styles)),this.model.hasChildren()&&r.push("has-children"),this.element.className=r.join(" "),this.element.draggable=this.draggable,this.element.style.height=this.height+"px",this.element.setAttribute("role","treeitem"),this.model.hasTrait("focused")){var o=h.safeBtoa(this.model.id),i=this.context.accessibilityProvider.getAriaLabel(this.context.tree,this.model.getElement());this.element.setAttribute("aria-selected","true"),this.element.setAttribute("id",o),i?this.element.setAttribute("aria-label",i):this.element.setAttribute("aria-labelledby",o)}else this.element.setAttribute("aria-selected","false"),this.element.removeAttribute("id"),this.element.removeAttribute("aria-label"),this.element.removeAttribute("aria-labelledby");this.model.hasChildren()?this.element.setAttribute("aria-expanded",String(this.model.isExpanded())):this.element.removeAttribute("aria-expanded"),this.element.setAttribute("aria-level",String(this.model.getDepth())),this.context.options.paddingOnRow?this.element.style.paddingLeft=this.context.options.twistiePixels+(this.model.getDepth()-1)*this.context.options.indentPixels+"px":(this.element.style.paddingLeft=(this.model.getDepth()-1)*this.context.options.indentPixels+"px",this.row.element.firstElementChild.style.paddingLeft=this.context.options.twistiePixels+"px");var n=this.context.dnd.getDragURI(this.context.tree,this.model.getElement());n!==this.uri&&(this.unbindDragStart&&(this.unbindDragStart.dispose(),this.unbindDragStart=null),n?(this.uri=n,this.draggable=!0,this.unbindDragStart=s.addDisposableListener(this.element,"dragstart",function(e){t.onDragStart(e)})):this.uri=null),e||this.context.renderer.renderElement(this.context.tree,this.model.getElement(),this.templateId,this.row.templateData)}},e.prototype.insertInDOM=function(e,t){if(this.row||(this.row=this.context.cache.alloc(this.templateId),this.element[A.BINDING]=this),!this.element.parentElement){if(null===t)e.appendChild(this.element);else try{e.insertBefore(this.element,t)}catch(r){console.warn("Failed to locate previous tree element"),e.appendChild(this.element)}this.render()}},e.prototype.removeFromDOM=function(){this.row&&(this.unbindDragStart&&(this.unbindDragStart.dispose(),this.unbindDragStart=null),this.uri=null,this.element[A.BINDING]=null,this.context.cache.release(this.templateId,this.row),this.row=null)},e.prototype.dispose=function(){this.row=null,this.model=null},e}();t.ViewItem=I;var x=function(e){function t(t,r,o){e.call(this,t,r),this.row={element:o,templateData:null,templateId:null}}return __extends(t,e),t.prototype.render=function(){if(this.model&&this.element){var e=["monaco-tree-wrapper"];e.push.apply(e,Object.keys(this._styles)),this.model.hasChildren()&&e.push("has-children"),this.element.className=e.join(" ")}},t.prototype.insertInDOM=function(e,t){},t.prototype.removeFromDOM=function(){},t}(I),A=function(e){function t(t,r){var i=this;e.call(this),this.lastClickTimeStamp=0,this.isRefreshing=!1,this.refreshingPreviousChildrenIds={},this.context={dataSource:t.dataSource,renderer:t.renderer,controller:t.controller,dnd:t.dnd,filter:t.filter,sorter:t.sorter,tree:t.tree,accessibilityProvider:t.accessibilityProvider,options:t.options,cache:new T(t)},this.modelListeners=[],this.viewListeners=[],this.dragAndDropListeners=[],this.model=null,this.items={},this.domNode=document.createElement("div"),this.domNode.className="monaco-tree no-focused-item",this.domNode.tabIndex=0,this.domNode.setAttribute("role","tree"),this.context.options.ariaLabel&&this.domNode.setAttribute("aria-label",this.context.options.ariaLabel),this.context.options.alwaysFocused&&s.addClass(this.domNode,"focused"),this.context.options.bare&&s.addClass(this.domNode,"bare"),this.context.options.paddingOnRow||s.addClass(this.domNode,"no-row-padding"),this.wrapper=document.createElement("div"),this.wrapper.className="monaco-tree-wrapper",this.scrollableElement=new m.ScrollableElement(this.wrapper,{canUseTranslate3d:!1,horizontal:g.ScrollbarVisibility.Hidden,vertical:"undefined"!=typeof t.options.verticalScrollMode?t.options.verticalScrollMode:g.ScrollbarVisibility.Auto,useShadows:t.options.useShadows,saveLastScrollTimeOnClassName:"monaco-tree-row"}),this.scrollableElement.onScroll(function(e){i.render(e.scrollTop,e.height),i.emit("scroll",e)}),o.isIE11orEarlier?(this.wrapper.style.msTouchAction="none",this.wrapper.style.msContentZooming="none"):this.wrapperGesture=new l.Gesture(this.wrapper),this.rowsContainer=document.createElement("div"),this.rowsContainer.className="monaco-tree-rows";var n=s.trackFocus(this.domNode);n.addFocusListener(function(){return i.onFocus()}),n.addBlurListener(function(){return i.onBlur()}),this.viewListeners.push(n),this.viewListeners.push(s.addDisposableListener(this.domNode,"keydown",function(e){return i.onKeyDown(e)})),this.viewListeners.push(s.addDisposableListener(this.domNode,"keyup",function(e){return i.onKeyUp(e)})),this.viewListeners.push(s.addDisposableListener(this.domNode,"mousedown",function(e){return i.onMouseDown(e)})),this.viewListeners.push(s.addDisposableListener(this.domNode,"mouseup",function(e){return i.onMouseUp(e)})),this.viewListeners.push(s.addDisposableListener(this.wrapper,"click",function(e){return i.onClick(e)})),this.viewListeners.push(s.addDisposableListener(this.domNode,"contextmenu",function(e){return i.onContextMenu(e)})),this.viewListeners.push(s.addDisposableListener(this.wrapper,l.EventType.Tap,function(e){return i.onTap(e)})),this.viewListeners.push(s.addDisposableListener(this.wrapper,l.EventType.Change,function(e){return i.onTouchChange(e)})),o.isIE11orEarlier&&(this.viewListeners.push(s.addDisposableListener(this.wrapper,"MSPointerDown",function(e){return i.onMsPointerDown(e)})),this.viewListeners.push(s.addDisposableListener(this.wrapper,"MSGestureTap",function(e){return i.onMsGestureTap(e)})),this.viewListeners.push(s.addDisposableThrottledListener(this.wrapper,"MSGestureChange",function(e){return i.onThrottledMsGestureChange(e)},function(e,t){t.stopPropagation(),t.preventDefault();var r={translationY:t.translationY,translationX:t.translationX};return e&&(r.translationY+=e.translationY,r.translationX+=e.translationX),r}))),this.viewListeners.push(s.addDisposableListener(window,"dragover",function(e){return i.onDragOver(e)})),this.viewListeners.push(s.addDisposableListener(window,"drop",function(e){return i.onDrop(e)})),this.viewListeners.push(s.addDisposableListener(window,"dragend",function(e){return i.onDragEnd(e)})),this.viewListeners.push(s.addDisposableListener(window,"dragleave",function(e){return i.onDragOver(e)})),this.wrapper.appendChild(this.rowsContainer),this.domNode.appendChild(this.scrollableElement.getDomNode()),r.appendChild(this.domNode),this.lastRenderTop=0,this.lastRenderHeight=0,this.didJustPressContextMenuKey=!1,this.currentDropTarget=null,this.currentDropTargets=[],this.shouldInvalidateDropReaction=!1,this.dragAndDropScrollInterval=null,this.dragAndDropScrollTimeout=null,this.onHiddenScrollTop=null,this.onRowsChanged(),this.layout(),this.setupMSGesture()}return __extends(t,e),t.prototype.createViewItem=function(e){return new I(this.context,e)},t.prototype.getHTMLElement=function(){return this.domNode},t.prototype.focus=function(){this.domNode.focus()},t.prototype.isFocused=function(){return document.activeElement===this.domNode},t.prototype.blur=function(){this.domNode.blur()},t.prototype.onVisible=function(){this.scrollTop=this.onHiddenScrollTop,this.onHiddenScrollTop=null,this.setupMSGesture()},t.prototype.setupMSGesture=function(){var e=this;window.MSGesture&&(this.msGesture=new MSGesture,setTimeout(function(){return e.msGesture.target=e.wrapper},100))},t.prototype.onHidden=function(){this.onHiddenScrollTop=this.scrollTop},t.prototype.isTreeVisible=function(){return null===this.onHiddenScrollTop},t.prototype.layout=function(e){this.isTreeVisible()&&(this.viewHeight=e||s.getContentHeight(this.wrapper))},t.prototype.render=function(e,t){var r,o,i=e,n=e+t,s=this.lastRenderTop+this.lastRenderHeight;for(r=this.indexAfter(n)-1,o=this.indexAt(Math.max(s,i));r>=o;r--)this.insertItemInDOM(this.itemAtIndex(r));for(r=Math.min(this.indexAt(this.lastRenderTop),this.indexAfter(n))-1,o=this.indexAt(i);r>=o;r--)this.insertItemInDOM(this.itemAtIndex(r));for(r=this.indexAt(this.lastRenderTop),o=Math.min(this.indexAt(i),this.indexAfter(s));r<o;r++)this.removeItemFromDOM(this.itemAtIndex(r));for(r=Math.max(this.indexAfter(n),this.indexAt(this.lastRenderTop)),o=this.indexAfter(s);r<o;r++)this.removeItemFromDOM(this.itemAtIndex(r));var a=this.itemAtIndex(this.indexAt(i));a&&(this.rowsContainer.style.top=a.top-i+"px"),this.lastRenderTop=i,this.lastRenderHeight=n-i},t.prototype.setModel=function(e){var t=this;this.releaseModel(),this.model=e,this.modelListeners.push(this.model.addBulkListener2(function(e){return t.onModelEvents(e)}))},t.prototype.onModelEvents=function(e){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r],n=i.getData();switch(i.getType()){case"refreshing":this.onRefreshing();break;case"refreshed":this.onRefreshed();break;case"clearingInput":this.onClearingInput(n);break;case"setInput":this.onSetInput(n);break;case"item:childrenRefreshing":this.onItemChildrenRefreshing(n);break;case"item:childrenRefreshed":this.onItemChildrenRefreshed(n);break;case"item:refresh":t.push(n.item);break;case"item:expanding":this.onItemExpanding(n);break;case"item:expanded":this.onItemExpanded(n);break;case"item:collapsing":this.onItemCollapsing(n);break;case"item:reveal":this.onItemReveal(n);break;case"item:addTrait":this.onItemAddTrait(n);break;case"item:removeTrait":this.onItemRemoveTrait(n);break;case"focus":this.onModelFocusChange()}}t.length>0&&this.onItemsRefresh(t)},t.prototype.onRefreshing=function(){this.isRefreshing=!0},t.prototype.onRefreshed=function(){this.isRefreshing=!1,this.onRowsChanged()},t.prototype.onRowsChanged=function(e){void 0===e&&(e=this.scrollTop),this.isRefreshing||(this.scrollTop=e)},t.prototype.focusNextPage=function(e){var t=this,r=this.indexAt(this.scrollTop+this.viewHeight);r=0===r?0:r-1;var o=this.itemAtIndex(r).model.getElement(),i=this.model.getFocus();if(i!==o)this.model.setFocus(o,e);else{var n=this.scrollTop;this.scrollTop+=this.viewHeight,this.scrollTop!==n&&setTimeout(function(){t.focusNextPage(e)},0)}},t.prototype.focusPreviousPage=function(e){var t,r=this;t=0===this.scrollTop?this.indexAt(this.scrollTop):this.indexAfter(this.scrollTop-1);var o=this.itemAtIndex(t).model.getElement(),i=this.model.getFocus();if(i!==o)this.model.setFocus(o,e);else{var n=this.scrollTop;this.scrollTop-=this.viewHeight,this.scrollTop!==n&&setTimeout(function(){r.focusPreviousPage(e)},0)}},Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this.scrollableElement.getHeight()},set:function(e){this.scrollableElement.updateState({height:e,scrollHeight:this.getTotalHeight()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this.scrollableElement.getScrollTop()},set:function(e){this.scrollableElement.updateState({scrollTop:e,scrollHeight:this.getTotalHeight()})},enumerable:!0,configurable:!0}),t.prototype.getScrollPosition=function(){var e=this.getTotalHeight()-this.viewHeight;return e<=0?0:this.scrollTop/e},t.prototype.setScrollPosition=function(e){var t=this.getTotalHeight()-this.viewHeight;this.scrollTop=t*e},t.prototype.onClearingInput=function(e){var t=e.item;t&&(this.onRemoveItems(new u.MappedIterator(t.getNavigator(),function(e){return e&&e.id})),this.onRowsChanged())},t.prototype.onSetInput=function(e){this.context.cache.garbageCollect(),this.inputItem=new x(this.context,e.item,this.wrapper),this.emit("viewItem:create",{item:this.inputItem.model})},t.prototype.onItemChildrenRefreshing=function(e){var r=e.item,o=this.items[r.id];if(o&&(o.loadingPromise=i.TPromise.timeout(t.LOADING_DECORATION_DELAY).then(function(){o.loadingPromise=null,o.loading=!0})),!e.isNested){for(var n,s=[],a=r.getNavigator();n=a.next();)s.push(n.id);this.refreshingPreviousChildrenIds[r.id]=s}},t.prototype.onItemChildrenRefreshed=function(e){var t=this,r=e.item,o=this.items[r.id];if(o&&(o.loadingPromise&&(o.loadingPromise.cancel(),o.loadingPromise=null),o.loading=!1),!e.isNested){for(var i,n=this.refreshingPreviousChildrenIds[r.id],s=[],l=r.getNavigator();i=l.next();)s.push(i);var h=Math.abs(n.length-s.length)>1e3,d=void 0,p=void 0;if(!h){var c=new a.LcsDiff({getLength:function(){return n.length},getElementHash:function(e){return n[e]}},{getLength:function(){return s.length},getElementHash:function(e){return s[e].id}},null);d=c.ComputeDiff(),p=d.some(function(e){if(e.modifiedLength>0)for(var r=e.modifiedStart,o=e.modifiedStart+e.modifiedLength;r<o;r++)if(t.items.hasOwnProperty(s[r].id))return!0;return!1})}if(!h&&!p&&d.length<50)for(var m=0,g=d.length;m<g;m++){var f=d[m];if(f.originalLength>0&&this.onRemoveItems(new u.ArrayIterator(n,f.originalStart,f.originalStart+f.originalLength)),f.modifiedLength>0){var v=s[f.modifiedStart-1]||r;v=v.getDepth()>0?v:null,this.onInsertItems(new u.ArrayIterator(s,f.modifiedStart,f.modifiedStart+f.modifiedLength),v?v.id:null)}}else(h||d.length)&&(this.onRemoveItems(new u.ArrayIterator(n)),this.onInsertItems(new u.ArrayIterator(s)));(h||d.length)&&this.onRowsChanged()}},t.prototype.onItemsRefresh=function(e){var t=this;this.onRefreshItemSet(e.filter(function(e){return t.items.hasOwnProperty(e.id)})),this.onRowsChanged()},t.prototype.onItemExpanding=function(e){var t=this.items[e.item.id];t&&(t.expanded=!0)},t.prototype.onItemExpanded=function(e){var t=e.item,r=this.items[t.id];if(r){r.expanded=!0;var o=this.onInsertItems(t.getNavigator(),t.id),i=this.scrollTop;r.top+r.height<=this.scrollTop&&(i+=o),this.onRowsChanged(i)}},t.prototype.onItemCollapsing=function(e){var t=e.item,r=this.items[t.id];r&&(r.expanded=!1,this.onRemoveItems(new u.MappedIterator(t.getNavigator(),function(e){return e&&e.id})),this.onRowsChanged())},t.prototype.getRelativeTop=function(e){if(e&&e.isVisible()){var t=this.items[e.id];if(t)return(t.top-this.scrollTop)/(this.viewHeight-t.height)}return-1},t.prototype.onItemReveal=function(e){var t=e.item,r=e.relativeTop,o=this.items[t.id];if(o)if(null!==r){r=r<0?0:r,r=r>1?1:r;var i=o.height-this.viewHeight;this.scrollTop=i*r+o.top}else{var n=o.top+o.height,s=this.scrollTop+this.viewHeight;o.top<this.scrollTop?this.scrollTop=o.top:n>=s&&(this.scrollTop=n-this.viewHeight)}},t.prototype.onItemAddTrait=function(e){var t=e.item,r=e.trait,o=this.items[t.id];o&&o.addClass(r),"highlighted"===r&&(s.addClass(this.domNode,r),o&&(this.highlightedItemWasDraggable=!!o.draggable,o.draggable&&(o.draggable=!1)))},t.prototype.onItemRemoveTrait=function(e){var t=e.item,r=e.trait,o=this.items[t.id];o&&o.removeClass(r),"highlighted"===r&&(s.removeClass(this.domNode,r),this.highlightedItemWasDraggable&&(o.draggable=!0),this.highlightedItemWasDraggable=!1)},t.prototype.onModelFocusChange=function(){var e=this.model&&this.model.getFocus();s.toggleClass(this.domNode,"no-focused-item",!e),e?this.domNode.setAttribute("aria-activedescendant",h.safeBtoa(this.context.dataSource.getId(this.context.tree,e))):this.domNode.removeAttribute("aria-activedescendant")},t.prototype.onInsertItem=function(e){var t=this;e.onDragStart=function(r){t.onDragStart(e,r)},e.needsRender=!0,this.refreshViewItem(e),this.items[e.id]=e},t.prototype.onRefreshItem=function(e,t){void 0===t&&(t=!1),e.needsRender=e.needsRender||t,this.refreshViewItem(e)},t.prototype.onRemoveItem=function(e){this.removeItemFromDOM(e),e.dispose(),this.emit("viewItem:dispose",{item:this.inputItem.model}),delete this.items[e.id]},t.prototype.refreshViewItem=function(e){e.render(),this.shouldBeRendered(e)?this.insertItemInDOM(e):this.removeItemFromDOM(e)},t.prototype.onClick=function(e){if(!this.lastPointerType||"mouse"===this.lastPointerType){var t=new d.StandardMouseEvent(e),r=this.getItemAround(t.target);r&&(o.isIE10orLater&&Date.now()-this.lastClickTimeStamp<300&&(t.detail=2),this.lastClickTimeStamp=Date.now(),this.context.controller.onClick(this.context.tree,r.model.getElement(),t))}},t.prototype.onMouseDown=function(e){if(this.didJustPressContextMenuKey=!1,this.context.controller.onMouseDown&&(!this.lastPointerType||"mouse"===this.lastPointerType)){var t=new d.StandardMouseEvent(e);if(!(t.ctrlKey&&r.isNative&&r.isMacintosh)){var o=this.getItemAround(t.target);o&&this.context.controller.onMouseDown(this.context.tree,o.model.getElement(),t)}}},t.prototype.onMouseUp=function(e){if(this.context.controller.onMouseUp&&(!this.lastPointerType||"mouse"===this.lastPointerType)){var t=new d.StandardMouseEvent(e);if(!(t.ctrlKey&&r.isNative&&r.isMacintosh)){var o=this.getItemAround(t.target);o&&this.context.controller.onMouseUp(this.context.tree,o.model.getElement(),t)}}},t.prototype.onTap=function(e){var t=this.getItemAround(e.initialTarget);t&&this.context.controller.onTap(this.context.tree,t.model.getElement(),e)},t.prototype.onTouchChange=function(e){e.preventDefault(),e.stopPropagation(),this.scrollTop-=e.translationY},t.prototype.onContextMenu=function(e){var t,r;if(e instanceof KeyboardEvent||this.didJustPressContextMenuKey){this.didJustPressContextMenuKey=!1;var o=new p.StandardKeyboardEvent(e);if(r=this.model.getFocus(),!r)return;var i=this.context.dataSource.getId(this.context.tree,r),n=this.items[i],a=s.getDomNodePagePosition(n.element);t=new v.KeyboardContextMenuEvent(a.left+a.width,a.top,o)}else{var l=new d.StandardMouseEvent(e),h=this.getItemAround(l.target);if(!h)return;r=h.model.getElement(),t=new v.MouseContextMenuEvent(l)}this.context.controller.onContextMenu(this.context.tree,r,t)},t.prototype.onKeyDown=function(e){var t=new p.StandardKeyboardEvent(e);this.didJustPressContextMenuKey=t.keyCode===D.KeyCode.ContextMenu||t.shiftKey&&t.keyCode===D.KeyCode.F10,this.didJustPressContextMenuKey&&(t.preventDefault(),t.stopPropagation()),t.target&&t.target.tagName&&"input"===t.target.tagName.toLowerCase()||this.context.controller.onKeyDown(this.context.tree,t)},t.prototype.onKeyUp=function(e){this.didJustPressContextMenuKey&&this.onContextMenu(e),this.didJustPressContextMenuKey=!1,this.context.controller.onKeyUp(this.context.tree,new p.StandardKeyboardEvent(e))},t.prototype.onDragStart=function(e,r){if(!this.model.getHighlight()){var o,i=e.model.getElement(),n=this.model.getSelection();if(o=n.indexOf(i)>-1?n:[i],r.dataTransfer.effectAllowed="copyMove",r.dataTransfer.setData("URL",e.uri),r.dataTransfer.setDragImage)if(1===o.length&&e.element)r.dataTransfer.setDragImage(e.element,r.offsetX||6,r.offsetY||6);else if(o.length>1){var s=document.createElement("div");s.className="monaco-tree-drag-image",s.textContent=""+o.length,document.body.appendChild(s),r.dataTransfer.setDragImage(s,-10,-10),setTimeout(function(){return document.body.removeChild(s)},0)}this.currentDragAndDropData=new c.ElementsDragAndDropData(o),t.currentExternalDragAndDropData=new c.ExternalElementsDragAndDropData(o),this.context.dnd.onDragStart(this.context.tree,this.currentDragAndDropData,new d.DragMouseEvent(r))}},t.prototype.setupDragAndDropScrollInterval=function(){var e=this,t=s.getTopLeftOffset(this.wrapper).top;this.dragAndDropScrollInterval||(this.dragAndDropScrollInterval=window.setInterval(function(){if(void 0!==e.dragAndDropMouseY){var r=e.dragAndDropMouseY-t,o=0,i=e.viewHeight-35;r<35?o=Math.max(-14,.2*(r-35)):r>i&&(o=Math.min(14,.2*(r-i))),e.scrollTop+=o}},10),this.cancelDragAndDropScrollTimeout(),this.dragAndDropScrollTimeout=window.setTimeout(function(){e.cancelDragAndDropScrollInterval(),e.dragAndDropScrollTimeout=null},1e3))},t.prototype.cancelDragAndDropScrollInterval=function(){this.dragAndDropScrollInterval&&(window.clearInterval(this.dragAndDropScrollInterval),this.dragAndDropScrollInterval=null),this.cancelDragAndDropScrollTimeout()},t.prototype.cancelDragAndDropScrollTimeout=function(){this.dragAndDropScrollTimeout&&(window.clearTimeout(this.dragAndDropScrollTimeout),this.dragAndDropScrollTimeout=null)},t.prototype.onDragOver=function(e){var r=this,o=new d.DragMouseEvent(e),n=this.getItemAround(o.target);if(!n)return this.currentDropTarget&&(this.currentDropTargets.forEach(function(e){return e.dropTarget=!1}),this.currentDropTargets=[],this.currentDropPromise&&(this.currentDropPromise.cancel(),this.currentDropPromise=null)),this.cancelDragAndDropScrollInterval(),this.currentDropTarget=null,this.currentDropElement=null,this.dragAndDropMouseY=null,!1;if(this.setupDragAndDropScrollInterval(),this.dragAndDropMouseY=o.posy,!this.currentDragAndDropData)if(t.currentExternalDragAndDropData)this.currentDragAndDropData=t.currentExternalDragAndDropData;else{if(!o.dataTransfer.types)return!1;this.currentDragAndDropData=new c.DesktopDragAndDropData}this.currentDragAndDropData.update(o);var s,a,l=n.model;do{if(s=l?l.getElement():this.model.getInput(),a=this.context.dnd.onDragOver(this.context.tree,this.currentDragAndDropData,s,o),!a||a.bubble!==v.DragOverBubble.BUBBLE_UP)break;l=l&&l.parent}while(l);if(!l)return this.currentDropElement=null,!1;var h=a&&a.accept;h?(this.currentDropElement=l.getElement(),o.preventDefault(),o.dataTransfer.dropEffect=a.effect===v.DragOverEffect.COPY?"copy":"move"):this.currentDropElement=null;var p=l.id===this.inputItem.id?this.inputItem:this.items[l.id];if((this.shouldInvalidateDropReaction||this.currentDropTarget!==p||!y(this.currentDropElementReaction,a))&&(this.shouldInvalidateDropReaction=!1,this.currentDropTarget&&(this.currentDropTargets.forEach(function(e){return e.dropTarget=!1}),this.currentDropTargets=[],this.currentDropPromise&&(this.currentDropPromise.cancel(),this.currentDropPromise=null)),this.currentDropTarget=p,this.currentDropElementReaction=a,h)){if(this.currentDropTarget&&(this.currentDropTarget.dropTarget=!0,this.currentDropTargets.push(this.currentDropTarget)),a.bubble===v.DragOverBubble.BUBBLE_DOWN)for(var u,m=l.getNavigator();u=m.next();)n=this.items[u.id],n&&(n.dropTarget=!0,this.currentDropTargets.push(n));this.currentDropPromise=i.TPromise.timeout(500).then(function(){return r.context.tree.expand(r.currentDropElement).then(function(){r.shouldInvalidateDropReaction=!0})})}return!0},t.prototype.onDrop=function(e){if(this.currentDropElement){var t=new d.DragMouseEvent(e);t.preventDefault(),this.currentDragAndDropData.update(t),this.context.dnd.drop(this.context.tree,this.currentDragAndDropData,this.currentDropElement,t),this.onDragEnd(e)}this.cancelDragAndDropScrollInterval()},t.prototype.onDragEnd=function(e){this.currentDropTarget&&(this.currentDropTargets.forEach(function(e){return e.dropTarget=!1}),this.currentDropTargets=[]),this.currentDropPromise&&(this.currentDropPromise.cancel(),this.currentDropPromise=null),this.cancelDragAndDropScrollInterval(),this.currentDragAndDropData=null,t.currentExternalDragAndDropData=null,this.currentDropElement=null,this.currentDropTarget=null,this.dragAndDropMouseY=null},t.prototype.onFocus=function(){this.context.options.alwaysFocused||s.addClass(this.domNode,"focused")},t.prototype.onBlur=function(){this.context.options.alwaysFocused||s.removeClass(this.domNode,"focused"),this.domNode.removeAttribute("aria-activedescendant")},t.prototype.onMsPointerDown=function(e){if(this.msGesture){var t=e.pointerType;return t===(e.MSPOINTER_TYPE_MOUSE||"mouse")?void(this.lastPointerType="mouse"):void(t===(e.MSPOINTER_TYPE_TOUCH||"touch")&&(this.lastPointerType="touch",e.stopPropagation(),e.preventDefault(),this.msGesture.addPointer(e.pointerId)))}},t.prototype.onThrottledMsGestureChange=function(e){this.scrollTop-=e.translationY},t.prototype.onMsGestureTap=function(e){e.initialTarget=document.elementFromPoint(e.clientX,e.clientY),this.onTap(e)},t.prototype.insertItemInDOM=function(e){var t=null,r=this.itemAfter(e);r&&r.element&&(t=r.element),e.insertInDOM(this.rowsContainer,t)},t.prototype.removeItemFromDOM=function(e){e.removeFromDOM()},t.prototype.shouldBeRendered=function(e){return e.top<this.lastRenderTop+this.lastRenderHeight&&e.top+e.height>this.lastRenderTop},t.prototype.getItemAround=function(e){var r=this.inputItem;do{if(e[t.BINDING]&&(r=e[t.BINDING]),e===this.wrapper||e===this.domNode)return r;if(e===document.body)return null}while(e=e.parentElement)},t.prototype.releaseModel=function(){this.model&&(this.modelListeners=n.dispose(this.modelListeners),this.model=null)},t.prototype.dispose=function(){this.scrollableElement.dispose(),this.releaseModel(),this.modelListeners=null,this.viewListeners=n.dispose(this.viewListeners),this.domNode.parentNode&&this.domNode.parentNode.removeChild(this.domNode),this.domNode=null,this.wrapperGesture&&(this.wrapperGesture.dispose(),this.wrapperGesture=null),this.context.cache&&(this.context.cache.dispose(),this.context.cache=null),e.prototype.dispose.call(this)},t.BINDING="monaco-tree-row",t.LOADING_DECORATION_DELAY=800,t.currentExternalDragAndDropData=null,t}(f.HeightMap);t.TreeView=A});