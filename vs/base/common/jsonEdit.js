define(["require","exports","vs/base/common/json","vs/base/common/jsonFormatter"],function(t,e,n,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function r(t,e,n){return f(t,e,void 0,n)}function f(t,e,o,r,f){for(var s=[],l=n.parseTree(t,s),h=void 0,a=void 0;e.length>0&&(a=e.pop(),h=n.findNodeAtLocation(l,e),void 0===h&&void 0!==o);)"string"==typeof a?(b={},b[a]=o,o=b):o=[o];if(h){if("object"===h.type&&"string"==typeof a){var d=n.findNodeAtLocation(h,[a]);if(void 0!==d){if(void 0===o){var c=h.children.indexOf(d.parent),g=void 0,p=d.parent.offset+d.parent.length;if(c>0){var v=h.children[c-1];g=v.offset+v.length}else if(g=h.offset+1,h.children.length>1){var y=h.children[1];p=y.offset}return i(t,{offset:g,length:p-g,content:""},r)}return[{offset:d.offset,length:d.length,content:JSON.stringify(o)}]}if(void 0===o)throw new Error("Property "+a+" does not exist.");var u=JSON.stringify(a)+": "+JSON.stringify(o),m=f?f(h.children.map(function(t){return t.children[0].value})):h.children.length,w=void 0;if(m>0){var v=h.children[m-1];w={offset:v.offset+v.length,length:0,content:","+u}}else w=0===h.children.length?{offset:h.offset+1,length:0,content:u}:{offset:h.offset+1,length:0,content:u+","};return i(t,w,r)}throw"array"===h.type&&"number"==typeof a?new Error("Array modification not supported yet"):new Error("Can not add "+("number"!=typeof a?"index":"property")+" to parent of type "+h.type)}if(void 0===o)throw new Error("Can not delete in empty document");return i(t,{offset:l?l.offset:0,length:l?l.length:0,content:JSON.stringify(o)},r);var b}function i(t,e,n){for(var r=o.applyEdit(t,e),f=e.offset,i=e.offset+e.content.length,s=o.format(r,{offset:f,length:i-f},n),l=s.length-1;l>=0;l--){var h=s[l];r=o.applyEdit(r,h),f=Math.min(f,h.offset),i=Math.max(i,h.offset+h.length),i+=h.content.length-h.length}var a=t.length-(r.length-i)-f;return[{offset:f,length:a,content:r.substring(f,i)}]}e.removeProperty=r,e.setProperty=f});