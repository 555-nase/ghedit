/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/winjs.base","vs/base/common/set","vs/base/common/types"],function(e,t,s,r,i){"use strict";function n(e){return{firstPage:e,total:e.length,pageSize:e.length,getPage:null}}function o(e,t){return{firstPage:e.firstPage.map(t),total:e.total,pageSize:e.pageSize,getPage:function(s){return e.getPage(s).then(function(e){return e.map(t)})}}}t.singlePagePager=n;var a=function(){function e(e,t){void 0===t&&(t=500),this.arg=e,this.pageTimeout=t,this.pages=[],this.pager=i.isArray(e)?n(e):e,this.pages=[{isResolved:!0,promise:null,promiseIndexes:new r.ArraySet,elements:this.pager.firstPage.slice()}];for(var s=Math.ceil(this.pager.total/this.pager.pageSize),o=0,a=s-1;o<a;o++)this.pages.push({isResolved:!1,promise:null,promiseIndexes:new r.ArraySet,elements:[]})}return Object.defineProperty(e.prototype,"length",{get:function(){return this.pager.total},enumerable:!0,configurable:!0}),e.prototype.isResolved=function(e){var t=Math.floor(e/this.pager.pageSize),s=this.pages[t];return!!s.isResolved},e.prototype.get=function(e){var t=Math.floor(e/this.pager.pageSize),s=e%this.pager.pageSize,r=this.pages[t];return r.elements[s]},e.prototype.resolve=function(e){var t=this,r=Math.floor(e/this.pager.pageSize),i=e%this.pager.pageSize,n=this.pages[r];return n.isResolved?s.TPromise.as(n.elements[i]):(n.promise||(n.promise=s.TPromise.timeout(this.pageTimeout).then(function(){return t.pager.getPage(r)}).then(function(e){n.elements=e,n.isResolved=!0,n.promise=null},function(e){return n.isResolved=!1,n.promise=null,s.TPromise.wrapError(e)})),new s.TPromise(function(t,s){n.promiseIndexes.set(e),n.promise.done(function(){return t(n.elements[i])})},function(){n.promise&&(n.promiseIndexes.unset(e),0===n.promiseIndexes.elements.length&&n.promise.cancel())}))},e}();t.PagedModel=a,t.mapPager=o});