define(["require","exports","vs/base/common/diff/diffChange"],function(t,r,e){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var s=function(){function t(t,r,e,s){this.x=t,this.y=r,this.ids_for_x=[],this.ids_for_y=[],s?this.hashFunc=s:this.hashFunc=function(t,r){return t[r]},this.resultX=[],this.resultY=[],this.forwardPrev=[],this.forwardCurr=[],this.backwardPrev=[],this.backwardCurr=[];for(var i=0,h=this.x.getLength();i<h;i++)this.resultX[i]=!1;for(var i=0,f=this.y.getLength();i<=f;i++)this.resultY[i]=!1;this.ComputeUniqueIdentifiers()}return t.prototype.ComputeUniqueIdentifiers=function(){var t=this.x.getLength(),r=this.y.getLength();this.ids_for_x=new Array(t),this.ids_for_y=new Array(r);var e,s={},i=1;for(e=0;e<t;e++){var h=this.x.getElementHash(e);s.hasOwnProperty(h)?this.ids_for_x[e]=s[h]:(this.ids_for_x[e]=i++,s[h]=this.ids_for_x[e])}for(e=0;e<r;e++){var f=this.y.getElementHash(e);s.hasOwnProperty(f)?this.ids_for_y[e]=s[f]:(this.ids_for_y[e]=i++,s[f]=this.ids_for_y[e])}},t.prototype.ElementsAreEqual=function(t,r){return this.ids_for_x[t]===this.ids_for_y[r]},t.prototype.ComputeDiff=function(){var t=this.x.getLength(),r=this.y.getLength();this.execute(0,t-1,0,r-1);for(var s,i,h=0,f=0,n=[];h<t&&f<r;)if(this.resultX[h]&&this.resultY[f])h++,f++;else{for(s=h,i=f;h<t&&!this.resultX[h];)h++;for(;f<r&&!this.resultY[f];)f++;n.push(new e.DiffChange(s,h-s,i,f-i))}return h<t&&n.push(new e.DiffChange(h,t-h,r,0)),f<r&&n.push(new e.DiffChange(t,0,f,r-f)),n},t.prototype.forward=function(t,r,e,s){var i,h,f,n=this.forwardPrev,o=this.forwardCurr;for(n[e]=this.ElementsAreEqual(t,e)?1:0,f=e+1;f<=s;f++)n[f]=this.ElementsAreEqual(t,f)?1:n[f-1];for(h=t+1;h<=r;h++){for(o[e]=this.ElementsAreEqual(h,e)?1:n[e],f=e+1;f<=s;f++)this.ElementsAreEqual(h,f)?o[f]=n[f-1]+1:o[f]=n[f]>o[f-1]?n[f]:o[f-1];i=o,o=n,n=i}return n},t.prototype.backward=function(t,r,e,s){var i,h,f,n=this.backwardPrev,o=this.backwardCurr;for(n[s]=this.ElementsAreEqual(r,s)?1:0,f=s-1;f>=e;f--)n[f]=this.ElementsAreEqual(r,f)?1:n[f+1];for(h=r-1;h>=t;h--){for(o[s]=this.ElementsAreEqual(h,s)?1:n[s],f=s-1;f>=e;f--)this.ElementsAreEqual(h,f)?o[f]=n[f+1]+1:o[f]=n[f]>o[f+1]?n[f]:o[f+1];i=o,o=n,n=i}return n},t.prototype.findCut=function(t,r,e,s,i){for(var h=this.forward(t,i,e,s),f=this.backward(i+1,r,e,s),n=f[e],o=e-1,u=e;u<s;u++)h[u]+f[u+1]>n&&(n=h[u]+f[u+1],o=u);return h[s]>n&&(n=h[s],o=s),o},t.prototype.execute=function(t,r,e,s){for(;t<=r&&e<=s&&this.ElementsAreEqual(t,e);)this.resultX[t]=!0,t++,this.resultY[e]=!0,e++;for(;t<=r&&e<=s&&this.ElementsAreEqual(r,s);)this.resultX[r]=!0,r--,this.resultY[s]=!0,s--;if(!(t>r||e>s)){var i,h;if(t===r){for(i=-1,h=e;h<=s;h++)if(this.ElementsAreEqual(t,h)){i=h;break}i>=0&&(this.resultX[t]=!0,this.resultY[i]=!0)}else if(e===s){for(i=-1,h=t;h<=r;h++)if(this.ElementsAreEqual(h,e)){i=h;break}i>=0&&(this.resultX[i]=!0,this.resultY[e]=!0)}else{var f=Math.floor((t+r)/2),n=this.findCut(t,r,e,s,f);e<=n&&this.execute(t,f,e,n),n+1<=s&&this.execute(f+1,r,n+1,s)}}},t}();r.LcsDiff2=s});