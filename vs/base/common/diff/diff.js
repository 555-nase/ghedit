define(["require","exports","vs/base/common/diff/diffChange"],function(t,i,e){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var n=function(){function t(){}return t.Assert=function(t,i){if(!t)throw new Error(i)},t}();i.Debug=n;var r=function(){function t(){}return t.Copy=function(t,i,e,n,r){for(var o=0;o<r;o++)e[n+o]=t[i+o]},t}();i.MyArray=r;var o=1447,a=function(){function t(){this.m_changes=[],this.m_originalStart=Number.MAX_VALUE,this.m_modifiedStart=Number.MAX_VALUE,this.m_originalCount=0,this.m_modifiedCount=0}return t.prototype.MarkNextChange=function(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new e.DiffChange(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=Number.MAX_VALUE,this.m_modifiedStart=Number.MAX_VALUE},t.prototype.AddOriginalElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_originalCount++},t.prototype.AddModifiedElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_modifiedCount++},t.prototype.getChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes},t.prototype.getReverseChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes},t}(),s=function(){function t(t,i,e){void 0===e&&(e=null),this.OriginalSequence=t,this.ModifiedSequence=i,this.ContinueProcessingPredicate=e,this.m_originalIds=[],this.m_modifiedIds=[],this.m_forwardHistory=[],this.m_reverseHistory=[],this.ComputeUniqueIdentifiers()}return t.prototype.ComputeUniqueIdentifiers=function(){var t=this.OriginalSequence.getLength(),i=this.ModifiedSequence.getLength();this.m_originalIds=new Array(t),this.m_modifiedIds=new Array(i);var e,n={},r=1;for(e=0;e<t;e++){var o=this.OriginalSequence.getElementHash(e);n.hasOwnProperty(o)?this.m_originalIds[e]=n[o]:(this.m_originalIds[e]=r++,n[o]=this.m_originalIds[e])}for(e=0;e<i;e++){var a=this.ModifiedSequence.getElementHash(e);n.hasOwnProperty(a)?this.m_modifiedIds[e]=n[a]:(this.m_modifiedIds[e]=r++,n[a]=this.m_modifiedIds[e])}},t.prototype.ElementsAreEqual=function(t,i){return this.m_originalIds[t]===this.m_modifiedIds[i]},t.prototype.ComputeDiff=function(){return this._ComputeDiff(0,this.OriginalSequence.getLength()-1,0,this.ModifiedSequence.getLength()-1)},t.prototype._ComputeDiff=function(t,i,e,n){var r=[!1];return this.ComputeDiffRecursive(t,i,e,n,r)},t.prototype.ComputeDiffRecursive=function(t,i,r,o,a){for(a[0]=!1;t<=i&&r<=o&&this.ElementsAreEqual(t,r);)t++,r++;for(;i>=t&&o>=r&&this.ElementsAreEqual(i,o);)i--,o--;if(t>i||r>o){var s=void 0;return r<=o?(n.Assert(t===i+1,"originalStart should only be one more than originalEnd"),s=[new e.DiffChange(t,0,r,o-r+1)]):t<=i?(n.Assert(r===o+1,"modifiedStart should only be one more than modifiedEnd"),s=[new e.DiffChange(t,i-t+1,r,0)]):(n.Assert(t===i+1,"originalStart should only be one more than originalEnd"),n.Assert(r===o+1,"modifiedStart should only be one more than modifiedEnd"),s=[]),s}var h=[0],d=[0],f=this.ComputeRecursionPoint(t,i,r,o,h,d,a),g=h[0],m=d[0];if(null!==f)return f;if(!a[0]){var l=this.ComputeDiffRecursive(t,g,r,m,a),u=[];return u=a[0]?[new e.DiffChange(g+1,i-(g+1)+1,m+1,o-(m+1)+1)]:this.ComputeDiffRecursive(g+1,i,m+1,o,a),this.ConcatenateChanges(l,u)}return[new e.DiffChange(t,i-t+1,r,o-r+1)]},t.prototype.WALKTRACE=function(t,i,n,r,o,s,h,d,f,g,m,l,u,C,_,c,p,y){var A,S=null,v=null,E=new a,M=i,w=n,L=u[0]-c[0]-r,D=Number.MIN_VALUE,q=this.m_forwardHistory.length-1;do A=L+t,A===M||A<w&&f[A-1]<f[A+1]?(m=f[A+1],C=m-L-r,m<D&&E.MarkNextChange(),D=m,E.AddModifiedElement(m+1,C),L=A+1-t):(m=f[A-1]+1,C=m-L-r,m<D&&E.MarkNextChange(),D=m-1,E.AddOriginalElement(m,C+1),L=A-1-t),q>=0&&(f=this.m_forwardHistory[q],t=f[0],M=1,w=f.length-1);while(--q>=-1);if(S=E.getReverseChanges(),y[0]){var I=u[0]+1,b=c[0]+1;if(null!==S&&S.length>0){var N=S[S.length-1];I=Math.max(I,N.getOriginalEnd()),b=Math.max(b,N.getModifiedEnd())}v=[new e.DiffChange(I,l-I+1,b,_-b+1)]}else{E=new a,M=s,w=h,L=u[0]-c[0]-d,D=Number.MAX_VALUE,q=p?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do A=L+o,A===M||A<w&&g[A-1]>=g[A+1]?(m=g[A+1]-1,C=m-L-d,m>D&&E.MarkNextChange(),D=m+1,E.AddOriginalElement(m+1,C+1),L=A+1-o):(m=g[A-1],C=m-L-d,m>D&&E.MarkNextChange(),D=m,E.AddModifiedElement(m+1,C+1),L=A-1-o),q>=0&&(g=this.m_reverseHistory[q],o=g[0],M=1,w=g.length-1);while(--q>=-1);v=E.getChanges()}return this.ConcatenateChanges(S,v)},t.prototype.ComputeRecursionPoint=function(t,i,n,a,s,h,d){var f,g,m,l=0,u=0,C=0,_=0;t--,n--,s[0]=0,h[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];var c=i-t+(a-n),p=c+1,y=new Array(p),A=new Array(p),S=a-n,v=i-t,E=t-n,M=i-a,w=v-S,L=w%2===0;y[S]=t,A[v]=i,d[0]=!1;var D,q;for(m=1;m<=c/2+1;m++){var I=0,b=0;for(l=this.ClipDiagonalBound(S-m,m,S,p),u=this.ClipDiagonalBound(S+m,m,S,p),D=l;D<=u;D+=2){for(f=D===l||D<u&&y[D-1]<y[D+1]?y[D+1]:y[D-1]+1,g=f-(D-S)-E,q=f;f<i&&g<a&&this.ElementsAreEqual(f+1,g+1);)f++,g++;if(y[D]=f,f+g>I+b&&(I=f,b=g),!L&&Math.abs(D-v)<=m-1&&f>=A[D])return s[0]=f,h[0]=g,q<=A[D]&&o>0&&m<=o+1?this.WALKTRACE(S,l,u,E,v,C,_,M,y,A,f,i,s,g,a,h,L,d):null}var N=(I-t+(b-n)-m)/2;if(null!==this.ContinueProcessingPredicate&&!this.ContinueProcessingPredicate(I,this.OriginalSequence,N))return d[0]=!0,s[0]=I,h[0]=b,N>0&&o>0&&m<=o+1?this.WALKTRACE(S,l,u,E,v,C,_,M,y,A,f,i,s,g,a,h,L,d):(t++,n++,[new e.DiffChange(t,i-t+1,n,a-n+1)]);for(C=this.ClipDiagonalBound(v-m,m,v,p),_=this.ClipDiagonalBound(v+m,m,v,p),D=C;D<=_;D+=2){for(f=D===C||D<_&&A[D-1]>=A[D+1]?A[D+1]-1:A[D-1],g=f-(D-v)-M,q=f;f>t&&g>n&&this.ElementsAreEqual(f,g);)f--,g--;if(A[D]=f,L&&Math.abs(D-S)<=m&&f<=y[D])return s[0]=f,h[0]=g,q>=y[D]&&o>0&&m<=o+1?this.WALKTRACE(S,l,u,E,v,C,_,M,y,A,f,i,s,g,a,h,L,d):null}if(m<=o){var H=new Array(u-l+2);H[0]=S-l+1,r.Copy(y,l,H,1,u-l+1),this.m_forwardHistory.push(H),H=new Array(_-C+2),H[0]=v-C+1,r.Copy(A,C,H,1,_-C+1),this.m_reverseHistory.push(H)}}return this.WALKTRACE(S,l,u,E,v,C,_,M,y,A,f,i,s,g,a,h,L,d)},t.prototype.ConcatenateChanges=function(t,i){var e=[],n=null;return 0===t.length||0===i.length?i.length>0?i:t:this.ChangesOverlap(t[t.length-1],i[0],e)?(n=new Array(t.length+i.length-1),r.Copy(t,0,n,0,t.length-1),n[t.length-1]=e[0],r.Copy(i,1,n,t.length,i.length-1),n):(n=new Array(t.length+i.length),r.Copy(t,0,n,0,t.length),r.Copy(i,0,n,t.length,i.length),n)},t.prototype.ChangesOverlap=function(t,i,r){if(n.Assert(t.originalStart<=i.originalStart,"Left change is not less than or equal to right change"),n.Assert(t.modifiedStart<=i.modifiedStart,"Left change is not less than or equal to right change"),t.originalStart+t.originalLength>=i.originalStart||t.modifiedStart+t.modifiedLength>=i.modifiedStart){var o=t.originalStart,a=t.originalLength,s=t.modifiedStart,h=t.modifiedLength;return t.originalStart+t.originalLength>=i.originalStart&&(a=i.originalStart+i.originalLength-t.originalStart),t.modifiedStart+t.modifiedLength>=i.modifiedStart&&(h=i.modifiedStart+i.modifiedLength-t.modifiedStart),r[0]=new e.DiffChange(o,a,s,h),!0}return r[0]=null,!1},t.prototype.ClipDiagonalBound=function(t,i,e,n){if(t>=0&&t<n)return t;var r=e,o=n-e-1,a=i%2===0;if(t<0){var s=r%2===0;return a===s?0:1}var h=o%2===0;return a===h?n-1:n-2},t}();i.LcsDiff=s});