/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,i){function t(){this.constructor=e}for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s]);e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)};define(["require","exports","vs/base/common/lifecycle","vs/base/common/eventEmitter","vs/base/common/types","vs/base/common/objects","vs/base/browser/dom","vs/base/common/numbers","vs/base/browser/ui/sash/sash","vs/base/browser/keyboardEvent","vs/base/common/keyCodes","vs/base/common/event","vs/css!./splitview"],function(e,i,t,s,n,o,r,a,h,u,l,d){"use strict";function c(e){return e.reduce(function(e,i){return e+i})}!function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(i.Orientation||(i.Orientation={}));var p=i.Orientation;!function(e){e[e.Flexible=0]="Flexible",e[e.Fixed=1]="Fixed"}(i.ViewSizing||(i.ViewSizing={}));var f=i.ViewSizing,m=function(e){function i(i){e.call(this),this.size=0,this._sizing=n.isUndefined(i.sizing)?f.Flexible:i.sizing,this._fixedSize=n.isUndefined(i.fixedSize)?22:i.fixedSize,this._minimumSize=n.isUndefined(i.minimumSize)?22:i.minimumSize}return __extends(i,e),Object.defineProperty(i.prototype,"sizing",{get:function(){return this._sizing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fixedSize",{get:function(){return this._fixedSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minimumSize",{get:function(){return this.sizing===f.Fixed?this.fixedSize:this._minimumSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maximumSize",{get:function(){return this.sizing===f.Fixed?this.fixedSize:Number.POSITIVE_INFINITY},enumerable:!0,configurable:!0}),i.prototype.setFlexible=function(e){this._sizing=f.Flexible,this.emit("change",n.isUndefined(e)?this._minimumSize:e)},i.prototype.setFixed=function(e){this._sizing=f.Fixed,this._fixedSize=n.isUndefined(e)?this._fixedSize:e,this.emit("change",this._fixedSize)},i}(s.EventEmitter);i.View=m;var v=function(e){function i(i){e.call(this,i),this.headerSize=n.isUndefined(i.headerSize)?22:i.headerSize}return __extends(i,e),i.prototype.render=function(e,i){this.header=document.createElement("div"),this.header.className="header";var t=this.headerSize+"px";i===p.HORIZONTAL?this.header.style.width=t:this.header.style.height=t,this.headerSize>0&&(this.renderHeader(this.header),e.appendChild(this.header)),this.body=document.createElement("div"),this.body.className="body",this.layoutBodyContainer(i),this.renderBody(this.body),e.appendChild(this.body)},i.prototype.layout=function(e,i){this.layoutBodyContainer(i),this.layoutBody(e-this.headerSize)},i.prototype.layoutBodyContainer=function(e){var i="calc(100% - "+this.headerSize+"px)";e===p.HORIZONTAL?this.body.style.width=i:this.body.style.height=i},i.prototype.dispose=function(){this.header=null,this.body=null,e.prototype.dispose.call(this)},i}(m);i.HeaderView=v,function(e){e[e.EXPANDED=0]="EXPANDED",e[e.COLLAPSED=1]="COLLAPSED"}(i.CollapsibleState||(i.CollapsibleState={}));var y=i.CollapsibleState,w=function(e){function i(i){e.call(this,i),this.ariaHeaderLabel=i&&i.ariaHeaderLabel,this.changeState(n.isUndefined(i.initialState)?y.EXPANDED:i.initialState)}return __extends(i,e),i.prototype.render=function(i,t){var s=this;e.prototype.render.call(this,i,t),r.addClass(this.header,"collapsible"),r.addClass(this.body,"collapsible"),this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","toolbar"),this.ariaHeaderLabel&&this.header.setAttribute("aria-label",this.ariaHeaderLabel),this.header.setAttribute("aria-expanded",String(this.state===y.EXPANDED)),this.headerKeyListener=r.addDisposableListener(this.header,r.EventType.KEY_DOWN,function(e){var i=new u.StandardKeyboardEvent(e),t=!1;i.equals(l.CommonKeybindings.ENTER)||i.equals(l.CommonKeybindings.SPACE)||i.equals(l.CommonKeybindings.LEFT_ARROW)&&s.state===y.EXPANDED||i.equals(l.CommonKeybindings.RIGHT_ARROW)&&s.state===y.COLLAPSED?(s.toggleExpansion(),t=!0):i.equals(l.CommonKeybindings.ESCAPE)?(s.header.blur(),t=!0):i.equals(l.CommonKeybindings.UP_ARROW)?(s.emit("focusPrevious"),t=!0):i.equals(l.CommonKeybindings.DOWN_ARROW)&&(s.emit("focusNext"),t=!0),t&&r.EventHelper.stop(i,!0)}),this.headerClickListener=r.addDisposableListener(this.header,r.EventType.CLICK,function(){return s.toggleExpansion()}),this.focusTracker=r.trackFocus(this.header),this.focusTracker.addFocusListener(function(){r.addClass(s.header,"focused")}),this.focusTracker.addBlurListener(function(){r.removeClass(s.header,"focused")})},i.prototype.focus=function(){this.header&&this.header.focus()},i.prototype.layout=function(i,t){this.layoutHeader(),e.prototype.layout.call(this,i,t)},i.prototype.isExpanded=function(){return this.state===y.EXPANDED},i.prototype.expand=function(){this.isExpanded()||this.changeState(y.EXPANDED)},i.prototype.collapse=function(){this.isExpanded()&&this.changeState(y.COLLAPSED)},i.prototype.toggleExpansion=function(){this.isExpanded()?this.collapse():this.expand()},i.prototype.layoutHeader=function(){this.header&&(this.state===y.COLLAPSED?r.addClass(this.header,"collapsed"):r.removeClass(this.header,"collapsed"))},i.prototype.changeState=function(e){this.state=e,this.header&&this.header.setAttribute("aria-expanded",String(this.state===y.EXPANDED)),this.layoutHeader()},i.prototype.dispose=function(){this.headerClickListener&&(this.headerClickListener.dispose(),this.headerClickListener=null),this.headerKeyListener&&(this.headerKeyListener.dispose(),this.headerKeyListener=null),this.focusTracker&&(this.focusTracker.dispose(),this.focusTracker=null),e.prototype.dispose.call(this)},i}(v);i.AbstractCollapsibleView=w;var z=function(e){function i(i){e.call(this,i),this.previousSize=null}return __extends(i,e),i.prototype.changeState=function(i){e.prototype.changeState.call(this,i),i===y.EXPANDED?this.setFlexible(this.previousSize||this._minimumSize):(this.previousSize=this.size,this.setFixed())},i}(w);i.CollapsibleView=z;var x=function(e){function i(i){e.call(this,o.mixin({sizing:f.Fixed},i)),this._expandedBodySize=n.isUndefined(i.expandedBodySize)?22:i.expandedBodySize}return __extends(i,e),Object.defineProperty(i.prototype,"fixedSize",{get:function(){return this.state===y.EXPANDED?this.expandedSize:this.headerSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"expandedSize",{get:function(){return this.expandedBodySize+this.headerSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"expandedBodySize",{get:function(){return this._expandedBodySize},set:function(e){this._expandedBodySize=e,this.setFixed(this.fixedSize)},enumerable:!0,configurable:!0}),i.prototype.changeState=function(i){e.prototype.changeState.call(this,i),this.setFixed(this.fixedSize)},i}(w);i.FixedCollapsibleView=x;var b=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.render=function(){},i.prototype.focus=function(){},i.prototype.layout=function(){},i}(m),g=function(e){function i(i){e.call(this,{sizing:f.Fixed,fixedSize:0}),this.size=i.size}return __extends(i,e),i}(b),S=function(e){function i(){e.call(this,{sizing:f.Fixed,minimumSize:0,fixedSize:0})}return __extends(i,e),i.prototype.setFlexible=function(i){e.prototype.setFlexible.call(this,i)},i.prototype.setFixed=function(i){e.prototype.setFixed.call(this,i)},i}(b),E=function(){function e(e,i){i=i||{},this.orientation=n.isUndefined(i.orientation)?p.VERTICAL:i.orientation,this.el=document.createElement("div"),r.addClass(this.el,"monaco-split-view"),r.addClass(this.el,this.orientation===p.VERTICAL?"vertical":"horizontal"),e.appendChild(this.el),this.size=null,this.viewElements=[],this.views=[],this.viewChangeListeners=[],this.viewFocusPreviousListeners=[],this.viewFocusNextListeners=[],this.viewFocusListeners=[],this.initialWeights=[],this.sashes=[],this.sashesListeners=[],this.animationTimeout=null,this._onFocus=new d.Emitter,this.sashOrientation=this.orientation===p.VERTICAL?h.Orientation.HORIZONTAL:h.Orientation.VERTICAL,this.orientation===p.VERTICAL?(this.measureContainerSize=function(){return r.getContentHeight(e)},this.layoutViewElement=function(e,i){return e.style.height=i+"px"},this.eventWrapper=function(e){return{start:e.startY,current:e.currentY}}):(this.measureContainerSize=function(){return r.getContentWidth(e)},this.layoutViewElement=function(e,i){return e.style.width=i+"px"},this.eventWrapper=function(e){return{start:e.startX,current:e.currentX}}),this.addView(new S,1,0)}return Object.defineProperty(e.prototype,"onFocus",{get:function(){return this._onFocus.event},enumerable:!0,configurable:!0}),e.prototype.addView=function(e,i,t){var s=this;if(void 0===i&&(i=1),void 0===t&&(t=this.views.length-1),i<=0)throw new Error("Initial weight must be a positive number.");var n=this.views.length,o=document.createElement("div");if(r.addClass(o,"split-view-view"),this.viewElements.splice(t,0,o),e.render(o,this.orientation),this.views.splice(t,0,e),this.initialWeights.splice(t,0,i),t===n?this.el.appendChild(o):this.el.insertBefore(o,this.el.children.item(t)),this.views.length>2){var a=new h.Sash(this.el,this,{orientation:this.sashOrientation});this.sashes.splice(t-1,0,a),this.sashesListeners.push(a.addListener2("start",function(e){return s.onSashStart(a,s.eventWrapper(e))})),this.sashesListeners.push(a.addListener2("change",function(e){return s.onSashChange(a,s.eventWrapper(e))}))}this.viewChangeListeners.splice(t,0,e.addListener2("change",function(i){return s.onViewChange(e,i)})),this.onViewChange(e,e.minimumSize);var u=r.trackFocus(o);this.viewFocusListeners.splice(t,0,u),u.addFocusListener(function(){return s._onFocus.fire(e)}),this.viewFocusPreviousListeners.splice(t,0,e.addListener2("focusPrevious",function(){return t>0&&s.views[t-1].focus()})),this.viewFocusNextListeners.splice(t,0,e.addListener2("focusNext",function(){return t<s.views.length&&s.views[t+1].focus()}))},e.prototype.removeView=function(e){var i=this.views.indexOf(e);if(!(i<0)){var t=new g(e);this.views[i]=t,this.onViewChange(t,0);var s=Math.max(i-1,0);this.sashes[s].dispose(),this.sashes.splice(s,1),this.viewChangeListeners[i].dispose(),this.viewChangeListeners.splice(i,1),this.viewFocusPreviousListeners[i].dispose(),this.viewFocusPreviousListeners.splice(i,1),this.viewFocusListeners[i].dispose(),this.viewFocusListeners.splice(i,1),this.viewFocusNextListeners[i].dispose(),this.viewFocusNextListeners.splice(i,1),this.views.splice(i,1),this.el.removeChild(this.viewElements[i]),this.viewElements.splice(i,1),t.dispose(),e.dispose()}},e.prototype.layout=function(e){if(e=e||this.measureContainerSize(),null===this.size)return this.size=e,void this.initialLayout();e=Math.max(e,this.views.reduce(function(e,i){return e+i.minimumSize},0));var i=Math.abs(this.size-e),t=a.countToArray(this.views.length-1,-1),s=this.views.map(function(e){return e.size-e.minimumSize}),n=this.views.map(function(e){return e.maximumSize-e.size});e<this.size?this.expandCollapse(Math.min(i,c(s)),s,n,t,[]):e>this.size&&this.expandCollapse(Math.min(i,c(n)),s,n,[],t),this.size=e,this.layoutViews()},e.prototype.onSashStart=function(e,i){var t=this.sashes.indexOf(e),s=this.views.map(function(e){return e.size-e.minimumSize}),n=this.views.map(function(e){return e.maximumSize-e.size}),o=a.countToArray(t,-1),r=a.countToArray(t+1,this.views.length),h=o.map(function(e){return s[e]}),u=r.map(function(e){return s[e]}),l=o.map(function(e){return n[e]}),d=r.map(function(e){return n[e]});this.state={start:i.start,sizes:this.views.map(function(e){return e.size}),up:o,down:r,maxUp:Math.min(c(h),c(d)),maxDown:Math.min(c(l),c(u)),collapses:s,expands:n}},e.prototype.onSashChange=function(e,i){for(var t=i.current-this.state.start,s=0;s<this.views.length;s++)this.views[s].size=this.state.sizes[s];t<0?this.expandCollapse(Math.min(-t,this.state.maxUp),this.state.collapses,this.state.expands,this.state.up,this.state.down):this.expandCollapse(Math.min(t,this.state.maxDown),this.state.collapses,this.state.expands,this.state.down,this.state.up),this.layoutViews()},e.prototype.expandCollapse=function(e,i,t,s,n){var o=this,r=e,a=r;s.forEach(function(e){var t=Math.min(i[e],r);r-=t,o.views[e].size-=t}),n.forEach(function(e){var i=Math.min(t[e],a);a-=i,o.views[e].size+=i})},e.prototype.initialLayout=function(){var e=this,i=0,t=0;this.views.forEach(function(s,n){s.sizing===f.Flexible?i+=e.initialWeights[n]:t+=s.fixedSize});var s=this.size-t;this.views.forEach(function(t,n){t.sizing===f.Flexible?t.size=e.initialWeights[n]*s/i:t.size=t.fixedSize});var n=this.getLastFlexibleViewIndex();n>=0&&(this.views[n].size+=this.size-this.views.reduce(function(e,i){return e+i.size},0)),this.layoutViews()},e.prototype.getLastFlexibleViewIndex=function(e){void 0===e&&(e=null);for(var i=this.views.length-1;i>=0;i--)if(e!==i&&this.views[i].sizing===f.Flexible)return i;return-1},e.prototype.layoutViews=function(){for(var e=0;e<this.views.length;e++)this.layoutViewElement(this.viewElements[e],this.views[e].size),this.views[e].layout(this.views[e].size,this.orientation);this.sashes.forEach(function(e){return e.layout()});var i=!1,t=this.views.map(function(e){return i=e.size-e.minimumSize>0||i});i=!1;var s=this.views.map(function(e){return i=e.maximumSize-e.size>0||i}),n=this.views.slice().reverse();i=!1;var o=n.map(function(e){return i=e.size-e.minimumSize>0||i}).reverse();i=!1;var r=n.map(function(e){return i=e.maximumSize-e.size>0||i}).reverse();this.sashes.forEach(function(e,i){t[i]&&r[i+1]||s[i]&&o[i+1]?e.enable():e.disable()})},e.prototype.onViewChange=function(e,i){if(e!==this.voidView&&(this.areAllViewsFixed()?this.voidView.setFlexible():this.voidView.setFixed()),null!==this.size&&i!==e.size){this.setupAnimation();var t,s,n,o=this.views.indexOf(e),r=Math.abs(i-e.size),h=a.countToArray(o-1,-1),u=a.countToArray(o+1,this.views.length),l=u.concat(h),d=this.views.map(function(e){return Math.max(e.size-e.minimumSize,0)}),c=this.views.map(function(e){return Math.max(e.maximumSize-e.size,0)});i<e.size?(t=Math.min(l.reduce(function(e,i){return e+c[i]},0),r),s=[o],n=l):(t=Math.min(l.reduce(function(e,i){return e+d[i]},0),r),s=l,n=[o]),this.expandCollapse(t,d,c,s,n),this.layoutViews()}},e.prototype.setupAnimation=function(){var e=this;n.isNumber(this.animationTimeout)&&window.clearTimeout(this.animationTimeout),r.addClass(this.el,"animated"),this.animationTimeout=window.setTimeout(function(){return e.clearAnimation()},200)},e.prototype.clearAnimation=function(){this.animationTimeout=null,r.removeClass(this.el,"animated")},Object.defineProperty(e.prototype,"voidView",{get:function(){return this.views[this.views.length-1]},enumerable:!0,configurable:!0}),e.prototype.areAllViewsFixed=function(){var e=this;return this.views.every(function(i,t){return i.sizing===f.Fixed||t===e.views.length-1})},e.prototype.getVerticalSashLeft=function(e){return this.getSashPosition(e)},e.prototype.getHorizontalSashTop=function(e){return this.getSashPosition(e)},e.prototype.getSashPosition=function(e){for(var i=this.sashes.indexOf(e),t=0,s=0;s<=i;s++)t+=this.views[s].size;return t},e.prototype.dispose=function(){var e=this;n.isNumber(this.animationTimeout)&&window.clearTimeout(this.animationTimeout),this.orientation=null,this.size=null,this.viewElements.forEach(function(i){return e.el.removeChild(i)}),this.el=null,this.viewElements=[],this.views=t.dispose(this.views),this.sashes=t.dispose(this.sashes),this.sashesListeners=t.dispose(this.sashesListeners),this.measureContainerSize=null,this.layoutViewElement=null,this.eventWrapper=null,this.state=null},e}();i.SplitView=E});