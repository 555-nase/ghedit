/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/timer","vs/base/common/lifecycle","vs/base/browser/dom","vs/css!./timer"],function(e,t,i,o,r){"use strict";var n=function(){function e(e){var t=this;this.timeKeeper=i.getTimeKeeper(),this.onHide=e,this.lastEventIndex=0,this.renderedEvents={},this.renderCnt=0,this.listenersToRemove=[],this.domNode=this._createDomNode(),this.intervalTokenId=window.setInterval(function(){return t._render()},500)}return e.prototype.destroy=function(){document.body.removeChild(this.outerDomNode),window.clearInterval(this.intervalTokenId),this.listenersToRemove=o.dispose(this.listenersToRemove)},e.prototype._createDomNode=function(){var e=this;this.outerDomNode=document.createElement("div"),this.outerDomNode.className="benchmarktimerbox";var t=document.createElement("input");t.type="button",t.value="Clear",this.listenersToRemove.push(r.addDisposableListener(t,"click",function(){return e._onClear()})),this.outerDomNode.appendChild(t),this.textFilterDomNode=document.createElement("input"),this.textFilterDomNode.type="text",this.textFilterDomNode.className="textFilter",this.listenersToRemove.push(r.addDisposableListener(this.textFilterDomNode,"keydown",function(){return e.onTextFilterChange()})),this.textFilter="",this.outerDomNode.appendChild(document.createTextNode("Filter")),this.outerDomNode.appendChild(this.textFilterDomNode),this.timeFilterDomNode=document.createElement("input"),this.timeFilterDomNode.type="text",this.timeFilterDomNode.value="0",this.timeFilterDomNode.className="timeFilter",this.listenersToRemove.push(r.addDisposableListener(this.timeFilterDomNode,"keydown",function(){return e.onTimeFilterChange()})),this.timeFilter=0,this.outerDomNode.appendChild(document.createTextNode("Hide time under")),this.outerDomNode.appendChild(this.timeFilterDomNode);var i=document.createElement("input");i.type="button",i.value="Close",this.listenersToRemove.push(r.addDisposableListener(i,"click",function(){e.onHide()})),this.outerDomNode.appendChild(i);var o=document.createElement("pre");o.appendChild(document.createTextNode(this.renderRow("TOPIC","NAME","TOOK","START","END"))),this.outerDomNode.appendChild(o),this.outerDomNode.appendChild(document.createElement("hr"));var n=document.createElement("div");return n.className="inner",this.outerDomNode.appendChild(n),document.body.appendChild(this.outerDomNode),n},e.prototype.onTextFilterChange=function(){var e=this;setTimeout(function(){e.refilter()})},e.prototype.onTimeFilterChange=function(){var e=this;setTimeout(function(){e.refilter()})},e.prototype.matchesTextFilter=function(e){return!this.textFilter||(e.topic.toLowerCase().indexOf(this.textFilter.toLowerCase())>=0||e.name.toLowerCase().indexOf(this.textFilter.toLowerCase())>=0)},e.prototype.matchesTimeFilter=function(e){return!this.timeFilter||e.timeTaken()>=this.timeFilter},e.prototype.shouldShow=function(e){return this.matchesTextFilter(e)&&this.matchesTimeFilter(e)},e.prototype.refilter=function(){this.textFilter=this.textFilterDomNode.value,this.timeFilter=parseInt(this.timeFilterDomNode.value,10);for(var e=Array.prototype.slice.call(this.domNode.children,0),t=0;t<e.length;t++){var i=e[t].getAttribute("data-event-id"),o=this.renderedEvents[i];this.shouldShow(o)?e[t].style.display="inherit":e[t].style.display="none"}},e.prototype._onClear=function(){this.lastEventIndex=this.timeKeeper.getCollectedEvents().length,this.renderedEvents={},this.renderCnt=0,r.clearNode(this.domNode)},e.prototype.leftPaddedString=function(e,t,i){var o=this._repeatStr(t,Math.max(0,e-i.length));return o+i},e.prototype.rightPaddedString=function(e,t,i){var o=this._repeatStr(t,Math.max(0,e-i.length));return i+o},e.prototype.renderRow=function(e,t,i,o,r){var n=" ";return n+=this.rightPaddedString(10," ",e),n+=this.rightPaddedString(30," ",t),n+=" "+this.leftPaddedString(15," ",i),n+=" "+this.leftPaddedString(13," ",o)},e.prototype._suffix0=function(e){return"."===e.charAt(e.length-3)?e:"."===e.charAt(e.length-2)?e+"0":e+".00"},e.prototype._twoPrecision=function(e){return this._suffix0(Math.round(100*e)/100+"")},e.prototype._absoluteTime=function(e){return e<1e3?this._twoPrecision(e)+" ms":(e/=1e3,e<60?this._twoPrecision(e)+" s":(e/=60,e<60?this._twoPrecision(e)+" m":(e/=60,this._twoPrecision(e)+" h")))},e.prototype._renderEvent=function(e,t){var o=t.startTime.getTime()-i.TimeKeeper.PARSE_TIME.getTime(),r=this.renderRow(t.topic,t.name,this._twoPrecision(t.timeTaken()),this._absoluteTime(o)+"",this._absoluteTime(o+t.timeTaken()));e.textContent="",e.appendChild(document.createTextNode(r))},e.prototype._renderStartTimerEvent=function(e){var t=document.createElement("pre");this._renderEvent(t,e),this.domNode.appendChild(t);var i=e.id.toString();t.setAttribute("data-event-id",i),t.className="timer-event-"+e.id%2,this.renderedEvents[i]=e,this.shouldShow(this.renderedEvents[i])?t.style.display="inherit":t.style.display="none",this.renderCnt++},e.prototype._render=function(){for(var e=this.timeKeeper.getCollectedEvents(),t=!1,i=this.lastEventIndex;i<e.length;i++){var o=e[i];if(!o.stopTime)return this.lastEventIndex=i,void(t&&(this.domNode.scrollTop=1e5));this._renderStartTimerEvent(o),t=!0}t&&(this.domNode.scrollTop=1e5),this.lastEventIndex=e.length},e.prototype._repeatStr=function(e,t){for(var i="",o=0;o<t;o++)i+=e;return i},e}();t.TimeKeeperRenderer=n});