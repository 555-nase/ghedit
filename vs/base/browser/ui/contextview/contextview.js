/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};define(["require","exports","vs/base/browser/builder","vs/base/browser/dom","vs/base/common/lifecycle","vs/base/common/eventEmitter","vs/css!./contextview"],function(t,e,i,o,n,s){"use strict";function h(t,e,i,o,n){var s=function(t,e,i,o){return e?t:o?i:t},h=function(t,e,i,o,n){return n?s(t,e,i,o):s(i,o,t,e)},a=function(){var n=e.top-t.height,s=e.top+e.height,r=n>=i.top&&n+t.height<=i.top+i.height,a=s>=i.top&&s+t.height<=i.top+i.height;return h(n,r,s,a,o===l.ABOVE)}(),d=function(){var o=e.left,s=e.left+e.width-t.width,l=o>=i.left&&o+t.width<=i.left+i.width,a=s>=i.left&&s+t.width<=i.left+i.width;return h(o,l,s,a,n===r.LEFT)}();return{top:a,left:d}}!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"}(e.AnchorAlignment||(e.AnchorAlignment={}));var r=e.AnchorAlignment;!function(t){t[t.BELOW=0]="BELOW",t[t.ABOVE=1]="ABOVE"}(e.AnchorPosition||(e.AnchorPosition={}));var l=e.AnchorPosition,a=function(t){function e(e){var o=this;t.call(this),this.$view=i.$(".context-view").hide(),this.setContainer(e),this.toDispose=[{dispose:function(){o.setContainer(null)}}],this.toDisposeOnClean=null}return __extends(e,t),e.prototype.setContainer=function(t){var o=this;this.$container&&(this.$container.off(e.BUBBLE_UP_EVENTS),this.$container.off(e.BUBBLE_DOWN_EVENTS,!0),this.$container=null),t&&(this.$container=i.$(t),this.$view.appendTo(this.$container),this.$container.on(e.BUBBLE_UP_EVENTS,function(t){o.onDOMEvent(t,document.activeElement,!1)}),this.$container.on(e.BUBBLE_DOWN_EVENTS,function(t){o.onDOMEvent(t,document.activeElement,!0)},null,!0))},e.prototype.show=function(t){this.isVisible()&&this.hide(),this.$view.setClass("context-view").empty().style({top:"0px",left:"0px"}).show(),this.toDisposeOnClean=t.render(this.$view.getHTMLElement()),this.delegate=t,this.doLayout()},e.prototype.layout=function(){if(this.isVisible()){if(this.delegate.canRelayout===!1)return void this.hide();this.delegate.layout&&this.delegate.layout(),this.doLayout()}},e.prototype.doLayout=function(){var t,e=this.delegate.getAnchor();if(o.isHTMLElement(e)){var i=o.getDomNodePagePosition(e);t={top:i.top,left:i.left,width:i.width,height:i.height}}else{var n=e;t={top:n.y,left:n.x,width:n.width||0,height:n.height||0}}var s={top:o.StandardWindow.scrollY,left:o.StandardWindow.scrollX,height:window.innerHeight,width:window.innerWidth},a=this.$view.getTotalSize(),d={width:a.width,height:a.height},c=this.delegate.anchorPosition||l.BELOW,p=this.delegate.anchorAlignment||r.LEFT,u=h(d,t,s,c,p),f=o.getDomNodePagePosition(this.$container.getHTMLElement());u.top-=f.top,u.left-=f.left,this.$view.removeClass("top","bottom","left","right"),this.$view.addClass(c===l.BELOW?"bottom":"top"),this.$view.addClass(p===r.LEFT?"left":"right"),this.$view.style({top:u.top+"px",left:u.left+"px",width:"initial"})},e.prototype.hide=function(t){this.delegate&&this.delegate.onHide&&this.delegate.onHide(t),this.delegate=null,this.toDisposeOnClean&&(this.toDisposeOnClean.dispose(),this.toDisposeOnClean=null),this.$view.hide()},e.prototype.isVisible=function(){return!!this.delegate},e.prototype.onDOMEvent=function(t,e,i){this.delegate&&(this.delegate.onDOMEvent?this.delegate.onDOMEvent(t,document.activeElement):i&&!o.isAncestor(t.target,this.$container.getHTMLElement())&&this.hide())},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.hide(),this.toDispose=n.dispose(this.toDispose)},e.BUBBLE_UP_EVENTS=["click","keydown","focus","blur"],e.BUBBLE_DOWN_EVENTS=["click"],e}(s.EventEmitter);e.ContextView=a});