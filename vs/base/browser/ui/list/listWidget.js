/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define(["require","exports","vs/base/common/lifecycle","vs/base/common/types","vs/base/browser/dom","vs/base/browser/touch","vs/base/common/keyCodes","vs/base/browser/keyboardEvent","vs/base/common/event","vs/base/browser/event","./listView","vs/css!./list"],function(e,t,o,n,i,s,r,h,u,c,l){"use strict";var p=function(){function e(e,t){this.controller=e,this.renderer=t}return Object.defineProperty(e.prototype,"templateId",{get:function(){return this.renderer.templateId},enumerable:!0,configurable:!0}),e.prototype.renderTemplate=function(e){var t=this.renderer.renderTemplate(e);return{container:e,data:t}},e.prototype.renderElement=function(e,t,o){this.controller.renderElement(e,t,o.container),this.renderer.renderElement(e,t,o.data)},e.prototype.disposeTemplate=function(e){return this.renderer.disposeTemplate(e.data)},e}(),a=function(){function e(e){this._trait=e,this._onChange=new u.Emitter,this.indexes=[]}return Object.defineProperty(e.prototype,"onChange",{get:function(){return this._onChange.event},enumerable:!0,configurable:!0}),e.prototype.splice=function(e,t,o){for(var n=o-t,i=e+t,s=[],r=0,h=s;r<h.length;r++){var u=h[r];u>=e&&u<i||s.push(u>e?u+n:u)}this.indexes=s,this._onChange.fire({indexes:s})},e.prototype.renderElement=function(e,t,o){i.toggleClass(o,this._trait,this.contains(t))},e.prototype.set=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var o=this.indexes;return this.indexes=e,this._onChange.fire({indexes:e}),o},e.prototype.get=function(){return this.indexes},e.prototype.contains=function(e){return this.indexes.some(function(t){return t===e})},e.prototype.wrapRenderer=function(e){return new p(this,e)},e.prototype.dispose=function(){this.indexes=null,this._onChange=o.dispose(this._onChange)},e}(),f=function(e){function t(t){e.call(this,"focused"),this.getElementId=t}return __extends(t,e),t.prototype.renderElement=function(t,o,n){e.prototype.renderElement.call(this,t,o,n),n.setAttribute("role","option"),n.setAttribute("id",this.getElementId(o))},t}(a),v=function(){function e(e,t){var o=this;this.list=e,this.view=t,this.disposables=[],this.disposables.push(t.addListener("mousedown",function(e){return o.onMouseDown(e)})),this.disposables.push(t.addListener("click",function(e){return o.onPointer(e)})),this.disposables.push(t.addListener(s.EventType.Tap,function(e){return o.onPointer(e)}));var n=c.domEvent(t.domNode,"keydown"),i=u.mapEvent(n,function(e){return new h.StandardKeyboardEvent(e)});u.filterEvent(i,function(e){return e.keyCode===r.KeyCode.Enter})(this.onEnter,this,this.disposables),u.filterEvent(i,function(e){return e.keyCode===r.KeyCode.UpArrow})(this.onUpArrow,this,this.disposables),u.filterEvent(i,function(e){return e.keyCode===r.KeyCode.DownArrow})(this.onDownArrow,this,this.disposables),u.filterEvent(i,function(e){return e.keyCode===r.KeyCode.PageUp})(this.onPageUpArrow,this,this.disposables),u.filterEvent(i,function(e){return e.keyCode===r.KeyCode.PageDown})(this.onPageDownArrow,this,this.disposables)}return e.prototype.onMouseDown=function(e){e.preventDefault(),e.stopPropagation()},e.prototype.onPointer=function(e){e.preventDefault(),e.stopPropagation(),this.view.domNode.focus(),this.list.setFocus(e.index),this.list.setSelection(e.index)},e.prototype.onEnter=function(e){e.preventDefault(),e.stopPropagation(),(t=this.list).setSelection.apply(t,this.list.getFocus());var t},e.prototype.onUpArrow=function(e){e.preventDefault(),e.stopPropagation(),this.list.focusPrevious(),this.list.reveal(this.list.getFocus()[0]),this.view.domNode.focus()},e.prototype.onDownArrow=function(e){e.preventDefault(),e.stopPropagation(),this.list.focusNext(),this.list.reveal(this.list.getFocus()[0]),this.view.domNode.focus()},e.prototype.onPageUpArrow=function(e){e.preventDefault(),e.stopPropagation(),this.list.focusPreviousPage(),this.list.reveal(this.list.getFocus()[0]),this.view.domNode.focus()},e.prototype.onPageDownArrow=function(e){e.preventDefault(),e.stopPropagation(),this.list.focusNextPage(),this.list.reveal(this.list.getFocus()[0]),this.view.domNode.focus()},e.prototype.dispose=function(){this.disposables=o.dispose(this.disposables)},e}(),d={},g=function(){function e(t,o,n,i){var s=this;void 0===i&&(i=d),this.idPrefix="list_id_"+ ++e.InstanceCount,this.focus=new f(function(e){return s.getElementId(e)}),this.selection=new a("selected"),this.eventBufferer=new u.EventBufferer,n=n.map(function(e){return e=s.focus.wrapRenderer(e),e=s.selection.wrapRenderer(e)}),this.view=new l.ListView(t,o,n,i),this.view.domNode.setAttribute("role","listbox"),this.view.domNode.tabIndex=0,this.controller=new v(this,this.view),this.disposables=[this.focus,this.selection,this.view,this.controller],this._onDOMFocus=c.domEvent(this.view.domNode,"focus"),this.onFocusChange(this._onFocusChange,this,this.disposables)}return Object.defineProperty(e.prototype,"onFocusChange",{get:function(){var e=this;return this.eventBufferer.wrapEvent(u.mapEvent(this.focus.onChange,function(t){return e.toListEvent(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSelectionChange",{get:function(){var e=this;return this.eventBufferer.wrapEvent(u.mapEvent(this.selection.onChange,function(t){return e.toListEvent(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDOMFocus",{get:function(){return this._onDOMFocus},enumerable:!0,configurable:!0}),e.prototype.splice=function(e,t){for(var o=this,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];this.eventBufferer.bufferEvents(function(){o.focus.splice(e,t,n.length),o.selection.splice(e,t,n.length),(i=o.view).splice.apply(i,[e,t].concat(n));var i})},Object.defineProperty(e.prototype,"length",{get:function(){return this.view.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this.view.getContentHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this.view.getScrollTop()},set:function(e){this.view.setScrollTop(e)},enumerable:!0,configurable:!0}),e.prototype.layout=function(e){this.view.layout(e)},e.prototype.setSelection=function(){for(var e=this,t=[],o=0;o<arguments.length;o++)t[o-0]=arguments[o];this.eventBufferer.bufferEvents(function(){t=t.concat((o=e.selection).set.apply(o,t)),t.forEach(function(t){return e.view.splice(t,1,e.view.element(t))});var o})},e.prototype.selectNext=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=!1),0!==this.length){var o=this.selection.get(),n=o.length>0?o[0]+e:0;this.setSelection(t?n%this.length:Math.min(n,this.length-1))}},e.prototype.selectPrevious=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=!1),0!==this.length){var o=this.selection.get(),n=o.length>0?o[0]-e:0;t&&n<0&&(n=this.length+n%this.length),this.setSelection(Math.max(n,0))}},e.prototype.getSelection=function(){return this.selection.get()},e.prototype.setFocus=function(){for(var e=this,t=[],o=0;o<arguments.length;o++)t[o-0]=arguments[o];this.eventBufferer.bufferEvents(function(){t=t.concat((o=e.focus).set.apply(o,t)),t.forEach(function(t){return e.view.splice(t,1,e.view.element(t))});var o})},e.prototype.focusNext=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=!1),0!==this.length){var o=this.focus.get(),n=o.length>0?o[0]+e:0;this.setFocus(t?n%this.length:Math.min(n,this.length-1))}},e.prototype.focusPrevious=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=!1),0!==this.length){var o=this.focus.get(),n=o.length>0?o[0]-e:0;t&&n<0&&(n=(this.length+n%this.length)%this.length),this.setFocus(Math.max(n,0))}},e.prototype.focusNextPage=function(){var e=this,t=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);t=0===t?0:t-1;var o=this.view.element(t),n=this.getFocusedElements()[0];if(n!==o)this.setFocus(t);else{var i=this.view.getScrollTop();this.view.setScrollTop(i+this.view.renderHeight-this.view.elementHeight(t)),this.view.getScrollTop()!==i&&setTimeout(function(){return e.focusNextPage()},0)}},e.prototype.focusPreviousPage=function(){var e,t=this,o=this.view.getScrollTop();e=0===o?this.view.indexAt(o):this.view.indexAfter(o-1);var n=this.view.element(e),i=this.getFocusedElements()[0];if(i!==n)this.setFocus(e);else{var s=o;this.view.setScrollTop(o-this.view.renderHeight),this.view.getScrollTop()!==s&&setTimeout(function(){return t.focusPreviousPage()},0)}},e.prototype.getFocus=function(){return this.focus.get()},e.prototype.getFocusedElements=function(){var e=this;return this.getFocus().map(function(t){return e.view.element(t)})},e.prototype.reveal=function(e,t){var o=this.view.getScrollTop(),i=this.view.elementTop(e),s=this.view.elementHeight(e);if(n.isNumber(t)){t=t<0?0:t,t=t>1?1:t;var r=s-this.view.renderHeight;this.view.setScrollTop(r*t+i)}else{var h=i+s,u=o+this.view.renderHeight;i<o?this.view.setScrollTop(i):h>=u&&this.view.setScrollTop(h-this.view.renderHeight)}},e.prototype.getElementId=function(e){return this.idPrefix+"_"+e},e.prototype.toListEvent=function(e){var t=this,o=e.indexes;return{indexes:o,elements:o.map(function(e){return t.view.element(e)})}},e.prototype._onFocusChange=function(){i.toggleClass(this.view.domNode,"element-focused",this.focus.get().length>0)},e.prototype.dispose=function(){this.disposables=o.dispose(this.disposables)},e.InstanceCount=0,e}();t.List=g});