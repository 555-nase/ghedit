var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};define(["require","exports","vs/base/common/winjs.base","vs/base/common/types","vs/base/common/lifecycle","vs/base/common/strings","vs/base/common/assert","vs/base/browser/dom","vs/css!./builder"],function(t,e,n,r,i,o,s,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function u(t,e){s.ok(r.isString(t),"Expected String as parameter");var n=document.getElementById(t);return n?new T(n,e):null}function h(t){return t[v]||(t[v]={}),t[v]}function c(t){return!!t[v]}function p(t,e){return t instanceof O?new O(t):new T(t.getHTMLElement(),e)}function d(t,e){return new T(t,e)}function a(){return new T(null,(!0))}function f(t,e,n){h(t)[e]=n}function m(t,e,n){if(c(t)){var i=h(t)[e];if(!r.isUndefined(i))return i}return n}function y(t,e){c(t)&&delete h(t)[e]}function E(t,e){f(t,w,e)}function b(t){y(t,w)}function g(t){return m(t,w)}e.withElementById=u,e.Build={withElementById:u};var v="_msDataKey",w="__$binding",x="__$listeners",S="__$visibility",C=function(){function t(t,e){this.x=t,this.y=e}return t}();e.Position=C;var P=function(){function t(t,e,n,r){this.top=t,this.right=e,this.bottom=n,this.left=r}return t}();e.Box=P;var U=function(){function t(t,e){this.width=t,this.height=e}return t.prototype.substract=function(e){return new t(this.width-e.left-e.right,this.height-e.top-e.bottom)},t}();e.Dimension=U;var T=function(){function t(t,e){this.offdom=e,this.container=t,this.currentElement=t,this.createdElements=[],this.toUnbind={},this.captureToUnbind={}}return t.prototype.asContainer=function(){return p(this,this.offdom)},t.prototype.clone=function(){var e=new t(this.container,this.offdom);return e.currentElement=this.currentElement,e.createdElements=this.createdElements,e.captureToUnbind=this.captureToUnbind,e.toUnbind=this.toUnbind,e},t.prototype.and=function(e){e instanceof t||e instanceof O||(e=new t(e,this.offdom));var n=[this];if(e instanceof O)for(var r=0;r<e.length;r++)n.push(e.item(r));else n.push(e);return new O(n)},t.prototype.build=function(e,n){s.ok(this.offdom,"This builder was not created off-dom, so build() can not be called."),e?e instanceof t&&(e=e.getHTMLElement()):e=this.container,s.ok(e,"Builder can only be build() with a container provided."),s.ok(l.isHTMLElement(e),"The container must either be a HTMLElement or a Builder.");var i,o,u=e,h=u.childNodes;if(r.isNumber(n)&&n<h.length)for(i=0,o=this.createdElements.length;i<o;i++)u.insertBefore(this.createdElements[i],h[n++]);else for(i=0,o=this.createdElements.length;i<o;i++)u.appendChild(this.createdElements[i]);return this},t.prototype.appendTo=function(e,n){e?e instanceof t&&(e=e.getHTMLElement()):e=this.container,s.ok(e,"Builder can only be build() with a container provided."),s.ok(l.isHTMLElement(e),"The container must either be a HTMLElement or a Builder.");var i=e;this.currentElement.parentNode&&this.currentElement.parentNode.removeChild(this.currentElement);var o=i.childNodes;return r.isNumber(n)&&n<o.length?i.insertBefore(this.currentElement,o[n]):i.appendChild(this.currentElement),this},t.prototype.append=function(e,n){return s.ok(e,"Need a child to append"),l.isHTMLElement(e)&&(e=d(e)),s.ok(e instanceof t||e instanceof O,"Need a child to append"),e.appendTo(this,n),this},t.prototype.offDOM=function(){return this.currentElement.parentNode&&this.currentElement.parentNode.removeChild(this.currentElement),this},t.prototype.getHTMLElement=function(){return this.currentElement},t.prototype.getContainer=function(){return this.container},t.prototype.div=function(t,e){return this.doElement("div",t,e)},t.prototype.p=function(t,e){return this.doElement("p",t,e)},t.prototype.ul=function(t,e){return this.doElement("ul",t,e)},t.prototype.ol=function(t,e){return this.doElement("ol",t,e)},t.prototype.li=function(t,e){return this.doElement("li",t,e)},t.prototype.span=function(t,e){return this.doElement("span",t,e)},t.prototype.img=function(t,e){return this.doElement("img",t,e)},t.prototype.a=function(t,e){return this.doElement("a",t,e)},t.prototype.header=function(t,e){return this.doElement("header",t,e)},t.prototype.section=function(t,e){return this.doElement("section",t,e)},t.prototype.footer=function(t,e){return this.doElement("footer",t,e)},t.prototype.element=function(t,e,n){return this.doElement(t,e,n)},t.prototype.doElement=function(e,n,i){var o=document.createElement(e);if(this.currentElement=o,this.offdom&&this.createdElements.push(o),r.isObject(n)&&this.attr(n),r.isFunction(n)&&(i=n),r.isFunction(i)){var s=new t(o);i.call(s,s)}return this.offdom||this.container.appendChild(o),this},t.prototype.domFocus=function(){return this.currentElement.focus(),this},t.prototype.hasFocus=function(){var t=document.activeElement;return t===this.currentElement},t.prototype.domSelect=function(t){void 0===t&&(t=null);var e=this.currentElement;return e.select(),t&&e.setSelectionRange(t.start,t.end),this},t.prototype.domBlur=function(){return this.currentElement.blur(),this},t.prototype.domClick=function(){return this.currentElement.click(),this},t.prototype.on=function(t,e,n,i){var o=this;if(r.isArray(t))t.forEach(function(t){o.on(t,e,n,i)});else{var s=t,u=l.addDisposableListener(this.currentElement,s,function(t){e(t,o,u)},i||!1);i?(this.captureToUnbind[s]||(this.captureToUnbind[s]=[]),this.captureToUnbind[s].push(u)):(this.toUnbind[s]||(this.toUnbind[s]=[]),this.toUnbind[s].push(u));var h=this.getProperty(x,[]);h.push(u),this.setProperty(x,h),n&&r.isArray(n)&&n.push(u)}return this},t.prototype.off=function(t,e){var n=this;if(r.isArray(t))t.forEach(function(t){n.off(t)});else{var o=t;e?this.captureToUnbind[o]&&(this.captureToUnbind[o]=i.dispose(this.captureToUnbind[o])):this.toUnbind[o]&&(this.toUnbind[o]=i.dispose(this.toUnbind[o]))}return this},t.prototype.once=function(t,e,n,i){var o=this;if(r.isArray(t))t.forEach(function(t){o.once(t,e)});else{var s=t,u=l.addDisposableListener(this.currentElement,s,function(t){e(t,o,u),u.dispose()},i||!1);n&&r.isArray(n)&&n.push(u)}return this},t.prototype.preventDefault=function(t,e,n,r){var i=function(t){t.preventDefault(),e&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)};return this.on(t,i,n)},t.prototype.attr=function(t,e){if(r.isObject(t)){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];this.doSetAttr(n,i)}return this}return r.isString(t)&&!r.isString(e)?this.currentElement.getAttribute(t):(r.isString(t)&&(r.isString(e)||(e=String(e)),this.doSetAttr(t,e)),this)},t.prototype.doSetAttr=function(t,e){"class"===t&&(t="addClass"),this[t]?r.isArray(e)?this[t].apply(this,e):this[t].call(this,e):this.currentElement.setAttribute(t,e)},t.prototype.removeAttribute=function(t){this.currentElement.removeAttribute(t)},t.prototype.id=function(t){return this.currentElement.setAttribute("id",t),this},t.prototype.src=function(t){return this.currentElement.setAttribute("src",t),this},t.prototype.href=function(t){return this.currentElement.setAttribute("href",t),this},t.prototype.title=function(t){return this.currentElement.setAttribute("title",t),this},t.prototype.name=function(t){return this.currentElement.setAttribute("name",t),this},t.prototype.type=function(t){return this.currentElement.setAttribute("type",t),this},t.prototype.value=function(t){return this.currentElement.setAttribute("value",t),this},t.prototype.alt=function(t){return this.currentElement.setAttribute("alt",t),this},t.prototype.draggable=function(t){return this.currentElement.setAttribute("draggable",t?"true":"false"),this},t.prototype.tabindex=function(t){return this.currentElement.setAttribute("tabindex",t.toString()),this},t.prototype.style=function(t,e){if(r.isObject(t)){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];this.doSetStyle(n,i)}}else{if(r.isString(t)&&!r.isString(e))return this.currentElement.style[this.cssKeyToJavaScriptProperty(t)];r.isString(t)&&r.isString(e)&&this.doSetStyle(t,e)}return this},t.prototype.doSetStyle=function(t,e){if(t.indexOf("-")>=0){var n=t.split("-");t=n[0];for(var r=1;r<n.length;r++){var i=n[r];t=t+i.charAt(0).toUpperCase()+i.substr(1)}}this.currentElement.style[this.cssKeyToJavaScriptProperty(t)]=e},t.prototype.cssKeyToJavaScriptProperty=function(t){if(t.indexOf("-")>=0){var e=t.split("-");t=e[0];for(var n=1;n<e.length;n++){var r=e[n];t=t+r.charAt(0).toUpperCase()+r.substr(1)}}else"float"===t&&(t="cssFloat");return t},t.prototype.getComputedStyle=function(){return l.getComputedStyle(this.currentElement)},t.prototype.addClass=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.forEach(function(e){var n=e.split(" ");n.forEach(function(e){l.addClass(t.currentElement,e)})}),this},t.prototype.setClass=function(t,e){return void 0===e&&(e=null),null===e?this.currentElement.className=t:e?this.addClass(t):this.removeClass(t),this},t.prototype.hasClass=function(t){return l.hasClass(this.currentElement,t)},t.prototype.removeClass=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.forEach(function(e){var n=e.split(" ");n.forEach(function(e){l.removeClass(t.currentElement,e)})}),this},t.prototype.swapClass=function(t,e){return this.hasClass(t)?(this.removeClass(t),this.addClass(e)):(this.removeClass(e),this.addClass(t)),this},t.prototype.toggleClass=function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},t.prototype.color=function(t){return this.currentElement.style.color=t,this},t.prototype.background=function(t){return this.currentElement.style.backgroundColor=t,this},t.prototype.padding=function(t,e,n,i){return r.isString(t)&&t.indexOf(" ")>=0?this.padding.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.paddingTop=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.paddingRight=this.toPixel(e)),r.isUndefinedOrNull(n)||(this.currentElement.style.paddingBottom=this.toPixel(n)),r.isUndefinedOrNull(i)||(this.currentElement.style.paddingLeft=this.toPixel(i)),this)},t.prototype.margin=function(t,e,n,i){return r.isString(t)&&t.indexOf(" ")>=0?this.margin.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.marginTop=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.marginRight=this.toPixel(e)),r.isUndefinedOrNull(n)||(this.currentElement.style.marginBottom=this.toPixel(n)),r.isUndefinedOrNull(i)||(this.currentElement.style.marginLeft=this.toPixel(i)),this)},t.prototype.position=function(t,e,n,i,o){return r.isString(t)&&t.indexOf(" ")>=0?this.position.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.top=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.right=this.toPixel(e)),r.isUndefinedOrNull(n)||(this.currentElement.style.bottom=this.toPixel(n)),r.isUndefinedOrNull(i)||(this.currentElement.style.left=this.toPixel(i)),o||(o="absolute"),this.currentElement.style.position=o,this)},t.prototype.size=function(t,e){return r.isString(t)&&t.indexOf(" ")>=0?this.size.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.width=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.height=this.toPixel(e)),this)},t.prototype.minSize=function(t,e){return r.isString(t)&&t.indexOf(" ")>=0?this.minSize.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.minWidth=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.minHeight=this.toPixel(e)),this)},t.prototype.maxSize=function(t,e){return r.isString(t)&&t.indexOf(" ")>=0?this.maxSize.apply(this,t.split(" ")):(r.isUndefinedOrNull(t)||(this.currentElement.style.maxWidth=this.toPixel(t)),r.isUndefinedOrNull(e)||(this.currentElement.style.maxHeight=this.toPixel(e)),this)},t.prototype["float"]=function(t){return this.currentElement.style.cssFloat=t,this},t.prototype.clear=function(t){return this.currentElement.style.clear=t,this},t.prototype.normal=function(){return this.currentElement.style.fontStyle="normal",this.currentElement.style.fontWeight="normal",this.currentElement.style.textDecoration="none",this},t.prototype.italic=function(){return this.currentElement.style.fontStyle="italic",this},t.prototype.bold=function(){return this.currentElement.style.fontWeight="bold",this},t.prototype.underline=function(){return this.currentElement.style.textDecoration="underline",this},t.prototype.overflow=function(t){return this.currentElement.style.overflow=t,this},t.prototype.display=function(t){return this.currentElement.style.display=t,this},t.prototype.disable=function(){return this.currentElement.setAttribute("disabled","disabled"),this},t.prototype.enable=function(){return this.currentElement.removeAttribute("disabled"),this},t.prototype.show=function(){return this.hasClass("hidden")&&this.removeClass("hidden"),this.attr("aria-hidden","false"),this.cancelVisibilityPromise(),this},t.prototype.showDelayed=function(t){var e=this;this.cancelVisibilityPromise();var r=n.TPromise.timeout(t);return this.setProperty(S,r),r.done(function(){e.removeProperty(S),e.show()}),this},t.prototype.hide=function(){return this.hasClass("hidden")||this.addClass("hidden"),this.attr("aria-hidden","true"),this.cancelVisibilityPromise(),this},t.prototype.isHidden=function(){return this.hasClass("hidden")||"none"===this.currentElement.style.display},t.prototype.toggleVisibility=function(){return this.cancelVisibilityPromise(),this.swapClass("builder-visible","hidden"),this.isHidden()?this.attr("aria-hidden","true"):this.attr("aria-hidden","false"),this},t.prototype.cancelVisibilityPromise=function(){var t=this.getProperty(S);t&&(t.cancel(),this.removeProperty(S))},t.prototype.border=function(t,e,n){return r.isString(t)&&t.indexOf(" ")>=0?this.border.apply(this,t.split(" ")):(this.currentElement.style.borderWidth=this.toPixel(t),n&&(this.currentElement.style.borderColor=n),e&&(this.currentElement.style.borderStyle=e),this)},t.prototype.borderTop=function(t,e,n){return r.isString(t)&&t.indexOf(" ")>=0?this.borderTop.apply(this,t.split(" ")):(this.currentElement.style.borderTopWidth=this.toPixel(t),n&&(this.currentElement.style.borderTopColor=n),e&&(this.currentElement.style.borderTopStyle=e),this)},t.prototype.borderBottom=function(t,e,n){return r.isString(t)&&t.indexOf(" ")>=0?this.borderBottom.apply(this,t.split(" ")):(this.currentElement.style.borderBottomWidth=this.toPixel(t),n&&(this.currentElement.style.borderBottomColor=n),e&&(this.currentElement.style.borderBottomStyle=e),this)},t.prototype.borderLeft=function(t,e,n){return r.isString(t)&&t.indexOf(" ")>=0?this.borderLeft.apply(this,t.split(" ")):(this.currentElement.style.borderLeftWidth=this.toPixel(t),n&&(this.currentElement.style.borderLeftColor=n),e&&(this.currentElement.style.borderLeftStyle=e),this)},t.prototype.borderRight=function(t,e,n){return r.isString(t)&&t.indexOf(" ")>=0?this.borderRight.apply(this,t.split(" ")):(this.currentElement.style.borderRightWidth=this.toPixel(t),n&&(this.currentElement.style.borderRightColor=n),e&&(this.currentElement.style.borderRightStyle=e),this)},t.prototype.textAlign=function(t){return this.currentElement.style.textAlign=t,this},t.prototype.verticalAlign=function(t){return this.currentElement.style.verticalAlign=t,this},t.prototype.toPixel=function(t){return t.toString().indexOf("px")===-1?t.toString()+"px":t},t.prototype.innerHtml=function(t,e){return e?this.currentElement.innerHTML+=t:this.currentElement.innerHTML=t,this},t.prototype.text=function(t,e){return e?0===this.currentElement.children.length?this.currentElement.textContent+=t:this.currentElement.appendChild(document.createTextNode(t)):this.currentElement.textContent=t,this},t.prototype.safeInnerHtml=function(t,e){return this.innerHtml(o.escape(t),e)},t.prototype.bind=function(t){return E(this.currentElement,t),this},t.prototype.unbind=function(){return b(this.currentElement),this},t.prototype.getBinding=function(){return g(this.currentElement)},t.prototype.setProperty=function(t,e){return f(this.currentElement,t,e),this},t.prototype.getProperty=function(t,e){return m(this.currentElement,t,e)},t.prototype.removeProperty=function(t){return c(this.currentElement)&&delete h(this.currentElement)[t],this},t.prototype.parent=function(t){return s.ok(!this.offdom,"Builder was created with offdom = true and thus has no parent set"),d(this.currentElement.parentNode,t)},t.prototype.children=function(t){for(var e=this.currentElement.children,n=[],r=0;r<e.length;r++)n.push(d(e.item(r),t));return new O(n)},t.prototype.child=function(t){void 0===t&&(t=0);var e=this.currentElement.children;return d(e.item(t))},t.prototype.removeChild=function(t){return this.currentElement===t.parent().getHTMLElement()&&this.currentElement.removeChild(t.getHTMLElement()),this},t.prototype.select=function(t,e){s.ok(r.isString(t),"Expected String as parameter");for(var n=this.currentElement.querySelectorAll(t),i=[],o=0;o<n.length;o++)i.push(d(n.item(o),e));return new O(i)},t.prototype.matches=function(t){var e=this.currentElement,n=e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;return n&&n.call(e,t)},t.prototype.isEmpty=function(){return!this.currentElement.childNodes||0===this.currentElement.childNodes.length},t.prototype.unbindDescendants=function(t){if(t&&t.children)for(var e=0,n=t.children.length;e<n;e++){var i=t.children.item(e);if(c(i)){var o=h(i)[x];if(r.isArray(o))for(;o.length;)o.pop().dispose();delete i[v]}this.unbindDescendants(i)}},t.prototype.empty=function(){return this.unbindDescendants(this.currentElement),this.clearChildren(),this.offdom&&(this.createdElements=[]),this},t.prototype.clearChildren=function(){return this.currentElement&&l.clearNode(this.currentElement),this},t.prototype.destroy=function(){if(this.currentElement&&(this.currentElement.parentNode&&this.currentElement.parentNode.removeChild(this.currentElement),this.empty(),c(this.currentElement))){var t=h(this.currentElement)[x];if(r.isArray(t))for(;t.length;)t.pop().dispose();delete this.currentElement[v]}var e;for(e in this.toUnbind)this.toUnbind.hasOwnProperty(e)&&r.isArray(this.toUnbind[e])&&(this.toUnbind[e]=i.dispose(this.toUnbind[e]));for(e in this.captureToUnbind)this.captureToUnbind.hasOwnProperty(e)&&r.isArray(this.captureToUnbind[e])&&(this.captureToUnbind[e]=i.dispose(this.captureToUnbind[e]));this.currentElement=null,this.container=null,this.offdom=null,this.createdElements=null,this.captureToUnbind=null,this.toUnbind=null},t.prototype.dispose=function(){this.destroy()},t.prototype.getTotalSize=function(){var t=l.getTotalWidth(this.currentElement),e=l.getTotalHeight(this.currentElement);return new U(t,e)},t.prototype.getContentSize=function(){var t=l.getContentWidth(this.currentElement),e=l.getContentHeight(this.currentElement);return new U(t,e)},t.prototype.getClientArea=function(){if(this.currentElement!==document.body)return new U(this.currentElement.clientWidth,this.currentElement.clientHeight);if(window.innerWidth&&window.innerHeight)return new U(window.innerWidth,window.innerHeight);if(document.body&&document.body.clientWidth&&document.body.clientWidth)return new U(document.body.clientWidth,document.body.clientHeight);if(document.documentElement&&document.documentElement.clientWidth&&document.documentElement.clientHeight)return new U(document.documentElement.clientWidth,document.documentElement.clientHeight);throw new Error("Unable to figure out browser width and height")},t}();e.Builder=T;var O=function(t){function e(n){if(s.ok(r.isArray(n)||n instanceof e,"Expected Array or MultiBuilder as parameter"),t.call(this),this.length=0,this.builders=[],r.isArray(n))for(var i=0;i<n.length;i++)n[i]instanceof HTMLElement?this.push(d(n[i])):this.push(n[i]);else for(var i=0;i<n.length;i++)this.push(n.item(i));var o=this,l=function(t){o[t]=function(){for(var n,i=Array.prototype.slice.call(arguments),s=!1,l=0;l<o.length;l++){var u=o.item(l)[t].apply(o.item(l),i);if(u instanceof e){n||(n=[]),s=!0;for(var h=0;h<u.length;h++)n.push(u.item(h))}else r.isUndefined(u)||u instanceof T||(n||(n=[]),n.push(u))}return n&&s?new e(n):n||o}};for(var u in T.prototype)"clone"!==u&&"and"!==u&&T.prototype.hasOwnProperty(u)&&r.isFunction(T.prototype[u])&&l(u)}return __extends(e,t),e.prototype.item=function(t){return this.builders[t]},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.builders.push(t[n]);this.length=this.builders.length},e.prototype.pop=function(){var t=this.builders.pop();return this.length=this.builders.length,t},e.prototype.concat=function(t){var e=this.builders.concat(t);return this.length=this.builders.length,e},e.prototype.shift=function(){var t=this.builders.shift();return this.length=this.builders.length,t},e.prototype.unshift=function(t){var e=this.builders.unshift(t);return this.length=this.builders.length,e},e.prototype.slice=function(t,e){var n=this.builders.slice(t,e);return this.length=this.builders.length,n},e.prototype.splice=function(t,e){var n=this.builders.splice(t,e);return this.length=this.builders.length,n},e.prototype.clone=function(){return new e(this)},e.prototype.and=function(t){t instanceof T||t instanceof e||(t=new T(t));var n=[];if(t instanceof e)for(var r=0;r<t.length;r++)n.push(t.item(r));else n.push(t);return this.push.apply(this,n),this},e}(T);e.MultiBuilder=O,e.setPropertyOnElement=f,e.getPropertyFromElement=m,e.removePropertyFromElement=y,e.bindElement=E,e.unbindElement=b,e.getBindingFromElement=g,e.Binding={setPropertyOnElement:f,getPropertyFromElement:m,removePropertyFromElement:y,bindElement:E,unbindElement:b,getBindingFromElement:g};var A=/([\w\-]+)?(#([\w\-]+))?((.([\w\-]+))*)/;e.$=function(t){if(r.isUndefined(t))return a();if(!t)throw new Error("Bad use of $");if(l.isHTMLElement(t)||t===window)return d(t);if(r.isArray(t))return new O(t);if(t instanceof T)return p(t);if(r.isString(t)){if("<"===t[0]){var e=void 0,n=document.createElement("div");if(n.innerHTML=o.format.apply(o,arguments),0===n.children.length)throw new Error("Bad use of $");if(1===n.children.length)return e=n.firstChild,n.removeChild(e),d(e);for(var i=[];n.firstChild;)e=n.firstChild,n.removeChild(e),i.push(d(e));return new O(i)}if(1===arguments.length){var s=A.exec(t);if(!s)throw new Error("Bad use of $");var u=s[1]||"div",h=s[3]||void 0,c=(s[4]||"").replace(/\./g," "),f={};return h&&(f.id=h),c&&(f["class"]=c),a().element(u,f)}var m=a();return m.element.apply(m,arguments),m}throw new Error("Bad use of $")},e.$.Box=P,e.$.Dimension=U,e.$.Position=C,e.$.Builder=T,e.$.MultiBuilder=O,e.$.Build=e.Build,e.$.Binding=e.Binding});