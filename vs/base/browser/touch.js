define(["require","exports","vs/base/common/arrays","vs/base/common/lifecycle","vs/base/browser/dom"],function(e,t,a,i,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var r;!function(e){e.Tap="-monaco-gesturetap",e.Change="-monaco-gesturechange",e.Start="-monaco-gesturestart",e.End="-monaco-gesturesend",e.Contextmenu="-monaco-gesturecontextmenu"}(r=t.EventType||(t.EventType={}));var o=function(){function e(e){this.callOnTarget=[],this.activeTouches={},this.target=e,this.handle=null}return e.prototype.dispose=function(){this.target=null,this.handle&&(this.handle.dispose(),this.handle=null)},Object.defineProperty(e.prototype,"target",{set:function(e){var t=this;this.callOnTarget=i.dispose(this.callOnTarget),this.activeTouches={},this.targetElement=e,this.targetElement&&(this.callOnTarget.push(n.addDisposableListener(this.targetElement,"touchstart",function(e){return t.onTouchStart(e)})),this.callOnTarget.push(n.addDisposableListener(this.targetElement,"touchend",function(e){return t.onTouchEnd(e)})),this.callOnTarget.push(n.addDisposableListener(this.targetElement,"touchmove",function(e){return t.onTouchMove(e)})))},enumerable:!0,configurable:!0}),e.newGestureEvent=function(e){var t=document.createEvent("CustomEvent");return t.initEvent(e,!1,!0),t},e.prototype.onTouchStart=function(t){var a=Date.now();t.preventDefault(),t.stopPropagation(),this.handle&&(this.handle.dispose(),this.handle=null);for(var i=0,n=t.targetTouches.length;i<n;i++){var o=t.targetTouches.item(i);this.activeTouches[o.identifier]={id:o.identifier,initialTarget:o.target,initialTimeStamp:a,initialPageX:o.pageX,initialPageY:o.pageY,rollingTimestamps:[a],rollingPageX:[o.pageX],rollingPageY:[o.pageY]};var s=e.newGestureEvent(r.Start);s.pageX=o.pageX,s.pageY=o.pageY,this.targetElement.dispatchEvent(s)}},e.prototype.onTouchEnd=function(t){var i=Date.now();t.preventDefault(),t.stopPropagation();for(var n=Object.keys(this.activeTouches).length,o=0,s=t.changedTouches.length;o<s;o++){var l=t.changedTouches.item(o);if(this.activeTouches.hasOwnProperty(String(l.identifier))){var g=this.activeTouches[l.identifier],h=Date.now()-g.initialTimeStamp;if(h<e.HOLD_DELAY&&Math.abs(g.initialPageX-a.tail(g.rollingPageX))<30&&Math.abs(g.initialPageY-a.tail(g.rollingPageY))<30){var c=e.newGestureEvent(r.Tap);c.initialTarget=g.initialTarget,c.pageX=a.tail(g.rollingPageX),c.pageY=a.tail(g.rollingPageY),this.targetElement.dispatchEvent(c)}else if(h>=e.HOLD_DELAY&&Math.abs(g.initialPageX-a.tail(g.rollingPageX))<30&&Math.abs(g.initialPageY-a.tail(g.rollingPageY))<30){var c=e.newGestureEvent(r.Contextmenu);c.initialTarget=g.initialTarget,c.pageX=a.tail(g.rollingPageX),c.pageY=a.tail(g.rollingPageY),this.targetElement.dispatchEvent(c)}else if(1===n){var u=a.tail(g.rollingPageX),p=a.tail(g.rollingPageY),v=a.tail(g.rollingTimestamps)-g.rollingTimestamps[0],d=u-g.rollingPageX[0],m=p-g.rollingPageY[0];this.inertia(i,Math.abs(d)/v,d>0?1:-1,u,Math.abs(m)/v,m>0?1:-1,p)}delete this.activeTouches[l.identifier]}else console.warn("move of an UNKNOWN touch",l)}},e.prototype.inertia=function(t,a,i,o,s,l,g){var h=this;this.handle=n.scheduleAtNextAnimationFrame(function(){var n=Date.now(),c=n-t,u=0,p=0,v=!0;a+=e.SCROLL_FRICTION*c,s+=e.SCROLL_FRICTION*c,a>0&&(v=!1,u=i*a*c),s>0&&(v=!1,p=l*s*c);var d=e.newGestureEvent(r.Change);d.translationX=u,d.translationY=p,h.targetElement.dispatchEvent(d),v||h.inertia(n,a,i,o+u,s,l,g+p)})},e.prototype.onTouchMove=function(t){var i=Date.now();t.preventDefault(),t.stopPropagation();for(var n=0,o=t.changedTouches.length;n<o;n++){var s=t.changedTouches.item(n);if(this.activeTouches.hasOwnProperty(String(s.identifier))){var l=this.activeTouches[s.identifier],g=e.newGestureEvent(r.Change);g.translationX=s.pageX-a.tail(l.rollingPageX),g.translationY=s.pageY-a.tail(l.rollingPageY),g.pageX=s.pageX,g.pageY=s.pageY,this.targetElement.dispatchEvent(g),l.rollingPageX.length>3&&(l.rollingPageX.shift(),l.rollingPageY.shift(),l.rollingTimestamps.shift()),l.rollingPageX.push(s.pageX),l.rollingPageY.push(s.pageY),l.rollingTimestamps.push(i)}else console.warn("end of an UNKNOWN touch",s)}},e.HOLD_DELAY=700,e.SCROLL_FRICTION=-.005,e}();t.Gesture=o});