define(["require","exports","vs/base/common/strings","vs/editor/common/controller/cursorMoveHelper","vs/editor/common/core/range","vs/editor/common/core/selection","vs/editor/common/modes/languageConfigurationRegistry"],function(e,t,n,o,i,r,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var a=function(){function e(e,t){this._opts=t,this._selection=e,this._useLastEditRangeForCursorEndPosition=!1}return e.unshiftIndentCount=function(e,t,n){var i=o.CursorMoveHelper.visibleColumnFromColumn2(e,t,n),r=o.CursorMoveHelper.prevTabColumn(i,n);return r/n},e.shiftIndentCount=function(e,t,n){var i=o.CursorMoveHelper.visibleColumnFromColumn2(e,t,n),r=o.CursorMoveHelper.nextTabColumn(i,n);return r/n},e.prototype.getEditOperations=function(t,r){var a=this._selection.startLineNumber,u=this._selection.endLineNumber,l=" ".charCodeAt(0);1===this._selection.endColumn&&a!==u&&(u-=1);var d,c=this._opts.tabSize,h=this._opts.oneIndent,m=a===u,v=["",h];this._selection.isEmpty()&&/^\s*$/.test(t.getLineContent(a))&&(this._useLastEditRangeForCursorEndPosition=!0);var C=0,f=0;for(d=a;d<=u;d++,C=f){f=0;var p=t.getLineContent(d),g=n.firstNonWhitespaceIndex(p);if((!this._opts.isUnshift||0!==p.length&&0!==g)&&(m||this._opts.isUnshift||0!==p.length)){if(g===-1&&(g=p.length),d>1){var _=o.CursorMoveHelper.visibleColumnFromColumn2(p,g+1,c);if(_%c!==0){var b=s.LanguageConfigurationRegistry.getRawEnterActionAtPosition(t,d-1,t.getLineMaxColumn(d-1));if(b){if(f=C,b.appendText)for(var E=0,L=b.appendText.length;E<L&&f<c&&b.appendText.charCodeAt(E)===l;E++)f++;b.removeText&&(f=Math.max(0,f-b.removeText));for(var E=0;E<f&&(0!==g&&p.charCodeAt(g-1)===l);E++)g--}}}if(!this._opts.isUnshift||0!==g){var x=void 0;x=this._opts.isUnshift?e.unshiftIndentCount(p,g+1,c):e.shiftIndentCount(p,g+1,c);for(var E=v.length;E<=x;E++)v[E]=v[E-1]+h;r.addEditOperation(new i.Range(d,1,d,g+1),v[x])}}}this._selectionId=r.trackSelection(this._selection)},e.prototype.computeCursorState=function(e,t){if(this._useLastEditRangeForCursorEndPosition){var n=t.getInverseEditOperations()[0];return new r.Selection(n.range.endLineNumber,n.range.endColumn,n.range.endLineNumber,n.range.endColumn)}return t.getTrackedSelection(this._selectionId)},e}();t.ShiftCommand=a});