/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/event","vs/editor/common/modes/languageSelector"],function(e,r,t,i){"use strict";var o=function(){function e(){this._clock=0,this._entries=[],this._onDidChange=new t.Emitter}return Object.defineProperty(e.prototype,"onDidChange",{get:function(){return this._onDidChange.event},enumerable:!0,configurable:!0}),e.prototype.register=function(e,r,t){var i=this;void 0===t&&(t=!1);var o={selector:e,provider:r,isBuiltin:t,_score:-1,_time:this._clock++};return this._entries.push(o),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),{dispose:function(){if(o){var e=i._entries.indexOf(o);e>=0&&(i._entries.splice(e,1),i._lastCandidate=void 0,i._onDidChange.fire(i._entries.length),o=void 0)}}}},e.prototype.has=function(e){return this.all(e).length>0},e.prototype.all=function(e){if(!e||e.isTooLargeForHavingAMode())return[];this._updateScores(e);for(var r=[],t=0,i=this._entries;t<i.length;t++){var o=i[t];o._score>0&&r.push(o.provider)}return r},e.prototype.ordered=function(e){var r=[];return this._orderedForEach(e,function(e){return r.push(e.provider)}),r},e.prototype.orderedGroups=function(e){var r,t,i=[];return this._orderedForEach(e,function(e){r&&t===e._score?r.push(e.provider):(t=e._score,r=[e.provider],i.push(r))}),i},e.prototype._orderedForEach=function(e,r){if(e&&!e.isTooLargeForHavingAMode()){this._updateScores(e);for(var t=0;t<this._entries.length;t++){var i=this._entries[t];i._score>0&&r(i)}}},e.prototype._updateScores=function(r){var t={uri:r.uri.toString(),language:r.getModeId()};if(!this._lastCandidate||this._lastCandidate.language!==t.language||this._lastCandidate.uri!==t.uri){this._lastCandidate=t;for(var o=0,n=this._entries;o<n.length;o++){var s=n[o];s._score=i.score(s.selector,r.uri,r.getModeId()),s.isBuiltin&&s._score>0&&(s._score=.5,s._time=-1)}this._entries.sort(e._compareByScoreAndTime)}},e._compareByScoreAndTime=function(e,r){return e._score<r._score?1:e._score>r._score?-1:e._time<r._time?1:e._time>r._time?-1:0},e}();Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o});