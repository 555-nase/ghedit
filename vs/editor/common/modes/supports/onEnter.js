define(["require","exports","vs/base/common/errors","vs/base/common/strings","vs/editor/common/modes","vs/editor/common/modes/supports"],function(e,t,n,r,i,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var o=function(){function e(t,n,r){this._registry=t,r=r||{},r.brackets=r.brackets||[["(",")"],["{","}"],["[","]"]],this._modeId=n,this._brackets=r.brackets.map(function(t){return{open:t[0],openRegExp:e._createOpenBracketRegExp(t[0]),close:t[1],closeRegExp:e._createCloseBracketRegExp(t[1])}}),this._regExpRules=r.regExpRules||[],this._indentationRules=r.indentationRules}return e.prototype.onEnter=function(e,t){var n=this,r=e.getLineContext(t.lineNumber);return s.handleEvent(r,t.column-1,function(r,i,s){if(n._modeId===r)return n._onEnter(e,t);var o=n._registry.getOnEnterSupport(r);return o?o.onEnter(e,t):null})},e.prototype._onEnter=function(e,t){var n=e.getLineContent(t.lineNumber),r=n.substr(0,t.column-1),i=n.substr(t.column-1),s=1===t.lineNumber?"":e.getLineContent(t.lineNumber-1);return this._actualOnEnter(s,r,i)},e.prototype._actualOnEnter=function(t,n,r){for(var i=0,s=this._regExpRules.length;i<s;i++){var o=this._regExpRules[i];if(o.beforeText.test(n)){if(!o.afterText)return o.action;if(o.afterText.test(r))return o.action}}if(n.length>0&&r.length>0)for(var i=0,s=this._brackets.length;i<s;i++){var a=this._brackets[i];if(a.openRegExp.test(n)&&a.closeRegExp.test(r))return e._INDENT_OUTDENT}if(this._indentationRules){if(this._indentationRules.increaseIndentPattern&&this._indentationRules.increaseIndentPattern.test(n))return e._INDENT;if(this._indentationRules.indentNextLinePattern&&this._indentationRules.indentNextLinePattern.test(n))return e._INDENT;if(/^\s/.test(n)){if(this._indentationRules.decreaseIndentPattern&&this._indentationRules.decreaseIndentPattern.test(r))return e._OUTDENT;if(this._indentationRules.indentNextLinePattern&&this._indentationRules.indentNextLinePattern.test(t))return e._OUTDENT}}if(n.length>0)for(var i=0,s=this._brackets.length;i<s;i++){var a=this._brackets[i];if(a.openRegExp.test(n))return e._INDENT}return null},e._createOpenBracketRegExp=function(t){var n=r.escapeRegExpCharacters(t);return/\B/.test(n.charAt(0))||(n="\\b"+n),n+="\\s*$",e._safeRegExp(n)},e._createCloseBracketRegExp=function(t){var n=r.escapeRegExpCharacters(t);return/\B/.test(n.charAt(n.length-1))||(n+="\\b"),n="^\\s*"+n,e._safeRegExp(n)},e._safeRegExp=function(e){try{return new RegExp(e)}catch(t){return n.onUnexpectedError(t),null}},e._INDENT={indentAction:i.IndentAction.Indent},e._INDENT_OUTDENT={indentAction:i.IndentAction.IndentOutdent},e._OUTDENT={indentAction:i.IndentAction.Outdent},e}();t.OnEnterSupport=o});