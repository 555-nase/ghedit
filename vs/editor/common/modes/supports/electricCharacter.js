define(["require","exports","vs/base/common/strings","vs/editor/common/modes/supports","vs/editor/common/modes/supports/richEditBrackets"],function(t,e,r,n,i){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var o=function(){function t(t,e,r,n,i){this._registry=t,this._modeId=e,this.contribution=i||{},this.brackets=new c(e,r,n,this.contribution.docComment)}return t.prototype.getElectricCharacters=function(){return Array.isArray(this.contribution.embeddedElectricCharacters)?this.contribution.embeddedElectricCharacters.concat(this.brackets.getElectricCharacters()):this.brackets.getElectricCharacters()},t.prototype.onElectricCharacter=function(t,e){var r=this;return n.handleEvent(t,e,function(t,e,n){if(r._modeId===t)return r.brackets.onElectricCharacter(e,n);var i=r._registry.getElectricCharacterSupport(t);return i?i.onElectricCharacter(e,n):null})},t}();e.BracketElectricCharacterSupport=o;var c=function(){function t(t,e,r,n){this._modeId=t,this._richEditBrackets=e,this._complexAutoClosePairs=r.filter(function(t){return t.open.length>1&&!!t.close}),n&&this._complexAutoClosePairs.push({open:n.open,close:n.close})}return t.prototype.getElectricCharacters=function(){var t=[];if(this._richEditBrackets)for(var e=0,r=this._richEditBrackets.brackets.length;e<r;e++){var n=this._richEditBrackets.brackets[e],i=n.close.charAt(n.close.length-1);t.push(i)}for(var o=0,c=this._complexAutoClosePairs;o<c.length;o++){var s=c[o];t.push(s.open.charAt(s.open.length-1))}return t=t.filter(function(t,e,r){return r.indexOf(t)===e})},t.prototype.onElectricCharacter=function(t,e){return 0===t.getTokenCount()?null:this._onElectricAutoClose(t,e)||this._onElectricAutoIndent(t,e)},t.prototype.containsTokenTypes=function(t,e){for(var r=e.split("."),n=0;n<r.length;++n)if(t.indexOf(r[n])<0)return!1;return!0},t.prototype._onElectricAutoIndent=function(t,e){if(!this._richEditBrackets||0===this._richEditBrackets.brackets.length)return null;var o=this._richEditBrackets.reversedRegex,c=t.getLineContent(),s=t.findIndexOfOffset(e),a=t.getTokenStartIndex(s),u=e+1,h=r.firstNonWhitespaceIndex(t.getLineContent());if(h!==-1&&h<a)return null;if(!n.ignoreBracketsInToken(t.getTokenType(s))){var l=i.BracketsUtils.findPrevBracketInToken(o,1,c,a,u);if(l){var f=c.substring(l.startColumn-1,l.endColumn-1),p=this._richEditBrackets.textIsOpenBracket[f];if(!p)return{matchOpenBracket:f}}}return null},t.prototype._onElectricAutoClose=function(t,e){var r=this;if(!this._complexAutoClosePairs.length)return null;for(var n=t.getLineContent(),i=n[e],o=function(o){var s=c._complexAutoClosePairs[o];if(i!==s.open.charAt(s.open.length-1))return"continue";if(n.indexOf(s.close,e)>=0)return"continue";var a=t.findIndexOfOffset(e);if(n.substring(t.getTokenStartIndex(a),e+1)!==s.open)return"continue";if(s.notIn){var u=t.getTokenType(a);if(s.notIn.some(function(t){return r.containsTokenTypes(u,t)}))return"continue"}return{value:{appendText:s.close}}},c=this,s=0;s<this._complexAutoClosePairs.length;s++){var a=o(s);if("object"==typeof a)return a.value}},t}();e.Brackets=c});