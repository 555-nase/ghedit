var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define(["require","exports","vs/editor/common/modes/abstractState","vs/editor/common/modes/lineStream","vs/editor/common/modes/monarch/monarchCommon","vs/editor/common/modes/supports/tokenizationSupport"],function(e,t,r,s,n,i){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function o(e,t){if(!t)return null;t=n.fixCase(e,t);for(var r=e.brackets,s=0;s<r.length;s++){var i=r[s];if(i.open===t)return{token:i.token,bracketType:n.MonarchBracket.Open};if(i.close===t)return{token:i.token,bracketType:n.MonarchBracket.Close}}return null}function h(e,t,r){return new i.TokenizationSupport(t,{getInitialState:function(){return new a(t,e,r)},enterNestedMode:function(e){return e instanceof a&&e.embeddedEntered},getNestedMode:function(t){var r=t.embeddedMode;if(!e.isRegisteredMode(r))return{mode:e.getMode("text/plain"),missingModePromise:null};var s=e.getMode(r);return s?{mode:s,missingModePromise:null}:{mode:e.getMode("text/plain"),missingModePromise:e.getOrCreateMode(r).then(function(){return null})}},getLeavingNestedModeData:function(e,t){for(var r=t.clone(),n=new s.LineStream(e);!n.eos()&&r.embeddedMode;)r.tokenize(n,!0);if(r.embeddedMode)return null;var i=n.pos();return{nestedModeBuffer:e.substring(0,i),bufferAfterNestedMode:e.substring(i),stateAfterNestedMode:r}}},r.usesEmbedded)}var a=function(e){function t(r,s,n,i,o){e.call(this,r),this.id=t.ID++,this.modeService=s,this.lexer=n,this.stack=i?i:[n.start],this.embeddedMode=o?o:null,this.embeddedEntered=!1,this.groupActions=null,this.groupMatches=null,this.groupMatched=null,this.groupRule=null}return __extends(t,e),t.prototype.makeClone=function(){return new t(this.getMode(),this.modeService,this.lexer,this.stack.slice(0),this.embeddedMode)},t.prototype.equals=function(r){if(!e.prototype.equals.call(this,r))return!1;if(!(r instanceof t))return!1;var s=r;if(this.stack.length!==s.stack.length||this.lexer.languageId!==s.lexer.languageId||this.embeddedMode!==s.embeddedMode)return!1;var n;for(n in this.stack)if(this.stack.hasOwnProperty(n)&&this.stack[n]!==s.stack[n])return!1;return!0},t.prototype.tokenize=function(e,t){var r=this.stack.length,s=0,i=this.stack[0];this.embeddedEntered=!1;var h=null,a=null,l=null,d=null,u=null;if(this.groupActions)s=this.groupActions.length,h=this.groupMatches,a=this.groupMatched.shift(),l=this.groupActions.shift(),u=this.groupRule,0===this.groupActions.length&&(this.groupActions=null,this.groupMatches=null,this.groupMatched=null,this.groupRule=null);else{if(e.eos())return{type:""};var c=e.advanceToEOS();e.goBack(c.length);var g=this.lexer.tokenizer[i];if(g||(g=n.findRules(this.lexer,i)),g){u=null;var f,m=e.pos();for(f in g)if(g.hasOwnProperty(f)&&(u=g[f],(0===m||!u.matchOnlyAtLineStart)&&(h=c.match(u.regex)))){a=h[0],l=u.action;break}}else n.throwError(this.lexer,"tokenizer state is not defined: "+i)}for(h||(h=[""],a=""),l||(e.eos()||(h=[e.peek()],a=h[0]),l=this.lexer.defaultToken),e.advance(a.length);l.test;){var p=l.test(a,h,i,e.eos());l=p}var k=null;if("string"==typeof l||Array.isArray(l))k=l;else if(l.group)k=l.group;else if(null!==l.token&&void 0!==l.token){if(k=l.token,l.tokenSubst&&(k=n.substituteMatches(this.lexer,k,a,h,i)),l.nextEmbedded)if("@pop"===l.nextEmbedded)this.embeddedMode||n.throwError(this.lexer,"cannot pop embedded mode if not inside one"),this.embeddedMode=null;else if(this.embeddedMode)n.throwError(this.lexer,"cannot enter embedded mode from within an embedded mode");else{this.embeddedMode=n.substituteMatches(this.lexer,l.nextEmbedded,a,h,i);var x=this.modeService.getModeIdForLanguageName(this.embeddedMode);this.embeddedMode&&x&&(this.embeddedMode=x),this.embeddedEntered=!0}if(l.goBack&&e.goBack(l.goBack),l.switchTo&&"string"==typeof l.switchTo){var b=n.substituteMatches(this.lexer,l.switchTo,a,h,i);"@"===b[0]&&(b=b.substr(1)),n.findRules(this.lexer,b)?this.stack[0]=b:n.throwError(this.lexer,"trying to switch to a state '"+b+"' that is undefined in rule: "+u.name),d=null}else if(l.transform&&"function"==typeof l.transform)this.stack=l.transform(this.stack),d=null;else if(l.next)if("@push"===l.next)this.stack.length>=this.lexer.maxStack?n.throwError(this.lexer,"maximum tokenizer stack size reached: ["+this.stack[0]+","+this.stack[1]+",...,"+this.stack[this.stack.length-2]+","+this.stack[this.stack.length-1]+"]"):this.stack.unshift(i);else if("@pop"===l.next)this.stack.length<=1?n.throwError(this.lexer,"trying to pop an empty stack in rule: "+u.name):this.stack.shift();else if("@popall"===l.next)this.stack.length>1&&(this.stack=[this.stack[this.stack.length-1]]);else{var b=n.substituteMatches(this.lexer,l.next,a,h,i);"@"===b[0]&&(b=b.substr(1)),n.findRules(this.lexer,b)?this.stack.unshift(b):n.throwError(this.lexer,"trying to set a next state '"+b+"' that is undefined in rule: "+u.name)}l.log&&"string"==typeof l.log&&n.log(this.lexer,this.lexer.languageId+": "+n.substituteMatches(this.lexer,l.log,a,h,i))}if(null===k&&(n.throwError(this.lexer,"lexer rule has no well-defined action in rule: "+u.name),k=this.lexer.defaultToken),Array.isArray(k)){this.groupActions&&this.groupActions.length>0&&n.throwError(this.lexer,"groups cannot be nested: "+u.name),h.length!==k.length+1&&n.throwError(this.lexer,"matched number of groups does not match the number of actions in rule: "+u.name);for(var M=0,v=1;v<h.length;v++)M+=h[v].length;return M!==a.length&&n.throwError(this.lexer,"with groups, all characters should be matched in consecutive groups in rule: "+u.name),this.groupMatches=h,this.groupMatched=h.slice(1),this.groupActions=k.slice(0),this.groupRule=u,e.goBack(a.length),this.tokenize(e)}if("@rematch"===k&&(e.goBack(a.length),a="",h=null,k=""),0===a.length)if(r!==this.stack.length||i!==this.stack[0]||(this.groupActions?this.groupActions.length:0)!==s){if(!t)return this.tokenize(e)}else n.throwError(this.lexer,"no progress in tokenizer in rule: "+u.name),e.advanceToEOS();if(0===k.indexOf("@brackets")){var y=k.substr("@brackets".length),w=o(this.lexer,a);return w||(n.throwError(this.lexer,"@brackets token returned but no bracket defined as: "+a),w={token:"",bracketType:n.MonarchBracket.None}),{type:n.sanitize(w.token+y)}}var E=""===k?"":k+this.lexer.tokenPostfix;return{type:n.sanitize(E)}},t.ID=0,t}(r.AbstractState);t.MonarchLexer=a,t.createTokenizationSupport=h});