define(["require","exports","vs/base/common/objects","vs/editor/common/modes/monarch/monarchCommon"],function(e,t,r,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function o(e,t){if(!t)return!1;if(!Array.isArray(t))return!1;var r;for(r in t)if(t.hasOwnProperty(r)&&!e(t[r]))return!1;return!0}function a(e,t,r){return"boolean"==typeof e?e:(r&&(e||void 0===t)&&r(),void 0===t?null:t)}function i(e,t,r){return"string"==typeof e?e:(r&&(e||void 0===t)&&r(),void 0===t?null:t)}function s(e,t){if("string"!=typeof t)return null;for(var r=0;t.indexOf("@")>=0&&r<5;)r++,t=t.replace(/@(\w+)/g,function(r,o){var a="";return"string"==typeof e[o]?a=e[o]:e[o]&&e[o]instanceof RegExp?a=e[o].source:void 0===e[o]?n.throwError(e,"language definition does not contain attribute '"+o+"', used at: "+t):n.throwError(e,"attribute reference '"+o+"' must be a string, used at: "+t),n.empty(a)?"":"(?:"+a+")"});return new RegExp(t,e.ignoreCase?"i":"")}function u(e,t,r,n){if(n<0)return e;if(n<t.length)return t[n];if(n>=100){n-=100;var o=r.split(".");if(o.unshift(r),n<o.length)return o[n]}return null}function c(e,t,a,i){var c=-1,f=a,l=a.match(/^\$(([sS]?)(\d\d?)|#)(.*)$/);l&&(l[3]&&(c=parseInt(l[3]),l[2]&&(c+=100)),f=l[4]);var h="~",d=f;f&&0!==f.length?/^\w*$/.test(d)?h="==":(l=f.match(/^(@|!@|~|!~|==|!=)(.*)$/),l&&(h=l[1],d=l[2])):(h="!=",d="");var g;if("~"!==h&&"!~"!==h||!/^(\w|\|)*$/.test(d))if("@"===h||"!@"===h){var p=e[d];p||n.throwError(e,"the @ match target '"+d+"' is not defined, in rule: "+t),o(function(e){return"string"==typeof e},p)||n.throwError(e,"the @ match target '"+d+"' must be an array of strings, in rule: "+t);var b=r.createKeywordMatcher(p,e.ignoreCase);g=function(e){return"@"===h?b(e):!b(e)}}else if("~"===h||"!~"===h)if(d.indexOf("$")<0){var k=s(e,"^"+d+"$");g=function(e){return"~"===h?k.test(e):!k.test(e)}}else g=function(t,r,o,a){var i=s(e,"^"+n.substituteMatches(e,d,r,o,a)+"$");return i.test(t)};else if(d.indexOf("$")<0){var m=n.fixCase(e,d);g=function(e){return"=="===h?e===m:e!==m}}else{var m=n.fixCase(e,d);g=function(t,r,o,a,i){var s=n.substituteMatches(e,m,r,o,a);return"=="===h?t===s:t!==s}}else{var b=r.createKeywordMatcher(d.split("|"),e.ignoreCase);g=function(e){return"~"===h?b(e):!b(e)}}return c===-1?{name:a,value:i,test:function(e,t,r,n){return g(e,e,t,r,n)}}:{name:a,value:i,test:function(e,t,r,n){var o=u(e,t,r,c);return g(o?o:"",e,t,r,n)}}}function f(e,t,r){if(r){if("string"==typeof r)return r;if(r.token||""===r.token){if("string"!=typeof r.token)return n.throwError(e,"a 'token' attribute must be of type string, in rule: "+t),{token:""};var o={token:r.token};if(r.token.indexOf("$")>=0&&(o.tokenSubst=!0),"string"==typeof r.bracket&&("@open"===r.bracket?o.bracket=n.MonarchBracket.Open:"@close"===r.bracket?o.bracket=n.MonarchBracket.Close:n.throwError(e,"a 'bracket' attribute must be either '@open' or '@close', in rule: "+t)),r.next)if("string"!=typeof r.next)n.throwError(e,"the next state must be a string value in rule: "+t);else{var a=r.next;/^(@pop|@push|@popall)$/.test(a)||("@"===a[0]&&(a=a.substr(1)),a.indexOf("$")<0&&(n.stateExists(e,n.substituteMatches(e,a,"",[],""))||n.throwError(e,"the next state '"+r.next+"' is not defined in rule: "+t))),o.next=a}return"number"==typeof r.goBack&&(o.goBack=r.goBack),"string"==typeof r.switchTo&&(o.switchTo=r.switchTo),"string"==typeof r.log&&(o.log=r.log),"string"==typeof r.nextEmbedded&&(o.nextEmbedded=r.nextEmbedded,e.usesEmbedded=!0),o}if(Array.isArray(r)){var i,s=[];for(i in r)r.hasOwnProperty(i)&&(s[i]=f(e,t,r[i]));return{group:s}}if(r.cases){var u,l=[];for(u in r.cases)if(r.cases.hasOwnProperty(u)){var h=f(e,t,r.cases[u]);"@default"===u||"@"===u||""===u?l.push({test:null,value:h,name:u}):"@eos"===u?l.push({test:function(e,t,r,n){return n},value:h,name:u}):l.push(c(e,t,u,h))}var d=e.defaultToken;return{test:function(e,t,r,n){var o;for(o in l)if(l.hasOwnProperty(o)){var a=!l[o].test||l[o].test(e,t,r,n);if(a)return l[o].value}return d}}}return n.throwError(e,"an action must be a string, an object with a 'token' or 'cases' attribute, or an array of actions; in rule: "+t),""}return{token:""}}function l(e,t){function r(e,u,c){var f;for(f in c)if(c.hasOwnProperty(f)){var l=c[f],d=l.include;if(d)"string"!=typeof d&&n.throwError(o,"an 'include' attribute must be a string at: "+e),"@"===d[0]&&(d=d.substr(1)),t.tokenizer[d]||n.throwError(o,"include target '"+d+"' is not defined at: "+e),r(e+"."+d,u,t.tokenizer[d]);else{var g=new h(e);if(Array.isArray(l)&&l.length>=1&&l.length<=3)if(g.setRegex(s,l[0]),l.length>=3)if("string"==typeof l[1])g.setAction(s,{token:l[1],next:l[2]});else if("object"==typeof l[1]){var p=l[1];p.next=l[2],g.setAction(s,p)}else n.throwError(o,"a next state as the last element of a rule can only be given if the action is either an object or a string, at: "+e);else g.setAction(s,l[1]);else l.regex||n.throwError(o,"a rule must either be an array, or an object with a 'regex' or 'include' field at: "+e),l.name&&(g.name=i(l.name)),l.matchOnlyAtStart&&(g.matchOnlyAtLineStart=a(l.matchOnlyAtLineStart)),g.setRegex(s,l.regex),g.setAction(s,l.action);u.push(g)}}}if(!t||"object"!=typeof t)throw new Error("Monarch: expecting a language definition object");var o={};o.languageId=e,o.noThrow=!1,o.maxStack=100,o.start=i(t.start),o.ignoreCase=a(t.ignoreCase,!1),o.tokenPostfix=i(t.tokenPostfix,"."+o.languageId),o.defaultToken=i(t.defaultToken,"source",function(){n.throwError(o,"the 'defaultToken' must be a string")}),o.usesEmbedded=!1;var s=t;s.languageId=e,s.ignoreCase=o.ignoreCase,s.noThrow=o.noThrow,s.usesEmbedded=o.usesEmbedded,s.stateNames=t.tokenizer,s.defaultToken=o.defaultToken,t.tokenizer&&"object"==typeof t.tokenizer||n.throwError(o,"a language definition must define the 'tokenizer' attribute as an object"),o.tokenizer=[];var u;for(u in t.tokenizer)if(t.tokenizer.hasOwnProperty(u)){o.start||(o.start=u);var c=t.tokenizer[u];o.tokenizer[u]=new Array,r("tokenizer."+u,o.tokenizer[u],c)}o.usesEmbedded=s.usesEmbedded,t.brackets?Array.isArray(t.brackets)||n.throwError(o,"the 'brackets' attribute must be defined as an array"):t.brackets=[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"<",close:">",token:"delimiter.angle"}];var f=[];for(var l in t.brackets)if(t.brackets.hasOwnProperty(l)){var d=t.brackets[l];d&&Array.isArray(d)&&3===d.length&&(d={token:d[2],open:d[0],close:d[1]}),d.open===d.close&&n.throwError(o,"open and close brackets in a 'brackets' attribute must be different: "+d.open+"\n hint: use the 'bracket' attribute if matching on equal brackets is required."),"string"==typeof d.open&&"string"==typeof d.token?f.push({token:i(d.token)+o.tokenPostfix,open:n.fixCase(o,i(d.open)),close:n.fixCase(o,i(d.close))}):n.throwError(o,"every element in the 'brackets' array must be a '{open,close,token}' object or array")}return o.brackets=f,o.noThrow=!0,o}var h=function(){function e(e){this.regex=new RegExp(""),this.action={token:""},this.matchOnlyAtLineStart=!1,this.name="",this.name=e}return e.prototype.setRegex=function(e,t){var r;"string"==typeof t?r=t:t instanceof RegExp?r=t.source:n.throwError(e,"rules must start with a match string or regular expression: "+this.name),this.matchOnlyAtLineStart=r.length>0&&"^"===r[0],this.name=this.name+": "+r,this.regex=s(e,"^(?:"+(this.matchOnlyAtLineStart?r.substr(1):r)+")")},e.prototype.setAction=function(e,t){this.action=f(e,this.name,t)},e}();t.compile=l});