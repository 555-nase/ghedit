define(["require","exports","vs/editor/common/modes","vs/editor/common/modes/supports/characterPair","vs/editor/common/modes/supports/electricCharacter","vs/editor/common/modes/supports/onEnter","vs/editor/common/modes/supports/richEditBrackets","vs/base/common/event","vs/base/common/errors","vs/editor/common/core/position","vs/base/common/strings","vs/editor/common/model/wordHelper"],function(t,n,e,r,o,i,s,c,a,u,p,h){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var l=function(){function t(e,i,c){var a=null;i&&(a=i._conf),this._conf=t._mergeConf(a,c),this._conf.brackets&&(this.brackets=new s.RichEditBrackets(e,this._conf.brackets)),this._handleOnEnter(e,this._conf),this._handleComments(e,this._conf),this.characterPair=new r.CharacterPairSupport(n.LanguageConfigurationRegistry,e,this._conf),this.electricCharacter=new o.BracketElectricCharacterSupport(n.LanguageConfigurationRegistry,e,this.brackets,this.characterPair.getAutoClosingPairs(),this._conf.__electricCharacterSupport),this.wordDefinition=this._conf.wordPattern||h.DEFAULT_WORD_REGEXP}return t._mergeConf=function(t,n){return{comments:t?n.comments||t.comments:n.comments,brackets:t?n.brackets||t.brackets:n.brackets,wordPattern:t?n.wordPattern||t.wordPattern:n.wordPattern,indentationRules:t?n.indentationRules||t.indentationRules:n.indentationRules,onEnterRules:t?n.onEnterRules||t.onEnterRules:n.onEnterRules,autoClosingPairs:t?n.autoClosingPairs||t.autoClosingPairs:n.autoClosingPairs,surroundingPairs:t?n.surroundingPairs||t.surroundingPairs:n.surroundingPairs,__electricCharacterSupport:t?n.__electricCharacterSupport||t.__electricCharacterSupport:n.__electricCharacterSupport}},t.prototype._handleOnEnter=function(t,e){var r={},o=!0;e.brackets&&(o=!1,r.brackets=e.brackets),e.indentationRules&&(o=!1,r.indentationRules=e.indentationRules),e.onEnterRules&&(o=!1,r.regExpRules=e.onEnterRules),o||(this.onEnter=new i.OnEnterSupport(n.LanguageConfigurationRegistry,t,r))},t.prototype._handleComments=function(t,n){var e=n.comments;if(e&&(this.comments={},e.lineComment&&(this.comments.lineCommentToken=e.lineComment),e.blockComment)){var r=e.blockComment,o=r[0],i=r[1];this.comments.blockCommentStartToken=o,this.comments.blockCommentEndToken=i}},t}();n.RichEditSupport=l;var d=function(){function t(){this._onDidChange=new c.Emitter,this.onDidChange=this._onDidChange.event,this._entries=Object.create(null)}return t.prototype.register=function(t,n){var e=this._entries[t]||null;return this._entries[t]=new l(t,e,n),this._onDidChange.fire(void 0),{dispose:function(){}}},t.prototype._getRichEditSupport=function(t){return this._entries[t]},t.prototype.getElectricCharacterSupport=function(t){var n=this._getRichEditSupport(t);return n?n.electricCharacter||null:null},t.prototype.getComments=function(t){var n=this._getRichEditSupport(t);return n?n.comments||null:null},t.prototype.getCharacterPairSupport=function(t){var n=this._getRichEditSupport(t);return n?n.characterPair||null:null},t.prototype.getWordDefinition=function(t){var n=this._getRichEditSupport(t);return n?n.wordDefinition||null:null},t.prototype.getOnEnterSupport=function(t){var n=this._getRichEditSupport(t);return n?n.onEnter||null:null},t.prototype.getRawEnterActionAtPosition=function(t,n,e){var r,o=this.getOnEnterSupport(t.getMode().getId());if(o)try{r=o.onEnter(t,new u.Position(n,e))}catch(i){a.onUnexpectedError(i)}return r},t.prototype.getEnterActionAtPosition=function(t,n,r){var o=t.getLineContent(n),i=p.getLeadingWhitespace(o);i.length>r-1&&(i=i.substring(0,r-1));var s=this.getRawEnterActionAtPosition(t,n,r);return s?s.appendText||(s.indentAction===e.IndentAction.Indent||s.indentAction===e.IndentAction.IndentOutdent?s.appendText="\t":s.appendText=""):s={indentAction:e.IndentAction.None,appendText:""},s.removeText&&(i=i.substring(0,i.length-1)),{enterAction:s,indentation:i}},t.prototype.getBracketsSupport=function(t){var n=this._getRichEditSupport(t);return n?n.brackets||null:null},t}();n.LanguageConfigurationRegistryImpl=d,n.LanguageConfigurationRegistry=new d});