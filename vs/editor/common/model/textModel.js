var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};define(["require","exports","vs/base/common/eventEmitter","vs/base/common/strings","vs/editor/common/core/position","vs/editor/common/core/range","vs/editor/common/editorCommon","vs/editor/common/model/modelLine","vs/editor/common/model/indentationGuesser","vs/editor/common/config/defaultConfig","vs/editor/common/viewModel/prefixSumComputer","vs/editor/common/model/indentRanges"],function(t,e,n,i,r,o,s,a,u,h,l,d){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var p=999;e.LONG_LINE_BOUNDARY=1e3;var c=function(t){function n(e,i){e.push(s.EventType.ModelRawContentChanged,s.EventType.ModelOptionsChanged),t.call(this,e),this._shouldSimplifyMode=i.length>n.MODEL_SYNC_LIMIT,this._shouldDenyMode=i.length>n.MODEL_TOKENIZATION_LIMIT,this._options=i.options,this._constructLines(i),this._setVersionId(1),this._isDisposed=!1,this._isDisposing=!1}return __extends(n,t),n.prototype.isTooLargeForHavingAMode=function(){return this._shouldDenyMode},n.prototype.isTooLargeForHavingARichMode=function(){return this._shouldSimplifyMode},n.prototype.getOptions=function(){return this._options},n.prototype.updateOptions=function(t){var e=!1,n={tabSize:!1,insertSpaces:!1,trimAutoWhitespace:!1};if("undefined"!=typeof t.insertSpaces&&this._options.insertSpaces!==t.insertSpaces&&(e=!0,n.insertSpaces=!0,this._options.insertSpaces=t.insertSpaces),"undefined"!=typeof t.tabSize){var i=0|t.tabSize;if(this._options.tabSize!==i){e=!0,n.tabSize=!0,this._options.tabSize=i;for(var r=0,o=this._lines.length;r<o;r++)this._lines[r].updateTabSize(i)}}"undefined"!=typeof t.trimAutoWhitespace&&this._options.trimAutoWhitespace!==t.trimAutoWhitespace&&(e=!0,n.trimAutoWhitespace=!0,this._options.trimAutoWhitespace=t.trimAutoWhitespace),e&&this.emit(s.EventType.ModelOptionsChanged,n)},n.prototype.detectIndentation=function(t,e){var n=this._lines.map(function(t){return t.text}),i=u.guessIndentation(n,e,t);this.updateOptions({insertSpaces:i.insertSpaces,tabSize:i.tabSize})},n.prototype._normalizeIndentationFromWhitespace=function(t){for(var e=this._options.tabSize,n=this._options.insertSpaces,i=0,r=0;r<t.length;r++)"\t"===t.charAt(r)?i+=e:i++;var o="";if(!n){var s=Math.floor(i/e);i%=e;for(var r=0;r<s;r++)o+="\t"}for(var r=0;r<i;r++)o+=" ";return o},n.prototype.normalizeIndentation=function(t){var e=i.firstNonWhitespaceIndex(t);return e===-1&&(e=t.length),this._normalizeIndentationFromWhitespace(t.substring(0,e))+t.substring(e)},n.prototype.getOneIndent=function(){var t=this._options.tabSize,e=this._options.insertSpaces;if(e){for(var n="",i=0;i<t;i++)n+=" ";return n}return"\t"},n.prototype.getVersionId=function(){return this._versionId},n.prototype.getAlternativeVersionId=function(){return this._alternativeVersionId},n.prototype._ensureLineStarts=function(){if(!this._lineStarts){for(var t=[],e=this._EOL.length,n=0,i=this._lines.length;n<i;n++)t.push(this._lines[n].text.length+e);this._lineStarts=new l.PrefixSumComputer(t)}},n.prototype.getOffsetAt=function(t){var e=this.validatePosition(t);return this._ensureLineStarts(),this._lineStarts.getAccumulatedValue(e.lineNumber-2)+e.column-1},n.prototype.getPositionAt=function(t){t=Math.floor(t),t=Math.max(0,t),this._ensureLineStarts();var e=this._lineStarts.getIndexOf(t),n=this._lines[e.index].text.length;return new r.Position(e.index+1,Math.min(e.remainder+1,n+1))},n.prototype._increaseVersionId=function(){this._setVersionId(this._versionId+1)},n.prototype._setVersionId=function(t){this._versionId=t,this._alternativeVersionId=this._versionId},n.prototype._overwriteAlternativeVersionId=function(t){this._alternativeVersionId=t},n.prototype.isDisposed=function(){return this._isDisposed},n.prototype.dispose=function(){this._isDisposed=!0,this._lines=null,this._EOL=null,this._BOM=null,t.prototype.dispose.call(this)},n.prototype._createContentChangedFlushEvent=function(){return{changeType:s.EventType.ModelRawContentChangedFlush,detail:null,versionId:-1,isUndoing:!1,isRedoing:!1}},n.prototype._emitContentChanged2=function(t,e,n,i,r,a,u,h){var l={range:new o.Range(t,e,n,i),rangeLength:r,text:a,eol:this._EOL,versionId:this.getVersionId(),isUndoing:u,isRedoing:h};this._isDisposing||this.emit(s.EventType.ModelContentChanged2,l)},n.prototype._resetValue=function(t,e){this._constructLines(e),this._increaseVersionId(),t.detail=this.toRawText(),t.versionId=this._versionId},n.prototype.toRawText=function(){return{BOM:this._BOM,EOL:this._EOL,lines:this.getLinesContent(),length:this.getValueLength(),options:this._options}},n.prototype.equals=function(t){if(this._BOM!==t.BOM)return!1;if(this._EOL!==t.EOL)return!1;if(this._lines.length!==t.lines.length)return!1;for(var e=0,n=this._lines.length;e<n;e++)if(this._lines[e].text!==t.lines[e])return!1;return!0},n.prototype.setValue=function(t){if(null!==t){var e=null;e=n.toRawText(t,{tabSize:this._options.tabSize,insertSpaces:this._options.insertSpaces,trimAutoWhitespace:this._options.trimAutoWhitespace,detectIndentation:!1,defaultEOL:this._options.defaultEOL}),this.setValueFromRawText(e)}},n.prototype.setValueFromRawText=function(t){if(null!==t){var e=this.getFullModelRange(),n=this.getValueLengthInRange(e),i=this.getLineCount(),r=this.getLineMaxColumn(i),o=this._createContentChangedFlushEvent();this._resetValue(o,t),this._emitModelContentChangedFlushEvent(o),this._emitContentChanged2(1,1,i,r,n,this.getValue(),!1,!1)}},n.prototype.getValue=function(t,e){void 0===e&&(e=!1);var n=this.getFullModelRange(),i=this.getValueInRange(n,t);return e?this._BOM+i:i},n.prototype.getValueLength=function(t,e){void 0===e&&(e=!1);var n=this.getFullModelRange(),i=this.getValueLengthInRange(n,t);return e?this._BOM.length+i:i},n.prototype.getEmptiedValueInRange=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=s.EndOfLinePreference.TextDefined);var i=this.validateRange(t);if(i.isEmpty())return"";if(i.startLineNumber===i.endLineNumber)return this._repeatCharacter(e,i.endColumn-i.startColumn);var r=this._getEndOfLine(n),o=i.startLineNumber-1,a=i.endLineNumber-1,u=[];u.push(this._repeatCharacter(e,this._lines[o].text.length-i.startColumn+1));for(var h=o+1;h<a;h++)u.push(this._repeatCharacter(e,this._lines[h].text.length));return u.push(this._repeatCharacter(e,i.endColumn-1)),u.join(r)},n.prototype._repeatCharacter=function(t,e){for(var n="",i=0;i<e;i++)n+=t;return n},n.prototype.getValueInRange=function(t,e){void 0===e&&(e=s.EndOfLinePreference.TextDefined);var n=this.validateRange(t);if(n.isEmpty())return"";if(n.startLineNumber===n.endLineNumber)return this._lines[n.startLineNumber-1].text.substring(n.startColumn-1,n.endColumn-1);var i=this._getEndOfLine(e),r=n.startLineNumber-1,o=n.endLineNumber-1,a=[];a.push(this._lines[r].text.substring(n.startColumn-1));for(var u=r+1;u<o;u++)a.push(this._lines[u].text);return a.push(this._lines[o].text.substring(0,n.endColumn-1)),a.join(i)},n.prototype.getValueLengthInRange=function(t,e){void 0===e&&(e=s.EndOfLinePreference.TextDefined);var n=this.validateRange(t);if(n.isEmpty())return 0;if(n.startLineNumber===n.endLineNumber)return n.endColumn-n.startColumn;var i=this.getOffsetAt(new r.Position(n.startLineNumber,n.startColumn)),o=this.getOffsetAt(new r.Position(n.endLineNumber,n.endColumn));return o-i},n.prototype.isDominatedByLongLines=function(){var t,n,i,r=0,o=0,s=this._lines;for(t=0,n=this._lines.length;t<n;t++)i=s[t].text.length,i>=e.LONG_LINE_BOUNDARY?o+=i:r+=i;return o>r},n.prototype.getLineCount=function(){return this._lines.length},n.prototype.getLineContent=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");return this._lines[t-1].text},n.prototype.getIndentLevel=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");return this._lines[t-1].getIndentLevel()},n.prototype._resetIndentRanges=function(){this._indentRanges=null},n.prototype._getIndentRanges=function(){return this._indentRanges||(this._indentRanges=d.computeRanges(this)),this._indentRanges},n.prototype.getIndentRanges=function(){var t=this._getIndentRanges();return d.IndentRange.deepCloneArr(t)},n.prototype.getLineIndentGuide=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");for(var e=this._getIndentRanges(),n=e.length-1;n>=0;n--){var i=e[n];if(i.startLineNumber===t)return Math.ceil(i.indent/this._options.tabSize);if(i.startLineNumber<t&&t<=i.endLineNumber)return 1+Math.floor(i.indent/this._options.tabSize);if(i.endLineNumber+1===t&&(0===n||e[n-1].endLineNumber+1!==t))return Math.ceil(i.indent/this._options.tabSize)}return 0},n.prototype.getLinesContent=function(){for(var t=[],e=0,n=this._lines.length;e<n;e++)t[e]=this._lines[e].text;return t},n.prototype.getEOL=function(){return this._EOL},n.prototype.setEOL=function(t){var e=t===s.EndOfLineSequence.CRLF?"\r\n":"\n";if(this._EOL!==e){var n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),o=this.getLineMaxColumn(r);this._EOL=e,this._lineStarts=null,this._increaseVersionId();var a=this._createContentChangedFlushEvent();a.detail=this.toRawText(),a.versionId=this._versionId,this._emitModelContentChangedFlushEvent(a),this._emitContentChanged2(1,1,r,o,i,this.getValue(),!1,!1)}},n.prototype.getLineMinColumn=function(t){return 1},n.prototype.getLineMaxColumn=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");return this._lines[t-1].text.length+1},n.prototype.getLineFirstNonWhitespaceColumn=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");var e=i.firstNonWhitespaceIndex(this._lines[t-1].text);return e===-1?0:e+1},n.prototype.getLineLastNonWhitespaceColumn=function(t){if(t<1||t>this.getLineCount())throw new Error("Illegal value "+t+" for `lineNumber`");var e=i.lastNonWhitespaceIndex(this._lines[t-1].text);return e===-1?0:e+2},n.prototype.validateLineNumber=function(t){return t<1&&(t=1),t>this._lines.length&&(t=this._lines.length),t},n.prototype.validatePosition=function(t){var e=t.lineNumber?t.lineNumber:1,n=t.column?t.column:1;if(e<1)e=1,n=1;else if(e>this._lines.length)e=this._lines.length,n=this.getLineMaxColumn(e);else{var i=this.getLineMaxColumn(e);n<1?n=1:n>i&&(n=i)}return new r.Position(e,n)},n.prototype.validateRange=function(t){var e=this.validatePosition(new r.Position(t.startLineNumber,t.startColumn)),n=this.validatePosition(new r.Position(t.endLineNumber,t.endColumn));return new o.Range(e.lineNumber,e.column,n.lineNumber,n.column)},n.prototype.modifyPosition=function(t,e){return this.getPositionAt(this.getOffsetAt(t)+e)},n.prototype.getFullModelRange=function(){var t=this.getLineCount();return new o.Range(1,1,t,this.getLineMaxColumn(t))},n.prototype._emitModelContentChangedFlushEvent=function(t){this._isDisposing||this.emit(s.EventType.ModelRawContentChanged,t)},n.toRawText=function(t,e){for(var n=0,r=-1;(r=t.indexOf("\r",r+1))!==-1;)n++;var o=t.split(/\r\n|\r|\n/),a="";i.startsWithUTF8BOM(o[0])&&(a=i.UTF8_BOM_CHARACTER,o[0]=o[0].substr(1));var h=o.length-1,l="";l=0===h?e.defaultEOL===s.DefaultEndOfLine.LF?"\n":"\r\n":n>h/2?"\r\n":"\n";var d;if(e.detectIndentation){var p=u.guessIndentation(o,e.tabSize,e.insertSpaces);d={tabSize:p.tabSize,insertSpaces:p.insertSpaces,trimAutoWhitespace:e.trimAutoWhitespace,defaultEOL:e.defaultEOL}}else d={tabSize:e.tabSize,insertSpaces:e.insertSpaces,trimAutoWhitespace:e.trimAutoWhitespace,defaultEOL:e.defaultEOL};return{BOM:a,EOL:l,lines:o,length:t.length,options:d}},n.prototype._constructLines=function(t){for(var e=t.options.tabSize,n=t.lines,i=[],r=0,o=n.length;r<o;r++)i[r]=new a.ModelLine(r+1,n[r],e);this._BOM=t.BOM,this._EOL=t.EOL,this._lines=i,this._lineStarts=null,this._resetIndentRanges()},n.prototype._getEndOfLine=function(t){switch(t){case s.EndOfLinePreference.LF:return"\n";case s.EndOfLinePreference.CRLF:return"\r\n";case s.EndOfLinePreference.TextDefined:return this.getEOL()}throw new Error("Unknown EOL preference")},n._isMultiline=function(t){var e="\\".charCodeAt(0),n="n".charCodeAt(0),i="r".charCodeAt(0);if(!t||0===t.length)return!1;for(var r=0,o=t.length;r<o;r++){var s=t.charCodeAt(r);if(s===e){if(r++,r>=o)break;var a=t.charCodeAt(r);if(a===n||a===i)return!0}}return!1},n.parseSearchRequest=function(t,e,r,o){if(""===t)return null;var s=null;try{s=i.createRegExp(t,e,r,o,!0)}catch(a){return null}return s?{regex:s,isMultiline:e&&n._isMultiline(t)}:null},n.prototype.findMatches=function(t,e,i,r,s,a){void 0===a&&(a=p);var u=n.parseSearchRequest(t,i,r,s);if(!u)return[];var h;return h=o.Range.isIRange(e)?e:this.getFullModelRange(),u.isMultiline?this._doFindMatchesMultiline(h,u.regex,a):this._doFindMatchesLineByLine(h,u.regex,a)},n.prototype._doFindMatchesMultiline=function(t,e,n){for(var i,r=this.getOffsetAt(t.getStartPosition()),s=this.getValueInRange(t),a=[],u=0,h=0,l=0;i=e.exec(s);){var d=r+i.index,p=d+i[0].length;if(u===d&&h===p)return a;var c=this.getPositionAt(d),g=this.getPositionAt(p);if(a[l++]=new o.Range(c.lineNumber,c.column,g.lineNumber,g.column),l>=n)return a;u=d,h=p}return a},n.prototype._doFindMatchesLineByLine=function(t,e,n){var i,r=[],o=0;if(t.startLineNumber===t.endLineNumber)return i=this._lines[t.startLineNumber-1].text.substring(t.startColumn-1,t.endColumn-1),o=this._findMatchesInLine(e,i,t.startLineNumber,t.startColumn-1,o,r,n),r;i=this._lines[t.startLineNumber-1].text.substring(t.startColumn-1),o=this._findMatchesInLine(e,i,t.startLineNumber,t.startColumn-1,o,r,n);for(var s=t.startLineNumber+1;s<t.endLineNumber&&o<n;s++)o=this._findMatchesInLine(e,this._lines[s-1].text,s,0,o,r,n);return o<n&&(i=this._lines[t.endLineNumber-1].text.substring(0,t.endColumn-1),o=this._findMatchesInLine(e,i,t.endLineNumber,0,o,r,n)),r},n.prototype.findNextMatch=function(t,e,i,r,o){var s=n.parseSearchRequest(t,i,r,o);if(!s)return null;var a=this.validatePosition(e);return s.isMultiline?this._doFindNextMatchMultiline(a,s.regex):this._doFindNextMatchLineByLine(a,s.regex)},n.prototype._doFindNextMatchMultiline=function(t,e){var n=this.getOffsetAt(t),i=this.getValueInRange(new o.Range(t.lineNumber,t.column,this.getLineCount(),this.getLineMaxColumn(this.getLineCount()))),s=e.exec(i);if(s){var a=n+s.index,u=a+s[0].length,h=this.getPositionAt(a),l=this.getPositionAt(u);return new o.Range(h.lineNumber,h.column,l.lineNumber,l.column)}return 1!==t.lineNumber||t.column!==-1?this._doFindNextMatchMultiline(new r.Position(1,1),e):null},n.prototype._doFindNextMatchLineByLine=function(t,e){var n,i,r=this.getLineCount(),o=t.lineNumber;if(n=this._lines[o-1].text.substring(t.column-1),i=this._findFirstMatchInLine(e,n,o,t.column-1))return i;for(var s=1;s<=r;s++){var a=(o+s-1)%r;if(n=this._lines[a].text,i=this._findFirstMatchInLine(e,n,a+1,0))return i}return null},n.prototype.findPreviousMatch=function(t,e,i,r,o){var s=n.parseSearchRequest(t,i,r,o);if(!s)return null;var a=this.validatePosition(e);return s.isMultiline?this._doFindPreviousMatchMultiline(a,s.regex):this._doFindPreviousMatchLineByLine(a,s.regex)},n.prototype._doFindPreviousMatchMultiline=function(t,e){var n=this._doFindMatchesMultiline(new o.Range(1,1,t.lineNumber,t.column),e,10*p);return n.length>0?n[n.length-1]:t.lineNumber!==this.getLineCount()||t.column!==this.getLineMaxColumn(this.getLineCount())?this._doFindPreviousMatchMultiline(new r.Position(this.getLineCount(),this.getLineMaxColumn(this.getLineCount())),e):null},n.prototype._doFindPreviousMatchLineByLine=function(t,e){var n,i,r=this.getLineCount(),o=t.lineNumber;if(n=this._lines[o-1].text.substring(0,t.column-1),i=this._findLastMatchInLine(e,n,o))return i;for(var s=1;s<=r;s++){var a=(r+o-s-1)%r;if(n=this._lines[a].text,i=this._findLastMatchInLine(e,n,a+1))return i}return null},n.prototype._findFirstMatchInLine=function(t,e,n,i){var r=t.exec(e);return r?new o.Range(n,r.index+1+i,n,r.index+1+r[0].length+i):null},n.prototype._findLastMatchInLine=function(t,e,n){for(var i,r=null;i=t.exec(e);){var s=new o.Range(n,i.index+1,n,i.index+1+i[0].length);if(s.equalsRange(r))break;if(r=s,i.index+i[0].length===e.length)break}return r},n.prototype._findMatchesInLine=function(t,e,n,i,r,s,a){var u;t.lastIndex=0;do if(u=t.exec(e)){var h=new o.Range(n,u.index+1+i,n,u.index+1+u[0].length+i);if(h.equalsRange(s[s.length-1]))return r;if(s.push(h),r++,r>=a)return r;if(u.index+u[0].length===e.length)return r}while(u);return r},n.MODEL_SYNC_LIMIT=5242880,n.MODEL_TOKENIZATION_LIMIT=20971520,n.DEFAULT_CREATION_OPTIONS={tabSize:h.DEFAULT_INDENTATION.tabSize,insertSpaces:h.DEFAULT_INDENTATION.insertSpaces,detectIndentation:!1,defaultEOL:s.DefaultEndOfLine.LF,trimAutoWhitespace:h.DEFAULT_TRIM_AUTO_WHITESPACE},n}(n.OrderGuaranteeEventEmitter);e.TextModel=c;var g=function(){function t(){}return t.fromString=function(t,e){return c.toRawText(t,e)},t.fromStringWithModelOptions=function(t,e){var n=e.getOptions();return c.toRawText(t,{tabSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:n.trimAutoWhitespace,detectIndentation:!1,defaultEOL:n.defaultEOL})},t}();e.RawText=g});