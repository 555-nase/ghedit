define(["require","exports","vs/base/common/errors"],function(t,e,r){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var n=function(){function t(t){this.model=t,this.currentOpenStackElement=null,this.past=[],this.future=[]}return t.prototype.pushStackElement=function(){null!==this.currentOpenStackElement&&(this.past.push(this.currentOpenStackElement),this.currentOpenStackElement=null)},t.prototype.clear=function(){this.currentOpenStackElement=null,this.past=[],this.future=[]},t.prototype.pushEditOperation=function(t,e,n){this.future=[],this.currentOpenStackElement||(this.currentOpenStackElement={beforeVersionId:this.model.getAlternativeVersionId(),beforeCursorState:t,editOperations:[],afterCursorState:null,afterVersionId:-1});var s={operations:this.model.applyEdits(e)};this.currentOpenStackElement.editOperations.push(s);try{this.currentOpenStackElement.afterCursorState=n?n(s.operations):null}catch(i){r.onUnexpectedError(i),this.currentOpenStackElement.afterCursorState=null}return this.currentOpenStackElement.afterVersionId=this.model.getVersionId(),this.currentOpenStackElement.afterCursorState},t.prototype.undo=function(){if(this.pushStackElement(),this.past.length>0){var t=this.past.pop();try{for(var e=t.editOperations.length-1;e>=0;e--)t.editOperations[e]={operations:this.model.applyEdits(t.editOperations[e].operations)}}catch(r){return this.clear(),null}return this.future.push(t),{selections:t.beforeCursorState,recordedVersionId:t.beforeVersionId}}return null},t.prototype.redo=function(){if(this.future.length>0){if(this.currentOpenStackElement)throw new Error("How is this possible?");var t=this.future.pop();try{for(var e=0;e<t.editOperations.length;e++)t.editOperations[e]={operations:this.model.applyEdits(t.editOperations[e].operations)}}catch(r){return this.clear(),null}return this.past.push(t),{selections:t.afterCursorState,recordedVersionId:t.afterVersionId}}return null},t}();e.EditStack=n});