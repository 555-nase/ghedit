var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define(["require","exports","vs/editor/common/editorCommon","vs/editor/common/model/modelLine","vs/editor/common/model/textModel","vs/editor/common/model/textModelWithTokens","vs/editor/common/core/range","vs/editor/common/core/position"],function(e,t,n,o,i,r,s,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function u(e,t,n){return void 0===t&&(t=null),new d(0,i.TextModel.toRawText(e,i.TextModel.DEFAULT_CREATION_OPTIONS),t,n)}var a=0,h=function(e){function t(t,o,i,r,s){e.call(this,t.concat([n.EventType.ModelDispose]),i,r),this._setVersionId(o),this._associatedResource=s}return __extends(t,e),t.prototype.getModeId=function(){return this.getMode().getId()},t.prototype._constructLines=function(t){e.prototype._constructLines.call(this,t),this._EOL="\n"},t.prototype.destroy=function(){this.dispose()},t.prototype.dispose=function(){this.emit(n.EventType.ModelDispose),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"uri",{get:function(){return this._associatedResource},enumerable:!0,configurable:!0}),t.prototype.getRangeFromOffsetAndLength=function(e,t){var n=this.getPositionAt(e),o=this.getPositionAt(e+t);return new s.Range(n.lineNumber,n.column,o.lineNumber,o.column)},t.prototype.getOffsetAndLengthFromRange=function(e){var t=this.getOffsetAt(new l.Position(e.startLineNumber,e.startColumn)),n=this.getOffsetAt(new l.Position(e.endLineNumber,e.endColumn));return{offset:t,length:n-t}},t.prototype.getPositionFromOffset=function(e){return this.getPositionAt(e)},t.prototype.getOffsetFromPosition=function(e){return this.getOffsetAt(e)},t.prototype.getLineStart=function(e){return e<1&&(e=1),e>this.getLineCount()&&(e=this.getLineCount()),this.getOffsetAt(new l.Position(e,1))},t.prototype.getAllWordsWithRange=function(){if(this._lines.length>1e4)return[];var e,t=[],n=function(n){var i=o.text.substring(n.start,n.end),r={startLineNumber:e+1,startColumn:n.start+1,endLineNumber:e+1,endColumn:n.end+1};t.push({text:i,range:r})};for(e=0;e<this._lines.length;e++){var o=this._lines[e];this.wordenize(o.text).forEach(n)}return t},t.prototype.getAllWords=function(){var e=this,t=[];return this._lines.forEach(function(n){e.wordenize(n.text).forEach(function(e){t.push(n.text.substring(e.start,e.end))})}),t},t.prototype.getAllUniqueWords=function(e){var t=!1,n={};return this.getAllWords().filter(function(o){return e&&!t&&e===o?(t=!0,!1):!n[o]&&(n[o]=!0,!0)})},t.prototype.wordenize=function(e){for(var t,n=[],o=this._getWordDefinition();t=o.exec(e);)n.push({start:t.index,end:t.index+t[0].length});return n},t}(r.TextModelWithTokens);t.AbstractMirrorModel=h,t.createTestMirrorModelFromString=u;var d=function(e){function t(t,n,o,i){e.call(this,["changed"],t,n,o,i)}return __extends(t,e),t.prototype.onEvents=function(e){for(var t=!1,o=0,i=e.contentChanged.length;o<i;o++){var r=e.contentChanged[o];switch(this._setVersionId(r.versionId),r.changeType){case n.EventType.ModelRawContentChangedFlush:this._onLinesFlushed(r),t=!0;break;case n.EventType.ModelRawContentChangedLinesDeleted:this._onLinesDeleted(r),t=!0;break;case n.EventType.ModelRawContentChangedLinesInserted:this._onLinesInserted(r),t=!0;break;case n.EventType.ModelRawContentChangedLineChanged:this._onLineChanged(r),t=!0}}t&&this.emit("changed",{})},t.prototype._onLinesFlushed=function(e){this._constructLines(e.detail),this._resetTokenizationState()},t.prototype._onLineChanged=function(e){this._lines[e.lineNumber-1].applyEdits({},[{startColumn:1,endColumn:Number.MAX_VALUE,text:e.detail,forceMoveMarkers:!1}],a),this._lineStarts&&this._lineStarts.changeValue(e.lineNumber-1,this._lines[e.lineNumber-1].text.length+this._EOL.length),this._invalidateLine(e.lineNumber-1)},t.prototype._onLinesDeleted=function(e){var t=e.fromLineNumber-1,n=e.toLineNumber-1,o=this._lines[t].getState();this._lines.splice(t,n-t+1),this._lineStarts&&this._lineStarts.removeValues(t,n-t+1),t<this._lines.length&&(this._lines[t].setState(o),this._invalidateLine(t))},t.prototype._onLinesInserted=function(e){var t,n,i=e.detail.split("\n"),r=[];for(t=e.fromLineNumber-1,n=0;t<e.toLineNumber;t++,n++)this._lines.splice(t,0,new o.ModelLine(0,i[n],a)),r.push(i[n].length+this._EOL.length);this._lineStarts&&this._lineStarts.insertValues(e.fromLineNumber-1,r),e.fromLineNumber>=2&&this._invalidateLine(e.fromLineNumber-2)},t}(h);t.MirrorModel=d});