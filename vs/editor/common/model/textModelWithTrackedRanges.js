var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)};define(["require","exports","vs/base/common/idGenerator","vs/editor/common/core/range","vs/editor/common/editorCommon","vs/editor/common/model/textModelWithMarkers","vs/editor/common/model/textModelWithTokens"],function(e,r,t,n,a,i,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var o=function(e){function r(r,t,n){e.call(this,r,n),this.trackedRangeId=n.addTrackedRange({startLineNumber:t,startColumn:1,endLineNumber:t,endColumn:n.getLineMaxColumn(t)},a.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges)}return __extends(r,e),r.prototype.getRange=function(){return this._model.getTrackedRange(this.trackedRangeId)},r.prototype.dispose=function(){var r=this._model;r.isValidTrackedRange(this.trackedRangeId)&&r.removeTrackedRange(this.trackedRangeId),e.prototype.dispose.call(this)},r}(s.FullModelRetokenizer),d=function(){function e(e,r,t){this.id=e,this.startMarkerId=r,this.endMarkerId=t}return e}(),h=0,u=function(e){function r(r,n,a){e.call(this,r,n,a),this._rangeIdGenerator=new t.IdGenerator(++h+";"),this._ranges={},this._markerIdToRangeId={},this._multiLineTrackedRanges={}}return __extends(r,e),r.prototype._createRetokenizer=function(e,r){return new o(e,r,this)},r.prototype.dispose=function(){this._ranges=null,this._markerIdToRangeId=null,this._multiLineTrackedRanges=null,e.prototype.dispose.call(this)},r.prototype._resetValue=function(r,t){e.prototype._resetValue.call(this,r,t),this._ranges={},this._markerIdToRangeId={},this._multiLineTrackedRanges={}},r.prototype._setRangeIsMultiLine=function(e,r){var t=this._multiLineTrackedRanges.hasOwnProperty(e);!t&&r?this._multiLineTrackedRanges[e]=!0:t&&!r&&delete this._multiLineTrackedRanges[e]},r.prototype._shouldStartMarkerSticksToPreviousCharacter=function(e){return e===a.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges||e===a.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore},r.prototype._shouldEndMarkerSticksToPreviousCharacter=function(e){return e===a.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges||e===a.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore},r.prototype._getTrackedRangesCount=function(){return Object.keys(this._ranges).length},r.prototype.addTrackedRange=function(e,r){e=this.validateRange(e);var t=this._shouldStartMarkerSticksToPreviousCharacter(r),n=this._shouldEndMarkerSticksToPreviousCharacter(r),a=this._addMarker(e.startLineNumber,e.startColumn,t),i=this._addMarker(e.endLineNumber,e.endColumn,n),s=new d(this._rangeIdGenerator.nextId(),a,i);return this._ranges[s.id]=s,this._markerIdToRangeId[a]=s.id,this._markerIdToRangeId[i]=s.id,this._setRangeIsMultiLine(s.id,e.startLineNumber!==e.endLineNumber),s.id},r.prototype._addTrackedRanges=function(e,r){for(var t=[],n=0,a=e.length;n<a;n++){var i=e[n],s=r[n];t.push({lineNumber:i.startLineNumber,column:i.startColumn,stickToPreviousCharacter:this._shouldStartMarkerSticksToPreviousCharacter(s)}),t.push({lineNumber:i.endLineNumber,column:i.endColumn,stickToPreviousCharacter:this._shouldEndMarkerSticksToPreviousCharacter(s)})}for(var o=this._addMarkers(t),h=[],n=0,a=e.length;n<a;n++){var i=e[n],u=o[2*n],g=o[2*n+1],k=new d(this._rangeIdGenerator.nextId(),u,g);this._ranges[k.id]=k,this._markerIdToRangeId[u]=k.id,this._markerIdToRangeId[g]=k.id,this._setRangeIsMultiLine(k.id,i.startLineNumber!==i.endLineNumber),h.push(k.id)}return h},r.prototype.changeTrackedRange=function(e,r){if(this._ranges.hasOwnProperty(e)){r=this.validateRange(r);var t=this._ranges[e];this._changeMarker(t.startMarkerId,r.startLineNumber,r.startColumn),this._changeMarker(t.endMarkerId,r.endLineNumber,r.endColumn),this._setRangeIsMultiLine(t.id,r.startLineNumber!==r.endLineNumber)}},r.prototype.changeTrackedRangeStickiness=function(e,r){if(this._ranges.hasOwnProperty(e)){var t=this._ranges[e];this._changeMarkerStickiness(t.startMarkerId,this._shouldStartMarkerSticksToPreviousCharacter(r)),this._changeMarkerStickiness(t.endMarkerId,this._shouldEndMarkerSticksToPreviousCharacter(r))}},r.prototype.isValidTrackedRange=function(e){return!(this._isDisposed||!this._ranges)&&this._ranges.hasOwnProperty(e)},r.prototype.removeTrackedRange=function(e){if(this._ranges.hasOwnProperty(e)){var r=this._ranges[e];this._removeMarker(r.startMarkerId),this._removeMarker(r.endMarkerId),this._setRangeIsMultiLine(r.id,!1),delete this._ranges[r.id],delete this._markerIdToRangeId[r.startMarkerId],delete this._markerIdToRangeId[r.endMarkerId]}},r.prototype.removeTrackedRanges=function(e){for(var r=[],t=0,n=e.length;t<n;t++){var a=e[t];if(this._ranges.hasOwnProperty(a)){var i=this._ranges[a];r.push(i.startMarkerId),r.push(i.endMarkerId),this._setRangeIsMultiLine(i.id,!1),delete this._ranges[i.id],delete this._markerIdToRangeId[i.startMarkerId],delete this._markerIdToRangeId[i.endMarkerId]}}r.length>0&&this._removeMarkers(r)},r.prototype._newEditorRange=function(e,r){return r.isBefore(e)?new n.Range(e.lineNumber,e.column,e.lineNumber,e.column):new n.Range(e.lineNumber,e.column,r.lineNumber,r.column)},r.prototype.getTrackedRange=function(e){var r=this._ranges[e],t=this._getMarker(r.startMarkerId),n=this._getMarker(r.endMarkerId);return this._newEditorRange(t,n)},r.prototype._getMultiLineTrackedRanges=function(e,r){for(var t=[],n=Object.keys(this._multiLineTrackedRanges),a=0,i=n.length;a<i;a++){var s=n[a],o=this._ranges[s],d=this._getMarker(o.startMarkerId);if(!(d.lineNumber>r)){var h=this._getMarker(o.endMarkerId);h.lineNumber<e||t.push({id:o.id,range:this._newEditorRange(d,h)})}}return t},r.prototype.getLinesTrackedRanges=function(e,r){var t,n,a,i,s,o,d,h,u=this._getMultiLineTrackedRanges(e,r),g={};for(i=0,s=u.length;i<s;i++)g[u[i].id]=!0;for(o=e;o<=r;o++)for(t=this._getLineMarkers(o),i=0,s=t.length;i<s;i++)n=t[i],this._markerIdToRangeId.hasOwnProperty(n.id)&&(a=this._markerIdToRangeId[n.id],g.hasOwnProperty(a)||(d=this._getMarker(this._ranges[a].startMarkerId),h=this._getMarker(this._ranges[a].endMarkerId),u.push({id:a,range:this._newEditorRange(d,h)}),g[a]=!0));return u},r.prototype._onChangedMarkers=function(e){var r,t,n,a,i,s,o={};for(i=0,s=e.length;i<s;i++)a=e[i],this._markerIdToRangeId.hasOwnProperty(a.id)&&(n=this._markerIdToRangeId[a.id],t=this._ranges[n],o.hasOwnProperty(t.id)?r=o[t.id]:(r={startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0},o[t.id]=r),a.id===t.startMarkerId?(r.startLineNumber=a.oldLineNumber,r.startColumn=a.oldColumn):(r.endLineNumber=a.oldLineNumber,r.endColumn=a.oldColumn),this._setRangeIsMultiLine(t.id,this._getMarker(t.startMarkerId).lineNumber!==this._getMarker(t.endMarkerId).lineNumber));return o},r}(i.TextModelWithMarkers);r.TextModelWithTrackedRanges=u});