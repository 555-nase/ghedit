define(["require","exports","vs/editor/common/core/range","vs/editor/common/editorCommon","vs/editor/common/viewModel/viewModel"],function(e,o,n,t,r){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function i(e){var o=e.options;return!!(o.inlineClassName||o.beforeContentClassName||o.afterContentClassName)}var a=function(){function e(e,o){this.id=e.id,this.options=e.options,this.ownerId=e.ownerId,this.modelRange=e.range,this.range=o}return e}(),s=function(){function e(e,o,n){this.editorId=e,this.configuration=o,this.converter=n,this.decorations=[],this._clearCachedModelDecorationsResolver()}return e.prototype._clearCachedModelDecorationsResolver=function(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverStartLineNumber=0,this._cachedModelDecorationsResolverEndLineNumber=0},e.prototype.dispose=function(){this.converter=null,this.decorations=null,this._clearCachedModelDecorationsResolver()},e.compareDecorations=function(e,o){return n.Range.compareRangesUsingStarts(e.range,o.range)},e.prototype.reset=function(o){var n,t,r,i,s=o.getAllDecorations(this.editorId,this.configuration.editor.readOnly);for(this.decorations=[],n=0,t=s.length;n<t;n++)r=s[n],i=new a(r,this.converter.convertModelRangeToViewRange(r.range,r.options.isWholeLine)),this.decorations[n]=i;this._clearCachedModelDecorationsResolver(),this.decorations.sort(e.compareDecorations)},e.prototype.onModelDecorationsChanged=function(o,n){var r,s,c,d=!1,l=!1,h={},u={},g=this.configuration.editor.readOnly;for(s=0,c=o.addedOrChangedDecorations.length;s<c;s++)r=o.addedOrChangedDecorations[s],g&&r.isForValidation||r.ownerId&&r.ownerId!==this.editorId||(u[r.id]=r);for(s=0,c=o.removedDecorations.length;s<c;s++)h[o.removedDecorations[s]]=!0;var m,p={};for(s=0,c=this.decorations.length;s<c;s++)m=this.decorations[s],u.hasOwnProperty(m.id)&&(p[m.id]=!0,r=u[m.id],m.options=r.options,m.modelRange=r.range,m.range=this.converter.convertModelRangeToViewRange(r.range,r.options.isWholeLine),l=l||i(m),d=!0),h.hasOwnProperty(m.id)&&(l=l||i(this.decorations[s]),this.decorations.splice(s,1),c--,s--,d=!0);for(var v=Object.keys(u),D=0,f=v.length;D<f;D++){var C=v[D];p.hasOwnProperty(C)||(r=u[C],m=new a(r,this.converter.convertModelRangeToViewRange(r.range,r.options.isWholeLine)),this.decorations.push(m),l=l||i(m),d=!0)}if(d){this._clearCachedModelDecorationsResolver(),this.decorations.sort(e.compareDecorations);var R={inlineDecorationsChanged:l};n(t.ViewEventNames.DecorationsChangedEvent,R)}},e.prototype.onLineMappingChanged=function(o){var r,a,s,c,d=this.decorations,l=!1,h=!1;for(a=0,c=d.length;a<c;a++)r=d[a],s=this.converter.convertModelRangeToViewRange(r.modelRange,r.options.isWholeLine),h||!i(r)||n.Range.equalsRange(s,r.range)||(h=!0),l||n.Range.equalsRange(s,r.range)||(l=!0),r.range=s;if(l){this._clearCachedModelDecorationsResolver(),this.decorations.sort(e.compareDecorations);var u={inlineDecorationsChanged:h};o(t.ViewEventNames.DecorationsChangedEvent,u)}},e.prototype.getAllDecorations=function(){return this.decorations},e.prototype.getDecorationsViewportData=function(e,o){var n=!0;return n=n&&null!==this._cachedModelDecorationsResolver,n=n&&this._cachedModelDecorationsResolverStartLineNumber===e,n=n&&this._cachedModelDecorationsResolverEndLineNumber===o,n||(this._cachedModelDecorationsResolver=this._getDecorationsViewportData(e,o),this._cachedModelDecorationsResolverStartLineNumber=e,this._cachedModelDecorationsResolverEndLineNumber=o),this._cachedModelDecorationsResolver},e.prototype._getDecorationsViewportData=function(e,o){var t,i,a,s,c,d,l,h=[],u=[],g=this.decorations;for(t=e;t<=o;t++)u[t-e]=[];for(d=0,l=g.length;d<l&&(s=g[d],c=s.range,!(c.startLineNumber>o));d++)if(!(c.endLineNumber<e)){if(h.push(s),s.options.inlineClassName){var m=new r.InlineDecoration(s.range,s.options.inlineClassName);for(i=Math.max(e,c.startLineNumber),a=Math.min(o,c.endLineNumber),t=i;t<=a;t++)u[t-e].push(m)}if(s.options.beforeContentClassName&&c.startLineNumber>=e){var m=new r.InlineDecoration(new n.Range(c.startLineNumber,c.startColumn,c.startLineNumber,c.startColumn+1),s.options.beforeContentClassName);u[c.startLineNumber-e].push(m)}if(s.options.afterContentClassName&&c.endLineNumber<=o&&c.endColumn>1){var m=new r.InlineDecoration(new n.Range(c.endLineNumber,c.endColumn-1,c.endLineNumber,c.endColumn),s.options.afterContentClassName);u[c.endLineNumber-e].push(m)}}return{decorations:h,inlineDecorations:u}},e}();o.ViewModelDecorations=s});