define(["require","exports","vs/base/common/strings","vs/editor/common/editorCommon","vs/editor/common/viewModel/prefixSumComputer","vs/editor/common/viewModel/splitLinesCollection"],function(t,e,n,i,r,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var s;!function(t){t[t.NONE=0]="NONE",t[t.BREAK_BEFORE=1]="BREAK_BEFORE",t[t.BREAK_AFTER=2]="BREAK_AFTER",t[t.BREAK_OBTRUSIVE=3]="BREAK_OBTRUSIVE",t[t.BREAK_IDEOGRAPHIC=4]="BREAK_IDEOGRAPHIC"}(s||(s={}));var a=function(){function t(t,e,n){this._asciiMap=[];for(var i=0;i<256;i++)this._asciiMap[i]=s.NONE;this._map=[];for(var i=0;i<t.length;i++)this._set(t.charCodeAt(i),s.BREAK_BEFORE);for(var i=0;i<e.length;i++)this._set(e.charCodeAt(i),s.BREAK_AFTER);for(var i=0;i<n.length;i++)this._set(n.charCodeAt(i),s.BREAK_OBTRUSIVE)}return t.prototype._set=function(t,e){t<256&&(this._asciiMap[t]=e),this._map[t]=e},t.prototype.classify=function(t){if(t<256)return this._asciiMap[t];var e=this._map[t];return e?e:t>=12352&&t<=12543||t>=13312&&t<=19903||t>=19968&&t<=40959?s.BREAK_IDEOGRAPHIC:s.NONE},t}(),u=function(){function t(t,e,n){this.classifier=new a(t,e,n)}return t.nextVisibleColumn=function(t,e,n,i){return t=+t,e=+e,i=+i,n?t+(e-t%e):t+i},t.prototype.createLineMapping=function(e,o,a,u,c){if(a===-1)return null;o=+o,a=+a,u=+u,c=+c;var f=0,E="",A="\t".charCodeAt(0),R=-1;if(c!==i.WrappingIndent.None&&(R=n.firstNonWhitespaceIndex(e),R!==-1)){E=e.substring(0,R);for(var l=0;l<R;l++)f=t.nextVisibleColumn(f,o,e.charCodeAt(l)===A,1);c===i.WrappingIndent.Indent&&(E+="\t",f=t.nextVisibleColumn(f,o,!0,1)),f>.5*a&&(E="",f=0)}for(var _,h,d=this.classifier,m=0,C=[],B=0,O=0,I=-1,v=0,g=-1,K=0,x=e.length,l=0;l<x;l++){var y=e.charCodeAt(l),F=y===A,V=d.classify(y);if(V===s.BREAK_BEFORE&&(I=l,v=0),V===s.BREAK_IDEOGRAPHIC&&l>0){var N=e.charCodeAt(l-1),S=d.classify(N);S!==s.BREAK_BEFORE&&(I=l,v=0)}var b=1;if(n.isFullWidthCharacter(y)&&(b=u),O=t.nextVisibleColumn(O,o,F,b),O>a&&0!==l&&(I!==-1?(_=I,h=v):g!==-1?(_=g,h=K):(_=l,h=f),C[B++]=_-m,m=_,O=t.nextVisibleColumn(h,o,F,b),I=-1,v=0,g=-1,K=0),I!==-1&&(v=t.nextVisibleColumn(v,o,F,b)),g!==-1&&(K=t.nextVisibleColumn(K,o,F,b)),V===s.BREAK_AFTER&&(c===i.WrappingIndent.None||l>=R)&&(I=l+1,v=f),V===s.BREAK_IDEOGRAPHIC&&l<x-1){var M=e.charCodeAt(l+1),P=d.classify(M);P!==s.BREAK_AFTER&&(I=l+1,v=f)}V===s.BREAK_OBTRUSIVE&&(g=l+1,K=f)}return 0===B?null:(C[B++]=x-m,new p(new r.PrefixSumComputer(C),E))},t}();e.CharacterHardWrappingLineMapperFactory=u;var p=function(){function t(t,e){this._prefixSums=t,this._wrappedLinesIndent=e}return t.prototype.getOutputLineCount=function(){return this._prefixSums.getCount()},t.prototype.getWrappedLinesIndent=function(){return this._wrappedLinesIndent},t.prototype.getInputOffsetOfOutputPosition=function(t,e){return 0===t?e:this._prefixSums.getAccumulatedValue(t-1)+e},t.prototype.getOutputPositionOfInputOffset=function(t){var e=this._prefixSums.getIndexOf(t);return new o.OutputPosition(e.index,e.remainder)},t}();e.CharacterHardWrappingLineMapping=p});