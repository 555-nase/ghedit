define(["require","exports","vs/base/common/errors","vs/base/common/event","vs/base/common/mime","vs/base/common/strings","vs/editor/common/modes/modesRegistry"],function(e,i,t,s,n,r,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var a=Object.prototype.hasOwnProperty,d=function(){function e(e){var i=this;void 0===e&&(e=!0),this._onDidAddModes=new s.Emitter,this.onDidAddModes=this._onDidAddModes.event,this.knownModeIds={},this.mime2LanguageId={},this.name2LanguageId={},this.id2Name={},this.id2Extensions={},this.compatModes={},this.lowerName2Id={},this.id2ConfigurationFiles={},e&&(this._registerCompatModes(o.ModesRegistry.getCompatModes()),o.ModesRegistry.onDidAddCompatModes(function(e){return i._registerCompatModes(e)}),this._registerLanguages(o.ModesRegistry.getLanguages()),o.ModesRegistry.onDidAddLanguages(function(e){return i._registerLanguages(e)}))}return e.prototype._registerCompatModes=function(e){for(var i=[],t=0;t<e.length;t++){var s=e[t];this._registerLanguage({id:s.id,extensions:s.extensions,filenames:s.filenames,firstLine:s.firstLine,aliases:s.aliases,mimetypes:s.mimetypes}),this.compatModes[s.id]={moduleId:s.moduleId,ctorName:s.ctorName,deps:s.deps},i.push(s.id)}this._onDidAddModes.fire(i)},e.prototype._registerLanguages=function(e){for(var i=[],t=0;t<e.length;t++)this._registerLanguage(e[t]),i.push(e[t].id);this._onDidAddModes.fire(i)},e.prototype._setLanguageName=function(e,i,t){var s=this.id2Name[e];if(s){if(!t)return;delete this.name2LanguageId[s]}this.name2LanguageId[i]=e,this.id2Name[e]=i},e.prototype._registerLanguage=function(e){this.knownModeIds[e.id]=!0;var i=null;if("undefined"!=typeof e.mimetypes&&Array.isArray(e.mimetypes))for(var s=0;s<e.mimetypes.length;s++)i||(i=e.mimetypes[s]),this.mime2LanguageId[e.mimetypes[s]]=e.id;if(i||(i="text/x-"+e.id,this.mime2LanguageId[i]=e.id),Array.isArray(e.extensions)){this.id2Extensions[e.id]=this.id2Extensions[e.id]||[];for(var o=0,a=e.extensions;o<a.length;o++){var d=a[o];n.registerTextMime({mime:i,extension:d}),this.id2Extensions[e.id].push(d)}}if(Array.isArray(e.filenames))for(var g=0,m=e.filenames;g<m.length;g++){var u=m[g];n.registerTextMime({mime:i,filename:u})}if(Array.isArray(e.filenamePatterns))for(var f=0,p=e.filenamePatterns;f<p.length;f++){var l=p[f];n.registerTextMime({mime:i,filepattern:l})}if("string"==typeof e.firstLine&&e.firstLine.length>0){var h=e.firstLine;"^"!==h.charAt(0)&&(h="^"+h);try{var y=new RegExp(h);r.regExpLeadsToEndlessLoop(y)||n.registerTextMime({mime:i,firstline:y})}catch(c){t.onUnexpectedError(c)}}if(this.lowerName2Id[e.id.toLowerCase()]=e.id,"undefined"!=typeof e.aliases&&Array.isArray(e.aliases))for(var s=0;s<e.aliases.length;s++)e.aliases[s]&&0!==e.aliases[s].length&&(this.lowerName2Id[e.aliases[s].toLowerCase()]=e.id);var L="undefined"!=typeof e.aliases&&Array.isArray(e.aliases)&&e.aliases.length>0;if(L&&null===e.aliases[0]);else{var M=(L?e.aliases[0]:null)||e.id;this._setLanguageName(e.id,M,L)}"string"==typeof e.configuration&&(this.id2ConfigurationFiles[e.id]=this.id2ConfigurationFiles[e.id]||[],this.id2ConfigurationFiles[e.id].push(e.configuration))},e.prototype.isRegisteredMode=function(e){return!!a.call(this.mime2LanguageId,e)||a.call(this.knownModeIds,e)},e.prototype.getRegisteredModes=function(){return Object.keys(this.knownModeIds)},e.prototype.getRegisteredLanguageNames=function(){return Object.keys(this.name2LanguageId)},e.prototype.getLanguageName=function(e){return this.id2Name[e]||null},e.prototype.getModeIdForLanguageNameLowercase=function(e){return this.lowerName2Id[e]||null},e.prototype.getConfigurationFiles=function(e){return this.id2ConfigurationFiles[e]||[]},e.prototype.getMimeForMode=function(e){for(var i=Object.keys(this.mime2LanguageId),t=0,s=i.length;t<s;t++){var n=i[t],r=this.mime2LanguageId[n];if(r===e)return n}return null},e.prototype.extractModeIds=function(e){var i=this;return e?e.split(",").map(function(e){return e.trim()}).map(function(e){return i.mime2LanguageId[e]||e}).filter(function(e){return i.knownModeIds[e]}):[]},e.prototype.getModeIdsFromLanguageName=function(e){return e&&a.call(this.name2LanguageId,e)?[this.name2LanguageId[e]]:[]},e.prototype.getModeIdsFromFilenameOrFirstLine=function(e,i){if(!e&&!i)return[];var t=n.guessMimeTypes(e,i);return this.extractModeIds(t.join(","))},e.prototype.getCompatMode=function(e){return this.compatModes[e]||null},e.prototype.getExtensions=function(e){var i=this.name2LanguageId[e];return i?this.id2Extensions[i]:[]},e}();i.LanguagesRegistry=d});