var __decorate=this&&this.__decorate||function(e,t,r,o){var s,c=arguments.length,i=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(i=(c<3?s(i):c>3?s(t,r,i):s(t,r))||i);return c>3&&i&&Object.defineProperty(t,r,i),i},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(["require","exports","vs/base/common/winjs.base","vs/editor/common/services/resourceService","vs/editor/common/services/modeService","vs/editor/common/model/mirrorModel","vs/base/common/errors","vs/editor/common/modes/modesRegistry"],function(e,t,r,o,s,c,i,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var a=function(){function e(e,t,r){this.resourceService=e,this.modeService=t,this.isInMainThread=!1,n.ModesRegistry.registerCompatModes(r.compatModes),n.ModesRegistry.registerLanguages(r.languages),this._compatModes=Object.create(null)}return e.prototype.registerCompatMode=function(e){this._compatModes[e.getId()]=e},e.prototype.handleMainRequest=function(e,t,o){if("$"===e)switch(t){case"acceptNewModel":return this._acceptNewModel(o[0]);case"acceptDidDisposeModel":return this._acceptDidDisposeModel(o[0]);case"acceptModelEvents":return this._acceptModelEvents(o[0],o[1]);case"acceptCompatModes":return this._acceptCompatModes(o[0]);case"acceptLanguages":return this._acceptLanguages(o[0]);case"instantiateCompatMode":return this._instantiateCompatMode(o[0])}var s=this._compatModes[e];return r.TPromise.as(s[t].apply(s,o))},e.prototype.CompatWorker=function(e,t,r,o){return r.apply(e,o)},e.prototype._acceptNewModel=function(e){var t=this,r=new c.MirrorModel(e.versionId,e.value,null,e.url);return this.resourceService.insert(r.uri,r),this.modeService.getOrCreateMode(e.modeId).then(function(e){t.resourceService.remove(r.uri),r.setMode(e),t.resourceService.insert(r.uri,r)})},e.prototype._acceptDidDisposeModel=function(e){var t=this.resourceService.get(e);this.resourceService.remove(e),t.dispose()},e.prototype._acceptModelEvents=function(e,t){var r=this.resourceService.get(e);try{r.onEvents(t)}catch(o){i.onUnexpectedError(o)}},e.prototype._acceptCompatModes=function(e){n.ModesRegistry.registerCompatModes(e)},e.prototype._acceptLanguages=function(e){n.ModesRegistry.registerLanguages(e)},e.prototype._instantiateCompatMode=function(e){return this.modeService.getOrCreateMode(e).then(function(e){})},e=__decorate([__param(0,o.IResourceService),__param(1,s.IModeService)],e)}();t.CompatWorkerServiceWorker=a});