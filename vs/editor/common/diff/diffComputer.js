var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)};define(["require","exports","vs/base/common/diff/diff","vs/base/common/strings"],function(t,i,e,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function r(t,i,n){var r=new e.LcsDiff(t,i,n);return r.ComputeDiff()}function o(t){if(t.length<=1)return t;var i,e,n,r,o,s,u=[t[0]],h=u[0];for(i=1,e=t.length;i<e;i++)s=t[i],n=s.originalStart-(h.originalStart+h.originalLength),r=s.modifiedStart-(h.modifiedStart+h.modifiedLength),o=Math.min(n,r),o<a?(h.originalLength=s.originalStart+s.originalLength-h.originalStart,h.modifiedLength=s.modifiedStart+s.modifiedLength-h.modifiedStart):(u.push(s),h=s);return u}var s=5e3,a=3,u=function(){function t(t,i,e){this.buffer=t,this.startMarkers=i,this.endMarkers=e}return t.prototype.equals=function(i){if(!(i instanceof t))return!1;var e=i;if(this.getLength()!==e.getLength())return!1;for(var n=0,r=this.getLength();n<r;n++){var o=this.getElementHash(n),s=e.getElementHash(n);if(o!==s)return!1}return!0},t.prototype.getLength=function(){return this.startMarkers.length},t.prototype.getElementHash=function(t){return this.buffer.substring(this.startMarkers[t].offset,this.endMarkers[t].offset)},t.prototype.getStartLineNumber=function(t){return t===this.startMarkers.length?this.startMarkers[t-1].lineNumber+1:this.startMarkers[t].lineNumber},t.prototype.getStartColumn=function(t){return this.startMarkers[t].column},t.prototype.getEndLineNumber=function(t){return this.endMarkers[t].lineNumber},t.prototype.getEndColumn=function(t){return this.endMarkers[t].column},t}(),h=function(t){function i(e,n){var r,o,s,a,u,h="",m=[],d=[];for(s=0,r=0,o=e.length;r<o;r++)h+=e[r],a=1,u=e[r].length+1,n&&(a=i._getFirstNonBlankColumn(e[r],1),u=i._getLastNonBlankColumn(e[r],1)),m.push({offset:s+a-1,lineNumber:r+1,column:a}),d.push({offset:s+u-1,lineNumber:r+1,column:u}),s+=e[r].length;t.call(this,h,m,d)}return __extends(i,t),i._getFirstNonBlankColumn=function(t,i){var e=n.firstNonWhitespaceIndex(t);return e===-1?i:e+1},i._getLastNonBlankColumn=function(t,i){var e=n.lastNonWhitespaceIndex(t);return e===-1?i:e+2},i.prototype.getCharSequence=function(t,i){var e,n,r,o,s=[],a=[];for(e=t;e<=i;e++)for(r=this.startMarkers[e],o=this.endMarkers[e],n=r.offset;n<o.offset;n++)s.push({offset:n,lineNumber:r.lineNumber,column:r.column+(n-r.offset)}),a.push({offset:n+1,lineNumber:r.lineNumber,column:r.column+(n-r.offset)+1});return new u(this.buffer,s,a)},i}(u),m=function(){function t(t,i,e){0===t.originalLength?(this.originalStartLineNumber=0,this.originalStartColumn=0,this.originalEndLineNumber=0,this.originalEndColumn=0):(this.originalStartLineNumber=i.getStartLineNumber(t.originalStart),this.originalStartColumn=i.getStartColumn(t.originalStart),this.originalEndLineNumber=i.getEndLineNumber(t.originalStart+t.originalLength-1),this.originalEndColumn=i.getEndColumn(t.originalStart+t.originalLength-1)),0===t.modifiedLength?(this.modifiedStartLineNumber=0,this.modifiedStartColumn=0,this.modifiedEndLineNumber=0,this.modifiedEndColumn=0):(this.modifiedStartLineNumber=e.getStartLineNumber(t.modifiedStart),this.modifiedStartColumn=e.getStartColumn(t.modifiedStart),this.modifiedEndLineNumber=e.getEndLineNumber(t.modifiedStart+t.modifiedLength-1),this.modifiedEndColumn=e.getEndColumn(t.modifiedStart+t.modifiedLength-1))}return t}(),d=function(){function t(t,i,e,n,s){if(0===t.originalLength?(this.originalStartLineNumber=i.getStartLineNumber(t.originalStart)-1,this.originalEndLineNumber=0):(this.originalStartLineNumber=i.getStartLineNumber(t.originalStart),this.originalEndLineNumber=i.getEndLineNumber(t.originalStart+t.originalLength-1)),0===t.modifiedLength?(this.modifiedStartLineNumber=e.getStartLineNumber(t.modifiedStart)-1,this.modifiedEndLineNumber=0):(this.modifiedStartLineNumber=e.getStartLineNumber(t.modifiedStart),this.modifiedEndLineNumber=e.getEndLineNumber(t.modifiedStart+t.modifiedLength-1)),0!==t.originalLength&&0!==t.modifiedLength&&n()){var a=i.getCharSequence(t.originalStart,t.originalStart+t.originalLength-1),u=e.getCharSequence(t.modifiedStart,t.modifiedStart+t.modifiedLength-1),h=r(a,u,n);s&&(h=o(h)),this.charChanges=[];for(var d=0,g=h.length;d<g;d++)this.charChanges.push(new m(h[d],a,u))}}return t}(),g=function(){function t(t,i,e){this.shouldPostProcessCharChanges=e.shouldPostProcessCharChanges,this.shouldIgnoreTrimWhitespace=e.shouldIgnoreTrimWhitespace,this.maximumRunTimeMs=s,this.original=new h(t,this.shouldIgnoreTrimWhitespace),this.modified=new h(i,this.shouldIgnoreTrimWhitespace),e.shouldConsiderTrimWhitespaceInEmptyCase&&this.shouldIgnoreTrimWhitespace&&this.original.equals(this.modified)&&(this.shouldIgnoreTrimWhitespace=!1,this.original=new h(t,this.shouldIgnoreTrimWhitespace),this.modified=new h(i,this.shouldIgnoreTrimWhitespace))}return t.prototype.computeDiff=function(){this.computationStartTime=(new Date).getTime();for(var t=r(this.original,this.modified,this._continueProcessingPredicate.bind(this)),i=[],e=0,n=t.length;e<n;e++)i.push(new d(t[e],this.original,this.modified,this._continueProcessingPredicate.bind(this),this.shouldPostProcessCharChanges));return i},t.prototype._continueProcessingPredicate=function(){if(0===this.maximumRunTimeMs)return!0;var t=(new Date).getTime();return t-this.computationStartTime<this.maximumRunTimeMs},t}();i.DiffComputer=g});