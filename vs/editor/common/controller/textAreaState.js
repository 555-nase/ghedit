var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define(["require","exports","vs/base/common/strings","vs/editor/common/core/range","vs/editor/common/editorCommon"],function(e,t,n,r,i){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function o(e){return e===s.IENarrator?u.EMPTY:a?c.EMPTY:h.EMPTY}!function(e){e[e.IENarrator=0]="IENarrator",e[e.NVDA=1]="NVDA"}(t.TextAreaStrategy||(t.TextAreaStrategy={}));var s=t.TextAreaStrategy,a=!1;t.createTextAreaState=o;var l=function(){function e(e,t,n,r,i){this.previousState=e?e.shallowClone():null,this.value=t,this.selectionStart=n,this.selectionEnd=r,this.isInOverwriteMode=i}return e.prototype.updateComposition=function(){return this.previousState?{text:this.value,replaceCharCnt:this.previousState.selectionEnd-this.previousState.selectionStart}:{text:"",replaceCharCnt:0}},e.prototype.getSelectionStart=function(){return this.selectionStart},e.prototype.getValue=function(){return this.value},e.prototype.applyToTextArea=function(e,t,n){t.getValue()!==this.value&&t.setValue(e,this.value),n&&t.setSelectionRange(this.selectionStart,this.selectionEnd)},e.prototype.deduceInput=function(){if(!this.previousState)return{text:"",replaceCharCnt:0};var e=this.previousState.value,t=this.previousState.selectionStart,r=this.previousState.selectionEnd,i=this.value,o=this.selectionStart,s=this.selectionEnd,a=e.substring(r),l=i.substring(s),u=n.commonSuffixLength(a,l);i=i.substring(0,i.length-u),e=e.substring(0,e.length-u);var h=e.substring(0,t),c=i.substring(0,o),g=n.commonPrefixLength(h,c);if(i=i.substring(g),e=e.substring(g),o-=g,t-=g,s-=g,r-=g,o===s){if(e===i&&0===t&&r===e.length&&o===i.length&&i.indexOf("\n")===-1)return{text:"",replaceCharCnt:0};var f=h.length-g;return{text:i,replaceCharCnt:f}}var p=r-t;return{text:i,replaceCharCnt:p}},e}();t.TextAreaState=l;var u=function(e){function t(t,n,r,i,o,s){e.call(this,t,n,r,i,o),this.selectionToken=s}return __extends(t,e),t.prototype.shallowClone=function(){return new t(null,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode,this.selectionToken)},t.prototype.toEmpty=function(){return t.EMPTY},t.prototype.toString=function(){return"[ <"+this.value+">, selectionStart: "+this.selectionStart+", selectionEnd: "+this.selectionEnd+", isInOverwriteMode: "+this.isInOverwriteMode+", selectionToken: "+this.selectionToken+"]"},t.prototype.toStrategy=function(e){return e===s.IENarrator?this:a?new c(this.previousState,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode):new h(this.previousState,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode)},t.prototype.equals=function(e){return e instanceof t&&(this.value===e.value&&this.selectionStart===e.selectionStart&&this.selectionEnd===e.selectionEnd&&this.isInOverwriteMode===e.isInOverwriteMode&&this.selectionToken===e.selectionToken)},t.prototype.fromTextArea=function(e){return new t(this,e.getValue(),e.getSelectionStart(),e.getSelectionEnd(),e.isInOverwriteMode(),this.selectionToken)},t.prototype.fromEditorSelection=function(e,n){var o=100,s=0,a=n.startLineNumber,l=n.startColumn,u=n.endLineNumber,h=n.endColumn,c=e.getLineMaxColumn(u);n.isEmpty()&&this.selectionToken!==a&&(l=1,h=c);var g="",f=Math.max(1,a-s);f<a&&(g=e.getValueInRange(new r.Range(f,1,a,1),i.EndOfLinePreference.LF)),g+=e.getValueInRange(new r.Range(a,1,a,l),i.EndOfLinePreference.LF),g.length>o&&(g=g.substring(g.length-o,g.length));var p="",v=Math.min(u+s,e.getLineCount());p+=e.getValueInRange(new r.Range(u,h,u,c),i.EndOfLinePreference.LF),v>u&&(p="\n"+e.getValueInRange(new r.Range(u+1,1,v,e.getLineMaxColumn(v)),i.EndOfLinePreference.LF)),p.length>o&&(p=p.substring(0,o));var d=e.getValueInRange(new r.Range(a,l,u,h),i.EndOfLinePreference.LF);return d.length>2*o&&(d=d.substring(0,o)+String.fromCharCode(8230)+d.substring(d.length-o,d.length)),new t(this,g+d+p,g.length,g.length+d.length,(!1),a)},t.prototype.fromText=function(e){return new t(this,e,0,e.length,(!1),0)},t.prototype.resetSelection=function(){return new t(this.previousState,this.value,this.value.length,this.value.length,this.isInOverwriteMode,this.selectionToken)},t.EMPTY=new t(null,"",0,0,(!1),0),t}(l);t.IENarratorTextAreaState=u;var h=function(e){function t(t,n,r,i,o){e.call(this,t,n,r,i,o)}return __extends(t,e),t.prototype.shallowClone=function(){return new t(null,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode)},t.prototype.toEmpty=function(){return t.EMPTY},t.prototype.toString=function(){return"[ <"+this.value+">, selectionStart: "+this.selectionStart+", selectionEnd: "+this.selectionEnd+", isInOverwriteMode: "+this.isInOverwriteMode+"]"},t.prototype.toStrategy=function(e){return e===s.NVDA?this:new u(this.previousState,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode,0)},t.prototype.equals=function(e){return e instanceof t&&(this.value===e.value&&this.selectionStart===e.selectionStart&&this.selectionEnd===e.selectionEnd&&this.isInOverwriteMode===e.isInOverwriteMode)},t.prototype.fromTextArea=function(e){return new t(this,e.getValue(),e.getSelectionStart(),e.getSelectionEnd(),e.isInOverwriteMode())},t._getPageOfLine=function(e){return Math.floor((e-1)/t._LINES_PER_PAGE)},t._getRangeForPage=function(e){var n=e*t._LINES_PER_PAGE,i=n+1,o=n+t._LINES_PER_PAGE;return new r.Range(i,1,o,Number.MAX_VALUE)},t.prototype.fromEditorSelection=function(e,n){var o=t._getPageOfLine(n.startLineNumber),s=t._getRangeForPage(o),a=t._getPageOfLine(n.endLineNumber),l=t._getRangeForPage(a),u=s.intersectRanges(new r.Range(1,1,n.startLineNumber,n.startColumn)),h=e.getValueInRange(u,i.EndOfLinePreference.LF),c=e.getLineCount(),g=e.getLineMaxColumn(c),f=l.intersectRanges(new r.Range(n.endLineNumber,n.endColumn,c,g)),p=e.getValueInRange(f,i.EndOfLinePreference.LF),v=null;if(o===a||o+1===a)v=e.getValueInRange(n,i.EndOfLinePreference.LF);else{var d=s.intersectRanges(n),S=l.intersectRanges(n);v=e.getValueInRange(d,i.EndOfLinePreference.LF)+String.fromCharCode(8230)+e.getValueInRange(S,i.EndOfLinePreference.LF)}var E=500;return h.length>E&&(h=h.substring(h.length-E,h.length)),p.length>E&&(p=p.substring(0,E)),v.length>2*E&&(v=v.substring(0,E)+String.fromCharCode(8230)+v.substring(v.length-E,v.length)),new t(this,h+v+p,h.length,h.length+v.length,(!1))},t.prototype.fromText=function(e){return new t(this,e,0,e.length,(!1))},t.prototype.resetSelection=function(){return new t(this.previousState,this.value,this.value.length,this.value.length,this.isInOverwriteMode)},t.EMPTY=new t(null,"",0,0,(!1)),t._LINES_PER_PAGE=10,t}(l);t.NVDAPagedTextAreaState=h;var c=function(e){function t(t,n,r,i,o){e.call(this,t,n,r,i,o)}return __extends(t,e),t.prototype.shallowClone=function(){return new t(null,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode)},t.prototype.toEmpty=function(){return t.EMPTY},t.prototype.toString=function(){return"[ <ENTIRE TEXT>, selectionStart: "+this.selectionStart+", selectionEnd: "+this.selectionEnd+", isInOverwriteMode: "+this.isInOverwriteMode+"]"},t.prototype.toStrategy=function(e){return e===s.NVDA?this:new u(this.previousState,this.value,this.selectionStart,this.selectionEnd,this.isInOverwriteMode,0)},t.prototype.equals=function(e){return e instanceof t&&(this.value===e.value&&this.selectionStart===e.selectionStart&&this.selectionEnd===e.selectionEnd&&this.isInOverwriteMode===e.isInOverwriteMode)},t.prototype.fromTextArea=function(e){return new t(this,e.getValue(),e.getSelectionStart(),e.getSelectionEnd(),e.isInOverwriteMode())},t.prototype.fromEditorSelection=function(e,n){var o=e.getValueInRange(new r.Range(1,1,n.startLineNumber,n.startColumn),i.EndOfLinePreference.LF),s=e.getValueInRange(n,i.EndOfLinePreference.LF),a=e.getLineCount(),l=e.getLineMaxColumn(a),u=e.getValueInRange(new r.Range(n.endLineNumber,n.endColumn,a,l),i.EndOfLinePreference.LF);return new t(this,o+s+u,o.length,o.length+s.length,(!1))},t.prototype.fromText=function(e){return new t(this,e,0,e.length,(!1))},t.prototype.resetSelection=function(){return new t(this.previousState,this.value,this.value.length,this.value.length,this.isInOverwriteMode)},t.EMPTY=new t(null,"",0,0,(!1)),t}(l);t.NVDAFullTextAreaState=c});