var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/eventEmitter","vs/base/common/lifecycle","vs/editor/common/commands/replaceCommand","vs/editor/common/controller/cursorCollection","vs/editor/common/controller/oneCursor","vs/editor/common/core/range","vs/editor/common/core/selection","vs/editor/common/editorCommon","vs/editor/common/modes/languageConfigurationRegistry"],function(e,t,n,r,o,i,s,u,l,a,c,h,d){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var p;!function(e){e[e.Primary=0]="Primary",e[e.TopMost=1]="TopMost",e[e.BottomMost=2]="BottomMost"}(p||(p={}));var f=function(e){function t(t,n,r,o,i){var s=this;e.call(this,[h.EventType.CursorPositionChanged,h.EventType.CursorSelectionChanged,h.EventType.CursorRevealRange,h.EventType.CursorScrollRequest]),this._columnSelectToLineNumber=0,this._columnSelectToVisualColumn=0,this.editorId=t,this.configuration=n,this.model=r,this.viewModelHelper=o,this.enableEmptySelectionClipboard=i,this.cursors=new u.CursorCollection(this.editorId,this.model,this.configuration,this.viewModelHelper),this.cursorUndoStack=[],this.typingListeners={},this._isHandling=!1,this.modelUnbinds=[],this.modelUnbinds.push(this.model.onDidChangeRawContent(function(e){s._onModelContentChanged(e)})),this.modelUnbinds.push(this.model.onDidChangeMode(function(e){s._onModelModeChanged()})),this.modelUnbinds.push(d.LanguageConfigurationRegistry.onDidChange(function(){s._onModelModeChanged()})),this._handlers={},this._registerHandlers()}return __extends(t,e),t.prototype.dispose=function(){this.modelUnbinds=i.dispose(this.modelUnbinds),this.model=null,this.cursors.dispose(),this.cursors=null,this.configuration=null,this.viewModelHelper=null,e.prototype.dispose.call(this)},t.prototype.saveState=function(){for(var e,t=this.cursors.getSelections(),n=[],r=0;r<t.length;r++)e=t[r],n.push({inSelectionMode:!e.isEmpty(),selectionStart:{lineNumber:e.selectionStartLineNumber,column:e.selectionStartColumn},position:{lineNumber:e.positionLineNumber,column:e.positionColumn}});return n},t.prototype.restoreState=function(e){for(var t,n=this,r=[],o=0;o<e.length;o++){t=e[o];var i=1,s=1;t.position&&t.position.lineNumber&&(i=t.position.lineNumber),t.position&&t.position.column&&(s=t.position.column);var u=i,l=s;t.selectionStart&&t.selectionStart.lineNumber&&(u=t.selectionStart.lineNumber),t.selectionStart&&t.selectionStart.column&&(l=t.selectionStart.column),r.push({selectionStartLineNumber:u,selectionStartColumn:l,positionLineNumber:i,positionColumn:s})}this._onHandler("restoreState",function(e){return n.cursors.setSelections(r),!1},"restoreState",null)},t.prototype.setEditableRange=function(e){this.model.setEditableRange(e)},t.prototype.getEditableRange=function(){return this.model.getEditableRange()},t.prototype.addTypingListener=function(e,t){this.typingListeners.hasOwnProperty(e)||(this.typingListeners[e]=[]),this.typingListeners[e].push(t)},t.prototype.removeTypingListener=function(e,t){if(this.typingListeners.hasOwnProperty(e))for(var n=this.typingListeners[e],r=0;r<n.length;r++)if(n[r]===t)return void n.splice(r,1)},t.prototype._onModelModeChanged=function(){this.cursors.updateMode()},t.prototype._onModelContentChanged=function(e){var t=this;e.changeType===h.EventType.ModelRawContentChangedFlush?(this.cursors.dispose(),this.cursors=new u.CursorCollection(this.editorId,this.model,this.configuration,this.viewModelHelper),this.emitCursorPositionChanged("model",h.CursorChangeReason.ContentFlush),this.emitCursorSelectionChanged("model",h.CursorChangeReason.ContentFlush)):this._isHandling||this._onHandler("recoverSelectionFromMarkers",function(e){var n=t._invokeForAll(e,function(e,t,n){return t.recoverSelectionFromMarkers(n)});return e.shouldPushStackElementBefore=!1,e.shouldPushStackElementAfter=!1,n},"modelChange",null)},t.prototype.getSelection=function(){return this.cursors.getSelection(0)},t.prototype.getSelections=function(){return this.cursors.getSelections()},t.prototype.getPosition=function(){return this.cursors.getPosition(0)},t.prototype.setSelections=function(e,t){var n=this;this._onHandler("setSelections",function(e){return e.shouldReveal=!1,n.cursors.setSelections(t),!1},e,null)},t.prototype._createAndInterpretHandlerCtx=function(e,t,n){var r={cursorPositionChangeReason:h.CursorChangeReason.NotSet,shouldReveal:!0,shouldRevealVerticalInCenter:!1,shouldRevealHorizontal:!0,shouldRevealTarget:p.Primary,eventSource:e,eventData:t,executeCommands:[],isAutoWhitespaceCommand:[],hasExecutedCommands:!1,isCursorUndo:!1,postOperationRunnables:[],shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1,requestScrollDeltaLines:0,setColumnSelectToLineNumber:0,setColumnSelectToVisualColumn:0};return n(r),this._interpretHandlerContext(r),this.cursors.normalize(),r.hasExecutedCommands},t.prototype._onHandler=function(e,t,n,o){this._isHandling=!0,this.charactersTyped="";var i=!1;try{var s,u,l,a,c,d,p,f=this.cursors.getSelections(),m=this.cursors.getViewSelections(),v=this.cursors.saveState(),_=n,g=this._createAndInterpretHandlerCtx(_,o,function(e){i=t(e),s=e.cursorPositionChangeReason,u=e.shouldReveal,c=e.shouldRevealTarget,l=e.shouldRevealVerticalInCenter,a=e.shouldRevealHorizontal,d=e.isCursorUndo,p=e.requestScrollDeltaLines});g&&(this.cursorUndoStack=[]);for(var C=0;C<this.charactersTyped.length;C++){var S=this.charactersTyped.charAt(C);if(this.typingListeners.hasOwnProperty(S))for(var y=this.typingListeners[S].slice(0),R=0,O=y.length;R<O;R++)try{y[R]()}catch(L){r.onUnexpectedError(L)}}var k=this.cursors.getSelections(),E=this.cursors.getViewSelections(),T=!1;if(f.length!==k.length)T=!0;else{for(var C=0,D=f.length;!T&&C<D;C++)f[C].equalsSelection(k[C])||(T=!0);for(var C=0,D=m.length;!T&&C<D;C++)m[C].equalsSelection(E[C])||(T=!0)}T&&(g||d||this.cursorUndoStack.push(v),this.cursorUndoStack.length>50&&(this.cursorUndoStack=this.cursorUndoStack.splice(0,this.cursorUndoStack.length-50)),this.emitCursorPositionChanged(_,s),u&&this.emitCursorRevealRange(c,l?h.VerticalRevealType.Center:h.VerticalRevealType.Simple,a),this.emitCursorSelectionChanged(_,s)),p&&this.emitCursorScrollRequest(p)}catch(A){r.onUnexpectedError(A)}return this._isHandling=!1,i},t.prototype._interpretHandlerContext=function(e){e.shouldPushStackElementBefore&&(this.model.pushStackElement(),e.shouldPushStackElementBefore=!1),this._columnSelectToLineNumber=e.setColumnSelectToLineNumber,this._columnSelectToVisualColumn=e.setColumnSelectToVisualColumn,e.hasExecutedCommands=this._internalExecuteCommands(e.executeCommands,e.isAutoWhitespaceCommand,e.postOperationRunnables)||e.hasExecutedCommands,e.executeCommands=[],e.shouldPushStackElementAfter&&(this.model.pushStackElement(),e.shouldPushStackElementAfter=!1);for(var t=!1,n=0,r=e.postOperationRunnables.length;n<r;n++)if(e.postOperationRunnables[n]){t=!0;break}if(t){var o=e.postOperationRunnables.slice(0);e.postOperationRunnables=[],this._invokeForAll(e,function(e,t,n){return o[e]&&o[e](n),!1}),this._interpretHandlerContext(e)}},t.prototype._interpretCommandResult=function(e){return!!e&&(this.cursors.setSelections(e),!0)},t.prototype._getEditOperationsFromCommand=function(e,t,o,i){var s=this,u=[],l=0,a=function(e,n){e.isEmpty()&&""===n||u.push({identifier:{major:t,minor:l++},range:e,text:n,forceMoveMarkers:!1,isAutoWhitespaceEdit:i})},h=!1,d=function(t,n){var r,o;if(t.isEmpty())if("boolean"==typeof n)r=n,o=n;else{var i=s.model.getLineMaxColumn(t.startLineNumber);t.startColumn===i?(r=!0,o=!0):(r=!1,o=!1)}else t.getDirection()===c.SelectionDirection.LTR?(r=!1,o=!0):(r=!0,o=!1);var u=e.selectionStartMarkers.length;return e.selectionStartMarkers[u]=s.model._addMarker(t.selectionStartLineNumber,t.selectionStartColumn,r),e.positionMarkers[u]=s.model._addMarker(t.positionLineNumber,t.positionColumn,o),u.toString()},p={addEditOperation:a,trackSelection:d};try{o.getEditOperations(this.model,p)}catch(f){return f.friendlyMessage=n.localize("corrupt.commands","Unexpected exception while executing command."),r.onUnexpectedError(f),{operations:[],hadTrackedRange:!1}}return{operations:u,hadTrackedRange:h}},t.prototype._getEditOperations=function(e,t,n){for(var r,o,i=[],s=[],u=0;u<t.length;u++)t[u]?(r=this._getEditOperationsFromCommand(e,u,t[u],n[u]),i=i.concat(r.operations),s[u]=r.hadTrackedRange,o=o||s[u]):s[u]=!1;return{operations:i,hadTrackedRanges:s,anyoneHadTrackedRange:o}},t.prototype._getLoserCursorMap=function(e){e=e.slice(0),e.sort(function(e,t){return-a.Range.compareRangesUsingEnds(e.range,t.range)});for(var t,n,r,o={},i=1;i<e.length;i++)if(t=e[i-1],n=e[i],t.range.getStartPosition().isBefore(n.range.getEndPosition())){r=t.identifier.major>n.identifier.major?t.identifier.major:n.identifier.major,o[r.toString()]=!0;for(var s=0;s<e.length;s++)e[s].identifier.major===r&&(e.splice(s,1),s<i&&i--,s--);i>0&&i--}return o},t.prototype._collapseDeleteCommands=function(e,t,n){if(1!==e.length){var r=e.every(function(e){if(!(e instanceof s.ReplaceCommand))return!1;var t=e;return!(t.getText().length>0)});if(r){var o=e,i=o.map(function(e,t){return{range:o[t].getRange(),postOperationRunnable:n[t],order:t}});i.sort(function(e,t){return a.Range.compareRangesUsingStarts(e.range,t.range)});for(var u=i[0],l=1;l<i.length;l++)if(u.range.endLineNumber===i[l].range.startLineNumber&&u.range.endColumn===i[l].range.startColumn){var c=new a.Range(u.range.startLineNumber,u.range.startColumn,i[l].range.endLineNumber,i[l].range.endColumn);u.range=c,o[i[l].order].setRange(c),o[u.order].setRange(c)}else u=i[l]}}},t.prototype._internalExecuteCommands=function(e,t,n){var r={selectionStartMarkers:[],positionMarkers:[]};this._collapseDeleteCommands(e,t,n);for(var o=this._innerExecuteCommands(r,e,t,n),i=0;i<r.selectionStartMarkers.length;i++)this.model._removeMarker(r.selectionStartMarkers[i]),this.model._removeMarker(r.positionMarkers[i]);return o},t.prototype._arrayIsEmpty=function(e){var t,n;for(t=0,n=e.length;t<n;t++)if(e[t])return!1;return!0},t.prototype._innerExecuteCommands=function(e,t,n,r){var o=this;if(this.configuration.editor.readOnly)return!1;if(this._arrayIsEmpty(t))return!1;var i=this.cursors.getSelections(),s=this._getEditOperations(e,t,n);if(0===s.operations.length&&!s.anyoneHadTrackedRange)return!1;for(var u=s.operations,l=this.model.getEditableRange(),a=l.getStartPosition(),h=l.getEndPosition(),d=0;d<u.length;d++){var p=u[d].range;if(!a.isBeforeOrEqual(p.getStartPosition())||!p.getEndPosition().isBeforeOrEqual(h))return!1}var f=this._getLoserCursorMap(u);if(f.hasOwnProperty("0"))return console.warn("Ignoring commands"),!1;for(var m=[],d=0;d<u.length;d++)f.hasOwnProperty(u[d].identifier.major.toString())||m.push(u[d]);var v,_=this.model.pushEditOperations(i,m,function(n){for(var r=[],u=0;u<i.length;u++)r[u]=[];for(var u=0;u<n.length;u++){var l=n[u];l.identifier&&r[l.identifier.major].push(l)}for(var a=function(e,t){return e.identifier.minor-t.identifier.minor},h=[],u=0;u<i.length;u++)r[u].length>0||s.hadTrackedRanges[u]?(r[u].sort(a),h[u]=t[u].computeCursorState(o.model,{getInverseEditOperations:function(){return r[u]},getTrackedSelection:function(t){var n=parseInt(t,10),r=o.model._getMarker(e.selectionStartMarkers[n]),i=o.model._getMarker(e.positionMarkers[n]);return new c.Selection(r.lineNumber,r.column,i.lineNumber,i.column)}})):h[u]=i[u];return h}),g=[];for(v in f)f.hasOwnProperty(v)&&g.push(parseInt(v,10));g.sort(function(e,t){return t-e});for(var d=0;d<g.length;d++)_.splice(g[d],1),r.splice(g[d],1);return this._interpretCommandResult(_)},t.prototype.emitCursorPositionChanged=function(e,t){var n=this.cursors.getPositions(),r=n[0],o=n.slice(1),i=this.cursors.getViewPositions(),s=i[0],u=i.slice(1),l=!0;if(this.model.hasEditableRange()){var a=this.model.getEditableRange();a.containsPosition(r)||(l=!1)}var c={position:r,viewPosition:s,secondaryPositions:o,secondaryViewPositions:u,reason:t,source:e,isInEditableRange:l};this.emit(h.EventType.CursorPositionChanged,c)},t.prototype.emitCursorSelectionChanged=function(e,t){var n=this.cursors.getSelections(),r=n[0],o=n.slice(1),i=this.cursors.getViewSelections(),s=i[0],u=i.slice(1),l={selection:r,viewSelection:s,secondarySelections:o,secondaryViewSelections:u,source:e,reason:t};this.emit(h.EventType.CursorSelectionChanged,l)},t.prototype.emitCursorScrollRequest=function(e){var t={deltaLines:e};this.emit(h.EventType.CursorScrollRequest,t)},t.prototype.emitCursorRevealRange=function(e,t,n){var r=this.cursors.getPositions(),o=this.cursors.getViewPositions(),i=r[0],s=o[0];if(e===p.TopMost)for(var u=1;u<r.length;u++)r[u].isBefore(i)&&(i=r[u],s=o[u]);else if(e===p.BottomMost)for(var u=1;u<r.length;u++)i.isBeforeOrEqual(r[u])&&(i=r[u],s=o[u]);else if(r.length>1)return;var l=new a.Range(i.lineNumber,i.column,i.lineNumber,i.column),c=new a.Range(s.lineNumber,s.column,s.lineNumber,s.column),d={range:l,viewRange:c,verticalType:t,revealHorizontal:n};this.emit(h.EventType.CursorRevealRange,d)},t.prototype.trigger=function(e,t,n){if(this._handlers.hasOwnProperty(t)){var r=this._handlers[t];this._onHandler(t,r,e,n)}},t.prototype._registerHandlers=function(){var e=this,t=h.Handler;this._handlers[t.JumpToBracket]=function(t){return e._jumpToBracket(t)},this._handlers[t.CursorMove]=function(t){return e._cursorMove(t)},this._handlers[t.MoveTo]=function(t){return e._moveTo(!1,t)},this._handlers[t.MoveToSelect]=function(t){return e._moveTo(!0,t)},this._handlers[t.ColumnSelect]=function(t){return e._columnSelectMouse(t)},this._handlers[t.AddCursorUp]=function(t){return e._addCursorUp(t)},this._handlers[t.AddCursorDown]=function(t){return e._addCursorDown(t)},this._handlers[t.CreateCursor]=function(t){return e._createCursor(t)},this._handlers[t.LastCursorMoveToSelect]=function(t){return e._lastCursorMoveTo(t)},this._handlers[t.CursorLeft]=function(t){return e._moveLeft(!1,t)},this._handlers[t.CursorLeftSelect]=function(t){return e._moveLeft(!0,t)},this._handlers[t.CursorWordLeft]=function(t){return e._moveWordLeft(!1,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordStartLeft]=function(t){return e._moveWordLeft(!1,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordEndLeft]=function(t){return e._moveWordLeft(!1,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorWordLeftSelect]=function(t){return e._moveWordLeft(!0,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordStartLeftSelect]=function(t){return e._moveWordLeft(!0,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordEndLeftSelect]=function(t){return e._moveWordLeft(!0,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorRight]=function(t){return e._moveRight(!1,t)},this._handlers[t.CursorRightSelect]=function(t){return e._moveRight(!0,t)},this._handlers[t.CursorWordRight]=function(t){return e._moveWordRight(!1,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorWordStartRight]=function(t){return e._moveWordRight(!1,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordEndRight]=function(t){return e._moveWordRight(!1,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorWordRightSelect]=function(t){return e._moveWordRight(!0,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorWordStartRightSelect]=function(t){return e._moveWordRight(!0,l.WordNavigationType.WordStart,t)},this._handlers[t.CursorWordEndRightSelect]=function(t){return e._moveWordRight(!0,l.WordNavigationType.WordEnd,t)},this._handlers[t.CursorUp]=function(t){return e._moveUp(!1,!1,t)},this._handlers[t.CursorUpSelect]=function(t){return e._moveUp(!0,!1,t)},this._handlers[t.CursorDown]=function(t){return e._moveDown(!1,!1,t)},this._handlers[t.CursorDownSelect]=function(t){return e._moveDown(!0,!1,t)},this._handlers[t.CursorPageUp]=function(t){return e._moveUp(!1,!0,t)},this._handlers[t.CursorPageUpSelect]=function(t){return e._moveUp(!0,!0,t)},this._handlers[t.CursorPageDown]=function(t){return e._moveDown(!1,!0,t)},this._handlers[t.CursorPageDownSelect]=function(t){return e._moveDown(!0,!0,t)},this._handlers[t.CursorHome]=function(t){return e._moveToBeginningOfLine(!1,t)},this._handlers[t.CursorHomeSelect]=function(t){return e._moveToBeginningOfLine(!0,t)},this._handlers[t.CursorEnd]=function(t){return e._moveToEndOfLine(!1,t)},this._handlers[t.CursorEndSelect]=function(t){return e._moveToEndOfLine(!0,t)},this._handlers[t.CursorTop]=function(t){return e._moveToBeginningOfBuffer(!1,t)},this._handlers[t.CursorTopSelect]=function(t){return e._moveToBeginningOfBuffer(!0,t)},this._handlers[t.CursorBottom]=function(t){return e._moveToEndOfBuffer(!1,t)},this._handlers[t.CursorBottomSelect]=function(t){return e._moveToEndOfBuffer(!0,t)},this._handlers[t.CursorColumnSelectLeft]=function(t){return e._columnSelectLeft(t)},this._handlers[t.CursorColumnSelectRight]=function(t){return e._columnSelectRight(t)},this._handlers[t.CursorColumnSelectUp]=function(t){return e._columnSelectUp(!1,t)},this._handlers[t.CursorColumnSelectPageUp]=function(t){return e._columnSelectUp(!0,t)},this._handlers[t.CursorColumnSelectDown]=function(t){return e._columnSelectDown(!1,t)},this._handlers[t.CursorColumnSelectPageDown]=function(t){return e._columnSelectDown(!0,t)},this._handlers[t.SelectAll]=function(t){return e._selectAll(t)},this._handlers[t.LineSelect]=function(t){return e._line(!1,t)},this._handlers[t.LineSelectDrag]=function(t){return e._line(!0,t)},this._handlers[t.LastCursorLineSelect]=function(t){return e._lastCursorLine(!1,t)},this._handlers[t.LastCursorLineSelectDrag]=function(t){return e._lastCursorLine(!0,t)},this._handlers[t.LineInsertBefore]=function(t){return e._lineInsertBefore(t)},this._handlers[t.LineInsertAfter]=function(t){return e._lineInsertAfter(t)},this._handlers[t.LineBreakInsert]=function(t){return e._lineBreakInsert(t)},this._handlers[t.WordSelect]=function(t){return e._word(!1,t)},this._handlers[t.WordSelectDrag]=function(t){return e._word(!0,t)},this._handlers[t.LastCursorWordSelect]=function(t){return e._lastCursorWord(t)},this._handlers[t.CancelSelection]=function(t){return e._cancelSelection(t)},this._handlers[t.RemoveSecondaryCursors]=function(t){return e._removeSecondaryCursors(t)},this._handlers[t.Type]=function(t){return e._type(t)},this._handlers[t.ReplacePreviousChar]=function(t){return e._replacePreviousChar(t)},this._handlers[t.Tab]=function(t){return e._tab(t)},this._handlers[t.Indent]=function(t){return e._indent(t)},this._handlers[t.Outdent]=function(t){return e._outdent(t)},this._handlers[t.Paste]=function(t){return e._paste(t)},this._handlers[t.ScrollLineUp]=function(t){return e._scrollUp(!1,t)},this._handlers[t.ScrollLineDown]=function(t){return e._scrollDown(!1,t)},this._handlers[t.ScrollPageUp]=function(t){return e._scrollUp(!0,t)},this._handlers[t.ScrollPageDown]=function(t){return e._scrollDown(!0,t)},this._handlers[t.DeleteLeft]=function(t){return e._deleteLeft(t)},this._handlers[t.DeleteWordLeft]=function(t){return e._deleteWordLeft(!0,l.WordNavigationType.WordStart,t)},this._handlers[t.DeleteWordStartLeft]=function(t){return e._deleteWordLeft(!1,l.WordNavigationType.WordStart,t)},this._handlers[t.DeleteWordEndLeft]=function(t){return e._deleteWordLeft(!1,l.WordNavigationType.WordEnd,t)},this._handlers[t.DeleteRight]=function(t){return e._deleteRight(t)},this._handlers[t.DeleteWordRight]=function(t){return e._deleteWordRight(!0,l.WordNavigationType.WordEnd,t)},this._handlers[t.DeleteWordStartRight]=function(t){return e._deleteWordRight(!1,l.WordNavigationType.WordStart,t)},this._handlers[t.DeleteWordEndRight]=function(t){return e._deleteWordRight(!1,l.WordNavigationType.WordEnd,t)},this._handlers[t.DeleteAllLeft]=function(t){return e._deleteAllLeft(t)},this._handlers[t.DeleteAllRight]=function(t){return e._deleteAllRight(t)},this._handlers[t.Cut]=function(t){return e._cut(t)},this._handlers[t.ExpandLineSelection]=function(t){return e._expandLineSelection(t)},this._handlers[t.Undo]=function(t){return e._undo(t)},this._handlers[t.CursorUndo]=function(t){return e._cursorUndo(t)},this._handlers[t.Redo]=function(t){return e._redo(t)},this._handlers[t.ExecuteCommand]=function(t){return e._externalExecuteCommand(t)},this._handlers[t.ExecuteCommands]=function(t){return e._externalExecuteCommands(t)}},t.prototype._invokeForAllSorted=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=!0),this._doInvokeForAll(e,!0,t,n,r)},t.prototype._invokeForAll=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=!0),this._doInvokeForAll(e,!1,t,n,r)},t.prototype._doInvokeForAll=function(e,t,n,r,o){void 0===r&&(r=!0),void 0===o&&(o=!0);var i=!1,s=this.cursors.getAll();t&&(s=s.sort(function(e,t){return a.Range.compareRangesUsingStarts(e.getSelection(),t.getSelection())}));var u;e.shouldPushStackElementBefore=r,e.shouldPushStackElementAfter=o;for(var l=0;l<s.length;l++)u={cursorPositionChangeReason:h.CursorChangeReason.NotSet,shouldReveal:!0,shouldRevealVerticalInCenter:!1,shouldRevealHorizontal:!0,executeCommand:null,isAutoWhitespaceCommand:!1,postOperationRunnable:null,shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1,requestScrollDeltaLines:0},i=n(l,s[l],u)||i,0===l&&(e.cursorPositionChangeReason=u.cursorPositionChangeReason,e.shouldRevealHorizontal=u.shouldRevealHorizontal,e.shouldReveal=u.shouldReveal,e.shouldRevealVerticalInCenter=u.shouldRevealVerticalInCenter,e.requestScrollDeltaLines=u.requestScrollDeltaLines),e.shouldPushStackElementBefore=e.shouldPushStackElementBefore||u.shouldPushStackElementBefore,e.shouldPushStackElementAfter=e.shouldPushStackElementAfter||u.shouldPushStackElementAfter,e.executeCommands[l]=u.executeCommand,e.isAutoWhitespaceCommand[l]=u.isAutoWhitespaceCommand,e.postOperationRunnables[l]=u.postOperationRunnable;return i},t.prototype._jumpToBracket=function(e){return this.cursors.killSecondaryCursors(),this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.jumpToBracket(t,n)})},t.prototype._moveTo=function(e,t){return this.cursors.killSecondaryCursors(),this._invokeForAll(t,function(n,r,o){return l.OneCursorOp.moveTo(r,e,t.eventData.position,t.eventData.viewPosition,t.eventSource,o)})},t.prototype._cursorMove=function(e){return this._invokeForAll(e,function(t,n,r){return l.OneCursorOp.move(n,e.eventData,e.eventSource,r)})},t.prototype._getColumnSelectToLineNumber=function(){if(!this._columnSelectToLineNumber){var e=this.cursors.getAll()[0],t=e.getViewPosition();return t.lineNumber}return this._columnSelectToLineNumber},t.prototype._getColumnSelectToVisualColumn=function(){if(!this._columnSelectToVisualColumn){var e=this.cursors.getAll()[0],t=e.getViewPosition();return e.getViewVisibleColumnFromColumn(t.lineNumber,t.column)}return this._columnSelectToVisualColumn},t.prototype._columnSelectMouse=function(e){var t=this.cursors.getAll(),n=l.OneCursorOp.columnSelectMouse(t[0],e.eventData.position,e.eventData.viewPosition,e.eventData.mouseColumn-1);return e.shouldRevealTarget=n.reversed?p.TopMost:p.BottomMost,e.shouldReveal=!0,e.setColumnSelectToLineNumber=n.toLineNumber,e.setColumnSelectToVisualColumn=n.toVisualColumn,this.cursors.setSelections(n.selections,n.viewSelections),!0},t.prototype._columnSelectOp=function(e,t){var n=this.cursors.getAll()[0],r=t(n,this._getColumnSelectToLineNumber(),this._getColumnSelectToVisualColumn());return e.shouldRevealTarget=r.reversed?p.TopMost:p.BottomMost,e.shouldReveal=!0,e.setColumnSelectToLineNumber=r.toLineNumber,e.setColumnSelectToVisualColumn=r.toVisualColumn,this.cursors.setSelections(r.selections,r.viewSelections),!0},t.prototype._columnSelectLeft=function(e){return this._columnSelectOp(e,function(e,t,n){return l.OneCursorOp.columnSelectLeft(e,t,n)})},t.prototype._columnSelectRight=function(e){return this._columnSelectOp(e,function(e,t,n){return l.OneCursorOp.columnSelectRight(e,t,n)})},t.prototype._columnSelectUp=function(e,t){return this._columnSelectOp(t,function(t,n,r){return l.OneCursorOp.columnSelectUp(e,t,n,r)})},t.prototype._columnSelectDown=function(e,t){return this._columnSelectOp(t,function(t,n,r){return l.OneCursorOp.columnSelectDown(e,t,n,r)})},t.prototype._createCursor=function(e){if(this.configuration.editor.readOnly||this.model.hasEditableRange())return!1;this.cursors.addSecondaryCursor({selectionStartLineNumber:1,selectionStartColumn:1,positionLineNumber:1,positionColumn:1});var t=this.cursors.getLastAddedCursor();return this._invokeForAll(e,function(n,r,o){return r===t&&(e.eventData.wholeLine?l.OneCursorOp.line(r,!1,e.eventData.position,e.eventData.viewPosition,o):l.OneCursorOp.moveTo(r,!1,e.eventData.position,e.eventData.viewPosition,e.eventSource,o))}),e.shouldReveal=!1,e.shouldRevealHorizontal=!1,!0},t.prototype._lastCursorMoveTo=function(e){if(this.configuration.editor.readOnly||this.model.hasEditableRange())return!1;var t=this.cursors.getLastAddedCursor();return this._invokeForAll(e,function(n,r,o){return r===t&&l.OneCursorOp.moveTo(r,!0,e.eventData.position,e.eventData.viewPosition,e.eventSource,o)}),e.shouldReveal=!1,e.shouldRevealHorizontal=!1,!0},t.prototype._addCursorUp=function(e){if(this.configuration.editor.readOnly)return!1;var t=this.cursors.getSelections().length;return this.cursors.duplicateCursors(),e.shouldRevealTarget=p.TopMost,this._invokeForAll(e,function(e,n,r){return e>=t&&l.OneCursorOp.translateUp(n,r)})},t.prototype._addCursorDown=function(e){if(this.configuration.editor.readOnly)return!1;var t=this.cursors.getSelections().length;return this.cursors.duplicateCursors(),e.shouldRevealTarget=p.BottomMost,this._invokeForAll(e,function(e,n,r){return e>=t&&l.OneCursorOp.translateDown(n,r)})},t.prototype._moveLeft=function(e,t){return t.eventData=t.eventData||{},t.eventData.to=h.CursorMovePosition.Left,t.eventData.select=e,this._cursorMove(t)},t.prototype._moveWordLeft=function(e,t,n){return this._invokeForAll(n,function(n,r,o){return l.OneCursorOp.moveWordLeft(r,e,t,o)})},t.prototype._moveRight=function(e,t){return t.eventData=t.eventData||{},t.eventData.to=h.CursorMovePosition.Right,t.eventData.select=e,this._cursorMove(t)},t.prototype._moveWordRight=function(e,t,n){return this._invokeForAll(n,function(n,r,o){return l.OneCursorOp.moveWordRight(r,e,t,o)})},t.prototype._moveDown=function(e,t,n){return n.eventData=n.eventData||{},n.eventData.to=h.CursorMovePosition.Down,n.eventData.select=e,n.eventData.by=h.CursorMoveByUnit.WrappedLine,n.eventData.isPaged=t,this._cursorMove(n)},t.prototype._moveUp=function(e,t,n){return n.eventData=n.eventData||{},n.eventData.to=h.CursorMovePosition.Up,n.eventData.select=e,n.eventData.by=h.CursorMoveByUnit.WrappedLine,n.eventData.isPaged=t,this._cursorMove(n)},t.prototype._moveToBeginningOfLine=function(e,t){return this._invokeForAll(t,function(t,n,r){return l.OneCursorOp.moveToBeginningOfLine(n,e,r)})},t.prototype._moveToEndOfLine=function(e,t){return this._invokeForAll(t,function(t,n,r){return l.OneCursorOp.moveToEndOfLine(n,e,r)})},t.prototype._moveToBeginningOfBuffer=function(e,t){return this._invokeForAll(t,function(t,n,r){return l.OneCursorOp.moveToBeginningOfBuffer(n,e,r)})},t.prototype._moveToEndOfBuffer=function(e,t){return this._invokeForAll(t,function(t,n,r){return l.OneCursorOp.moveToEndOfBuffer(n,e,r)})},t.prototype._selectAll=function(e){return this.cursors.killSecondaryCursors(),this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.selectAll(t,n)})},t.prototype._line=function(e,t){return this.cursors.killSecondaryCursors(),this._invokeForAll(t,function(n,r,o){return l.OneCursorOp.line(r,e,t.eventData.position,t.eventData.viewPosition,o)})},t.prototype._lastCursorLine=function(e,t){if(this.configuration.editor.readOnly||this.model.hasEditableRange())return!1;var n=this.cursors.getLastAddedCursor();return this._invokeForAll(t,function(r,o,i){return o===n&&l.OneCursorOp.line(o,e,t.eventData.position,t.eventData.viewPosition,i)}),t.shouldReveal=!1,t.shouldRevealHorizontal=!1,!0},t.prototype._expandLineSelection=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.expandLineSelection(t,n)})},t.prototype._lineInsertBefore=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.lineInsertBefore(t,n)})},t.prototype._lineInsertAfter=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.lineInsertAfter(t,n)})},t.prototype._lineBreakInsert=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.lineBreakInsert(t,n)})},t.prototype._word=function(e,t){return this.cursors.killSecondaryCursors(),this._invokeForAll(t,function(n,r,o){return l.OneCursorOp.word(r,e,t.eventData.position,o)})},t.prototype._lastCursorWord=function(e){if(this.configuration.editor.readOnly||this.model.hasEditableRange())return!1;var t=this.cursors.getLastAddedCursor();return this._invokeForAll(e,function(n,r,o){return r===t&&l.OneCursorOp.word(r,!0,e.eventData.position,o)}),e.shouldReveal=!1,e.shouldRevealHorizontal=!1,!0},t.prototype._removeSecondaryCursors=function(e){return this.cursors.killSecondaryCursors(),!0},t.prototype._cancelSelection=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.cancelSelection(t,n)})},t.prototype._type=function(e){var t=this,n=e.eventData.text;if("keyboard"===e.eventSource){var r,o,i;for(r=0,o=n.length;r<o;r++)i=n.charAt(r),this.charactersTyped+=i,e.hasExecutedCommands=this._createAndInterpretHandlerCtx(e.eventSource,e.eventData,function(n){t._invokeForAll(n,function(e,t,n){return l.OneCursorOp.type(t,i,n)},!1,!1),e.cursorPositionChangeReason=n.cursorPositionChangeReason,e.shouldReveal=n.shouldReveal,e.shouldRevealVerticalInCenter=n.shouldRevealVerticalInCenter,e.shouldRevealHorizontal=n.shouldRevealHorizontal})||e.hasExecutedCommands}else this._invokeForAll(e,function(e,t,r){return l.OneCursorOp.actualType(t,n,!1,r)});return!0},t.prototype._replacePreviousChar=function(e){var t=e.eventData.text,n=e.eventData.replaceCharCnt;return this._invokeForAll(e,function(e,r,o){return l.OneCursorOp.replacePreviousChar(r,t,n,o)})},t.prototype._tab=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.tab(t,n)},!1,!1)},t.prototype._indent=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.indent(t,n)})},t.prototype._outdent=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.outdent(t,n)})},t.prototype._paste=function(e){var t=this._distributePasteToCursors(e);return t?this._invokeForAllSorted(e,function(e,n,r){return l.OneCursorOp.paste(n,t[e],!1,r)}):this._invokeForAll(e,function(t,n,r){return l.OneCursorOp.paste(n,e.eventData.text,e.eventData.pasteOnNewLine,r)})},t.prototype._scrollUp=function(e,t){return t.requestScrollDeltaLines=e?-this.cursors.getAll()[0].getPageSize():-1,!0},t.prototype._scrollDown=function(e,t){return t.requestScrollDeltaLines=e?this.cursors.getAll()[0].getPageSize():1,!0},t.prototype._distributePasteToCursors=function(e){if(e.eventData.pasteOnNewLine)return null;var t=this.cursors.getSelections();if(1===t.length)return null;for(var n=0;n<t.length;n++)if(t[n].startLineNumber!==t[n].endLineNumber)return null;var r=e.eventData.text.split(/\r\n|\r|\n/);return r.length!==t.length?null:r},t.prototype._deleteLeft=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.deleteLeft(t,n)},!1,!1)},t.prototype._deleteWordLeft=function(e,t,n){return this._invokeForAll(n,function(n,r,o){return l.OneCursorOp.deleteWordLeft(r,e,t,o)},!1,!1)},t.prototype._deleteRight=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.deleteRight(t,n)},!1,!1)},t.prototype._deleteWordRight=function(e,t,n){return this._invokeForAll(n,function(n,r,o){return l.OneCursorOp.deleteWordRight(r,e,t,o)},!1,!1)},t.prototype._deleteAllLeft=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.deleteAllLeft(t,n)},!1,!1)},t.prototype._deleteAllRight=function(e){return this._invokeForAll(e,function(e,t,n){return l.OneCursorOp.deleteAllRight(t,n)},!1,!1)},t.prototype._cut=function(e){var t=this;return this._invokeForAll(e,function(e,n,r){return l.OneCursorOp.cut(n,t.enableEmptySelectionClipboard,r)})},t.prototype._undo=function(e){return e.cursorPositionChangeReason=h.CursorChangeReason.Undo,e.hasExecutedCommands=!0,this._interpretCommandResult(this.model.undo()),!0},t.prototype._cursorUndo=function(e){return 0!==this.cursorUndoStack.length&&(e.cursorPositionChangeReason=h.CursorChangeReason.Undo,e.isCursorUndo=!0,this.cursors.restoreState(this.cursorUndoStack.pop()),!0)},t.prototype._redo=function(e){return e.cursorPositionChangeReason=h.CursorChangeReason.Redo,e.hasExecutedCommands=!0,this._interpretCommandResult(this.model.redo()),!0},t.prototype._externalExecuteCommand=function(e){
return this.cursors.killSecondaryCursors(),this._invokeForAll(e,function(t,n,r){return r.shouldPushStackElementBefore=!0,r.shouldPushStackElementAfter=!0,r.executeCommand=e.eventData,!1})},t.prototype._externalExecuteCommands=function(e){return this._invokeForAll(e,function(t,n,r){return r.shouldPushStackElementBefore=!0,r.shouldPushStackElementAfter=!0,r.executeCommand=e.eventData[t],!1})},t}(o.EventEmitter);t.Cursor=f});