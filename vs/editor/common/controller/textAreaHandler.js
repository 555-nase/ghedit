var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)};define(["require","exports","vs/base/common/async","vs/base/common/event","vs/base/common/keyCodes","vs/base/common/lifecycle","vs/editor/common/controller/textAreaState","vs/editor/common/core/position","vs/editor/common/core/range","vs/editor/common/editorCommon"],function(t,e,o,i,s,n,r,a,h,c){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var l;!function(t){t[t.Type=0]="Type",t[t.Paste=1]="Paste"}(l||(l={}));var p=function(t){function e(e,s,n,c,p){var u=this;t.call(this),this._onKeyDown=this._register(new i.Emitter),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new i.Emitter),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new i.Emitter),this.onCut=this._onCut.event,this._onPaste=this._register(new i.Emitter),this.onPaste=this._onPaste.event,this._onType=this._register(new i.Emitter),this.onType=this._onType.event,this._onCompositionStart=this._register(new i.Emitter),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new i.Emitter),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new i.Emitter),this.onCompositionEnd=this._onCompositionEnd.event,this.Browser=e,this.textArea=n,this.model=c,this.flushAnyAccumulatedEvents=p,this.selection=new h.Range(1,1,1,1),this.selections=[new h.Range(1,1,1,1)],this.cursorPosition=new a.Position(1,1),this._nextCommand=l.Type,this.asyncTriggerCut=new o.RunOnceScheduler(function(){return u._onCut.fire()},0),this.lastCopiedValue=null,this.lastCopiedValueIsFromEmptySelection=!1,this.textAreaState=r.createTextAreaState(s),this.hasFocus=!1,this.lastCompositionEndTime=0,this._register(this.textArea.onKeyDown(function(t){return u._onKeyDownHandler(t)})),this._register(this.textArea.onKeyUp(function(t){return u._onKeyUp.fire(t)})),this._register(this.textArea.onKeyPress(function(t){return u._onKeyPressHandler(t)})),this.textareaIsShownAtCursor=!1,this._register(this.textArea.onCompositionStart(function(t){if(!u.textareaIsShownAtCursor){u.textareaIsShownAtCursor=!0;var e=!0;e&&(u.Browser.isIE11orEarlier||u.setTextAreaState("compositionstart",u.textAreaState.toEmpty()));var o,i;u.Browser.isIE11orEarlier?(o=u.selection.startLineNumber,i=u.selection.startColumn-u.textAreaState.getSelectionStart()):(o=u.cursorPosition.lineNumber,i=u.cursorPosition.column),u._onCompositionStart.fire({showAtLineNumber:o,showAtColumn:i})}})),this._register(this.textArea.onCompositionUpdate(function(t){u.textAreaState=u.textAreaState.fromText(t.data);var e=u.textAreaState.updateComposition();u._onType.fire(e),u._onCompositionUpdate.fire(t)}));var m=function(){u.textAreaState=u.textAreaState.fromTextArea(u.textArea);var t=u.textAreaState.deduceInput();u._nextCommand===l.Type?""!==t.text&&u._onType.fire(t):(u.executePaste(t.text),u._nextCommand=l.Type)};this._register(this.textArea.onCompositionEnd(function(t){u.textAreaState=u.textAreaState.fromText(t.data);var e=u.textAreaState.updateComposition();u._onType.fire(e),u.lastCompositionEndTime=(new Date).getTime(),u.textareaIsShownAtCursor&&(u.textareaIsShownAtCursor=!1,u._onCompositionEnd.fire())})),this._register(this.textArea.onInput(function(){u.textareaIsShownAtCursor||m()})),this._register(this.textArea.onCut(function(t){u.flushAnyAccumulatedEvents(),u._ensureClipboardGetsEditorSelection(t),u.asyncTriggerCut.schedule()})),this._register(this.textArea.onCopy(function(t){u.flushAnyAccumulatedEvents(),u._ensureClipboardGetsEditorSelection(t)})),this._register(this.textArea.onPaste(function(t){t.canUseTextData()?u.executePaste(t.getTextData()):(u.textArea.getSelectionStart()!==u.textArea.getSelectionEnd()&&u.setTextAreaState("paste",u.textAreaState.toEmpty()),u._nextCommand=l.Paste)})),this._writePlaceholderAndSelectTextArea("ctor")}return __extends(e,t),e.prototype.dispose=function(){this.asyncTriggerCut.dispose(),t.prototype.dispose.call(this)},e.prototype.setStrategy=function(t){this.textAreaState=this.textAreaState.toStrategy(t)},e.prototype.setHasFocus=function(t){this.hasFocus!==t&&(this.hasFocus=t,this.hasFocus&&this._writePlaceholderAndSelectTextArea("focusgain"))},e.prototype.setCursorSelections=function(t,e){this.selection=t,this.selections=[t].concat(e),this._writePlaceholderAndSelectTextArea("selection changed")},e.prototype.setCursorPosition=function(t){this.cursorPosition=t},e.prototype.setTextAreaState=function(t,e){this.hasFocus||(e=e.resetSelection()),e.applyToTextArea(t,this.textArea,this.hasFocus),this.textAreaState=e},e.prototype._onKeyDownHandler=function(t){t.equals(s.CommonKeybindings.ESCAPE)&&t.preventDefault(),this._onKeyDown.fire(t)},e.prototype._onKeyPressHandler=function(t){!this.hasFocus},e.prototype.executePaste=function(t){if(""!==t){var e=!1;this.Browser.enableEmptySelectionClipboard&&(e=t===this.lastCopiedValue&&this.lastCopiedValueIsFromEmptySelection),this._onPaste.fire({text:t,pasteOnNewLine:e})}},e.prototype.writePlaceholderAndSelectTextAreaSync=function(){this._writePlaceholderAndSelectTextArea("focusTextArea")},e.prototype._writePlaceholderAndSelectTextArea=function(t){this.textareaIsShownAtCursor||(this.Browser.isIPad?this.setTextAreaState(t,this.textAreaState.toEmpty()):this.setTextAreaState(t,this.textAreaState.fromEditorSelection(this.model,this.selection)))},e.prototype._ensureClipboardGetsEditorSelection=function(t){var e=this._getPlainTextToCopy();if(t.canUseTextData()?t.setTextData(e):this.setTextAreaState("copy or cut",this.textAreaState.fromText(e)),this.Browser.enableEmptySelectionClipboard){this.Browser.isFirefox?this.lastCopiedValue=e.replace(/\r\n/g,"\n"):this.lastCopiedValue=e;var o=this.selections;this.lastCopiedValueIsFromEmptySelection=1===o.length&&o[0].isEmpty()}},e.prototype._getPlainTextToCopy=function(){var t=this.model.getEOL(),e=this.selections;if(1===e.length){var o=e[0];if(o.isEmpty()){if(this.Browser.enableEmptySelectionClipboard){var i=this.model.convertViewPositionToModelPosition(o.startLineNumber,1).lineNumber;return this.model.getModelLineContent(i)+t}return""}return this.model.getValueInRange(o,c.EndOfLinePreference.TextDefined)}e=e.slice(0).sort(h.Range.compareRangesUsingStarts);for(var s=[],n=0;n<e.length;n++)s.push(this.model.getValueInRange(e[n],c.EndOfLinePreference.TextDefined));return s.join(t)},e}(n.Disposable);e.TextAreaHandler=p});