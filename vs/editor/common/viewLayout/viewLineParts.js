define(["require","exports","vs/base/common/strings","vs/editor/common/core/arrays","vs/editor/common/core/range","vs/editor/common/core/viewLineToken","vs/editor/common/viewModel/viewModel"],function(t,e,n,s,r,i,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function a(t,e){return r.Range.compareRangesUsingStarts(t.range,e.range)}function u(t,e,n,s,r,i,o){if(o){var u=i.length;i=l(t,n,s,r.getFauxIndentLength(),i),i.length!==u&&i.sort(a)}return i.length>0?m(t,e,r,n,i):g(r,n)}function f(t,e,n,s,r,i,o){if(r>=e.length)return t;if(0===o)return e[r].startIndex+1;if(o===i)return r+1<e.length?e[r+1].startIndex+1:n;for(var a=e[r].startIndex,u=r+1<e.length?e[r+1].startIndex:n-1,f=a,h=u;f+1<h;){var c=Math.floor((f+h)/2),l=s[c];if(l===o)return c+1;l>o?h=c:f=c}if(f===h)return f+1;var p=s[f],g=h<u?s[h]:i,m=o-p,d=g-o;return m<=d?f+1:h+1}function h(t,e){if(t.length<=1)return t;var n=t[t.length-1].startIndex;return n<e.length?t:t.slice(0,t.length-1)}function c(t,e,n,s,i){t.push(new o.InlineDecoration(new r.Range(e,n,e,s),i))}function l(t,e,s,r,i){var o=e.length;if(o===r)return i;var a=e.charCodeAt(r),u=e.charCodeAt(o-1);if(a!==d&&a!==v&&u!==d&&u!==v)return i;var f,h=n.firstNonWhitespaceIndex(e);h===-1?(h=o,f=o):f=n.lastNonWhitespaceIndex(e);var c=[],l=[];return r>0&&(c.push(r-1),l.push(null)),h>r&&(c.push(h-1),l.push("leading whitespace")),c.push(f),l.push(null),c.push(o-1),l.push("trailing whitespace"),c.push(o),l.push(null),p(t,e,s,i,c,l)}function p(t,e,n,s,r,i){for(var o=e.length,a=0,u=r[a],f=i[a],h=s.slice(0),l=0,p=1,g=0;g<o;g++){var m=e.charCodeAt(g);m===d?l=n:l++,g===u?(null!==f&&c(h,t,p,g+2,f),p=g+2,l%=n,a++,u=r[a],f=i[a]):null!==f&&l>=n&&(c(h,t,p,g+2,f),p=g+2,l%=n)}return h}function g(t,e){var n=t.getTokens();return n=h(n,e),new L(n)}function m(t,e,n,s,r){for(var o,a,u,f=O.normalize(t,e,r),h=0,c=f.length,l=n.getTokens(),p=[],g=0,m=l.length;g<m;g++){for(o=l[g].startIndex,a=g+1<m?l[g+1].startIndex:n.getTextLength(),u=l[g].type;h<c&&f[h].startOffset<a;){if(f[h].startOffset>o&&(p.push(new i.ViewLineToken(o,u)),o=f[h].startOffset),p.push(new i.ViewLineToken(o,u+" "+f[h].className)),f[h].endOffset>=a){o=a;break}o=f[h].endOffset+1,h++}o<a&&p.push(new i.ViewLineToken(o,u))}return new L(p)}e.createLineParts=u,e.getColumnOfLinePartOffset=f;var d="\t".charCodeAt(0),v=" ".charCodeAt(0),L=function(){function t(t){this._parts=t}return t.prototype.getParts=function(){return this._parts},t.prototype.equals=function(t){return i.ViewLineToken.equalsArray(this._parts,t._parts)},t.prototype.findIndexOfOffset=function(t){return s.Arrays.findIndexInSegmentsArray(this._parts,t)},t}();e.LineParts=L;var N=function(){function t(t,e,n){this.startOffset=t,this.endOffset=e,this.className=n}return t}();e.DecorationSegment=N;var w=function(){function t(){this.stopOffsets=[],this.classNames=[],this.count=0}return t.prototype.consumeLowerThan=function(t,e,n){for(;this.count>0&&this.stopOffsets[0]<t;){for(var s=0;s+1<this.count&&this.stopOffsets[s]===this.stopOffsets[s+1];)s++;n.push(new N(e,this.stopOffsets[s],this.classNames.join(" "))),e=this.stopOffsets[s]+1,this.stopOffsets.splice(0,s+1),this.classNames.splice(0,s+1),this.count-=s+1}return this.count>0&&e<t&&(n.push(new N(e,t-1,this.classNames.join(" "))),e=t),e},t.prototype.insert=function(t,e){if(0===this.count||this.stopOffsets[this.count-1]<=t)this.stopOffsets.push(t),this.classNames.push(e);else for(var n=0;n<this.count;n++)if(this.stopOffsets[n]>=t){this.stopOffsets.splice(n,0,t),this.classNames.splice(n,0,e);break}this.count++},t}(),O=function(){function t(){}return t.normalize=function(e,n,s){var r=[];if(0===s.length)return r;var i,o,a,u,f,h=new w,c=0;for(u=0,f=s.length;u<f;u++)i=s[u],i.range.endLineNumber<e||i.range.startLineNumber>e||i.range.startLineNumber===i.range.endLineNumber&&i.range.startColumn===i.range.endColumn||(o=i.range.startLineNumber===e?i.range.startColumn-1:n-1,a=i.range.endLineNumber===e?i.range.endColumn-2:t.MAX_LINE_LENGTH-1,a<0||(c=h.consumeLowerThan(o,c,r),0===h.count&&(c=o),h.insert(a,i.inlineClassName)));return h.consumeLowerThan(t.MAX_LINE_LENGTH,c,r),r},t.MAX_LINE_LENGTH=1e7,t}();e.LineDecorationsNormalizer=O});