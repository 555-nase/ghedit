var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};define(["require","exports","vs/base/common/event","vs/base/common/lifecycle","vs/base/common/platform","vs/base/browser/browser","vs/editor/common/config/commonEditorConfig","vs/editor/common/editorCommon","vs/editor/browser/config/elementSizeObserver"],function(t,e,i,n,o,r,a,s,h){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var c=function(){function t(){this._keys=Object.create(null),this._values=Object.create(null)}return t.prototype.has=function(t){return!!this._values[t.getId()]},t.prototype.get=function(t){return this._values[t.getId()]},t.prototype.put=function(t,e){this._keys[t.getId()]=t,this._values[t.getId()]=e},t.prototype.getKeys=function(){var t=this;return Object.keys(this._keys).map(function(e){return t._keys[e]})},t}(),u=function(){function t(t){this._chr=t,this._width=0}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),t.prototype.render=function(t){if(" "===this._chr){for(var e="&nbsp;",i=0;i<8;i++)e+=e;t.innerHTML=e}else{for(var n=this._chr,i=0;i<8;i++)n+=n;t.textContent=n}},t.prototype.read=function(t){this._width=t.offsetWidth/256},t}(),l=function(t){function e(){t.call(this),this._changeMonitorTimeout=-1,this._onDidChange=this._register(new i.Emitter),this.onDidChange=this._onDidChange.event,this._cache=new c}return __extends(e,t),e.prototype.dispose=function(){this._changeMonitorTimeout!==-1&&(clearTimeout(this._changeMonitorTimeout),this._changeMonitorTimeout=-1),t.prototype.dispose.call(this)},e.prototype.readConfiguration=function(t){if(!this._cache.has(t)){var i=e._actualReadConfiguration(t);(i.typicalHalfwidthCharacterWidth<=2||i.typicalFullwidthCharacterWidth<=2||i.spaceWidth<=2||i.maxDigitWidth<=2)&&(i.typicalHalfwidthCharacterWidth=Math.max(i.typicalHalfwidthCharacterWidth,5),i.typicalFullwidthCharacterWidth=Math.max(i.typicalFullwidthCharacterWidth,5),i.spaceWidth=Math.max(i.spaceWidth,5),i.maxDigitWidth=Math.max(i.maxDigitWidth,5),this._installChangeMonitor()),this._cache.put(t,i)}return this._cache.get(t)},e.prototype._installChangeMonitor=function(){var t=this;this._changeMonitorTimeout===-1&&(this._changeMonitorTimeout=setTimeout(function(){t._changeMonitorTimeout=-1,t._monitorForChanges()},500))},e.prototype._monitorForChanges=function(){for(var t=!1,i=this._cache.getKeys(),n=0;n<i.length;n++){var o=i[n],r=e._actualReadConfiguration(o);r.typicalHalfwidthCharacterWidth<=2||r.typicalFullwidthCharacterWidth<=2||r.maxDigitWidth<=2?t=!0:(this._cache.put(o,r),this._onDidChange.fire())}t&&this._installChangeMonitor()},e._testElementId=function(t){return"editorSizeProvider"+t},e._createTestElements=function(t,e){var i=document.createElement("div");d.applyFontInfoSlow(i,t),i.style.position="absolute",i.style.top="-50000px",i.style.width="50000px";for(var n=0,o=e.length;n<o;n++){i.appendChild(document.createElement("br"));var r=document.createElement("span");r.id=this._testElementId(n),e[n].render(r),i.appendChild(r)}return i.appendChild(document.createElement("br")),i},e._readFromTestElements=function(t){for(var e=0,i=t.length;e<i;e++)t[e].read(document.getElementById(this._testElementId(e)))},e._runReaders=function(t,e){var i=this._createTestElements(t,e);document.body.appendChild(i),this._readFromTestElements(e),document.body.removeChild(i)},e._actualReadConfiguration=function(t){var e=new u("n"),i=new u("ｍ"),n=new u(" "),o=["0","1","2","3","4","5","6","7","8","9"].map(function(t){return new u(t)});this._runReaders(t,o.concat([e,i,n]));for(var r=0,a=0,h=o.length;a<h;a++)r=Math.max(r,o[a].width);return new s.FontInfo({fontFamily:t.fontFamily,fontSize:t.fontSize,lineHeight:t.lineHeight,typicalHalfwidthCharacterWidth:e.width,typicalFullwidthCharacterWidth:i.width,spaceWidth:n.width,maxDigitWidth:r})},e.INSTANCE=new e,e}(n.Disposable),d=function(t){function e(e,i){var n=this;void 0===i&&(i=null),t.call(this,e,new h.ElementSizeObserver(i,function(){return n._onReferenceDomElementSizeChanged()})),this._register(l.INSTANCE.onDidChange(function(){return function(){return n._onCSSBasedConfigurationChanged()}})),this._configWithDefaults.getEditorOptions().automaticLayout&&this._elementSizeObserver.startObserving(),this._register(r.onDidChangeZoomLevel(function(t){return n._recomputeOptions()}))}return __extends(e,t),e.applyFontInfoSlow=function(t,e){t.style.fontFamily=e.fontFamily,t.style.fontSize=e.fontSize+"px",t.style.lineHeight=e.lineHeight+"px"},e.applyFontInfo=function(t,e){t.setFontFamily(e.fontFamily),t.setFontSize(e.fontSize),t.setLineHeight(e.lineHeight)},e.prototype._onReferenceDomElementSizeChanged=function(){this._recomputeOptions()},e.prototype._onCSSBasedConfigurationChanged=function(){this._recomputeOptions()},e.prototype.observeReferenceElement=function(t){this._elementSizeObserver.observe(t)},e.prototype.dispose=function(){this._elementSizeObserver.dispose(),t.prototype.dispose.call(this)},e.prototype._getEditorClassName=function(t,e){var i="";return r.isIE11orEarlier?i+="ie ":r.isFirefox&&(i+="ff "),r.isIE9&&(i+="ie9 "),o.isMacintosh&&(i+="mac "),e&&(i+="enable-ligatures "),"monaco-editor "+i+t},e.prototype.getOuterWidth=function(){return this._elementSizeObserver.getWidth()},e.prototype.getOuterHeight=function(){return this._elementSizeObserver.getHeight()},e.prototype._getCanUseTranslate3d=function(){return r.canUseTranslate3d&&0===r.getZoomLevel()},e.prototype.readConfiguration=function(t){return l.INSTANCE.readConfiguration(t)},e}(a.CommonEditorConfiguration);e.Configuration=d});