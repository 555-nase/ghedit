var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},__param=this&&this.__param||function(t,e){return function(o,i){e(o,i,t)}};define(["require","exports","vs/base/common/errors","vs/base/browser/browser","vs/base/browser/dom","vs/platform/instantiation/common/instantiation","vs/platform/commands/common/commands","vs/platform/keybinding/common/keybinding","vs/platform/telemetry/common/telemetry","vs/editor/common/commonCodeEditor","vs/editor/common/core/range","vs/editor/common/core/selection","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/common/services/codeEditorService","vs/editor/browser/config/configuration","vs/editor/browser/editorBrowserExtensions","vs/editor/browser/standalone/colorizer","vs/editor/browser/view/viewImpl","vs/base/common/lifecycle","vs/base/common/event","vs/css!./media/editor","vs/css!./media/tokens"],function(t,e,o,i,r,n,s,a,c,d,u,h,p,l,g,f,v,y,w,_,m){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var C=function(t){function e(e,i,r,n,s,a,c){var d=this;t.call(this,e,i,r,n,s,a,c),this._focusTracker=new E(e),this._focusTracker.onChage(function(){var t=d._focusTracker.hasFocus();t?(d._editorFocusContextKey.set(!0),d.emit(p.EventType.EditorFocus,{})):(d._editorFocusContextKey.reset(),d.emit(p.EventType.EditorBlur,{}))}),this.contentWidgets={},this.overlayWidgets={};for(var u=[].concat(v.EditorBrowserRegistry.getEditorContributions()).concat(l.CommonEditorRegistry.getEditorContributions()),h=0,g=u.length;h<g;h++)try{var f=u[h].createInstance(this._instantiationService,this);this.contributions[f.getId()]=f}catch(y){console.error("Could not instantiate contribution "+f.getId()),o.onUnexpectedError(y)}}return __extends(e,t),e.prototype.onMouseUp=function(t){return this.addListener2(p.EventType.MouseUp,t)},e.prototype.onMouseDown=function(t){return this.addListener2(p.EventType.MouseDown,t)},e.prototype.onContextMenu=function(t){return this.addListener2(p.EventType.ContextMenu,t)},e.prototype.onMouseMove=function(t){return this.addListener2(p.EventType.MouseMove,t)},e.prototype.onMouseLeave=function(t){return this.addListener2(p.EventType.MouseLeave,t)},e.prototype.onKeyUp=function(t){return this.addListener2(p.EventType.KeyUp,t)},e.prototype.onKeyDown=function(t){return this.addListener2(p.EventType.KeyDown,t)},e.prototype.onDidLayoutChange=function(t){return this.addListener2(p.EventType.EditorLayout,t)},e.prototype.onDidScrollChange=function(t){return this.addListener2("scroll",t)},e.prototype._createConfiguration=function(t){return new f.Configuration(t,this.domElement)},e.prototype.dispose=function(){this.contentWidgets={},this.overlayWidgets={},this._focusTracker.dispose(),t.prototype.dispose.call(this)},e.prototype.updateOptions=function(e){var o=this._configuration.editor.viewInfo.theme;t.prototype.updateOptions.call(this,e);var i=this._configuration.editor.viewInfo.theme;o!==i&&this.render()},e.prototype.colorizeModelLine=function(t,e){if(void 0===e&&(e=this.model),!e)return"";var o=e.getLineContent(t),i=e.getLineTokens(t,!1),r=i.inflate(),n=e.getOptions().tabSize;return y.Colorizer.colorizeLine(o,r,n)},e.prototype.getView=function(){return this._view},e.prototype.getDomNode=function(){return this.hasView?this._view.domNode:null},e.prototype.getCenteredRangeInViewport=function(){return this.hasView?this._view.getCenteredRangeInViewport():null},e.prototype.getVisibleRangeInViewport=function(){return this.hasView?this._view.getVisibleRangeInViewport():null},e.prototype.getScrollWidth=function(){return this.hasView?this._view.getCodeEditorHelper().getScrollWidth():-1},e.prototype.getScrollLeft=function(){return this.hasView?this._view.getCodeEditorHelper().getScrollLeft():-1},e.prototype.getScrollHeight=function(){return this.hasView?this._view.getCodeEditorHelper().getScrollHeight():-1},e.prototype.getScrollTop=function(){return this.hasView?this._view.getCodeEditorHelper().getScrollTop():-1},e.prototype.setScrollLeft=function(t){if(this.hasView){if("number"!=typeof t)throw new Error("Invalid arguments");this._view.getCodeEditorHelper().setScrollPosition({scrollLeft:t})}},e.prototype.setScrollTop=function(t){if(this.hasView){if("number"!=typeof t)throw new Error("Invalid arguments");this._view.getCodeEditorHelper().setScrollPosition({scrollTop:t})}},e.prototype.setScrollPosition=function(t){this.hasView&&this._view.getCodeEditorHelper().setScrollPosition(t)},e.prototype.delegateVerticalScrollbarMouseDown=function(t){this.hasView&&this._view.getCodeEditorHelper().delegateVerticalScrollbarMouseDown(t)},e.prototype.saveViewState=function(){if(!this.cursor||!this.hasView)return null;var t={};for(var e in this.contributions){var o=this.contributions[e];"function"==typeof o.saveViewState&&(t[e]=o.saveViewState())}var i=this.cursor.saveState(),r=this._view.saveState();return{cursorState:i,viewState:r,contributionsState:t}},e.prototype.restoreViewState=function(t){if(this.cursor&&this.hasView){var e=t;if(e&&e.cursorState&&e.viewState){var o=e,i=o.cursorState;Array.isArray(i)?this.cursor.restoreState(i):this.cursor.restoreState([i]),this._view.restoreState(o.viewState);var r=e.contributionsState||{};for(var n in this.contributions){var s=this.contributions[n];"function"==typeof s.restoreViewState&&s.restoreViewState(r[n])}}}},e.prototype.layout=function(t){this._configuration.observeReferenceElement(t),this.render()},e.prototype.focus=function(){this.hasView&&this._view.focus()},e.prototype.beginForcedWidgetFocus=function(){this._focusTracker.beginForcedFocus()},e.prototype.endForcedWidgetFocus=function(){this._focusTracker.endForcedFocus()},e.prototype.isFocused=function(){return this.hasView&&this._view.isFocused()},e.prototype.hasWidgetFocus=function(){return this._focusTracker.hasFocus()},e.prototype.addContentWidget=function(t){var e={widget:t,position:t.getPosition()};this.contentWidgets.hasOwnProperty(t.getId())&&console.warn("Overwriting a content widget with the same id."),this.contentWidgets[t.getId()]=e,this.hasView&&this._view.addContentWidget(e)},e.prototype.layoutContentWidget=function(t){var e=t.getId();if(this.contentWidgets.hasOwnProperty(e)){var o=this.contentWidgets[e];o.position=t.getPosition(),this.hasView&&this._view.layoutContentWidget(o)}},e.prototype.removeContentWidget=function(t){var e=t.getId();if(this.contentWidgets.hasOwnProperty(e)){var o=this.contentWidgets[e];delete this.contentWidgets[e],this.hasView&&this._view.removeContentWidget(o)}},e.prototype.addOverlayWidget=function(t){var e={widget:t,position:t.getPosition()};this.overlayWidgets.hasOwnProperty(t.getId())&&console.warn("Overwriting an overlay widget with the same id."),this.overlayWidgets[t.getId()]=e,this.hasView&&this._view.addOverlayWidget(e)},e.prototype.layoutOverlayWidget=function(t){var e=t.getId();if(this.overlayWidgets.hasOwnProperty(e)){var o=this.overlayWidgets[e];o.position=t.getPosition(),this.hasView&&this._view.layoutOverlayWidget(o)}},e.prototype.removeOverlayWidget=function(t){var e=t.getId();if(this.overlayWidgets.hasOwnProperty(e)){var o=this.overlayWidgets[e];delete this.overlayWidgets[e],this.hasView&&this._view.removeOverlayWidget(o)}},e.prototype.changeViewZones=function(t){if(this.hasView){var e=this._view.change(t);e&&this.emit(p.EventType.ViewZonesChanged)}},e.prototype.getWhitespaces=function(){return this.hasView?this._view.getWhitespaces():[]},e.prototype.getTopForLineNumber=function(t){return this.hasView?this._view.getCodeEditorHelper().getVerticalOffsetForPosition(t,1):-1},e.prototype.getTopForPosition=function(t,e){return this.hasView?this._view.getCodeEditorHelper().getVerticalOffsetForPosition(t,e):-1},e.prototype.getScrolledVisiblePosition=function(t){if(!this.hasView)return null;var e=this.model.validatePosition(t),o=this._view.getCodeEditorHelper(),i=this._configuration.editor.layoutInfo,r=o.getVerticalOffsetForPosition(e.lineNumber,e.column)-o.getScrollTop(),n=o.getOffsetForColumn(e.lineNumber,e.column)+i.glyphMarginWidth+i.lineNumbersWidth+i.decorationsWidth-o.getScrollLeft();return{top:r,left:n,height:this._configuration.editor.lineHeight}},e.prototype.getOffsetForColumn=function(t,e){return this.hasView?this._view.getCodeEditorHelper().getOffsetForColumn(t,e):-1},e.prototype.render=function(){this.hasView&&this._view.render(!0,!1)},e.prototype.setHiddenAreas=function(t){this.viewModel&&this.viewModel.setHiddenAreas(t)},e.prototype.setAriaActiveDescendant=function(t){this.hasView&&this._view.setAriaActiveDescendant(t)},e.prototype.applyFontInfo=function(t){f.Configuration.applyFontInfoSlow(t,this._configuration.editor.fontInfo)},e.prototype._attachModel=function(e){var o=this;this._view=null,t.prototype._attachModel.call(this,e),this._view&&(this.domElement.appendChild(this._view.domNode),this._view.renderOnce(function(){for(var t=Object.keys(o.contentWidgets),e=0,i=t.length;e<i;e++){var r=t[e];o._view.addContentWidget(o.contentWidgets[r])}t=Object.keys(o.overlayWidgets);for(var e=0,i=t.length;e<i;e++){var r=t[e];o._view.addOverlayWidget(o.overlayWidgets[r])}o._view.render(!1,!0),o.hasView=!0}))},e.prototype._enableEmptySelectionClipboard=function(){return i.enableEmptySelectionClipboard},e.prototype._createView=function(){var t=this;this._view=new w.View(this._keybindingService,this._commandService,this._configuration,this.viewModel,function(e,o,i){t.cursor&&t.cursor.trigger(e,o,i)})},e.prototype._getViewInternalEventBus=function(){return this._view.getInternalEventBus()},e.prototype._detachModel=function(){var e=null;this._view&&(this._view.dispose(),e=this._view.domNode,this._view=null);var o=t.prototype._detachModel.call(this);return e&&this.domElement.removeChild(e),o},e=__decorate([__param(2,n.IInstantiationService),__param(3,g.ICodeEditorService),__param(4,s.ICommandService),__param(5,a.IKeybindingService),__param(6,c.ITelemetryService)],e)}(d.CommonCodeEditor);e.CodeEditorWidget=C;var E=function(t){function e(e){var o=this;t.call(this),this._onChange=this._register(new m.Emitter),this.onChage=this._onChange.event,this._focusTrackerHasFocus=!1,this._forcedWidgetFocusCount=0,this._actualHasFocus=!1,this._focusTracker=this._register(r.trackFocus(e)),this._focusTracker.addFocusListener(function(){o._focusTrackerHasFocus=!0,o._update()}),this._focusTracker.addBlurListener(function(){o._focusTrackerHasFocus=!1,o._update()})}return __extends(e,t),e.prototype.hasFocus=function(){return this._actualHasFocus},e.prototype.beginForcedFocus=function(){this._forcedWidgetFocusCount++,this._update()},e.prototype.endForcedFocus=function(){this._forcedWidgetFocusCount--,this._update()},e.prototype._update=function(){var t=this._focusTrackerHasFocus;this._forcedWidgetFocusCount>0&&(t=!0),this._actualHasFocus!==t&&(this._actualHasFocus=t,this._onChange.fire(void 0))},e}(_.Disposable);(function(){function t(t,e){this._id=t,this._position=e,this._domNode=document.createElement("div"),this._domNode.className=this._id.replace(/\./g,"-").replace(/[^a-z0-9\-]/,"")}return t.prototype.getId=function(){return this._id},t.prototype.getDomNode=function(){return this._domNode},t.prototype.getPosition=function(){return this._position},t})();!function(t){t[t.EndOfLastEditOperation=0]="EndOfLastEditOperation"}(e.EditCursorState||(e.EditCursorState={}));var b=(e.EditCursorState,function(){function t(t){this.range=new u.Range(t.range.startLineNumber,t.range.startColumn,t.range.endLineNumber,t.range.endColumn),this.text=t.text,this.forceMoveMarkers=t.forceMoveMarkers||!1}return t}()),S=function(){function t(t,e){this._ops=t.map(function(t){return new b(t)}),this._editCursorState=e}return t.prototype.getEditOperations=function(t,e){if(0!==this._ops.length){this._ops.sort(function(t,e){return u.Range.compareRangesUsingStarts(t.range,e.range)});for(var o=[],i=this._ops[0],r=1;r<this._ops.length;r++)i.range.endLineNumber===this._ops[r].range.startLineNumber&&i.range.endColumn===this._ops[r].range.startColumn?(i.range=u.Range.plusRange(i.range,this._ops[r].range),i.text=i.text+this._ops[r].text):(o.push(i),i=this._ops[r]);o.push(i);for(var r=0;r<o.length;r++)e.addEditOperation(u.Range.lift(o[r].range),o[r].text)}},t.prototype.computeCursorState=function(t,e){var o=e.getInverseEditOperations(),i=o[o.length-1].range;return new h.Selection(i.endLineNumber,i.endColumn,i.endLineNumber,i.endColumn)},t}();e.CommandRunner=S});