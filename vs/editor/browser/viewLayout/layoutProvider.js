var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)};define(["require","exports","vs/editor/common/editorCommon","vs/editor/common/viewLayout/linesLayout","vs/editor/common/viewModel/viewEventHandler","vs/editor/browser/viewLayout/scrollManager"],function(t,e,o,r,i,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var s=function(t){function e(e,o,i,s,a,l){t.call(this),this.configuration=e,this.privateViewEventBus=i,this.model=o,this.scrollManager=new n.ScrollManager(e,i,s,a,l),this.configuration.setMaxLineNumber(this.model.getMaxLineNumber()),this.linesLayout=new r.LinesLayout(e,o),this._updateHeight()}return __extends(e,t),e.prototype.dispose=function(){this.scrollManager.dispose()},e.prototype.updateLineCount=function(){this.configuration.setMaxLineNumber(this.model.getMaxLineNumber())},e.prototype.onZonesChanged=function(){return this._updateHeight(),!1},e.prototype.onModelFlushed=function(){return this.linesLayout.onModelFlushed(),this.updateLineCount(),this._updateHeight(),!1},e.prototype.onModelLinesDeleted=function(t){return this.linesLayout.onModelLinesDeleted(t),this.updateLineCount(),this._updateHeight(),!1},e.prototype.onModelLinesInserted=function(t){return this.linesLayout.onModelLinesInserted(t),this.updateLineCount(),this._updateHeight(),!1},e.prototype.onConfigurationChanged=function(t){return this.linesLayout.onConfigurationChanged(t),t.layoutInfo&&(this.scrollManager.onLayoutInfoChanged(),this._emitLayoutChangedEvent()),this._updateHeight(),!1},e.prototype._updateHeight=function(){this.scrollManager.setScrollHeight(this.getTotalHeight())},e.prototype.getCurrentViewport=function(){return new o.Viewport(this.scrollManager.getScrollTop(),this.scrollManager.getScrollLeft(),this.scrollManager.getWidth(),this.scrollManager.getHeight())},e.prototype.getCenteredViewLineNumberInViewport=function(){return this.linesLayout.getCenteredLineInViewport(this.getCurrentViewport())},e.prototype._emitLayoutChangedEvent=function(){this.privateViewEventBus.emit(o.EventType.ViewLayoutChanged,this.configuration.editor.layoutInfo)},e.prototype.emitLayoutChangedEvent=function(){this._emitLayoutChangedEvent()},e.prototype._computeScrollWidth=function(t,o){var r=this.configuration.editor.wrappingInfo.isViewportWrapping;return r?Math.max(t,o):Math.max(t+e.LINES_HORIZONTAL_EXTRA_PX,o)},e.prototype.onMaxLineWidthChanged=function(t){var e=this._computeScrollWidth(t,this.getCurrentViewport().width);this.scrollManager.setScrollWidth(e),this._updateHeight()},e.prototype.saveState=function(){var t=this.scrollManager.getScrollTop(),e=this.linesLayout.getLineNumberAtOrAfterVerticalOffset(t),o=this.linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(e);return{scrollTop:t,scrollTopWithoutViewZones:t-o,scrollLeft:this.scrollManager.getScrollLeft()}},e.prototype.restoreState=function(t){var e=t.scrollTop;"number"!=typeof t.scrollTopWithoutViewZones||this.linesLayout.hasWhitespace()||(e=t.scrollTopWithoutViewZones),this.scrollManager.setScrollPosition({scrollLeft:t.scrollLeft,scrollTop:e})},e.prototype.addWhitespace=function(t,e,o){return this.linesLayout.insertWhitespace(t,e,o)},e.prototype.changeWhitespace=function(t,e,o){return this.linesLayout.changeWhitespace(t,e,o)},e.prototype.removeWhitespace=function(t){return this.linesLayout.removeWhitespace(t)},e.prototype.getVerticalOffsetForLineNumber=function(t){return this.linesLayout.getVerticalOffsetForLineNumber(t)},e.prototype.heightInPxForLine=function(t){return this.linesLayout.getHeightForLineNumber(t)},e.prototype.isAfterLines=function(t){return this.linesLayout.isAfterLines(t)},e.prototype.getLineNumberAtVerticalOffset=function(t){return this.linesLayout.getLineNumberAtOrAfterVerticalOffset(t)},e.prototype.getTotalHeight=function(){var t=0;return this.scrollManager.getScrollWidth()>this.scrollManager.getWidth()&&(t=this.configuration.editor.viewInfo.scrollbar.horizontalScrollbarSize),this.linesLayout.getTotalHeight(this.getCurrentViewport(),t)},e.prototype.getWhitespaceAtVerticalOffset=function(t){return this.linesLayout.getWhitespaceAtVerticalOffset(t)},e.prototype.getLinesViewportData=function(){return this.linesLayout.getLinesViewportData(this.getCurrentViewport())},e.prototype.getWhitespaceViewportData=function(){return this.linesLayout.getWhitespaceViewportData(this.getCurrentViewport())},e.prototype.getWhitespaces=function(){return this.linesLayout.getWhitespaces()},e.prototype.getOverviewRulerInsertData=function(){var t=this.scrollManager.getOverviewRulerLayoutInfo();return{parent:t.parent,insertBefore:t.insertBefore}},e.prototype.getScrollbarContainerDomNode=function(){return this.scrollManager.getScrollbarContainerDomNode()},e.prototype.delegateVerticalScrollbarMouseDown=function(t){this.scrollManager.delegateVerticalScrollbarMouseDown(t)},e.prototype.getScrollWidth=function(){return this.scrollManager.getScrollWidth()},e.prototype.getScrollLeft=function(){return this.scrollManager.getScrollLeft()},e.prototype.getScrollHeight=function(){return this.scrollManager.getScrollHeight()},e.prototype.getScrollTop=function(){return this.scrollManager.getScrollTop()},e.prototype.setScrollPosition=function(t){this.scrollManager.setScrollPosition(t)},e.prototype.getScrolledTopFromAbsoluteTop=function(t){return t-this.scrollManager.getScrollTop()},e.prototype.renderScrollbar=function(){this.scrollManager.renderScrollbar()},e.LINES_HORIZONTAL_EXTRA_PX=30,e}(i.ViewEventHandler);e.LayoutProvider=s});