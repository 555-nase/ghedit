var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define(["require","exports","vs/base/common/objects","vs/base/common/strings","vs/base/common/uri","vs/base/browser/dom","vs/editor/common/editorCommon","vs/editor/common/services/abstractCodeEditorService","vs/base/common/lifecycle"],function(e,t,o,r,n,i,a,s,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function c(e){var t=o.deepClone(e);o.mixin(t,e.light);var r=o.deepClone(e);return o.mixin(r,e.dark),{light:t,dark:r}}var C=function(e){function t(t){void 0===t&&(t=i.createStyleSheet()),e.call(this),this._styleSheet=t,this._decorationOptionProviders=Object.create(null)}return __extends(t,e),t.prototype.registerDecorationType=function(e,t,o){var r=this._decorationOptionProviders[e];r||(r=o?new u(this._styleSheet,e,o,t):new h(this._styleSheet,e,t),this._decorationOptionProviders[e]=r),r.refCount++},t.prototype.removeDecorationType=function(e){var t=this._decorationOptionProviders[e];t&&(t.refCount--,t.refCount<=0&&(delete this._decorationOptionProviders[e],t.dispose(),this.listCodeEditors().forEach(function(t){return t.removeDecorations(e)})))},t.prototype.resolveDecorationOptions=function(e,t){var o=this._decorationOptionProviders[e];if(!o)throw new Error("Unknown decoration type key: "+e);return o.getOptions(this,t)},t}(s.AbstractCodeEditorService);t.CodeEditorServiceImpl=C;var d,u=function(){function e(e,t,o,r){this._parentTypeKey=o,this.refCount=0;var n=c(r);this._beforeContentClassName=S.createCSSRules(e,t,o,g.BeforeContentClassName,{light:S.getCSSTextForModelDecorationContentClassName(n.light.before),dark:S.getCSSTextForModelDecorationContentClassName(n.dark.before)}),this._afterContentClassName=S.createCSSRules(e,t,o,g.AfterContentClassName,{light:S.getCSSTextForModelDecorationContentClassName(n.light.after),dark:S.getCSSTextForModelDecorationContentClassName(n.dark.after)}),(this._beforeContentClassName||this._afterContentClassName)&&(this._disposable=l.toDisposable(function(){i.removeCSSRulesContainingSelector(f.getDeletionSubstring(t),e)}))}return e.prototype.getOptions=function(e,t){var o=e.resolveDecorationOptions(this._parentTypeKey,!0);return this._beforeContentClassName&&(o.beforeContentClassName=this._beforeContentClassName),this._afterContentClassName&&(o.afterContentClassName=this._afterContentClassName),o},e.prototype.dispose=function(){this._disposable&&(this._disposable.dispose(),delete this._disposable)},e}(),h=function(){function e(e,t,o){this.refCount=0;var r=c(o);this.className=S.createCSSRules(e,t,null,g.ClassName,{light:S.getCSSTextForModelDecorationClassName(r.light),dark:S.getCSSTextForModelDecorationClassName(r.dark)}),this.inlineClassName=S.createCSSRules(e,t,null,g.InlineClassName,{light:S.getCSSTextForModelDecorationInlineClassName(r.light),dark:S.getCSSTextForModelDecorationInlineClassName(r.dark)}),this.beforeContentClassName=S.createCSSRules(e,t,null,g.BeforeContentClassName,{light:S.getCSSTextForModelDecorationContentClassName(r.light.before),dark:S.getCSSTextForModelDecorationContentClassName(r.dark.before)}),this.afterContentClassName=S.createCSSRules(e,t,null,g.AfterContentClassName,{light:S.getCSSTextForModelDecorationContentClassName(r.light.after),dark:S.getCSSTextForModelDecorationContentClassName(r.dark.after)}),this.glyphMarginClassName=S.createCSSRules(e,t,null,g.GlyphMarginClassName,{light:S.getCSSTextForModelDecorationGlyphMarginClassName(r.light),dark:S.getCSSTextForModelDecorationGlyphMarginClassName(r.dark)}),this.isWholeLine=Boolean(o.isWholeLine),"undefined"==typeof r.light.overviewRulerColor&&"undefined"==typeof r.dark.overviewRulerColor||(this.overviewRuler={color:r.light.overviewRulerColor||r.dark.overviewRulerColor,darkColor:r.dark.overviewRulerColor||r.light.overviewRulerColor,position:o.overviewRulerLane||a.OverviewRulerLane.Center}),this._disposable=l.toDisposable(function(){i.removeCSSRulesContainingSelector(f.getDeletionSubstring(t),e)})}return e.prototype.getOptions=function(e,t){return t?{inlineClassName:this.inlineClassName,beforeContentClassName:this.beforeContentClassName,afterContentClassName:this.afterContentClassName,className:this.className,glyphMarginClassName:this.glyphMarginClassName,isWholeLine:this.isWholeLine,overviewRuler:this.overviewRuler,stickiness:this.stickiness}:this},e.prototype.dispose=function(){this._disposable&&(this._disposable.dispose(),delete this._disposable)},e}(),S=function(){function e(){}return e.getCSSTextForModelDecorationClassName=function(t){var o=[];return e.collectCSSText(t,["backgroundColor","outline","outlineColor","outlineStyle","outlineWidth"],o),e.collectBorderSettingsCSSText(t,o),o.join("")},e.getCSSTextForModelDecorationInlineClassName=function(t){var o=[];return e.collectCSSText(t,["textDecoration","cursor","color","letterSpacing"],o),o.join("")},e.getCSSTextForModelDecorationContentClassName=function(t){var o=[];if("undefined"!=typeof t){if(e.collectBorderSettingsCSSText(t,o),"undefined"!=typeof t.contentIconPath&&o.push(r.format(this._CSS_MAP.contentIconPath,n["default"].file(t.contentIconPath).toString())),"undefined"!=typeof t.contentText){var i=t.contentText.replace(/\"/g,'\\"');o.push(r.format(this._CSS_MAP.contentText,i))}e.collectCSSText(t,["textDecoration","color","backgroundColor","margin"],o),e.collectCSSText(t,["width","height"],o)&&o.push("display:inline-block;")}return o.join("")},e.getCSSTextForModelDecorationGlyphMarginClassName=function(e){var t=[];return"undefined"!=typeof e.gutterIconPath&&(t.push(r.format(this._CSS_MAP.gutterIconPath,n["default"].parse(e.gutterIconPath).toString())),"undefined"!=typeof e.gutterIconSize&&t.push(r.format(this._CSS_MAP.gutterIconSize,e.gutterIconSize))),t.join("")},e.collectBorderSettingsCSSText=function(t,o){return!!e.collectCSSText(t,e.border_rules,o)&&(o.push(r.format("box-sizing: border-box;")),!0)},e.collectCSSText=function(e,t,o){for(var n=o.length,i=0,a=t;i<a.length;i++){var s=a[i];"undefined"!=typeof e[s]&&o.push(r.format(this._CSS_MAP[s],e[s]))}return o.length!==n},e.createCSSRules=function(e,t,o,r,n){function a(n,a){var s=f.getSelector(n,t,o,r);i.createCSSRule(s,a,e)}var s=!1;if(n.light.length>0&&(a(d.Light,n.light),s=!0),n.dark.length>0&&(a(d.Dark,n.dark),a(d.HighContrastBlack,n.dark),s=!0),s){var l=f.getClassName(t,r);return o&&(l=l+" "+f.getClassName(o,r)),l}},e._CSS_MAP={color:"color:{0} !important;",backgroundColor:"background-color:{0};",outline:"outline:{0};",outlineColor:"outline-color:{0};",outlineStyle:"outline-style:{0};",outlineWidth:"outline-width:{0};",border:"border:{0};",borderColor:"border-color:{0};",borderRadius:"border-radius:{0};",borderSpacing:"border-spacing:{0};",borderStyle:"border-style:{0};",borderWidth:"border-width:{0};",textDecoration:"text-decoration:{0};",cursor:"cursor:{0};",letterSpacing:"letter-spacing:{0};",gutterIconPath:"background:url('{0}') center center no-repeat;",gutterIconSize:"background-size:{0};",contentText:"content:'{0}';",contentIconPath:"content:url('{0}');",margin:"margin:{0};",width:"width:{0};",height:"height:{0};"},e.border_rules=["border","borderColor","borderColor","borderSpacing","borderStyle","borderWidth"],e}();!function(e){e[e.Light=0]="Light",e[e.Dark=1]="Dark",e[e.HighContrastBlack=2]="HighContrastBlack"}(d||(d={}));var g;!function(e){e[e.ClassName=0]="ClassName",e[e.InlineClassName=1]="InlineClassName",e[e.GlyphMarginClassName=2]="GlyphMarginClassName",e[e.BeforeContentClassName=3]="BeforeContentClassName",e[e.AfterContentClassName=4]="AfterContentClassName"}(g||(g={}));var f=function(){function e(){}return e._getSelectorPrefixOf=function(e){return e===d.Light?".monaco-editor.vs":e===d.Dark?".monaco-editor.vs-dark":".monaco-editor.hc-black"},e.getClassName=function(e,t){return"ced-"+e+"-"+t},e.getSelector=function(e,t,o,r){var n=this._getSelectorPrefixOf(e)+" ."+this.getClassName(t,r);return o&&(n=n+"."+this.getClassName(o,r)),r===g.BeforeContentClassName?n+="::before":r===g.AfterContentClassName&&(n+="::after"),n},e.getDeletionSubstring=function(e){return".ced-"+e+"-"},e}()});