/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/winjs.base","vs/platform/extensions/common/extensionsRegistry","vs/platform/jsonschemas/common/jsonContributionRegistry","vs/platform/platform","vs/editor/common/modes/modesRegistry","vs/editor/browser/standalone/standaloneServices","vs/editor/common/modes","./standaloneCodeEditor","vs/editor/common/core/range","vs/base/common/async","vs/editor/common/modes/monarch/monarchCompile","vs/editor/common/modes/monarch/monarchLexer","vs/editor/common/modes/languageConfigurationRegistry"],function(e,r,t,i,n,o,s,a,u,c,g,m,d,l,v){"use strict";function f(e){s.ModesRegistry.registerLanguage(e)}function p(){var e=[];return e=e.concat(s.ModesRegistry.getLanguages()),e=e.concat(s.ModesRegistry.getCompatModes())}function y(e,r){var t=!1;return i.ExtensionsRegistry.registerOneTimeActivationEventListener("onLanguage:"+e,function(){t||r()}),{dispose:function(){t=!0}}}function P(e,r){return v.LanguageConfigurationRegistry.register(e,r)}function C(e,r){c.startup.initStaticServicesIfNecessary();var t=a.ensureStaticPlatformServices(null);return t.modeService.registerTokenizationSupport2(e,r)}function R(e,r){c.startup.initStaticServicesIfNecessary();var t=a.ensureStaticPlatformServices(null),i=d.compile(e,r),n=t.modeService;return n.registerTokenizationSupport(e,function(e){return l.createTokenizationSupport(n,e,i)})}function h(e,r){return u.ReferenceProviderRegistry.register(e,r)}function S(e,r){return u.RenameProviderRegistry.register(e,r)}function I(e,r){return u.SignatureHelpProviderRegistry.register(e,r)}function b(e,r){return u.HoverProviderRegistry.register(e,r)}function L(e,r){return u.DocumentSymbolProviderRegistry.register(e,r)}function T(e,r){return u.DocumentHighlightProviderRegistry.register(e,r)}function x(e,r){return u.DefinitionProviderRegistry.register(e,r)}function D(e,r){return u.CodeLensProviderRegistry.register(e,r)}function E(e,r){return u.CodeActionProviderRegistry.register(e,{provideCodeActions:function(e,t,i){c.startup.initStaticServicesIfNecessary();var n=a.ensureStaticPlatformServices(null).markerService,o=n.read({resource:e.uri}).filter(function(e){return g.Range.areIntersectingOrTouching(e,t)});return r.provideCodeActions(e,t,{markers:o},i)}})}function F(e,r){return u.DocumentFormattingEditProviderRegistry.register(e,r)}function A(e,r){return u.DocumentRangeFormattingEditProviderRegistry.register(e,r)}function k(e,r){return u.OnTypeFormattingEditProviderRegistry.register(e,r)}function w(e,r){return u.LinkProviderRegistry.register(e,r)}function M(e,r){var t=new O(r);return u.SuggestRegistry.register(e,{triggerCharacters:r.triggerCharacters,provideCompletionItems:function(e,r,i){return t.provideCompletionItems(e,r,i)},resolveCompletionItem:function(e,r,i,n){return t.resolveCompletionItem(e,r,i,n)}})}function H(e){switch(e){case V.Function:return"function";case V.Constructor:return"constructor";case V.Field:return"field";case V.Variable:return"variable";case V.Class:return"class";case V.Interface:return"interface";case V.Module:return"module";case V.Property:return"property";case V.Unit:return"unit";case V.Value:return"value";case V.Enum:return"enum";case V.Keyword:return"keyword";case V.Snippet:return"snippet";case V.Text:return"text";case V.Color:return"color";case V.File:return"file";case V.Reference:return"reference"}return"property"}function K(e,r){var t=o.Registry.as(n.Extensions.JSONContribution);t.registerSchema(e,r)}function N(){return{register:f,getLanguages:p,onLanguage:y,setLanguageConfiguration:P,setTokensProvider:C,setMonarchTokensProvider:R,registerReferenceProvider:h,registerRenameProvider:S,registerCompletionItemProvider:M,registerSignatureHelpProvider:I,registerHoverProvider:b,registerDocumentSymbolProvider:L,registerDocumentHighlightProvider:T,registerDefinitionProvider:x,registerCodeLensProvider:D,registerCodeActionProvider:E,registerDocumentFormattingEditProvider:F,registerDocumentRangeFormattingEditProvider:A,registerOnTypeFormattingEditProvider:k,registerLinkProvider:w,DocumentHighlightKind:u.DocumentHighlightKind,CompletionItemKind:V,SymbolKind:u.SymbolKind,IndentAction:u.IndentAction}}r.register=f,r.getLanguages=p,r.onLanguage=y,r.setLanguageConfiguration=P,r.setTokensProvider=C,r.setMonarchTokensProvider=R,r.registerReferenceProvider=h,r.registerRenameProvider=S,r.registerSignatureHelpProvider=I,r.registerHoverProvider=b,r.registerDocumentSymbolProvider=L,r.registerDocumentHighlightProvider=T,r.registerDefinitionProvider=x,r.registerCodeLensProvider=D,r.registerCodeActionProvider=E,r.registerDocumentFormattingEditProvider=F,r.registerDocumentRangeFormattingEditProvider=A,r.registerOnTypeFormattingEditProvider=k,r.registerLinkProvider=w,r.registerCompletionItemProvider=M,function(e){e[e.Text=0]="Text",e[e.Method=1]="Method",e[e.Function=2]="Function",e[e.Constructor=3]="Constructor",e[e.Field=4]="Field",e[e.Variable=5]="Variable",e[e.Class=6]="Class",e[e.Interface=7]="Interface",e[e.Module=8]="Module",e[e.Property=9]="Property",e[e.Unit=10]="Unit",e[e.Value=11]="Value",e[e.Enum=12]="Enum",e[e.Keyword=13]="Keyword",e[e.Snippet=14]="Snippet",e[e.Color=15]="Color",e[e.File=16]="File",e[e.Reference=17]="Reference"}(r.CompletionItemKind||(r.CompletionItemKind={}));var V=r.CompletionItemKind,O=function(){function e(e){this._provider=e}return e.from=function(e){return{_actual:e,label:e.label,codeSnippet:e.insertText||e.label,type:H(e.kind),typeLabel:e.detail,documentationLabel:e.documentation,sortText:e.sortText,filterText:e.filterText}},e.prototype.provideCompletionItems=function(r,t,i){var n=r.getWordUntilPosition(t);return m.toThenable(this._provider.provideCompletionItems(r,t,i)).then(function(i){var o,s={suggestions:[],currentWord:n?n.word:""},a=[s];if(Array.isArray(i))o={items:i,isIncomplete:!1};else if("object"==typeof i&&Array.isArray(i.items))o=i,s.incomplete=o.isIncomplete;else{if(!i)return;console.warn("INVALID result from completion provider. expected CompletionItem-array or CompletionList but got:",i)}for(var u=0;u<o.items.length;u++){var c=o.items[u],g=e.from(c);if(c.textEdit){var m=c.textEdit.range,d=m.startLineNumber===m.endLineNumber;if(!d||m.startLineNumber!==t.lineNumber){console.warn("INVALID text edit, must be single line and on the same line");continue}g.codeSnippet=c.textEdit.text,g.overwriteBefore=t.column-m.startColumn,g.overwriteAfter=m.endColumn-t.column,a.push({currentWord:r.getValueInRange(m),suggestions:[g],incomplete:o.isIncomplete})}else s.suggestions.push(g)}return a})},e.prototype.resolveCompletionItem=function(r,i,n,o){if("function"!=typeof this._provider.resolveCompletionItem)return t.TPromise.as(n);var s=n._actual;return s?m.toThenable(this._provider.resolveCompletionItem(s,o)).then(function(r){return e.from(r)}):t.TPromise.as(n)},e}();r.registerStandaloneSchema=K,r.createMonacoLanguagesAPI=N});