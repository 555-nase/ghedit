var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define(["require","exports","vs/base/common/errors","vs/base/browser/styleMutator","vs/editor/browser/editorBrowser","vs/editor/browser/view/viewPart"],function(e,t,o,i,n,r){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var s=function(e){function t(t,o){e.call(this,t),this._lineHeight=this._context.configuration.editor.lineHeight,this._contentWidth=this._context.configuration.editor.layoutInfo.contentWidth,this._whitespaceManager=o,this.domNode=document.createElement("div"),this.domNode.className=n.ClassNames.VIEW_ZONES,this.domNode.style.position="absolute",this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._zones={}}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._whitespaceManager=null,this._zones={}},t.prototype._recomputeWhitespacesProps=function(){for(var e=!1,t=Object.keys(this._zones),o=0,i=t.length;o<i;o++){var n=t[o],r=this._zones[n],s=this._computeWhitespaceProps(r.delegate);this._whitespaceManager.changeWhitespace(parseInt(n,10),s.afterViewLineNumber,s.heightInPx)&&(this._safeCallOnComputedHeight(r.delegate,s.heightInPx),e=!0)}return e},t.prototype.onConfigurationChanged=function(e){return e.lineHeight?(this._lineHeight=this._context.configuration.editor.lineHeight,this._recomputeWhitespacesProps()):(e.layoutInfo&&(this._contentWidth=this._context.configuration.editor.layoutInfo.contentWidth),!1)},t.prototype.onLineMappingChanged=function(){return this._recomputeWhitespacesProps()},t.prototype.onLayoutChanged=function(e){return!0},t.prototype.onScrollChanged=function(e){return e.scrollTopChanged||e.scrollWidthChanged},t.prototype.onZonesChanged=function(){return!0},t.prototype.onModelLinesDeleted=function(e){return!0},t.prototype.onModelLinesInserted=function(e){return!0},t.prototype._getZoneOrdinal=function(e){return"undefined"!=typeof e.afterColumn?e.afterColumn:1e4},t.prototype._computeWhitespaceProps=function(e){if(0===e.afterLineNumber)return{afterViewLineNumber:0,heightInPx:this._heightInPixels(e)};var t;if("undefined"!=typeof e.afterColumn)t=this._context.model.validateModelPosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{var o=this._context.model.validateModelPosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t={lineNumber:o,column:this._context.model.getModelLineMaxColumn(o)}}var i;i=t.column===this._context.model.getModelLineMaxColumn(t.lineNumber)?this._context.model.validateModelPosition({lineNumber:t.lineNumber+1,column:1}):this._context.model.validateModelPosition({lineNumber:t.lineNumber,column:t.column+1});var n=this._context.model.convertModelPositionToViewPosition(t.lineNumber,t.column),r=this._context.model.modelPositionIsVisible(i);return{afterViewLineNumber:n.lineNumber,heightInPx:r?this._heightInPixels(e):0}},t.prototype.addZone=function(e){var t=this._computeWhitespaceProps(e),o=this._whitespaceManager.addWhitespace(t.afterViewLineNumber,this._getZoneOrdinal(e),t.heightInPx),n={whitespaceId:o,delegate:e,isVisible:!1};return this._safeCallOnComputedHeight(n.delegate,t.heightInPx),n.delegate.domNode.style.position="absolute",n.delegate.domNode.style.width="100%",i.StyleMutator.setDisplay(n.delegate.domNode,"none"),this._zones[n.whitespaceId.toString()]=n,n.delegate.domNode.setAttribute("monaco-view-zone",n.whitespaceId.toString()),this.domNode.appendChild(n.delegate.domNode),this.setShouldRender(),n.whitespaceId},t.prototype.removeZone=function(e){if(this._zones.hasOwnProperty(e.toString())){var t=this._zones[e.toString()];return delete this._zones[e.toString()],this._whitespaceManager.removeWhitespace(t.whitespaceId),t.delegate.domNode.removeAttribute("monaco-visible-view-zone"),t.delegate.domNode.removeAttribute("monaco-view-zone"),t.delegate.domNode.parentNode.removeChild(t.delegate.domNode),this.setShouldRender(),!0}return!1},t.prototype.layoutZone=function(e){var t=!1;if(this._zones.hasOwnProperty(e.toString())){var o=this._zones[e.toString()],i=this._computeWhitespaceProps(o.delegate);t=this._whitespaceManager.changeWhitespace(o.whitespaceId,i.afterViewLineNumber,i.heightInPx)||t,t&&(this._safeCallOnComputedHeight(o.delegate,i.heightInPx),this.setShouldRender())}return t},t.prototype.shouldSuppressMouseDownOnViewZone=function(e){if(this._zones.hasOwnProperty(e.toString())){var t=this._zones[e.toString()];return t.delegate.suppressMouseDown}return!1},t.prototype._heightInPixels=function(e){return"number"==typeof e.heightInPx?e.heightInPx:"number"==typeof e.heightInLines?this._lineHeight*e.heightInLines:this._lineHeight},t.prototype._safeCallOnComputedHeight=function(e,t){if("function"==typeof e.onComputedHeight)try{e.onComputedHeight(t)}catch(i){o.onUnexpectedError(i)}},t.prototype._safeCallOnDomNodeTop=function(e,t){if("function"==typeof e.onDomNodeTop)try{e.onDomNodeTop(t)}catch(i){o.onUnexpectedError(i)}},t.prototype.prepareRender=function(e){if(!this.shouldRender())throw new Error("I did not ask to render!")},t.prototype.render=function(e){for(var t=this._whitespaceManager.getWhitespaceViewportData(),o={},n=!1,r=0,s=t.length;r<s;r++)o[t[r].id.toString()]=t[r],n=!0;for(var a=Object.keys(this._zones),r=0,s=a.length;r<s;r++){var h=a[r],d=this._zones[h];o.hasOwnProperty(h)?(i.StyleMutator.setTop(d.delegate.domNode,o[h].verticalOffset-e.bigNumbersDelta),i.StyleMutator.setHeight(d.delegate.domNode,o[h].height),d.isVisible||(i.StyleMutator.setDisplay(d.delegate.domNode,"block"),d.delegate.domNode.setAttribute("monaco-visible-view-zone","true"),d.isVisible=!0),this._safeCallOnDomNodeTop(d.delegate,e.getScrolledTopFromAbsoluteTop(o[h].verticalOffset))):(d.isVisible&&(i.StyleMutator.setDisplay(d.delegate.domNode,"none"),d.delegate.domNode.removeAttribute("monaco-visible-view-zone"),d.isVisible=!1),this._safeCallOnDomNodeTop(d.delegate,e.getScrolledTopFromAbsoluteTop(-1e6)))}n&&i.StyleMutator.setWidth(this.domNode,Math.max(e.scrollWidth,this._contentWidth))},t}(r.ViewPart);t.ViewZones=s});