/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,n){function t(){this.constructor=e}for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)};define(["require","exports","vs/editor/browser/view/dynamicViewOverlay","vs/css!./decorations"],function(e,n,t){"use strict";var r=function(e){function n(n){e.call(this),this._context=n,this._lineHeight=this._context.configuration.editor.lineHeight,this._renderResult=null,this._context.addEventHandler(this)}return __extends(n,e),n.prototype.dispose=function(){this._context.removeEventHandler(this),this._context=null,this._renderResult=null},n.prototype.onModelFlushed=function(){return!0},n.prototype.onModelDecorationsChanged=function(e){return!0},n.prototype.onModelLinesDeleted=function(e){return!0},n.prototype.onModelLineChanged=function(e){return!0},n.prototype.onModelLinesInserted=function(e){return!0},n.prototype.onCursorPositionChanged=function(e){return!1},n.prototype.onCursorSelectionChanged=function(e){return!1},n.prototype.onCursorRevealRange=function(e){return!1},n.prototype.onConfigurationChanged=function(e){return e.lineHeight&&(this._lineHeight=this._context.configuration.editor.lineHeight),!0},n.prototype.onLayoutChanged=function(e){return!0},n.prototype.onScrollChanged=function(e){return e.scrollTopChanged||e.scrollWidthChanged},n.prototype.onZonesChanged=function(){return!0},n.prototype.prepareRender=function(e){if(!this.shouldRender())throw new Error("I did not ask to render!");var n=e.getDecorationsInViewport();n=n.filter(function(e){return!!e.options.className}),n=n.sort(function(e,n){return e.options.className<n.options.className?-1:e.options.className>n.options.className?1:e.range.startLineNumber===n.range.startLineNumber?e.range.startColumn===n.range.startColumn?e.range.endLineNumber===n.range.endLineNumber?e.range.endColumn-n.range.endColumn:e.range.endLineNumber-n.range.endLineNumber:e.range.startColumn-n.range.startColumn:e.range.startLineNumber-n.range.startLineNumber});for(var t=e.visibleRange.startLineNumber,r=e.visibleRange.endLineNumber,o=[],i=t;i<=r;i++){var s=i-t;o[s]=""}this._renderWholeLineDecorations(e,n,o),this._renderNormalDecorations(e,n,o),this._renderResult=o},n.prototype._renderWholeLineDecorations=function(e,n,t){for(var r=String(this._lineHeight),o=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,s=0,a=n.length;s<a;s++){var u=n[s];if(u.options.isWholeLine)for(var l='<div class="cdr '+u.options.className+'" style="left:0;width:100%;height:'+r+'px;"></div>',d=Math.max(u.range.startLineNumber,o),c=Math.min(u.range.endLineNumber,i),h=d;h<=c;h++){var p=h-o;t[p]+=l}}},n.prototype._renderNormalDecorations=function(e,n,t){for(var r=String(this._lineHeight),o=e.visibleRange.startLineNumber,i=0,s=n.length;i<s;i++){var a=n[i];if(!a.options.isWholeLine){var u=e.linesVisibleRangesForRange(a.range,"findMatch"===a.options.className);if(u)for(var l=a.options.className,d=0,c=u.length;d<c;d++)for(var h=u[d],p=h.lineNumber-o,g=0,f=h.ranges.length;g<f;g++){var m=h.ranges[g],v='<div class="cdr '+l+'" style="left:'+String(m.left)+"px;width:"+String(m.width)+"px;height:"+r+'px;"></div>';t[p]+=v}}}},n.prototype.render=function(e,n){if(!this._renderResult)return"";var t=n-e;if(t<0||t>=this._renderResult.length)throw new Error("Unexpected render request");return this._renderResult[t]},n}(t.DynamicViewOverlay);n.DecorationsOverlay=r});