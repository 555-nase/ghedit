/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};define(["require","exports","vs/editor/browser/view/dynamicViewOverlay","vs/css!./selections"],function(t,e,n){"use strict";function o(t){return new s(t)}function i(t){return new l(t.lineNumber,t.ranges.map(o))}var r;!function(t){t[t.EXTERN=0]="EXTERN",t[t.INTERN=1]="INTERN",t[t.FLAT=2]="FLAT"}(r||(r={}));var s=function(){function t(t){this.left=t.left,this.width=t.width,this.startStyle=null,this.endStyle=null}return t}(),l=function(){function t(t,e){this.lineNumber=t,this.ranges=e}return t}(),a=navigator.userAgent.indexOf("Trident/7.0")>=0||navigator.userAgent.indexOf("Edge/12")>=0,u=function(t){function e(e){t.call(this),this._previousFrameVisibleRangesWithStyle=[],this._context=e,this._lineHeight=this._context.configuration.editor.lineHeight,this._roundedSelection=this._context.configuration.editor.viewInfo.roundedSelection,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}return __extends(e,t),e.prototype.dispose=function(){this._context.removeEventHandler(this),this._context=null,this._selections=null,this._renderResult=null},e.prototype.onModelFlushed=function(){return!0},e.prototype.onModelDecorationsChanged=function(t){return t.inlineDecorationsChanged},e.prototype.onModelLinesDeleted=function(t){return!0},e.prototype.onModelLineChanged=function(t){return!0},e.prototype.onModelLinesInserted=function(t){return!0},e.prototype.onCursorPositionChanged=function(t){return!1},e.prototype.onCursorSelectionChanged=function(t){return this._selections=[t.selection],this._selections=this._selections.concat(t.secondarySelections),!0},e.prototype.onCursorRevealRange=function(t){return!1},e.prototype.onConfigurationChanged=function(t){return t.lineHeight&&(this._lineHeight=this._context.configuration.editor.lineHeight),t.viewInfo.roundedSelection&&(this._roundedSelection=this._context.configuration.editor.viewInfo.roundedSelection),!0},e.prototype.onLayoutChanged=function(t){return!0},e.prototype.onScrollChanged=function(t){return t.scrollTopChanged},e.prototype.onZonesChanged=function(){return!0},e.prototype._visibleRangesHaveGaps=function(t){var e,n,o;for(e=0,n=t.length;e<n;e++)if(o=t[e],o.ranges.length>1)return!0;return!1},e.prototype._enrichVisibleRangesWithStyle=function(t,e){var n,o,i,s,l,a,u,h,c,E,_,d=null,T=null;if(e&&e.length>0&&t.length>0){for(var p=t[0].lineNumber,E=0;!d&&E<e.length;E++)e[E].lineNumber===p&&(d=e[E].ranges[0]);for(var g=t[t.length-1].lineNumber,E=e.length-1;!T&&E>=0;E--)e[E].lineNumber===g&&(T=e[E].ranges[0]);d&&!d.startStyle&&(d=null),T&&!T.startStyle&&(T=null)}for(E=0,_=t.length;E<_;E++)n=t[E].ranges[0],o=n.left,i=n.left+n.width,h={top:r.EXTERN,bottom:r.EXTERN},c={top:r.EXTERN,bottom:r.EXTERN},E>0?(s=t[E-1].ranges[0].left,l=t[E-1].ranges[0].left+t[E-1].ranges[0].width,o===s?h.top=r.FLAT:o>s&&(h.top=r.INTERN),i===l?c.top=r.FLAT:s<i&&i<l&&(c.top=r.INTERN)):d&&(h.top=d.startStyle.top,c.top=d.endStyle.top),E+1<_?(a=t[E+1].ranges[0].left,u=t[E+1].ranges[0].left+t[E+1].ranges[0].width,o===a?h.bottom=r.FLAT:a<o&&o<u&&(h.bottom=r.INTERN),i===u?c.bottom=r.FLAT:i<u&&(c.bottom=r.INTERN)):T&&(h.bottom=T.startStyle.bottom,c.bottom=T.endStyle.bottom),n.startStyle=h,n.endStyle=c},e.prototype._getVisibleRangesWithStyle=function(t,e,n){var o=e.linesVisibleRangesForRange(t,!0)||[],r=o.map(i),s=this._visibleRangesHaveGaps(r);return a||s||!this._roundedSelection||this._enrichVisibleRangesWithStyle(r,n),r},e.prototype._createSelectionPiece=function(t,e,n,o,i){return'<div class="cslr '+n+'" style="top:'+t.toString()+"px;left:"+o.toString()+"px;width:"+i.toString()+"px;height:"+e+'px;"></div>'},e.prototype._actualRenderOneSelection=function(t,n,o,i){for(var s=i.length>0&&i[0].ranges[0].startStyle,l=this._lineHeight.toString(),a=(this._lineHeight-1).toString(),u=i.length>0?i[0].lineNumber:0,h=i.length>0?i[i.length-1].lineNumber:0,c=0,E=i.length;c<E;c++){for(var _=i[c],d=_.lineNumber,T=d-n,p=o&&(d===h||d===u)?a:l,g=o&&d===u?1:0,S="",N=0,f=_.ranges.length;N<f;N++){var R=_.ranges[N];if(s){if(R.startStyle.top===r.INTERN||R.startStyle.bottom===r.INTERN){S+=this._createSelectionPiece(g,p,e.SELECTION_CLASS_NAME,R.left-e.ROUNDED_PIECE_WIDTH,e.ROUNDED_PIECE_WIDTH);var y=e.EDITOR_BACKGROUND_CLASS_NAME;R.startStyle.top===r.INTERN&&(y+=" "+e.SELECTION_TOP_RIGHT),R.startStyle.bottom===r.INTERN&&(y+=" "+e.SELECTION_BOTTOM_RIGHT),S+=this._createSelectionPiece(g,p,y,R.left-e.ROUNDED_PIECE_WIDTH,e.ROUNDED_PIECE_WIDTH)}if(R.endStyle.top===r.INTERN||R.endStyle.bottom===r.INTERN){S+=this._createSelectionPiece(g,p,e.SELECTION_CLASS_NAME,R.left+R.width,e.ROUNDED_PIECE_WIDTH);var I=e.EDITOR_BACKGROUND_CLASS_NAME;R.endStyle.top===r.INTERN&&(I+=" "+e.SELECTION_TOP_LEFT),R.endStyle.bottom===r.INTERN&&(I+=" "+e.SELECTION_BOTTOM_LEFT),S+=this._createSelectionPiece(g,p,I,R.left+R.width,e.ROUNDED_PIECE_WIDTH)}}var O=e.SELECTION_CLASS_NAME;s&&(R.startStyle.top===r.EXTERN&&(O+=" "+e.SELECTION_TOP_LEFT),R.startStyle.bottom===r.EXTERN&&(O+=" "+e.SELECTION_BOTTOM_LEFT),R.endStyle.top===r.EXTERN&&(O+=" "+e.SELECTION_TOP_RIGHT),R.endStyle.bottom===r.EXTERN&&(O+=" "+e.SELECTION_BOTTOM_RIGHT)),S+=this._createSelectionPiece(g,p,O,R.left,R.width)}t[T]+=S}},e.prototype.prepareRender=function(t){if(!this.shouldRender())throw new Error("I did not ask to render!");for(var e=[],n=t.visibleRange.startLineNumber,o=t.visibleRange.endLineNumber,i=n;i<=o;i++){var r=i-n;e[r]=""}for(var s=[],l=0,a=this._selections.length;l<a;l++){var u=this._selections[l];if(u.isEmpty())s.push(null);else{var h=this._getVisibleRangesWithStyle(u,t,this._previousFrameVisibleRangesWithStyle[l]);s.push(h),this._actualRenderOneSelection(e,n,this._selections.length>1,h)}}this._previousFrameVisibleRangesWithStyle=s,this._renderResult=e},e.prototype.render=function(t,e){if(!this._renderResult)return"";var n=e-t;if(n<0||n>=this._renderResult.length)throw new Error("Unexpected render request");return this._renderResult[n]},e.SELECTION_CLASS_NAME="selected-text",e.SELECTION_TOP_LEFT="top-left-radius",e.SELECTION_BOTTOM_LEFT="bottom-left-radius",e.SELECTION_TOP_RIGHT="top-right-radius",e.SELECTION_BOTTOM_RIGHT="bottom-right-radius",e.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background",e.ROUNDED_PIECE_WIDTH=10,e}(n.DynamicViewOverlay);e.SelectionsOverlay=u});