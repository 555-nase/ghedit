var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};define(["require","exports","vs/base/browser/browser","vs/base/browser/styleMutator","vs/editor/common/viewLayout/viewLineParts","vs/editor/common/viewLayout/viewLineRenderer","vs/editor/browser/editorBrowser","vs/editor/browser/viewParts/lines/rangeUtil","vs/editor/common/view/renderingContext"],function(t,e,n,i,r,o,s,a,h){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function d(t,e,n){var i=t.findIndexOfOffset(e);return i<=n?i:n}function c(t){return new u(t)}function l(t){return new g(t)}function f(t){return new _(t)}var _=function(){function t(t){this._context=t,this._renderWhitespace=this._context.configuration.editor.viewInfo.renderWhitespace,this._renderControlCharacters=this._context.configuration.editor.viewInfo.renderControlCharacters,this._spaceWidth=this._context.configuration.editor.fontInfo.spaceWidth,this._lineHeight=this._context.configuration.editor.lineHeight,this._stopRenderingLineAfter=this._context.configuration.editor.viewInfo.stopRenderingLineAfter,this._domNode=null,this._isInvalid=!0,this._isMaybeInvalid=!1,this._lineParts=null,this._charOffsetInPart=[],this._lastRenderedPartIndex=0}return t.prototype.getDomNode=function(){return this._domNode?this._domNode.domNode:null},t.prototype.setDomNode=function(t){this._domNode=i.createFastDomNode(t)},t.prototype.onContentChanged=function(){this._isInvalid=!0},t.prototype.onLinesInsertedAbove=function(){this._isMaybeInvalid=!0},t.prototype.onLinesDeletedAbove=function(){this._isMaybeInvalid=!0},t.prototype.onLineChangedAbove=function(){this._isMaybeInvalid=!0},t.prototype.onTokensChanged=function(){this._isMaybeInvalid=!0},t.prototype.onModelDecorationsChanged=function(){this._isMaybeInvalid=!0},t.prototype.onConfigurationChanged=function(t){t.viewInfo.renderWhitespace&&(this._renderWhitespace=this._context.configuration.editor.viewInfo.renderWhitespace),t.viewInfo.renderControlCharacters&&(this._renderControlCharacters=this._context.configuration.editor.viewInfo.renderControlCharacters),t.fontInfo&&(this._spaceWidth=this._context.configuration.editor.fontInfo.spaceWidth),t.lineHeight&&(this._lineHeight=this._context.configuration.editor.lineHeight),t.viewInfo.stopRenderingLineAfter&&(this._stopRenderingLineAfter=this._context.configuration.editor.viewInfo.stopRenderingLineAfter),this._isInvalid=!0},t.prototype.shouldUpdateHTML=function(t,e,n){var i=null;return(this._isMaybeInvalid||this._isInvalid)&&(i=r.createLineParts(e,this._context.model.getLineMinColumn(e),this._context.model.getLineContent(e),this._context.model.getTabSize(),this._context.model.getLineTokens(e),n,this._renderWhitespace)),this._isMaybeInvalid&&(this._isInvalid||this._lineParts&&this._lineParts.equals(i)||(this._isInvalid=!0),this._isMaybeInvalid=!1),this._isInvalid&&(this._lineParts=i),this._isInvalid},t.prototype.getLineOuterHTML=function(t,e,n){t.push('<div lineNumber="'),t.push(e.toString()),t.push('" style="top:'),t.push(n.toString()),t.push("px;height:"),t.push(this._lineHeight.toString()),t.push('px;" class="'),t.push(s.ClassNames.VIEW_LINE),t.push('">'),t.push(this.getLineInnerHTML(e)),t.push("</div>")},t.prototype.getLineInnerHTML=function(t){return this._isInvalid=!1,this._render(t,this._lineParts)},t.prototype.layoutLine=function(t,e){this._domNode.setLineNumber(String(t)),this._domNode.setTop(e),this._domNode.setHeight(this._lineHeight)},t.prototype._render=function(t,e){this._cachedWidth=-1;var n=o.renderLine(new o.RenderLineInput(this._context.model.getLineContent(t),this._context.model.getTabSize(),this._spaceWidth,this._stopRenderingLineAfter,this._renderWhitespace,this._renderControlCharacters,e.getParts()));return this._charOffsetInPart=n.charOffsetInPart,this._lastRenderedPartIndex=n.lastRenderedPartIndex,n.output},t.prototype._getReadingTarget=function(){return this._domNode.domNode.firstChild},t.prototype.getWidth=function(){return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget().offsetWidth),this._cachedWidth},t.prototype.getVisibleRangesForRange=function(t,e,n,i){t=0|t,e=0|e,n=0|n;var r=0|this._stopRenderingLineAfter;return r!==-1&&t>r&&e>r?null:(r!==-1&&t>r&&(t=r),r!==-1&&e>r&&(e=r),this._readVisibleRangesForRange(t,e,n,i))},t.prototype._readVisibleRangesForRange=function(t,e,n,i){return t===e?this._readRawVisibleRangesForPosition(t,n,i):this._readRawVisibleRangesForRange(t,e,n,i)},t.prototype._readRawVisibleRangesForPosition=function(t,e,n){if(0===this._charOffsetInPart.length)return[new h.HorizontalRange(0,0)];var i=d(this._lineParts,t-1,this._lastRenderedPartIndex),r=this._charOffsetInPart[t-1];return a.RangeUtil.readHorizontalRanges(this._getReadingTarget(),i,r,i,r,e,this._getScaleRatio(),n)},t.prototype._readRawVisibleRangesForRange=function(t,e,n,i){if(1===t&&e===this._charOffsetInPart.length)return[new h.HorizontalRange(0,this.getWidth())];var r=d(this._lineParts,t-1,this._lastRenderedPartIndex),o=this._charOffsetInPart[t-1],s=d(this._lineParts,e-1,this._lastRenderedPartIndex),c=this._charOffsetInPart[e-1];return a.RangeUtil.readHorizontalRanges(this._getReadingTarget(),r,o,s,c,n,this._getScaleRatio(),i)},t.prototype._getScaleRatio=function(){return 1},t.prototype.getColumnOfNodeOffset=function(t,e,n){for(var i=e.textContent.length,o=-1;e;)e=e.previousSibling,o++;var s=this._lineParts.getParts();return r.getColumnOfLinePartOffset(this._stopRenderingLineAfter,s,this._context.model.getLineMaxColumn(t),this._charOffsetInPart,o,i,n)},t}();e.ViewLine=_;var u=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype._getScaleRatio=function(){return screen.logicalXDPI/screen.deviceXDPI},e}(_),g=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype._readVisibleRangesForRange=function(e,n,i,r){var o=t.prototype._readVisibleRangesForRange.call(this,e,n,i,r);if(!o||0===o.length||e===n||1===e&&n===this._charOffsetInPart.length)return o;var s=this._readRawVisibleRangesForPosition(n-1,i,r),a=this._readRawVisibleRangesForPosition(n,i,r);if(s&&s.length>0&&a&&a.length>0){var h=s[0],d=a[0],c=h.left<=d.left,l=o[o.length-1];c&&l.left<d.left&&(l.width=d.left-l.left)}return o},e}(_);e.createLine=function(){return window.screen&&window.screen.deviceXDPI&&(navigator.userAgent.indexOf("Trident/6.0")>=0||navigator.userAgent.indexOf("Trident/5.0")>=0)?c:n.isWebKit?l:f}()});