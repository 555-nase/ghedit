var __extends=this&&this.__extends||function(e,o){function t(){this.constructor=e}for(var r in o)o.hasOwnProperty(r)&&(e[r]=o[r]);e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)};define(["require","exports","vs/platform/theme/common/themes","vs/editor/common/editorCommon","vs/editor/browser/view/viewPart","vs/editor/browser/viewParts/overviewRuler/overviewRulerImpl"],function(e,o,t,r,i,s){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var n=function(e){function o(r,i,n){e.call(this,r),this._overviewRuler=new s.OverviewRulerImpl(1,"decorationsOverviewRuler",i,this._context.configuration.editor.lineHeight,this._context.configuration.editor.viewInfo.canUseTranslate3d,o.DECORATION_HEIGHT,o.DECORATION_HEIGHT,n),this._overviewRuler.setLanesCount(this._context.configuration.editor.viewInfo.overviewRulerLanes,!1);var u=this._context.configuration.editor.viewInfo.theme;this._overviewRuler.setUseDarkColor(!t.isLightTheme(u),!1),this._shouldUpdateDecorations=!0,this._zonesFromDecorations=[],this._shouldUpdateCursorPosition=!0,this._hideCursor=this._context.configuration.editor.viewInfo.hideCursorInOverviewRuler,this._zonesFromCursors=[],this._cursorPositions=[]}return __extends(o,e),o.prototype.dispose=function(){e.prototype.dispose.call(this),this._overviewRuler.dispose()},o.prototype.onCursorPositionChanged=function(e){return this._shouldUpdateCursorPosition=!0,this._cursorPositions=[e.position],this._cursorPositions=this._cursorPositions.concat(e.secondaryPositions),!0},o.prototype.onConfigurationChanged=function(e){var o=this._overviewRuler.getLanesCount(),r=this._context.configuration.editor.viewInfo.overviewRulerLanes,i=!1;if(e.lineHeight&&(this._overviewRuler.setLineHeight(this._context.configuration.editor.lineHeight,!1),i=!0),e.viewInfo.canUseTranslate3d&&(this._overviewRuler.setCanUseTranslate3d(this._context.configuration.editor.viewInfo.canUseTranslate3d,!1),i=!0),o!==r&&(this._overviewRuler.setLanesCount(r,!1),i=!0),e.viewInfo.hideCursorInOverviewRuler&&(this._hideCursor=this._context.configuration.editor.viewInfo.hideCursorInOverviewRuler,this._shouldUpdateCursorPosition=!0,i=!0),e.viewInfo.theme){var s=this._context.configuration.editor.viewInfo.theme;this._overviewRuler.setUseDarkColor(!t.isLightTheme(s),!1),i=!0}return i},o.prototype.onLayoutChanged=function(e){return this._overviewRuler.setLayout(e.overviewRuler,!1),!0},o.prototype.onZonesChanged=function(){return!0},o.prototype.onModelFlushed=function(){return this._shouldUpdateCursorPosition=!0,this._shouldUpdateDecorations=!0,!0},o.prototype.onModelDecorationsChanged=function(e){return this._shouldUpdateDecorations=!0,!0},o.prototype.onScrollChanged=function(o){return this._overviewRuler.setScrollHeight(o.scrollHeight,!1),e.prototype.onScrollChanged.call(this,o)||o.scrollHeightChanged},o.prototype.getDomNode=function(){return this._overviewRuler.getDomNode()},o.prototype._createZonesFromDecorations=function(){for(var e=this._context.model.getAllDecorations(),o=[],t=0,i=e.length;t<i;t++){var s=e[t];s.options.overviewRuler.color&&o.push(new r.OverviewRulerZone(s.range.startLineNumber,s.range.endLineNumber,s.options.overviewRuler.position,0,s.options.overviewRuler.color,s.options.overviewRuler.darkColor))}return o},o.prototype._createZonesFromCursors=function(){for(var e=[],t=0,i=this._cursorPositions.length;t<i;t++){var s=this._cursorPositions[t];e.push(new r.OverviewRulerZone(s.lineNumber,s.lineNumber,r.OverviewRulerLane.Full,2,o._CURSOR_COLOR,o._CURSOR_COLOR_DARK))}return e},o.prototype.prepareRender=function(e){if(!this.shouldRender())throw new Error("I did not ask to render!")},o.prototype.render=function(e){if(this._shouldUpdateDecorations||this._shouldUpdateCursorPosition){this._shouldUpdateDecorations&&(this._shouldUpdateDecorations=!1,this._zonesFromDecorations=this._createZonesFromDecorations()),this._shouldUpdateCursorPosition&&(this._shouldUpdateCursorPosition=!1,this._hideCursor?this._zonesFromCursors=[]:this._zonesFromCursors=this._createZonesFromCursors());var o=[];o=o.concat(this._zonesFromCursors),o=o.concat(this._zonesFromDecorations),this._overviewRuler.setZones(o,!1)}var t=this._overviewRuler.render(!1);if(t&&s.OverviewRulerImpl.hasCanvas&&this._overviewRuler.getLanesCount()>0&&(this._zonesFromDecorations.length>0||this._zonesFromCursors.length>0)){var r=this._overviewRuler.getDomNode().getContext("2d");r.beginPath(),r.lineWidth=1,r.strokeStyle="rgba(197,197,197,0.8)",r.moveTo(0,0),r.lineTo(0,this._overviewRuler.getPixelHeight()),r.stroke(),r.moveTo(0,0),r.lineTo(this._overviewRuler.getPixelWidth(),0),r.stroke()}},o.DECORATION_HEIGHT=6,o._CURSOR_COLOR="rgba(0, 0, 102, 0.8)",o._CURSOR_COLOR_DARK="rgba(152, 152, 152, 0.8)",o}(i.ViewPart);o.DecorationsOverviewRuler=n});