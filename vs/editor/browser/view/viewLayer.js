var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define(["require","exports","vs/editor/browser/view/viewPart","vs/base/browser/styleMutator"],function(e,t,n,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var r=function(){function e(e){this._lines=[],this._rendLineNumberStart=1,this._createLine=e}return e.prototype._set=function(e,t){this._lines=t,this._rendLineNumberStart=e},e.prototype._get=function(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}},e.prototype.getStartLineNumber=function(){return this._rendLineNumberStart},e.prototype.getEndLineNumber=function(){return this._rendLineNumberStart+this._lines.length-1},e.prototype.getCount=function(){return this._lines.length},e.prototype.getLine=function(e){var t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new Error("Illegal value for lineNumber: "+e);return this._lines[t]},e.prototype.onModelLinesDeleted=function(e,t){if(0===this.getCount())return null;for(var n=this.getStartLineNumber(),o=this.getEndLineNumber(),r=0,i=0,s=n;s<=o;s++){var l=s-this._rendLineNumberStart;e<=s&&s<=t?0===i?(r=l,i=1):i++:s>t&&this._lines[l].onLinesDeletedAbove()}if(e<n){var d=0;d=t<n?t-e+1:n-e,this._rendLineNumberStart-=d}var a=this._lines.splice(r,i);return a},e.prototype.onModelLineChanged=function(e){if(0===this.getCount())return!1;for(var t=this.getStartLineNumber(),n=this.getEndLineNumber(),o=!1,r=t;r<=n;r++){var i=r-this._rendLineNumberStart;r===e?(this._lines[i].onContentChanged(),o=!0):r>e&&(this._lines[i].onLineChangedAbove(),o=!0)}return o},e.prototype.onModelLinesInserted=function(e,t){if(0===this.getCount())return null;for(var n=t-e+1,o=this.getStartLineNumber(),r=this.getEndLineNumber(),i=o;i<=r;i++){var s=i-this._rendLineNumberStart;e<=i&&this._lines[s].onLinesInsertedAbove()}if(e<=o)return this._rendLineNumberStart+=n,null;if(e>r)return null;if(n+e>r){var l=this._lines.splice(e-this._rendLineNumberStart,r-e+1);return l}for(var d=[],a=0;a<n;a++)d[a]=this._createLine();var u=e-this._rendLineNumberStart,h=this._lines.slice(0,u),m=this._lines.slice(u,this._lines.length-n),c=this._lines.slice(this._lines.length-n,this._lines.length);return this._lines=h.concat(d).concat(m),c},e.prototype.onModelTokensChanged=function(e,t){if(0===this.getCount())return!1;for(var n=this.getStartLineNumber(),o=this.getEndLineNumber(),r=!1,i=n;i<=o;i++){var s=i-this._rendLineNumberStart;e<=i&&i<=t&&(this._lines[s].onTokensChanged(),r=!0)}return r},e}();t.RenderedLinesCollection=r;var i=function(e){function t(t){var n=this;e.call(this,t),this.domNode=this._createDomNode(),this._linesCollection=new r(function(){return n._createLine()}),this._scrollDomNode=null,this._scrollDomNodeIsAbove=!1,this._renderer=new s(function(){return n._createLine()},function(){return n._extraDomNodeHTML()})}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._linesCollection=null},t.prototype._extraDomNodeHTML=function(){return""},t.prototype.onConfigurationChanged=function(e){for(var t=this._linesCollection.getStartLineNumber(),n=this._linesCollection.getEndLineNumber(),o=t;o<=n;o++){var r=this._linesCollection.getLine(o);r.onConfigurationChanged(e)}return!0},t.prototype.onLayoutChanged=function(e){return!0},t.prototype.onScrollChanged=function(e){return e.scrollTopChanged},t.prototype.onZonesChanged=function(){return!0},t.prototype.onModelFlushed=function(){var e=this;return this._linesCollection=new r(function(){return e._createLine()}),this._scrollDomNode=null,!0},t.prototype.onModelLinesDeleted=function(e){var t=this._linesCollection.onModelLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(var n=0,o=t.length;n<o;n++){var r=t[n].getDomNode();r&&this.domNode.domNode.removeChild(r)}return!0},t.prototype.onModelLineChanged=function(e){return this._linesCollection.onModelLineChanged(e.lineNumber)},t.prototype.onModelLinesInserted=function(e){var t=this._linesCollection.onModelLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(var n=0,o=t.length;n<o;n++){var r=t[n].getDomNode();r&&this.domNode.domNode.removeChild(r)}return!0},t.prototype.onModelTokensChanged=function(e){return this._linesCollection.onModelTokensChanged(e.fromLineNumber,e.toLineNumber)},t.prototype._renderLines=function(e){var t=this._linesCollection._get(),n={domNode:this.domNode.domNode,rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length,getInlineDecorationsForLineInViewport:function(t){return e.getInlineDecorationsForLineInViewport(t)},viewportTop:e.viewportTop,viewportHeight:e.viewportHeight,scrollDomNode:this._scrollDomNode,scrollDomNodeIsAbove:this._scrollDomNodeIsAbove},o=this._renderer.renderWithManyUpdates(n,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(o.rendLineNumberStart,o.lines),this._scrollDomNode=o.scrollDomNode,this._scrollDomNodeIsAbove=o.scrollDomNodeIsAbove},t.prototype._createDomNode=function(){var e=o.createFastDomNode(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e},t}(n.ViewPart);t.ViewLayer=i;var s=function(){function e(e,t){this._createLine=e,this._extraDomNodeHTML=t}return e.prototype.renderWithManyUpdates=function(e,t,n,o){return this._render(e,t,n,o)},e.prototype._render=function(e,t,n,o){var r={domNode:e.domNode,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength,getInlineDecorationsForLineInViewport:e.getInlineDecorationsForLineInViewport,viewportTop:e.viewportTop,viewportHeight:e.viewportHeight,scrollDomNode:e.scrollDomNode,scrollDomNodeIsAbove:e.scrollDomNodeIsAbove},i=!0;if(r.scrollDomNode){var s=this._getScrollDomNodeTime(r.scrollDomNode);(new Date).getTime()-s<1e3&&(i=!1)}if(i&&(r.rendLineNumberStart+r.linesLength-1<t||n<r.rendLineNumberStart)){r.rendLineNumberStart=t,r.linesLength=n-t+1,r.lines=[];for(var l=t;l<=n;l++)r.lines[l-t]=this._createLine();return this._finishRendering(r,!0,o),r.scrollDomNode=null,r}this._renderUntouchedLines(r,Math.max(t-r.rendLineNumberStart,0),Math.min(n-r.rendLineNumberStart,r.linesLength-1),o,t);var d,a,u;return r.rendLineNumberStart>t?(d=t,a=Math.min(n,r.rendLineNumberStart-1),d<=a&&(this._insertLinesBefore(r,d,a,o,t),r.linesLength+=a-d+1,r.scrollDomNode&&r.scrollDomNodeIsAbove&&(r.scrollDomNode.parentNode&&r.scrollDomNode.parentNode.removeChild(r.scrollDomNode),r.scrollDomNode=null))):r.rendLineNumberStart<t&&(u=Math.min(r.linesLength,t-r.rendLineNumberStart),u>0&&(this._removeLinesBefore(r,u),r.linesLength-=u)),r.rendLineNumberStart=t,r.rendLineNumberStart+r.linesLength-1<n?(d=r.rendLineNumberStart+r.linesLength,a=n,d<=a&&(this._insertLinesAfter(r,d,a,o,t),r.linesLength+=a-d+1,r.scrollDomNode&&!r.scrollDomNodeIsAbove&&(r.scrollDomNode.parentNode&&r.scrollDomNode.parentNode.removeChild(r.scrollDomNode),r.scrollDomNode=null))):r.rendLineNumberStart+r.linesLength-1>n&&(d=Math.max(0,n-r.rendLineNumberStart+1),a=r.linesLength-1,u=a-d+1,u>0&&(this._removeLinesAfter(r,u),r.linesLength-=u)),this._finishRendering(r,!1,o),r},e.prototype._renderUntouchedLines=function(e,t,n,o,r){var i,s;for(i=t;i<=n;i++){s=e.rendLineNumberStart+i;var l=e.lines[i].getDomNode();l&&e.lines[i].layoutLine(s,o[s-r])}},e.prototype._insertLinesBefore=function(e,t,n,o,r){var i,s,l=[];for(s=t;s<=n;s++)i=this._createLine(),l.push(i);e.lines=l.concat(e.lines)},e.prototype._getScrollDomNodeTime=function(e){var t=e.getAttribute("last-scroll-time");return t?parseInt(t,10):0},e.prototype._removeIfNotScrollDomNode=function(e,t,n){var o=this._getScrollDomNodeTime(t);if(!o)return void e.domNode.removeChild(t);if(e.scrollDomNode){var r=this._getScrollDomNodeTime(e.scrollDomNode);if(r>o)return void e.domNode.removeChild(t);e.scrollDomNode.parentNode&&e.scrollDomNode.parentNode.removeChild(e.scrollDomNode),e.scrollDomNode=null}e.scrollDomNode=t,e.scrollDomNodeIsAbove=n},e.prototype._removeLinesBefore=function(e,t){var n;for(n=0;n<t;n++){var o=e.lines[n].getDomNode();o&&this._removeIfNotScrollDomNode(e,o,!0)}e.lines.splice(0,t)},e.prototype._insertLinesAfter=function(e,t,n,o,r){var i,s,l=[];for(s=t;s<=n;s++)i=this._createLine(),l.push(i);e.lines=e.lines.concat(l)},e.prototype._removeLinesAfter=function(e,t){var n,o=e.linesLength-t;for(n=0;n<t;n++){var r=e.lines[o+n].getDomNode();r&&this._removeIfNotScrollDomNode(e,r,!1)}e.lines.splice(o,t)},e._resolveInlineDecorations=function(e){for(var t=[],n=0,o=e.linesLength;n<o;n++){var r=n+e.rendLineNumberStart;t[n]=e.getInlineDecorationsForLineInViewport(r)}return t},e.prototype._finishRenderingNewLines=function(e,t,n,o){var r=e.domNode.lastChild;t||!r?e.domNode.innerHTML=this._extraDomNodeHTML()+n.join(""):r.insertAdjacentHTML("afterend",n.join(""));for(var i=e.domNode.lastChild,s=e.linesLength-1;s>=0;s--){var l=e.lines[s];o[s]&&(l.setDomNode(i),i=i.previousSibling)}},e.prototype._finishRenderingInvalidLines=function(e,t,n){var o=document.createElement("div");o.innerHTML=t.join("");for(var r,i,s=0;s<e.linesLength;s++){var l=e.lines[s];n[s]&&(i=o.firstChild,r=l.getDomNode(),r.parentNode.replaceChild(i,r),l.setDomNode(i))}},e.prototype._finishRendering=function(t,n,o){var r,i,s,l,d=e._resolveInlineDecorations(t),a=!1,u=[],h=[],m=!1,c=[],N=[];for(r=0,i=t.linesLength;r<i;r++)if(s=t.lines[r],l=r+t.rendLineNumberStart,s.shouldUpdateHTML(t.rendLineNumberStart,l,d[r])){var L=s.getDomNode();L?(s.getLineOuterHTML(N,l,o[r]),c[r]=!0,m=!0):(s.getLineOuterHTML(h,l,o[r]),u[r]=!0,a=!0)}a&&this._finishRenderingNewLines(t,n,h,u),m&&this._finishRenderingInvalidLines(t,N,c)},e}()});