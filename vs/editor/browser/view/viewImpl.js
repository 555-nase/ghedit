var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define(["require","exports","vs/base/common/errors","vs/base/common/eventEmitter","vs/base/common/lifecycle","vs/base/common/timer","vs/base/browser/browser","vs/base/browser/dom","vs/base/browser/styleMutator","vs/editor/common/core/range","vs/editor/common/editorCommon","vs/editor/common/viewModel/viewEventHandler","vs/editor/browser/controller/keyboardHandler","vs/editor/browser/controller/pointerHandler","vs/editor/browser/editorBrowser","vs/editor/browser/view/viewController","vs/editor/browser/view/viewEventDispatcher","vs/editor/browser/view/viewOverlays","vs/editor/browser/viewLayout/layoutProvider","vs/editor/browser/viewParts/contentWidgets/contentWidgets","vs/editor/browser/viewParts/currentLineHighlight/currentLineHighlight","vs/editor/browser/viewParts/decorations/decorations","vs/editor/browser/viewParts/glyphMargin/glyphMargin","vs/editor/browser/viewParts/lineNumbers/lineNumbers","vs/editor/browser/viewParts/indentGuides/indentGuides","vs/editor/browser/viewParts/lines/viewLines","vs/editor/browser/viewParts/linesDecorations/linesDecorations","vs/editor/browser/viewParts/overlayWidgets/overlayWidgets","vs/editor/browser/viewParts/overviewRuler/decorationsOverviewRuler","vs/editor/browser/viewParts/overviewRuler/overviewRuler","vs/editor/browser/viewParts/rulers/rulers","vs/editor/browser/viewParts/scrollDecoration/scrollDecoration","vs/editor/browser/viewParts/selections/selections","vs/editor/browser/viewParts/viewCursors/viewCursors","vs/editor/browser/viewParts/viewZones/viewZones","vs/editor/common/view/viewContext"],function(e,t,i,o,r,s,n,a,d,l,u,h,c,v,w,p,f,m,g,y,V,_,b,E,A,C,D,P,x,N,R,T,O,H,S,I){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function L(e){try{return e()}catch(t){i.onUnexpectedError(t)}}function W(e,t){try{return e(t)}catch(o){i.onUnexpectedError(o)}}var F=function(e){function t(t,i,r,s,n){var a=this;e.call(this),this._isDisposed=!1,this._renderAnimationFrame=null,this.outgoingEventBus=new o.EventEmitter;var d=new p.ViewController(s,n,this.outgoingEventBus,i);this.listenersToRemove=[],this.listenersToDispose=[],this.eventDispatcher=new f.ViewEventDispatcher(function(e){return a._renderOnce(e)}),this.linesContent=document.createElement("div"),this.linesContent.className=w.ClassNames.LINES_CONTENT+" monaco-editor-background",this.domNode=document.createElement("div"),this.domNode.className=r.editor.viewInfo.editorClassName,this.overflowGuardContainer=document.createElement("div"),this.overflowGuardContainer.className=w.ClassNames.OVERFLOW_GUARD,this.layoutProvider=new g.LayoutProvider(r,s,this.eventDispatcher,this.linesContent,this.domNode,this.overflowGuardContainer),this.eventDispatcher.addEventHandler(this.layoutProvider),this._context=new I.ViewContext(r,s,this.eventDispatcher,function(e){return a.eventDispatcher.addEventHandler(e)},function(e){return a.eventDispatcher.removeEventHandler(e)}),this.createTextArea(t),this.createViewParts(),this.keyboardHandler=new c.KeyboardHandler(this._context,d,this.createKeyboardHandlerHelper()),this.pointerHandler=new v.PointerHandler(this._context,d,this.createPointerHandlerHelper()),this.hasFocus=!1,this.codeEditorHelper=null,this.eventDispatcher.addEventHandler(this),this.handleAccumulatedModelEventsTimeout=-1,this.accumulatedModelEvents=[],this.listenersToRemove.push(s.addBulkListener2(function(e){a.accumulatedModelEvents=a.accumulatedModelEvents.concat(e),a.handleAccumulatedModelEventsTimeout===-1&&(a.handleAccumulatedModelEventsTimeout=setTimeout(function(){a.handleAccumulatedModelEventsTimeout=-1,a._flushAnyAccumulatedEvents()}))}))}return __extends(t,e),t.prototype._flushAnyAccumulatedEvents=function(){var e=this.accumulatedModelEvents;this.accumulatedModelEvents=[],e.length>0&&this.eventDispatcher.emitMany(e)},t.prototype.createTextArea=function(e){var t=this;this.textArea=document.createElement("textarea"),this._keybindingService=e.createScoped(this.textArea),this._editorTextFocusContextKey=this._keybindingService.createKey(u.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS,void 0),this.textArea.className=w.ClassNames.TEXTAREA,this.textArea.setAttribute("wrap","off"),this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",this._context.configuration.editor.viewInfo.ariaLabel),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),d.StyleMutator.setTop(this.textArea,0),d.StyleMutator.setLeft(this.textArea,0),this.listenersToDispose.push(a.addDisposableListener(this.textArea,"focus",function(){return t._setHasFocus(!0)})),this.listenersToDispose.push(a.addDisposableListener(this.textArea,"blur",function(){return t._setHasFocus(!1)})),this.textAreaCover=document.createElement("div"),this._context.configuration.editor.viewInfo.glyphMargin?this.textAreaCover.className="monaco-editor-background "+w.ClassNames.GLYPH_MARGIN+" "+w.ClassNames.TEXTAREA_COVER:this._context.configuration.editor.viewInfo.lineNumbers?this.textAreaCover.className="monaco-editor-background "+w.ClassNames.LINE_NUMBERS+" "+w.ClassNames.TEXTAREA_COVER:this.textAreaCover.className="monaco-editor-background "+w.ClassNames.TEXTAREA_COVER,this.textAreaCover.style.position="absolute",d.StyleMutator.setWidth(this.textAreaCover,1),d.StyleMutator.setHeight(this.textAreaCover,1),d.StyleMutator.setTop(this.textAreaCover,0),d.StyleMutator.setLeft(this.textAreaCover,0)},t.prototype.createViewParts=function(){var e=this;this.viewParts=[],this.viewLines=new C.ViewLines(this._context,this.layoutProvider),this.viewZones=new S.ViewZones(this._context,this.layoutProvider),this.viewParts.push(this.viewZones);var t=new x.DecorationsOverviewRuler(this._context,this.layoutProvider.getScrollHeight(),function(t){return e.layoutProvider.getVerticalOffsetForLineNumber(t)});this.viewParts.push(t);var i=new T.ScrollDecorationViewPart(this._context);this.viewParts.push(i);var o=new m.ContentViewOverlays(this._context,this.layoutProvider);this.viewParts.push(o),o.addDynamicOverlay(new V.CurrentLineHighlightOverlay(this._context,this.layoutProvider)),o.addDynamicOverlay(new O.SelectionsOverlay(this._context)),o.addDynamicOverlay(new _.DecorationsOverlay(this._context)),o.addDynamicOverlay(new A.IndentGuidesOverlay(this._context));var r=new m.MarginViewOverlays(this._context,this.layoutProvider);this.viewParts.push(r),r.addDynamicOverlay(new b.GlyphMarginOverlay(this._context)),r.addDynamicOverlay(new D.LinesDecorationsOverlay(this._context)),r.addDynamicOverlay(new E.LineNumbersOverlay(this._context)),this.contentWidgets=new y.ViewContentWidgets(this._context,this.domNode),this.viewParts.push(this.contentWidgets);var s=new H.ViewCursors(this._context);this.viewParts.push(s),this.overlayWidgets=new P.ViewOverlayWidgets(this._context),this.viewParts.push(this.overlayWidgets);var n=new R.Rulers(this._context,this.layoutProvider);if(this.viewParts.push(n),this.linesContentContainer=this.layoutProvider.getScrollbarContainerDomNode(),this.linesContentContainer.style.position="absolute",t){var a=this.layoutProvider.getOverviewRulerInsertData();a.parent.insertBefore(t.getDomNode(),a.insertBefore)}this.linesContent.appendChild(o.getDomNode()),this.linesContent.appendChild(n.domNode),this.linesContent.appendChild(this.viewZones.domNode),this.linesContent.appendChild(this.viewLines.getDomNode()),this.linesContent.appendChild(this.contentWidgets.domNode),this.linesContent.appendChild(s.getDomNode()),this.overflowGuardContainer.appendChild(r.getDomNode()),this.overflowGuardContainer.appendChild(this.linesContentContainer),this.overflowGuardContainer.appendChild(i.getDomNode()),this.overflowGuardContainer.appendChild(this.overlayWidgets.domNode),this.overflowGuardContainer.appendChild(this.textArea),this.overflowGuardContainer.appendChild(this.textAreaCover),this.domNode.appendChild(this.overflowGuardContainer),this.domNode.appendChild(this.contentWidgets.overflowingContentWidgetsDomNode)},t.prototype._flushAccumulatedAndRenderNow=function(){this._flushAnyAccumulatedEvents(),this._renderNow()},t.prototype.createPointerHandlerHelper=function(){var e=this;return{viewDomNode:this.domNode,linesContentDomNode:this.linesContent,focusTextArea:function(){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.focusTextArea: View is disposed");e.focus()},isDirty:function(){return e.accumulatedModelEvents.length>0},getScrollLeft:function(){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getScrollLeft: View is disposed");return e.layoutProvider.getScrollLeft()},getScrollTop:function(){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getScrollTop: View is disposed");return e.layoutProvider.getScrollTop()},setScrollPosition:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.setScrollPosition: View is disposed");e.layoutProvider.setScrollPosition(t)},isAfterLines:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.isAfterLines: View is disposed");return e.layoutProvider.isAfterLines(t)},getLineNumberAtVerticalOffset:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getLineNumberAtVerticalOffset: View is disposed");return e.layoutProvider.getLineNumberAtVerticalOffset(t)},getVerticalOffsetForLineNumber:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getVerticalOffsetForLineNumber: View is disposed");return e.layoutProvider.getVerticalOffsetForLineNumber(t)},getWhitespaceAtVerticalOffset:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getWhitespaceAtVerticalOffset: View is disposed");return e.layoutProvider.getWhitespaceAtVerticalOffset(t)},shouldSuppressMouseDownOnViewZone:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.shouldSuppressMouseDownOnViewZone: View is disposed");return e.viewZones.shouldSuppressMouseDownOnViewZone(t)},getPositionFromDOMInfo:function(t,i){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getPositionFromDOMInfo: View is disposed");return e._flushAccumulatedAndRenderNow(),e.viewLines.getPositionFromDOMInfo(t,i)},visibleRangeForPosition2:function(t,i){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.visibleRangeForPosition2: View is disposed");e._flushAccumulatedAndRenderNow();var o=e.viewLines.visibleRangesForRange2(new l.Range(t,i,t,i),0);return o?o[0]:null},getLineWidth:function(t){if(e._isDisposed)throw new Error("ViewImpl.pointerHandler.getLineWidth: View is disposed");return e._flushAccumulatedAndRenderNow(),e.viewLines.getLineWidth(t)}}},t.prototype.createKeyboardHandlerHelper=function(){var e=this;return{viewDomNode:this.domNode,textArea:this.textArea,visibleRangeForPositionRelativeToEditor:function(t,i){if(e._isDisposed)throw new Error("ViewImpl.keyboardHandler.visibleRangeForPositionRelativeToEditor: View is disposed");e._flushAccumulatedAndRenderNow();var o=e.layoutProvider.getLinesViewportData(),r=e.viewLines.visibleRangesForRange2(new l.Range(t,i,t,i),o.visibleRangesDeltaTop);return r?r[0]:null},flushAnyAccumulatedEvents:function(){e._flushAnyAccumulatedEvents()}}},t.prototype.setAriaActiveDescendant=function(e){e?(this.textArea.setAttribute("role","combobox"),this.textArea.getAttribute("aria-activedescendant")!==e&&(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-activedescendant",e))):(this.textArea.setAttribute("role","textbox"),this.textArea.removeAttribute("aria-activedescendant"),this.textArea.removeAttribute("aria-haspopup"))},t.prototype.onLayoutChanged=function(e){if(n.isChrome){this.overflowGuardContainer.clientWidth+"px"}return d.StyleMutator.setWidth(this.domNode,e.width),d.StyleMutator.setHeight(this.domNode,e.height),d.StyleMutator.setWidth(this.overflowGuardContainer,e.width),d.StyleMutator.setHeight(this.overflowGuardContainer,e.height),d.StyleMutator.setWidth(this.linesContent,1e6),d.StyleMutator.setHeight(this.linesContent,1e6),d.StyleMutator.setLeft(this.linesContentContainer,e.contentLeft),d.StyleMutator.setWidth(this.linesContentContainer,e.contentWidth),d.StyleMutator.setHeight(this.linesContentContainer,e.contentHeight),this.outgoingEventBus.emit(u.EventType.ViewLayoutChanged,e),!1},t.prototype.onConfigurationChanged=function(e){return e.viewInfo.editorClassName&&(this.domNode.className=this._context.configuration.editor.viewInfo.editorClassName),e.viewInfo.ariaLabel&&this.textArea.setAttribute("aria-label",this._context.configuration.editor.viewInfo.ariaLabel),!1},t.prototype.onScrollChanged=function(e){return this.outgoingEventBus.emit("scroll",e),!1},t.prototype.onViewFocusChanged=function(e){return a.toggleClass(this.domNode,"focused",e),e?(this._editorTextFocusContextKey.set(!0),this.outgoingEventBus.emit(u.EventType.ViewFocusGained,{})):(this._editorTextFocusContextKey.reset(),this.outgoingEventBus.emit(u.EventType.ViewFocusLost,{})),!1},t.prototype.dispose=function(){this._isDisposed=!0,this.handleAccumulatedModelEventsTimeout!==-1&&(clearTimeout(this.handleAccumulatedModelEventsTimeout),this.handleAccumulatedModelEventsTimeout=-1),null!==this._renderAnimationFrame&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this.accumulatedModelEvents=[],this.eventDispatcher.removeEventHandler(this),this.outgoingEventBus.dispose(),this.listenersToRemove=r.dispose(this.listenersToRemove),this.listenersToDispose=r.dispose(this.listenersToDispose),this.keyboardHandler.dispose(),this.pointerHandler.dispose(),this.viewLines.dispose();for(var e=0,t=this.viewParts.length;e<t;e++)this.viewParts[e].dispose();this.viewParts=[],this.layoutProvider.dispose(),this._keybindingService.dispose()},t.prototype.getCodeEditorHelper=function(){var e=this;return this.codeEditorHelper||(this.codeEditorHelper={getScrollWidth:function(){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getScrollWidth: View is disposed");return e.layoutProvider.getScrollWidth()},getScrollLeft:function(){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getScrollLeft: View is disposed");return e.layoutProvider.getScrollLeft()},getScrollHeight:function(){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getScrollHeight: View is disposed");return e.layoutProvider.getScrollHeight()},getScrollTop:function(){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getScrollTop: View is disposed");return e.layoutProvider.getScrollTop()},setScrollPosition:function(t){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.setScrollPosition: View is disposed");e.layoutProvider.setScrollPosition(t)},getVerticalOffsetForPosition:function(t,i){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getVerticalOffsetForPosition: View is disposed");var o=e._context.model.validateModelPosition({lineNumber:t,column:i}),r=e._context.model.convertModelPositionToViewPosition(o.lineNumber,o.column);return e.layoutProvider.getVerticalOffsetForLineNumber(r.lineNumber)},delegateVerticalScrollbarMouseDown:function(t){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.delegateVerticalScrollbarMouseDown: View is disposed");e.layoutProvider.delegateVerticalScrollbarMouseDown(t)},getOffsetForColumn:function(t,i){if(e._isDisposed)throw new Error("ViewImpl.codeEditorHelper.getOffsetForColumn: View is disposed");var o=e._context.model.validateModelPosition({lineNumber:t,column:i}),r=e._context.model.convertModelPositionToViewPosition(o.lineNumber,o.column);e._flushAccumulatedAndRenderNow();var s=e.viewLines.visibleRangesForRange2(new l.Range(r.lineNumber,r.column,r.lineNumber,r.column),0);return s?s[0].left:-1}}),this.codeEditorHelper},t.prototype.getCenteredRangeInViewport=function(){if(this._isDisposed)throw new Error("ViewImpl.getCenteredRangeInViewport: View is disposed");var e=this.layoutProvider.getCenteredViewLineNumberInViewport(),t=this._context.model,i=new l.Range(e,1,e,t.getLineMaxColumn(e));return t.convertViewRangeToModelRange(i)},t.prototype.getVisibleRangeInViewport=function(){if(this._isDisposed)throw new Error("ViewImpl.getVisibleRangeInViewport: View is disposed");var e=this.layoutProvider.getLinesViewportData().visibleRange;return this._context.model.convertViewRangeToModelRange(e)},t.prototype.getInternalEventBus=function(){if(this._isDisposed)throw new Error("ViewImpl.getInternalEventBus: View is disposed");return this.outgoingEventBus},t.prototype.saveState=function(){if(this._isDisposed)throw new Error("ViewImpl.saveState: View is disposed");return this.layoutProvider.saveState()},t.prototype.restoreState=function(e){if(this._isDisposed)throw new Error("ViewImpl.restoreState: View is disposed");return this._flushAnyAccumulatedEvents(),this.layoutProvider.restoreState(e)},t.prototype.focus=function(){if(this._isDisposed)throw new Error("ViewImpl.focus: View is disposed");this.keyboardHandler.focusTextArea(),this._setHasFocus(!0)},t.prototype.isFocused=function(){if(this._isDisposed)throw new Error("ViewImpl.isFocused: View is disposed");return this.hasFocus},t.prototype.createOverviewRuler=function(e,t,i){var o=this;if(this._isDisposed)throw new Error("ViewImpl.createOverviewRuler: View is disposed");return new N.OverviewRuler(this._context,e,this.layoutProvider.getScrollHeight(),t,i,function(e){return o.layoutProvider.getVerticalOffsetForLineNumber(e)})},t.prototype.change=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.change: View is disposed");var i=!1;return this._renderOnce(function(){t._flushAnyAccumulatedEvents();var o={addZone:function(e){return i=!0,t.viewZones.addZone(e)},removeZone:function(e){i=t.viewZones.removeZone(e)||i},layoutZone:function(e){i=t.viewZones.layoutZone(e)||i}},r=W(e,o);return o.addZone=null,o.removeZone=null,i&&t._context.privateViewEventBus.emit(u.EventType.ViewZonesChanged,null),r}),i},t.prototype.getWhitespaces=function(){if(this._isDisposed)throw new Error("ViewImpl.getWhitespaces: View is disposed");return this.layoutProvider.getWhitespaces()},t.prototype.addContentWidget=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.addContentWidget: View is disposed");this._renderOnce(function(){t.contentWidgets.addWidget(e.widget),t.layoutContentWidget(e)})},t.prototype.layoutContentWidget=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.layoutContentWidget: View is disposed");this._renderOnce(function(){var i=e.position?e.position.position:null,o=e.position?e.position.preference:null;t.contentWidgets.setWidgetPosition(e.widget,i,o)})},t.prototype.removeContentWidget=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.removeContentWidget: View is disposed");this._renderOnce(function(){t.contentWidgets.removeWidget(e.widget)})},t.prototype.addOverlayWidget=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.addOverlayWidget: View is disposed");this._renderOnce(function(){t.overlayWidgets.addWidget(e.widget),t.layoutOverlayWidget(e)})},t.prototype.layoutOverlayWidget=function(e){if(this._isDisposed)throw new Error("ViewImpl.layoutOverlayWidget: View is disposed");var t=e.position?e.position.preference:null,i=this.overlayWidgets.setWidgetPosition(e.widget,t);i&&this._scheduleRender()},t.prototype.removeOverlayWidget=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl.removeOverlayWidget: View is disposed");this._renderOnce(function(){t.overlayWidgets.removeWidget(e.widget)})},t.prototype.render=function(e,t){if(this._isDisposed)throw new Error("ViewImpl.render: View is disposed");t&&this.layoutProvider.emitLayoutChangedEvent(),e&&this._flushAccumulatedAndRenderNow()},t.prototype.renderOnce=function(e){if(this._isDisposed)throw new Error("ViewImpl.renderOnce: View is disposed");return this._renderOnce(e)},t.prototype._renderOnce=function(e){var t=this;if(this._isDisposed)throw new Error("ViewImpl._renderOnce: View is disposed");return this.outgoingEventBus.deferredEmit(function(){var i=L(e);return t._scheduleRender(),i})},t.prototype._scheduleRender=function(){if(this._isDisposed)throw new Error("ViewImpl._scheduleRender: View is disposed");null===this._renderAnimationFrame&&(this._renderAnimationFrame=a.runAtThisOrScheduleAtNextAnimationFrame(this._onRenderScheduled.bind(this),100))},t.prototype._onRenderScheduled=function(){this._renderAnimationFrame=null,this._flushAccumulatedAndRenderNow()},t.prototype._renderNow=function(){var e=this;L(function(){return e._actualRender()})},t.prototype.createRenderingContext=function(e){var t=this,i=this.layoutProvider.getCurrentViewport(),o=e.visibleRangesDeltaTop,r={linesViewportData:e,scrollWidth:this.layoutProvider.getScrollWidth(),scrollHeight:this.layoutProvider.getScrollHeight(),visibleRange:e.visibleRange,bigNumbersDelta:e.bigNumbersDelta,viewportWidth:i.width,viewportHeight:i.height,viewportLeft:i.left,viewportTop:i.top,getScrolledTopFromAbsoluteTop:function(e){return t.layoutProvider.getScrolledTopFromAbsoluteTop(e)},getViewportVerticalOffsetForLineNumber:function(e){var i=t.layoutProvider.getVerticalOffsetForLineNumber(e),o=t.layoutProvider.getScrolledTopFromAbsoluteTop(i);return o},getDecorationsInViewport:function(){return e.getDecorationsInViewport()},linesVisibleRangesForRange:function(e,i){return t.viewLines.linesVisibleRangesForRange(e,i)},visibleRangeForPosition:function(e){var i=t.viewLines.visibleRangesForRange2(new l.Range(e.lineNumber,e.column,e.lineNumber,e.column),o);return i?i[0]:null},lineIsVisible:function(t){return e.visibleRange.startLineNumber<=t&&t<=e.visibleRange.endLineNumber}};return r},t.prototype._getViewPartsToRender=function(){for(var e=[],t=0,i=this.viewParts.length;t<i;t++){var o=this.viewParts[t];o.shouldRender()&&e.push(o)}return e},t.prototype._actualRender=function(){var e=this;if(a.isInDOM(this.domNode)){var t=s.start(s.Topic.EDITOR,"View.render"),i=this._getViewPartsToRender();if(!this.viewLines.shouldRender()&&0===i.length)return this.keyboardHandler.writeToTextArea(),void t.stop();var o=this.layoutProvider.getLinesViewportData();this.viewLines.shouldRender()?(this.viewLines.renderText(o,function(){e.keyboardHandler.writeToTextArea()}),this.viewLines.onDidRender(),i=this._getViewPartsToRender()):this.keyboardHandler.writeToTextArea();for(var r=this.createRenderingContext(o),n=0,d=i.length;n<d;n++){var l=i[n];l.prepareRender(r)}for(var n=0,d=i.length;n<d;n++){var l=i[n];l.render(r),l.onDidRender()}this.layoutProvider.renderScrollbar(),t.stop()}},t.prototype._setHasFocus=function(e){this.hasFocus!==e&&(this.hasFocus=e,this._context.privateViewEventBus.emit(u.EventType.ViewFocusChanged,this.hasFocus))},t}(h.ViewEventHandler);t.View=F});