define(["require","exports","vs/base/common/async","vs/base/common/errors"],function(t,e,s,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var i;!function(t){t[t.IDLE=0]="IDLE",t[t.FIRST_WAIT=1]="FIRST_WAIT",t[t.SECOND_WAIT=2]="SECOND_WAIT",t[t.WAITING_FOR_ASYNC_COMPUTATION=3]="WAITING_FOR_ASYNC_COMPUTATION"}(i||(i={}));var n=function(){function t(t,e,o,n){var r=this;this._computer=t,this._state=i.IDLE,this._firstWaitScheduler=new s.RunOnceScheduler(function(){return r._triggerAsyncComputation()},this._getHoverTimeMillis()/2),this._secondWaitScheduler=new s.RunOnceScheduler(function(){return r._triggerSyncComputation()},this._getHoverTimeMillis()/2),this._loadingMessageScheduler=new s.RunOnceScheduler(function(){return r._showLoadingMessage()},3*this._getHoverTimeMillis()),this._asyncComputationPromise=null,this._asyncComputationPromiseDone=!1,this._completeCallback=e,this._errorCallback=o,this._progressCallback=n}return t.prototype.getComputer=function(){return this._computer},t.prototype._getHoverTimeMillis=function(){return this._computer.getHoverTimeMillis?this._computer.getHoverTimeMillis():t.HOVER_TIME},t.prototype._triggerAsyncComputation=function(){var t=this;this._state=i.SECOND_WAIT,this._secondWaitScheduler.schedule(),this._computer.computeAsync?(this._asyncComputationPromiseDone=!1,this._asyncComputationPromise=this._computer.computeAsync().then(function(e){t._asyncComputationPromiseDone=!0,t._withAsyncResult(e)},function(){return t._onError})):this._asyncComputationPromiseDone=!0},t.prototype._triggerSyncComputation=function(){this._computer.computeSync&&this._computer.onResult(this._computer.computeSync(),!0),this._asyncComputationPromiseDone?(this._state=i.IDLE,this._onComplete(this._computer.getResult())):(this._state=i.WAITING_FOR_ASYNC_COMPUTATION,this._onProgress(this._computer.getResult()))},t.prototype._showLoadingMessage=function(){this._state===i.WAITING_FOR_ASYNC_COMPUTATION&&this._onProgress(this._computer.getResultWithLoadingMessage())},t.prototype._withAsyncResult=function(t){t&&this._computer.onResult(t,!1),this._state===i.WAITING_FOR_ASYNC_COMPUTATION&&(this._state=i.IDLE,this._onComplete(this._computer.getResult()))},t.prototype._onComplete=function(t){this._completeCallback&&this._completeCallback(t)},t.prototype._onError=function(t){this._errorCallback?this._errorCallback(t):o.onUnexpectedError(t)},t.prototype._onProgress=function(t){this._progressCallback&&this._progressCallback(t)},t.prototype.start=function(){this._state===i.IDLE&&(this._state=i.FIRST_WAIT,this._firstWaitScheduler.schedule(),this._loadingMessageScheduler.schedule())},t.prototype.cancel=function(){this._loadingMessageScheduler.cancel(),this._state===i.FIRST_WAIT&&this._firstWaitScheduler.cancel(),this._state===i.SECOND_WAIT&&(this._secondWaitScheduler.cancel(),this._asyncComputationPromise&&(this._asyncComputationPromise.cancel(),this._asyncComputationPromise=null)),this._state===i.WAITING_FOR_ASYNC_COMPUTATION&&this._asyncComputationPromise&&(this._asyncComputationPromise.cancel(),this._asyncComputationPromise=null),this._state=i.IDLE},t.HOVER_TIME=300,t}();e.HoverOperation=n});