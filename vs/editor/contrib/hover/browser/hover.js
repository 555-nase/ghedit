/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var d=t.length-1;d>=0;d--)(i=t[d])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},__param=this&&this.__param||function(t,e){return function(o,n){e(o,n,t)}};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/platform","vs/base/common/winjs.base","vs/platform/opener/common/opener","vs/editor/common/services/modeService","vs/platform/keybinding/common/keybinding","vs/editor/common/core/range","vs/editor/common/editorAction","vs/editor/common/editorActionEnablement","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/browser/editorBrowserExtensions","./modesContentHover","./modesGlyphHover","vs/base/common/lifecycle","vs/css!./hover"],function(t,e,o,n,i,r,s,d,h,c,a,g,_,u,p,l,y,v){"use strict";var m=function(){function t(t,e,o){var n=this;this._editor=t,this._toUnhook=[],t.getConfiguration().contribInfo.hover&&(this._toUnhook.push(this._editor.onMouseDown(function(t){return n._onEditorMouseDown(t)})),this._toUnhook.push(this._editor.onMouseMove(function(t){return n._onEditorMouseMove(t)})),this._toUnhook.push(this._editor.onMouseLeave(function(t){return n._hideWidgets()})),this._toUnhook.push(this._editor.onKeyDown(function(t){return n._onKeyDown(t)})),this._toUnhook.push(this._editor.onDidChangeModel(function(){return n._hideWidgets()})),this._toUnhook.push(this._editor.onDidChangeModelDecorations(function(){return n._onModelDecorationsChanged()})),this._toUnhook.push(this._editor.onDidScrollChange(function(t){(t.scrollTopChanged||t.scrollLeftChanged)&&n._hideWidgets()})),this._contentWidget=new l.ModesContentHoverWidget(t,e,o),this._glyphWidget=new y.ModesGlyphHoverWidget(t))}return t.getModesHoverController=function(e){return e.getContribution(t.ID)},t.prototype._onModelDecorationsChanged=function(){this._contentWidget.onModelDecorationsChanged(),this._glyphWidget.onModelDecorationsChanged()},t.prototype._onEditorMouseDown=function(t){var e=t.target.type;e===_.MouseTargetType.CONTENT_WIDGET&&t.target.detail===l.ModesContentHoverWidget.ID||e===_.MouseTargetType.OVERLAY_WIDGET&&t.target.detail===y.ModesGlyphHoverWidget.ID||this._hideWidgets()},t.prototype._onEditorMouseMove=function(t){var e=t.target.type,o=i.isMacintosh?"metaKey":"ctrlKey";(e!==_.MouseTargetType.CONTENT_WIDGET||t.target.detail!==l.ModesContentHoverWidget.ID||t.event[o])&&(e!==_.MouseTargetType.OVERLAY_WIDGET||t.target.detail!==y.ModesGlyphHoverWidget.ID||t.event[o])&&(this._editor.getConfiguration().contribInfo.hover&&e===_.MouseTargetType.CONTENT_TEXT?(this._glyphWidget.hide(),this._contentWidget.startShowingAt(t.target.range,!1)):e===_.MouseTargetType.GUTTER_GLYPH_MARGIN?(this._contentWidget.hide(),this._glyphWidget.startShowingAt(t.target.position.lineNumber)):this._hideWidgets())},t.prototype._onKeyDown=function(t){var e=i.isMacintosh?n.KeyCode.Meta:n.KeyCode.Ctrl;t.keyCode!==e&&this._hideWidgets()},t.prototype._hideWidgets=function(){this._glyphWidget.hide(),this._contentWidget.hide()},t.prototype.showContentHover=function(t,e){this._contentWidget.startShowingAt(t,e)},t.prototype.getId=function(){return t.ID},t.prototype.dispose=function(){this._toUnhook=v.dispose(this._toUnhook),this._glyphWidget&&(this._glyphWidget.dispose(),this._glyphWidget=null),this._contentWidget&&(this._contentWidget.dispose(),this._contentWidget=null)},t.ID="editor.contrib.hover",t=__decorate([__param(1,s.IOpenerService),__param(2,d.IModeService)],t)}(),f=function(t){function e(e,o){t.call(this,e,o,g.Behaviour.TextFocus)}return __extends(e,t),e.prototype.run=function(){var t=this.editor.getPosition(),e=new c.Range(t.lineNumber,t.column,t.lineNumber,t.column);return this.editor.getContribution(m.ID).showContentHover(e,!0),r.TPromise.as(null)},e.ID="editor.action.showHover",e}(a.EditorAction);p.EditorBrowserRegistry.registerEditorContribution(m),u.CommonEditorRegistry.registerEditorAction(new u.EditorActionDescriptor(f,f.ID,o.localize("showHover","Show Hover"),{context:u.ContextKey.EditorTextFocus,kbExpr:h.KbExpr.has(_.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),primary:n.KeyMod.chord(n.KeyMod.CtrlCmd|n.KeyCode.KEY_K,n.KeyMod.CtrlCmd|n.KeyCode.KEY_I)},"Show Hover"))});