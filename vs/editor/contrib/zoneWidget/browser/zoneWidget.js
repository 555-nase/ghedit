/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/lifecycle","vs/base/common/objects","vs/base/browser/dom","vs/base/browser/ui/sash/sash","vs/editor/common/core/range","vs/css!./zoneWidget"],function(t,e,o,i,n,s,r){"use strict";var h={showArrow:!0,showFrame:!0,frameColor:"",className:""},d="vs.editor.contrib.zoneWidget",a=function(){function t(t,e,o,i,n,s){this.domNode=t,this.afterLineNumber=e,this.afterColumn=o,this.heightInLines=i,this._onDomNodeTop=n,this._onComputedHeight=s}return t.prototype.onDomNodeTop=function(t){this._onDomNodeTop(t)},t.prototype.onComputedHeight=function(t){this._onComputedHeight(t)},t}();e.ViewZoneDelegate=a;var l=function(){function t(t,e){this._id=t,this._domNode=e}return t.prototype.getId=function(){return this._id},t.prototype.getDomNode=function(){return this._domNode},t.prototype.getPosition=function(){return null},t}();e.OverlayWidgetDelegate=l;var u=function(){function t(t,e){var n=this;void 0===e&&(e={}),this._viewZone=null,this._overlayWidget=null,this._disposables=new o.Disposables,this.container=null,this.editor=t,this.options=i.mixin(i.clone(h),e),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(function(t){var e=n._getWidth(t);n.domNode.style.width=e+"px",n._onWidth(e)}))}return t.prototype.create=function(){n.addClass(this.domNode,"zone-widget"),n.addClass(this.domNode,this.options.className),this.container=document.createElement("div"),n.addClass(this.container,"zone-widget-container"),this.domNode.appendChild(this.container),this._fillContainer(this.container),this._initSash()},t.prototype._getWidth=function(t){return void 0===t&&(t=this.editor.getLayoutInfo()),t.width-t.verticalScrollbarWidth},t.prototype._onViewZoneTop=function(t){this.domNode.style.top=t+"px"},t.prototype._onViewZoneHeight=function(t){this.domNode.style.height=t+"px";var e=t-this._decoratingElementsHeight();this.container.style.height=e+"px",this._doLayout(e,this._getWidth()),this._resizeSash.layout()},t.prototype.show=function(t,e){var o=r.Range.isIRange(t)?t:new r.Range(t.lineNumber,t.column,t.lineNumber,t.column);this._showImpl(o,e)},t.prototype._decoratingElementsHeight=function(){var t=this.editor.getConfiguration().lineHeight,e=0;if(this.options.showArrow){var o=Math.round(t/3);e+=2*o}if(this.options.showFrame){var i=Math.round(t/9);e+=2*i}return e},t.prototype._showImpl=function(t,e){var o=this,i={lineNumber:t.startLineNumber,column:t.startColumn},n=this._getWidth();this.domNode.style.width=n+"px",this.editor.revealPosition(i);var s=document.createElement("div"),r=document.createElement("div"),h=this.editor.getConfiguration().lineHeight,u=0,p=0;this.options.showArrow&&(u=Math.round(h/3),r=document.createElement("div"),r.className="zone-widget-arrow below",r.style.top=-u+"px",r.style.borderWidth=u+"px",r.style.left=this.editor.getOffsetForColumn(i.lineNumber,i.column)+"px",r.style.borderBottomColor=this.options.frameColor,s.appendChild(r)),this.options.showFrame&&(p=Math.round(h/9)),this.editor.changeViewZones(function(t){o._viewZone&&t.removeZone(o._viewZone.id),o._overlayWidget&&(o.editor.removeOverlayWidget(o._overlayWidget),o._overlayWidget=null),o.domNode.style.top="-1000px",o._viewZone=new a(s,i.lineNumber,i.column,e,function(t){return o._onViewZoneTop(t)},function(t){return o._onViewZoneHeight(t)}),o._viewZone.id=t.addZone(o._viewZone),o._overlayWidget=new l(d+o._viewZone.id,o.domNode),o.editor.addOverlayWidget(o._overlayWidget)}),this.options.showFrame&&(this.container.style.borderTopColor=this.options.frameColor,this.container.style.borderBottomColor=this.options.frameColor,this.container.style.borderTopWidth=p+"px",this.container.style.borderBottomWidth=p+"px");var c=e*h-this._decoratingElementsHeight();this.container.style.top=u+"px",this.container.style.height=c+"px",this.container.style.overflow="hidden",this._doLayout(c,n),this.editor.setSelection(t);var m=Math.min(this.editor.getModel().getLineCount(),Math.max(1,t.endLineNumber+1));this.editor.revealLine(m),this.position=i},t.prototype.dispose=function(){var t=this;this._disposables.dispose(),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(function(e){e.removeZone(t._viewZone.id),t._viewZone=null})},t.prototype._onWidth=function(t){},t.prototype._doLayout=function(t,e){},t.prototype._initSash=function(){var t=this;this._resizeSash=new s.Sash(this.domNode,this,{orientation:s.Orientation.HORIZONTAL}),this.options.isResizeable||(this._resizeSash.hide(),this._resizeSash.disable());var e;this._disposables.add(this._resizeSash.addListener2("start",function(o){t._viewZone&&(e={startY:o.startY,heightInLines:t._viewZone.heightInLines})})),this._disposables.add(this._resizeSash.addListener2("end",function(){e=void 0})),this._disposables.add(this._resizeSash.addListener2("change",function(o){if(e){var i=(o.currentY-e.startY)/t.editor.getConfiguration().lineHeight,n=i<0?Math.ceil(i):Math.floor(i),s=e.heightInLines+n;s>5&&s<35&&t.editor.changeViewZones(function(e){t._viewZone.heightInLines=s,e.layoutZone(t._viewZone.id)})}}))},t.prototype.getHorizontalSashLeft=function(){return 0},t.prototype.getHorizontalSashTop=function(){return parseInt(this.domNode.style.height)-this._decoratingElementsHeight()/2},t.prototype.getHorizontalSashWidth=function(){return this.editor.getLayoutInfo().width},t}();e.ZoneWidget=u});