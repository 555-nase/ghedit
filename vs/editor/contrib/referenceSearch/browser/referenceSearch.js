var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/uri","vs/base/common/winjs.base","vs/platform/editor/common/editor","vs/platform/instantiation/common/instantiation","vs/platform/keybinding/common/keybinding","vs/platform/keybinding/common/keybindingsRegistry","vs/editor/common/core/position","vs/editor/common/core/range","vs/editor/common/editorAction","vs/editor/common/editorActionEnablement","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/common/modes","vs/editor/contrib/zoneWidget/browser/peekViewWidget","../common/referenceSearch","./referencesWidget","./referencesController","./referencesModel"],function(e,t,r,o,n,i,s,c,a,d,l,m,f,g,p,u,h,y,v,R,b,E){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function w(e,t){var r=y.getOuterEditor(e,t);if(r){var o=b.ReferencesController.getController(r);o.closeWidget()}}var C={getMetaTitle:function(e){return e.references.length>1&&r.localize("meta.titleReference"," â€“ {0} references",e.references.length)}},K=function(e){function t(t,o,n,i){e.call(this,t,o,g.Behaviour.WidgetFocus|g.Behaviour.UpdateOnCursorPositionChange),this.label=r.localize("references.action.label","Find All References"),this.peekViewService=i,this.peekViewService&&n.createKey(this.peekViewService.contextKey,!0)}return __extends(t,e),t.prototype.isSupported=function(){return h.ReferenceProviderRegistry.has(this.editor.getModel())&&e.prototype.isSupported.call(this)},t.prototype.getEnablementState=function(){return(!this.peekViewService||!this.peekViewService.isActive)&&h.ReferenceProviderRegistry.has(this.editor.getModel())},t.prototype.run=function(){var e=this.editor.getSelection(),t=this.editor.getModel(),r=v.provideReferences(t,e.getStartPosition()).then(function(e){return new E.ReferencesModel(e)}),o=b.ReferencesController.getController(this.editor);return i.TPromise.as(o.toggleWidget(e,r,C)).then(function(){return!0})},t.ID="editor.action.referenceSearch.trigger",t=__decorate([__param(2,a.IKeybindingService),__param(3,c.optional(y.IPeekViewService))],t)}(f.EditorAction);t.ReferenceAction=K;var S=function(e,t,r){if(!(t instanceof n["default"]))throw new Error("illegal argument, uri");if(!r)throw new Error("illega argument, position");return e.get(s.IEditorService).openEditor({resource:t}).then(function(e){var t=e.getControl();if(t&&"function"==typeof t.getEditorType){var o=v.provideReferences(t.getModel(),l.Position.lift(r)).then(function(e){return new E.ReferencesModel(e)}),n=b.ReferencesController.getController(t),s=new m.Range(r.lineNumber,r.column,r.lineNumber,r.column);return i.TPromise.as(n.toggleWidget(s,o,C))}})},_=function(e,t,r,o){if(!(t instanceof n["default"]))throw new Error("illegal argument, uri expected");return e.get(s.IEditorService).openEditor({resource:t}).then(function(e){var t=e.getControl();if(t&&"function"==typeof t.getEditorType){var n=b.ReferencesController.getController(t);return i.TPromise.as(n.toggleWidget(new m.Range(r.lineNumber,r.column,r.lineNumber,r.column),i.TPromise.as(new E.ReferencesModel(o)),C)).then(function(){return!0})}})};u.CommonEditorRegistry.registerEditorAction({ctor:K,id:K.ID,label:r.localize("references.action.name","Find All References"),alias:"Find All References",kbOpts:{context:u.ContextKey.EditorTextFocus,primary:o.KeyMod.Shift|o.KeyCode.F12},menuOpts:{kbExpr:a.KbExpr.has(p.ModeContextKeys.hasReferenceProvider),group:"navigation",order:1.3}}),d.KeybindingsRegistry.registerCommandDesc({id:"editor.action.findReferences",handler:S,weight:u.CommonEditorRegistry.commandWeight(50),when:null,primary:void 0}),d.KeybindingsRegistry.registerCommandDesc({id:"editor.action.showReferences",handler:_,weight:u.CommonEditorRegistry.commandWeight(50),when:null,primary:void 0,description:{description:"Show references at a position in a file",args:[{name:"uri",description:"The text document in which to show references",constraint:n["default"]},{name:"position",description:"The position at which to show",constraint:l.Position.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array}]}}),d.KeybindingsRegistry.registerCommandDesc({id:"closeReferenceSearch",weight:u.CommonEditorRegistry.commandWeight(50),primary:o.KeyCode.Escape,secondary:[o.KeyMod.Shift|o.KeyCode.Escape],when:a.KbExpr.and(a.KbExpr.has(b.ctxReferenceSearchVisible),a.KbExpr.not("config.editor.stablePeek")),handler:w}),d.KeybindingsRegistry.registerCommandDesc({id:"closeReferenceSearchEditor",weight:u.CommonEditorRegistry.commandWeight(-101),primary:o.KeyCode.Escape,secondary:[o.KeyMod.Shift|o.KeyCode.Escape],when:a.KbExpr.and(a.KbExpr.has(R.ReferenceWidget.INNER_EDITOR_CONTEXT_KEY),a.KbExpr.not("config.editor.stablePeek")),handler:w})});