{"version":3,"file":"vs/editor/contrib/snippet/common/snippet.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/editor/contrib/snippet/common/snippet.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport * as collections from 'vs/base/common/collections';\nimport {ListenerUnbind} from 'vs/base/common/eventEmitter';\nimport {KeyCode, KeyMod} from 'vs/base/common/keyCodes';\nimport * as strings from 'vs/base/common/strings';\nimport {IKeybindingContextKey, IKeybindingService} from 'vs/platform/keybinding/common/keybindingService';\nimport {EditOperation} from 'vs/editor/common/core/editOperation';\nimport {Range} from 'vs/editor/common/core/range';\nimport {Selection} from 'vs/editor/common/core/selection';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {CommonEditorRegistry} from 'vs/editor/common/editorCommonExtensions';\n\ninterface IParsedLinePlaceHolderInfo {\n\tid: string;\n\tvalue: string;\n\tstartColumn: number;\n\tendColumn: number;\n}\n\ninterface IParsedLine {\n\tline: string;\n\tplaceHolders: IParsedLinePlaceHolderInfo[];\n}\n\nexport interface IPlaceHolder {\n\tid: string;\n\tvalue: string;\n\toccurences: editorCommon.IRange[];\n}\n\nexport interface IIndentationNormalizer {\n\tnormalizeIndentation(str:string): string;\n}\n\nexport interface ICodeSnippet {\n\tlines:string[];\n\tplaceHolders:IPlaceHolder[];\n\tstartPlaceHolderIndex:number;\n\tfinishPlaceHolderIndex:number;\n}\n\nexport enum ExternalSnippetType {\n\tTextMateSnippet,\n\tEmmetSnippet\n}\n\nexport class CodeSnippet implements ICodeSnippet {\n\n\tprivate _lastGeneratedId: number;\n\tpublic lines:string[];\n\tpublic placeHolders:IPlaceHolder[];\n\tpublic startPlaceHolderIndex:number;\n\tpublic finishPlaceHolderIndex:number;\n\n\tconstructor(snippetTemplate:string) {\n\t\tthis.lines = [];\n\t\tthis.placeHolders = [];\n\t\tthis._lastGeneratedId = 0;\n\t\tthis.startPlaceHolderIndex = 0;\n\t\tthis.finishPlaceHolderIndex = -1;\n\n\t\tthis.parseTemplate(snippetTemplate);\n\t}\n\n\tprivate parseTemplate(template: string): void {\n\n\t\tvar placeHoldersMap: collections.IStringDictionary<IPlaceHolder> = {};\n\t\tvar i: number, len: number, j: number, lenJ: number, templateLines = template.split('\\n');\n\n\t\tfor (i = 0, len = templateLines.length; i < len; i++) {\n\t\t\tvar parsedLine = this.parseLine(templateLines[i], (id:string) => {\n\t\t\t\tif (collections.contains(placeHoldersMap, id)) {\n\t\t\t\t\treturn placeHoldersMap[id].value;\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t});\n\t\t\tfor (j = 0, lenJ = parsedLine.placeHolders.length; j < lenJ; j++) {\n\t\t\t\tvar linePlaceHolder = parsedLine.placeHolders[j];\n\t\t\t\tvar occurence = new Range(i + 1, linePlaceHolder.startColumn, i + 1, linePlaceHolder.endColumn);\n\t\t\t\tvar placeHolder: IPlaceHolder;\n\n\t\t\t\tif (collections.contains(placeHoldersMap, linePlaceHolder.id)) {\n\t\t\t\t\tplaceHolder = placeHoldersMap[linePlaceHolder.id];\n\t\t\t\t} else {\n\t\t\t\t\tplaceHolder = {\n\t\t\t\t\t\tid: linePlaceHolder.id,\n\t\t\t\t\t\tvalue: linePlaceHolder.value,\n\t\t\t\t\t\toccurences: []\n\t\t\t\t\t};\n\t\t\t\t\tthis.placeHolders.push(placeHolder);\n\t\t\t\t\tif (linePlaceHolder.value === '') {\n\t\t\t\t\t\tthis.finishPlaceHolderIndex = this.placeHolders.length - 1;\n\t\t\t\t\t}\n\t\t\t\t\tplaceHoldersMap[linePlaceHolder.id] = placeHolder;\n\t\t\t\t}\n\n\t\t\t\tplaceHolder.occurences.push(occurence);\n\t\t\t}\n\n\t\t\tthis.lines.push(parsedLine.line);\n\t\t}\n\n\t\tif (this.placeHolders.length > this.startPlaceHolderIndex) {\n\t\t\tvar startPlaceHolder = this.placeHolders[this.startPlaceHolderIndex];\n\t\t\tif (startPlaceHolder.value === '' && startPlaceHolder.id === '') {\n\t\t\t\t// Do not start at an empty placeholder if possible\n\t\t\t\tif (this.placeHolders.length > 1) {\n\t\t\t\t\tthis.startPlaceHolderIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate parseLine(line:string, findDefaultValueForId:(id:string)=>string) : IParsedLine {\n\n\t\t// Placeholder 0 is the entire line\n\t\tvar placeHolderStack: { placeHolderId: string; placeHolderText: string; }[] = [{ placeHolderId: '', placeHolderText: '' }];\n\t\tvar placeHolders: IParsedLinePlaceHolderInfo[] = [];\n\n\t\tvar i = 0;\n\t\tvar len = line.length;\n\t\tvar resultIndex = 0;\n\t\twhile (i < len) {\n\n\t\t\tvar restOfLine = line.substr(i);\n\n\t\t\t// Look for the start of a placeholder {{\n\t\t\tif (/^{{/.test(restOfLine)) {\n\t\t\t\ti += 2;\n\t\t\t\tplaceHolderStack.push({ placeHolderId: '', placeHolderText: '' });\n\n\t\t\t\t// Look for id\n\t\t\t\tvar matches = restOfLine.match(/^{{(\\w+):/);\n\t\t\t\tif (Array.isArray(matches) && matches.length === 2) {\n\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderId = matches[1];\n\t\t\t\t\ti += matches[1].length + 1; // +1 to account for the : at the end of the id\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Look for the end of a placeholder. placeHolderStack[0] is the top-level line.\n\t\t\tif (placeHolderStack.length > 1 && /^}}/.test(restOfLine)) {\n\t\t\t\ti += 2;\n\n\t\t\t\tif (placeHolderStack[placeHolderStack.length - 1].placeHolderId.length === 0) {\n\t\t\t\t\t// This placeholder did not have an explicit id\n\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderId = placeHolderStack[placeHolderStack.length - 1].placeHolderText;\n\n\t\t\t\t\tif (placeHolderStack[placeHolderStack.length - 1].placeHolderId === '_') {\n\t\t\t\t\t\t// This is just an empty tab stop\n\t\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderId = 'TAB_STOP_' + String(++this._lastGeneratedId);\n\t\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderText = '';\n\t\t\t\t\t\t--resultIndex; // Roll back one iteration of the result index as we made the text empty\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (placeHolderStack[placeHolderStack.length - 1].placeHolderText.length === 0) {\n\t\t\t\t\t// This placeholder is empty or was a mirror\n\t\t\t\t\tvar defaultValue = findDefaultValueForId(placeHolderStack[placeHolderStack.length - 1].placeHolderId);\n\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderText = defaultValue;\n\t\t\t\t\tresultIndex += defaultValue.length;\n\t\t\t\t}\n\n\t\t\t\tplaceHolders.push({\n\t\t\t\t\tid: placeHolderStack[placeHolderStack.length - 1].placeHolderId,\n\t\t\t\t\tvalue: placeHolderStack[placeHolderStack.length - 1].placeHolderText,\n\t\t\t\t\tstartColumn: resultIndex + 1 - placeHolderStack[placeHolderStack.length - 1].placeHolderText.length,\n\t\t\t\t\tendColumn: resultIndex + 1\n\t\t\t\t});\n\n\t\t\t\t// Insert our text into the previous placeholder\n\t\t\t\tplaceHolderStack[placeHolderStack.length - 2].placeHolderText += placeHolderStack[placeHolderStack.length - 1].placeHolderText;\n\t\t\t\tplaceHolderStack.pop();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Look for escapes\n\t\t\tif (/^\\\\./.test(restOfLine)) {\n\t\t\t\tif (restOfLine.charAt(1) === '{' || restOfLine.charAt(1) === '}' || restOfLine.charAt(1) === '\\\\') {\n\t\t\t\t\t++i; // Skip the escape slash and take the character literally\n\t\t\t\t} else {\n\t\t\t\t\t// invalid escapes\n\t\t\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderText += line.charAt(i);\n\t\t\t\t\t++resultIndex;\n\t\t\t\t\t++i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//This is an escape sequence or not a special character, just insert it\n\t\t\tplaceHolderStack[placeHolderStack.length - 1].placeHolderText += line.charAt(i);\n\t\t\t++resultIndex;\n\t\t\t++i;\n\t\t}\n\n\t\t// Sort the placeholder in order of apperance:\n\t\tplaceHolders.sort( (a, b) => {\n\t\t\tif (a.startColumn < b.startColumn) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.startColumn > b.startColumn) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.endColumn < b.endColumn) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.endColumn > b.endColumn) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\treturn {\n\t\t\tline: placeHolderStack[0].placeHolderText,\n\t\t\tplaceHolders: placeHolders\n\t\t};\n\t}\n\n\t// This is used for both TextMate and Emmet\n\tpublic static convertExternalSnippet(snippet: string, snippetType: ExternalSnippetType) : string {\n\t\tvar openBraces = 0;\n\t\tvar convertedSnippet = '';\n\t\tvar i = 0;\n\t\tvar len = snippet.length;\n\n\t\twhile (i < len) {\n\t\t\tvar restOfLine = snippet.substr(i);\n\n\t\t\t// Cursor tab stop\n\t\t\tif (/^\\$0/.test(restOfLine)) {\n\t\t\t\ti += 2;\n\t\t\t\tconvertedSnippet += snippetType === ExternalSnippetType.EmmetSnippet ? '{{_}}' : '{{}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (/^\\$\\{0\\}/.test(restOfLine)) {\n\t\t\t\ti += 4;\n\t\t\t\tconvertedSnippet += snippetType === ExternalSnippetType.EmmetSnippet ? '{{_}}' :'{{}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (snippetType === ExternalSnippetType.EmmetSnippet && /^\\|/.test(restOfLine)) {\n\t\t\t\t++i;\n\t\t\t\tconvertedSnippet += '{{}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Tab stops\n\t\t\tvar matches = restOfLine.match(/^\\$(\\d+)/);\n\t\t\tif (Array.isArray(matches) && matches.length === 2) {\n\t\t\t\ti += 1 + matches[1].length;\n\t\t\t\tconvertedSnippet += '{{' + matches[1] + ':}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmatches = restOfLine.match(/^\\$\\{(\\d+)\\}/);\n\t\t\tif (Array.isArray(matches) && matches.length === 2) {\n\t\t\t\ti += 3 + matches[1].length;\n\t\t\t\tconvertedSnippet += '{{' + matches[1] + ':}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Open brace patterns placeholder\n\t\t\tif (/^\\${/.test(restOfLine)) {\n\t\t\t\ti += 2;\n\t\t\t\t++openBraces;\n\t\t\t\tconvertedSnippet += '{{';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Close brace patterns placeholder\n\t\t\tif (openBraces > 0 && /^}/.test(restOfLine)) {\n\t\t\t\ti += 1;\n\t\t\t\t--openBraces;\n\t\t\t\tconvertedSnippet += '}}';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Escapes\n\t\t\tif (/^\\\\./.test(restOfLine)) {\n\t\t\t\ti += 2;\n\t\t\t\tif (/^\\\\\\$/.test(restOfLine)) {\n\t\t\t\t\tconvertedSnippet += '$';\n\t\t\t\t} else {\n\t\t\t\t\tconvertedSnippet += restOfLine.substr(0, 2);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Escape braces that don't belong to a placeholder\n\t\t\tmatches = restOfLine.match(/^({|})/);\n\t\t\tif (Array.isArray(matches) && matches.length === 2) {\n\t\t\t\ti += 1;\n\t\t\t\tconvertedSnippet += '\\\\' + matches[1];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ti += 1;\n\t\t\tconvertedSnippet += restOfLine.charAt(0);\n\t\t}\n\n\t\treturn convertedSnippet;\n\t}\n\n\tprivate extractLineIndentation(str:string, maxColumn:number=Number.MAX_VALUE): string {\n\t\tvar fullIndentation = strings.getLeadingWhitespace(str);\n\n\t\tif (fullIndentation.length > maxColumn - 1) {\n\t\t\treturn fullIndentation.substring(0, maxColumn - 1);\n\t\t}\n\n\t\treturn fullIndentation;\n\t}\n\n\tpublic bind(referenceLine:string, deltaLine:number, firstLineDeltaColumn:number, config:IIndentationNormalizer):ICodeSnippet {\n\t\tvar resultLines: string[] = [];\n\t\tvar resultPlaceHolders: IPlaceHolder[] = [];\n\n\t\tvar referenceIndentation = this.extractLineIndentation(referenceLine, firstLineDeltaColumn + 1);\n\t\tvar originalLine: string, originalLineIndentation: string, remainingLine: string, indentation: string;\n\t\tvar i:number, len:number, j: number, lenJ: number;\n\n\t\t// Compute resultLines & keep deltaColumns as a reference for adjusting placeholders\n\t\tvar deltaColumns: number[] = [];\n\t\tfor (i = 0, len = this.lines.length; i < len; i++) {\n\t\t\toriginalLine = this.lines[i];\n\t\t\tif (i === 0) {\n\t\t\t\tdeltaColumns[i + 1] = firstLineDeltaColumn;\n\t\t\t\tresultLines[i] = originalLine;\n\t\t\t} else {\n\t\t\t\toriginalLineIndentation = this.extractLineIndentation(originalLine);\n\t\t\t\tremainingLine = originalLine.substr(originalLineIndentation.length);\n\t\t\t\tindentation = config.normalizeIndentation(referenceIndentation + originalLineIndentation);\n\t\t\t\tdeltaColumns[i + 1] = indentation.length - originalLineIndentation.length;\n\t\t\t\tresultLines[i] = indentation + remainingLine;\n\t\t\t}\n\t\t}\n\n\t\t// Compute resultPlaceHolders\n\t\tvar originalPlaceHolder: IPlaceHolder, originalOccurence: editorCommon.IRange, resultOccurences: editorCommon.IRange[];\n\t\tfor (i = 0, len = this.placeHolders.length; i < len; i++) {\n\t\t\toriginalPlaceHolder = this.placeHolders[i];\n\n\t\t\tresultOccurences = [];\n\t\t\tfor (j = 0, lenJ = originalPlaceHolder.occurences.length; j < lenJ; j++) {\n\t\t\t\toriginalOccurence = originalPlaceHolder.occurences[j];\n\n\t\t\t\tresultOccurences.push({\n\t\t\t\t\tstartLineNumber: originalOccurence.startLineNumber + deltaLine,\n\t\t\t\t\tstartColumn: originalOccurence.startColumn + deltaColumns[originalOccurence.startLineNumber],\n\t\t\t\t\tendLineNumber: originalOccurence.endLineNumber + deltaLine,\n\t\t\t\t\tendColumn: originalOccurence.endColumn + deltaColumns[originalOccurence.endLineNumber]\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tresultPlaceHolders.push({\n\t\t\t\tid: originalPlaceHolder.id,\n\t\t\t\tvalue: originalPlaceHolder.value,\n\t\t\t\toccurences: resultOccurences\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tlines: resultLines,\n\t\t\tplaceHolders: resultPlaceHolders,\n\t\t\tstartPlaceHolderIndex: this.startPlaceHolderIndex,\n\t\t\tfinishPlaceHolderIndex: this.finishPlaceHolderIndex\n\t\t};\n\t}\n}\n\n\nexport interface ITrackedPlaceHolder {\n\tranges: string[];\n}\n\n\nclass InsertSnippetController {\n\n\tprivate editor: editorCommon.ICommonCodeEditor;\n\tprivate model: editorCommon.IModel;\n\tprivate finishPlaceHolderIndex:number;\n\n\tprivate listenersToRemove:ListenerUnbind[];\n\tprivate trackedPlaceHolders:ITrackedPlaceHolder[];\n\tprivate placeHolderDecorations: string[];\n\tprivate currentPlaceHolderIndex:number;\n\tprivate highlightDecorationId:string;\n\tprivate isFinished:boolean;\n\n\tprivate _onStop: () => void;\n\tprivate _initialAlternativeVersionId: number;\n\n\tconstructor(editor: editorCommon.ICommonCodeEditor, adaptedSnippet:ICodeSnippet, startLineNumber:number, initialAlternativeVersionId: number, onStop: () => void) {\n\t\tthis.editor = editor;\n\t\tthis._onStop = onStop;\n\t\tthis.model = editor.getModel();\n\t\tthis.finishPlaceHolderIndex = adaptedSnippet.finishPlaceHolderIndex;\n\n\t\tthis.trackedPlaceHolders = [];\n\t\tthis.placeHolderDecorations = [];\n\t\tthis.currentPlaceHolderIndex = adaptedSnippet.startPlaceHolderIndex;\n\t\tthis.highlightDecorationId = null;\n\t\tthis.isFinished = false;\n\n\t\tthis._initialAlternativeVersionId = initialAlternativeVersionId;\n\n\t\tthis.initialize(adaptedSnippet, startLineNumber);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.stopAll();\n\t}\n\n\tprivate initialize(adaptedSnippet:ICodeSnippet, startLineNumber:number): void {\n\t\tvar i:number, len:number;\n\n\t\tfor (i = 0, len = adaptedSnippet.placeHolders.length; i < len; i++) {\n\t\t\tvar placeHolder = adaptedSnippet.placeHolders[i];\n\n\t\t\tvar trackedRanges:string[] = [];\n\t\t\tfor (var j = 0, lenJ = placeHolder.occurences.length; j < lenJ; j++) {\n\t\t\t\ttrackedRanges.push(this.model.addTrackedRange(placeHolder.occurences[j], editorCommon.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges));\n\t\t\t}\n\n\t\t\tthis.trackedPlaceHolders.push({\n\t\t\t\tranges: trackedRanges\n\t\t\t});\n\t\t}\n\n\t\tthis.editor.changeDecorations((changeAccessor:editorCommon.IModelDecorationsChangeAccessor) => {\n\t\t\tlet newDecorations: editorCommon.IModelDeltaDecoration[] = [];\n\n\t\t\tlet endLineNumber = startLineNumber + adaptedSnippet.lines.length - 1;\n\t\t\tlet endLineNumberMaxColumn = this.model.getLineMaxColumn(endLineNumber);\n\t\t\tnewDecorations.push({\n\t\t\t\trange: new Range(startLineNumber, 1, endLineNumber, endLineNumberMaxColumn),\n\t\t\t\toptions: {\n\t\t\t\t\tclassName: 'new-snippet',\n\t\t\t\t\tisWholeLine: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (let i = 0, len = this.trackedPlaceHolders.length; i < len; i++) {\n\t\t\t\tlet className = (i === this.finishPlaceHolderIndex) ? 'finish-snippet-placeholder' : 'snippet-placeholder';\n\t\t\t\tnewDecorations.push({\n\t\t\t\t\trange: this.model.getTrackedRange(this.trackedPlaceHolders[i].ranges[0]),\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tclassName: className\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet decorations = changeAccessor.deltaDecorations([], newDecorations);\n\t\t\tthis.highlightDecorationId = decorations[0];\n\t\t\tthis.placeHolderDecorations = decorations.slice(1);\n\t\t});\n\n\t\tthis.listenersToRemove = [];\n\t\tthis.listenersToRemove.push(this.editor.addListener(editorCommon.EventType.ModelContentChanged, (e:editorCommon.IModelContentChangedEvent) => {\n\t\t\tif (this.isFinished) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.changeType === editorCommon.EventType.ModelContentChangedFlush) {\n\t\t\t\t// a model.setValue() was called\n\t\t\t\tthis.stopAll();\n\t\t\t} else if (e.changeType === editorCommon.EventType.ModelContentChangedLineChanged) {\n\t\t\t\tvar changedLine = (<editorCommon.IModelContentChangedLineChangedEvent>e).lineNumber;\n\t\t\t\tvar highlightRange = this.model.getDecorationRange(this.highlightDecorationId);\n\n\t\t\t\tif (changedLine < highlightRange.startLineNumber || changedLine > highlightRange.endLineNumber) {\n\t\t\t\t\tthis.stopAll();\n\t\t\t\t}\n\t\t\t} else if (e.changeType === editorCommon.EventType.ModelContentChangedLinesInserted) {\n\t\t\t\tvar insertLine = (<editorCommon.IModelContentChangedLinesInsertedEvent>e).fromLineNumber;\n\t\t\t\tvar highlightRange = this.model.getDecorationRange(this.highlightDecorationId);\n\n\t\t\t\tif (insertLine < highlightRange.startLineNumber || insertLine > highlightRange.endLineNumber) {\n\t\t\t\t\tthis.stopAll();\n\t\t\t\t}\n\t\t\t} else if (e.changeType === editorCommon.EventType.ModelContentChangedLinesDeleted) {\n\t\t\t\tvar deleteLine1 = (<editorCommon.IModelContentChangedLinesDeletedEvent>e).fromLineNumber;\n\t\t\t\tvar deleteLine2 = (<editorCommon.IModelContentChangedLinesDeletedEvent>e).toLineNumber;\n\t\t\t\tvar highlightRange = this.model.getDecorationRange(this.highlightDecorationId);\n\n\t\t\t\tvar deletedLinesAbove = (deleteLine2 < highlightRange.startLineNumber);\n\t\t\t\tvar deletedLinesBelow = (deleteLine1 > highlightRange.endLineNumber);\n\n\t\t\t\tif (deletedLinesAbove || deletedLinesBelow) {\n\t\t\t\t\tthis.stopAll();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar newAlternateVersionId = this.editor.getModel().getAlternativeVersionId();\n\t\t\tif (this._initialAlternativeVersionId === newAlternateVersionId) {\n\t\t\t\t// We executed undo until we reached the same version we started with\n\t\t\t\tthis.stopAll();\n\t\t\t}\n\t\t}));\n\n\t\tthis.listenersToRemove.push(this.editor.addListener(editorCommon.EventType.CursorPositionChanged, (e:editorCommon.ICursorPositionChangedEvent) => {\n\t\t\tif (this.isFinished) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar highlightRange = this.model.getDecorationRange(this.highlightDecorationId);\n\t\t\tvar lineNumber = e.position.lineNumber;\n\t\t\tif (lineNumber < highlightRange.startLineNumber || lineNumber > highlightRange.endLineNumber) {\n\t\t\t\tthis.stopAll();\n\t\t\t}\n\t\t}));\n\n\t\tthis.listenersToRemove.push(this.editor.addListener(editorCommon.EventType.ModelChanged, () => {\n\t\t\tthis.stopAll();\n\t\t}));\n\n\t\tvar blurTimeout = -1;\n\t\tthis.listenersToRemove.push(this.editor.addListener(editorCommon.EventType.EditorBlur, () => {\n\t\t\t// Blur if within 100ms we do not focus back\n\t\t\tblurTimeout = setTimeout(() => {\n\t\t\t\tthis.stopAll();\n\t\t\t}, 100);\n\t\t}));\n\n\t\tthis.listenersToRemove.push(this.editor.addListener(editorCommon.EventType.EditorFocus, () => {\n\t\t\t// Cancel the blur timeout (if any)\n\t\t\tif (blurTimeout !== -1) {\n\t\t\t\tclearTimeout(blurTimeout);\n\t\t\t\tblurTimeout = -1;\n\t\t\t}\n\t\t}));\n\n\t\tthis.listenersToRemove.push(this.model.addListener(editorCommon.EventType.ModelDecorationsChanged, (e: editorCommon.IModelDecorationsChangedEvent) => {\n\t\t\tif (this.isFinished) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar modelEditableRange = this.model.getEditableRange(),\n\t\t\t\tpreviousRange: editorCommon.IEditorRange = null,\n\t\t\t\tallCollapsed = true,\n\t\t\t\tallEqualToEditableRange = true;\n\n\t\t\tfor (var i = 0; (allCollapsed || allEqualToEditableRange) && i < this.trackedPlaceHolders.length; i++) {\n\t\t\t\tvar ranges = this.trackedPlaceHolders[i].ranges;\n\n\t\t\t\tfor (var j = 0; (allCollapsed || allEqualToEditableRange) && j < ranges.length; j++) {\n\t\t\t\t\tvar range = this.model.getTrackedRange(ranges[j]);\n\n\t\t\t\t\tif (allCollapsed) {\n\t\t\t\t\t\tif (!range.isEmpty()) {\n\t\t\t\t\t\t\tallCollapsed = false;\n\t\t\t\t\t\t} else if (previousRange === null) {\n\t\t\t\t\t\t\tpreviousRange = range;\n\t\t\t\t\t\t} else if (!previousRange.equalsRange(range)) {\n\t\t\t\t\t\t\tallCollapsed = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (allEqualToEditableRange && !modelEditableRange.equalsRange(range)) {\n\t\t\t\t\t\tallEqualToEditableRange = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif (allCollapsed || allEqualToEditableRange) {\n\t\t\t\tthis.stopAll();\n\t\t\t} else {\n\t\t\t\tif (this.finishPlaceHolderIndex !== -1) {\n\t\t\t\t\tvar finishPlaceHolderDecorationId = this.placeHolderDecorations[this.finishPlaceHolderIndex];\n\t\t\t\t\tvar finishPlaceHolderRange = this.model.getDecorationRange(finishPlaceHolderDecorationId);\n\t\t\t\t\tvar finishPlaceHolderOptions = this.model.getDecorationOptions(finishPlaceHolderDecorationId);\n\n\t\t\t\t\tvar finishPlaceHolderRangeIsEmpty = finishPlaceHolderRange.isEmpty();\n\t\t\t\t\tvar finishPlaceHolderClassNameIsForEmpty = (finishPlaceHolderOptions.className === 'finish-snippet-placeholder');\n\n\t\t\t\t\t// Remember xor? :)\n\t\t\t\t\tvar needsChanging = Number(finishPlaceHolderRangeIsEmpty) ^ Number(finishPlaceHolderClassNameIsForEmpty);\n\n\t\t\t\t\tif (needsChanging) {\n\t\t\t\t\t\tthis.editor.changeDecorations((changeAccessor:editorCommon.IModelDecorationsChangeAccessor) => {\n\t\t\t\t\t\t\tvar className = finishPlaceHolderRangeIsEmpty ? 'finish-snippet-placeholder' : 'snippet-placeholder';\n\t\t\t\t\t\t\tchangeAccessor.changeDecorationOptions(finishPlaceHolderDecorationId, {\n\t\t\t\t\t\t\t\tclassName: className\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis.doLinkEditing();\n\t}\n\n\tpublic onNextPlaceHolder():boolean {\n\t\treturn this.changePlaceHolder(true);\n\t}\n\n\tpublic onPrevPlaceHolder():boolean {\n\t\treturn this.changePlaceHolder(false);\n\t}\n\n\tprivate changePlaceHolder(goToNext: boolean): boolean {\n\t\tif (this.isFinished) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar oldPlaceHolderIndex = this.currentPlaceHolderIndex;\n\t\tvar oldRange = this.model.getTrackedRange(this.trackedPlaceHolders[oldPlaceHolderIndex].ranges[0]);\n\t\tvar sameRange = true;\n\t\tdo {\n\t\t\tif (goToNext) {\n\t\t\t\tthis.currentPlaceHolderIndex = (this.currentPlaceHolderIndex + 1) % this.trackedPlaceHolders.length;\n\t\t\t} else {\n\t\t\t\tthis.currentPlaceHolderIndex = (this.trackedPlaceHolders.length + this.currentPlaceHolderIndex - 1) % this.trackedPlaceHolders.length;\n\t\t\t}\n\n\t\t\tvar newRange = this.model.getTrackedRange(this.trackedPlaceHolders[this.currentPlaceHolderIndex].ranges[0]);\n\n\t\t\tsameRange = oldRange.equalsRange(newRange);\n\n\t\t} while (this.currentPlaceHolderIndex !== oldPlaceHolderIndex && sameRange);\n\n\t\tthis.doLinkEditing();\n\t\treturn true;\n\t}\n\n\tpublic onAccept():boolean {\n\t\tif (this.isFinished) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.finishPlaceHolderIndex !== -1) {\n\t\t\tvar finishRange = this.model.getTrackedRange(this.trackedPlaceHolders[this.finishPlaceHolderIndex].ranges[0]);\n\t\t\t// Let's just position cursor at the end of the finish range\n\t\t\tthis.editor.setPosition({\n\t\t\t\tlineNumber: finishRange.endLineNumber,\n\t\t\t\tcolumn: finishRange.endColumn\n\t\t\t});\n\t\t}\n\t\tthis.stopAll();\n\t\treturn true;\n\t}\n\n\tpublic onEscape():boolean {\n\t\tif (this.isFinished) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.stopAll();\n\t\t// Cancel multi-cursor\n\t\tthis.editor.setSelections([this.editor.getSelections()[0]]);\n\t\treturn true;\n\t}\n\n\tprivate doLinkEditing(): void {\n\t\tvar selections: editorCommon.ISelection[] = [];\n\t\tfor (var i = 0, len = this.trackedPlaceHolders[this.currentPlaceHolderIndex].ranges.length; i < len; i++) {\n\t\t\tvar range = this.model.getTrackedRange(this.trackedPlaceHolders[this.currentPlaceHolderIndex].ranges[i]);\n\t\t\tselections.push({\n\t\t\t\tselectionStartLineNumber: range.startLineNumber,\n\t\t\t\tselectionStartColumn: range.startColumn,\n\t\t\t\tpositionLineNumber: range.endLineNumber,\n\t\t\t\tpositionColumn: range.endColumn\n\t\t\t});\n\t\t}\n\t\tthis.editor.setSelections(selections);\n\t}\n\n\tprivate stopAll(): void {\n\t\tif (this.isFinished) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onStop();\n\n\t\tthis.isFinished = true;\n\n\t\tthis.listenersToRemove.forEach((element) => {\n\t\t\telement();\n\t\t});\n\t\tthis.listenersToRemove = [];\n\n\t\tfor (var i = 0; i < this.trackedPlaceHolders.length; i++) {\n\t\t\tvar ranges = this.trackedPlaceHolders[i].ranges;\n\t\t\tfor (var j = 0; j < ranges.length; j++) {\n\t\t\t\tthis.model.removeTrackedRange(ranges[j]);\n\t\t\t}\n\t\t}\n\t\tthis.trackedPlaceHolders = [];\n\n\t\tthis.editor.changeDecorations((changeAccessor:editorCommon.IModelDecorationsChangeAccessor) => {\n\t\t\tlet toRemove: string[] = [];\n\t\t\ttoRemove.push(this.highlightDecorationId);\n\t\t\tfor (let i = 0; i < this.placeHolderDecorations.length; i++) {\n\t\t\t\ttoRemove.push(this.placeHolderDecorations[i]);\n\t\t\t}\n\t\t\tchangeAccessor.deltaDecorations(toRemove, []);\n\t\t\tthis.placeHolderDecorations = [];\n\t\t\tthis.highlightDecorationId = null;\n\t\t});\n\t}\n}\n\nexport interface ISnippetController extends editorCommon.IEditorContribution {\n\trun(snippet: CodeSnippet, overwriteBefore: number, overwriteAfter: number): void;\n\tjumpToNextPlaceholder(): void;\n\tjumpToPrevPlaceholder(): void;\n\tacceptSnippet(): void;\n\tleaveSnippet(): void;\n}\n\nexport function getSnippetController(editor: editorCommon.ICommonCodeEditor): ISnippetController {\n\treturn <ISnippetController>editor.getContribution(SnippetController.ID);\n}\n\nclass SnippetController implements ISnippetController {\n\n\tpublic static ID = 'editor.contrib.snippetController';\n\n\tprivate _editor: editorCommon.ICommonCodeEditor;\n\tprivate _currentController: InsertSnippetController;\n\tprivate _inSnippetMode: IKeybindingContextKey<boolean>;\n\n\tconstructor(editor: editorCommon.ICommonCodeEditor, @IKeybindingService keybindingService: IKeybindingService) {\n\t\tthis._editor = editor;\n\t\tthis._currentController = null;\n\t\tthis._inSnippetMode = keybindingService.createKey(CONTEXT_SNIPPET_MODE, false);\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._currentController) {\n\t\t\tthis._currentController.dispose();\n\t\t\tthis._currentController = null;\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn SnippetController.ID;\n\t}\n\n\tpublic run(snippet:CodeSnippet, overwriteBefore:number, overwriteAfter:number): void {\n\t\tlet prevController = this._currentController;\n\t\tthis._currentController = null;\n\n\t\tif (snippet.placeHolders.length === 0) {\n\t\t\t// No placeholders => execute for all editor selections\n\t\t\tthis._runForAllSelections(snippet, overwriteBefore, overwriteAfter);\n\t\t} else {\n\t\t\tthis._runForPrimarySelection(snippet, overwriteBefore, overwriteAfter);\n\t\t}\n\n\t\tif (!this._currentController) {\n\t\t\t// we didn't end up in snippet mode again => restore previous controller\n\t\t\tthis._currentController = prevController;\n\t\t} else {\n\t\t\t// we ended up in snippet mode => dispose previous controller if necessary\n\t\t\tif (prevController) {\n\t\t\t\tprevController.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static _getTypeRangeForSelection(model:editorCommon.IModel, selection:editorCommon.IEditorSelection, overwriteBefore:number, overwriteAfter:number): editorCommon.IEditorRange {\n\t\tvar typeRange:editorCommon.IEditorRange;\n\t\tif (overwriteBefore || overwriteAfter) {\n\t\t\ttypeRange = model.validateRange(Range.plusRange(selection, {\n\t\t\t\tstartLineNumber: selection.positionLineNumber,\n\t\t\t\tstartColumn: selection.positionColumn - overwriteBefore,\n\t\t\t\tendLineNumber: selection.positionLineNumber,\n\t\t\t\tendColumn: selection.positionColumn + overwriteAfter\n\t\t\t}));\n\t\t} else {\n\t\t\ttypeRange = selection;\n\t\t}\n\t\treturn typeRange;\n\t}\n\n\tprivate static _getAdaptedSnippet(model:editorCommon.IModel, snippet:CodeSnippet, typeRange:editorCommon.IEditorRange): ICodeSnippet {\n\t\treturn snippet.bind(model.getLineContent(typeRange.startLineNumber), typeRange.startLineNumber - 1, typeRange.startColumn - 1, model);\n\t}\n\n\tprivate static _addCommandForSnippet(model:editorCommon.ITextModel, adaptedSnippet:ICodeSnippet, typeRange:editorCommon.IEditorRange, out:editorCommon.IIdentifiedSingleEditOperation[]): void {\n\t\tlet insertText = adaptedSnippet.lines.join('\\n');\n\t\tlet currentText = model.getValueInRange(typeRange, editorCommon.EndOfLinePreference.LF);\n\t\tif (insertText !== currentText) {\n\t\t\tout.push(EditOperation.replaceMove(typeRange, insertText));\n\t\t}\n\t}\n\n\tprivate _runForPrimarySelection(snippet: CodeSnippet, overwriteBefore: number, overwriteAfter: number): void {\n\t\tlet initialAlternativeVersionId = this._editor.getModel().getAlternativeVersionId();\n\n\t\tlet edits: editorCommon.IIdentifiedSingleEditOperation[] = [];\n\n\t\tlet prepared = SnippetController._prepareSnippet(this._editor, this._editor.getSelection(), snippet, overwriteBefore, overwriteAfter);\n\t\tSnippetController._addCommandForSnippet(this._editor.getModel(), prepared.adaptedSnippet, prepared.typeRange, edits);\n\n\t\tif (edits.length > 0) {\n\t\t\tthis._editor.getModel().pushStackElement();\n\t\t\tthis._editor.executeEdits('editor.contrib.insertSnippetHelper', edits);\n\t\t\tthis._editor.getModel().pushStackElement();\n\t\t}\n\n\t\tlet cursorOnly = SnippetController._getSnippetCursorOnly(prepared.adaptedSnippet);\n\t\tif (cursorOnly) {\n\t\t\tthis._editor.setSelection(Selection.createSelection(cursorOnly.lineNumber, cursorOnly.column, cursorOnly.lineNumber, cursorOnly.column));\n\t\t} else if (prepared.adaptedSnippet.placeHolders.length > 0) {\n\t\t\tthis._inSnippetMode.set(true);\n\t\t\tthis._currentController = new InsertSnippetController(this._editor, prepared.adaptedSnippet, prepared.typeRange.startLineNumber, initialAlternativeVersionId, () => {\n\t\t\t\tthis._inSnippetMode.reset();\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _runForAllSelections(snippet:CodeSnippet, overwriteBefore:number, overwriteAfter:number): void {\n\t\tlet selections = this._editor.getSelections(),\n\t\t\tedits:editorCommon.IIdentifiedSingleEditOperation[] = [];\n\n\t\tfor (let i = 0; i < selections.length; i++) {\n\t\t\tlet prepared = SnippetController._prepareSnippet(this._editor, selections[i], snippet, overwriteBefore, overwriteAfter);\n\t\t\tSnippetController._addCommandForSnippet(this._editor.getModel(), prepared.adaptedSnippet, prepared.typeRange, edits);\n\t\t}\n\n\t\tif (edits.length > 0) {\n\t\t\tthis._editor.getModel().pushStackElement();\n\t\t\tthis._editor.executeEdits('editor.contrib.insertSnippetHelper', edits);\n\t\t\tthis._editor.getModel().pushStackElement();\n\t\t}\n\t}\n\n\tprivate static _prepareSnippet(editor:editorCommon.ICommonCodeEditor, selection:editorCommon.IEditorSelection, snippet:CodeSnippet, overwriteBefore:number, overwriteAfter:number): { typeRange: editorCommon.IEditorRange; adaptedSnippet: ICodeSnippet; } {\n\t\tvar model = editor.getModel();\n\n\t\tvar typeRange = SnippetController._getTypeRangeForSelection(model, selection, overwriteBefore, overwriteAfter);\n\t\tif (snippet.lines.length === 1) {\n\t\t\tvar nextTextOnLine = model.getLineContent(typeRange.endLineNumber).substr(typeRange.endColumn - 1);\n\t\t\tvar nextInSnippet = snippet.lines[0].substr(overwriteBefore);\n\t\t\tvar commonPrefix = strings.commonPrefixLength(nextTextOnLine, nextInSnippet);\n\n\t\t\tif (commonPrefix > 0) {\n\t\t\t\ttypeRange = typeRange.setEndPosition(typeRange.endLineNumber, typeRange.endColumn + commonPrefix);\n\t\t\t}\n\t\t}\n\n\t\tvar adaptedSnippet = SnippetController._getAdaptedSnippet(model, snippet, typeRange);\n\t\treturn {\n\t\t\ttypeRange: typeRange,\n\t\t\tadaptedSnippet: adaptedSnippet\n\t\t};\n\t}\n\n\tprivate static _getSnippetCursorOnly(snippet:ICodeSnippet):editorCommon.IPosition {\n\n\t\tif (snippet.placeHolders.length !== 1) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar placeHolder = snippet.placeHolders[0];\n\t\tif (placeHolder.value !== '' || placeHolder.occurences.length !== 1) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar placeHolderRange = placeHolder.occurences[0];\n\t\tif (!Range.isEmpty(placeHolderRange)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tlineNumber: placeHolderRange.startLineNumber,\n\t\t\tcolumn: placeHolderRange.startColumn\n\t\t};\n\t}\n\n\tpublic jumpToNextPlaceholder(): void {\n\t\tif (this._currentController) {\n\t\t\tthis._currentController.onNextPlaceHolder();\n\t\t}\n\t}\n\n\tpublic jumpToPrevPlaceholder(): void {\n\t\tif (this._currentController) {\n\t\t\tthis._currentController.onPrevPlaceHolder();\n\t\t}\n\t}\n\n\tpublic acceptSnippet(): void {\n\t\tif (this._currentController) {\n\t\t\tthis._currentController.onAccept();\n\t\t}\n\t}\n\n\tpublic leaveSnippet(): void {\n\t\tif (this._currentController) {\n\t\t\tthis._currentController.onEscape();\n\t\t}\n\t}\n}\n\nexport var CONTEXT_SNIPPET_MODE = 'inSnippetMode';\n\nvar weight = CommonEditorRegistry.commandWeight(30);\n\nCommonEditorRegistry.registerEditorContribution(SnippetController);\nCommonEditorRegistry.registerEditorCommand('jumpToNextSnippetPlaceholder', weight, { primary: KeyCode.Tab }, true, CONTEXT_SNIPPET_MODE,(ctx, editor, args) => {\n\tgetSnippetController(editor).jumpToNextPlaceholder();\n});\nCommonEditorRegistry.registerEditorCommand('jumpToPrevSnippetPlaceholder', weight, { primary: KeyMod.Shift | KeyCode.Tab }, true, CONTEXT_SNIPPET_MODE,(ctx, editor, args) => {\n\tgetSnippetController(editor).jumpToPrevPlaceholder();\n});\nCommonEditorRegistry.registerEditorCommand('acceptSnippet', weight, { primary: KeyCode.Enter }, true, CONTEXT_SNIPPET_MODE,(ctx, editor, args) => {\n\tgetSnippetController(editor).acceptSnippet();\n});\nCommonEditorRegistry.registerEditorCommand('leaveSnippet', weight, { primary: KeyCode.Escape, secondary: [KeyMod.Shift | KeyCode.Escape] }, true, CONTEXT_SNIPPET_MODE,(ctx, editor, args) => {\n\tgetSnippetController(editor).leaveSnippet();\n});\n"]}