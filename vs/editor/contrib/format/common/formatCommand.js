define(["require","exports","vs/base/common/strings","vs/editor/common/core/range"],function(t,i,e,n){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var r=function(){function t(t,i){this._edits=t,this._initialSelection=i}return t.prototype.getEditOperations=function(i,e){this._edits.map(function(e){return t.trimEdit(e,i)}).filter(function(t){return null!==t}).forEach(function(t){return e.addEditOperation(n.Range.lift(t.range),t.text)});var r=!1;Array.isArray(this._edits)&&1===this._edits.length&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(r=!0,this._selectionId=e.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(r=!0,this._selectionId=e.trackSelection(this._initialSelection,!1))),r||(this._selectionId=e.trackSelection(this._initialSelection))},t.prototype.computeCursorState=function(t,i){return i.getTrackedSelection(this._selectionId)},t.fixLineTerminators=function(t,i){t.text=t.text.replace(/\r\n|\r|\n/g,i.getEOL())},t.trimEdit=function(t,i){return this.fixLineTerminators(t,i),this._trimEdit(i.validateRange(t.range),t.text,t.forceMoveMarkers,i)},t._trimEdit=function(t,i,r,o){var s=o.getValueInRange(t),a=e.commonPrefixLength(i,s);if(a===s.length&&a===i.length)return null;if(a>0){var l=o.modifyPosition(t.getStartPosition(),a);t=new n.Range(l.lineNumber,l.column,t.endLineNumber,t.endColumn),i=i.substring(a),s=s.substr(a)}var u=e.commonSuffixLength(i,s);if(u>0){var c=o.modifyPosition(t.getEndPosition(),-u);t=new n.Range(t.startLineNumber,t.startColumn,c.lineNumber,c.column),i=i.substring(0,i.length-u),s=s.substring(0,s.length-u)}return{text:i,range:t,forceMoveMarkers:r}},t}();i.EditOperationsCommand=r});