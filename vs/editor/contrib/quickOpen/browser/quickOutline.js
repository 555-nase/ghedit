/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/filters","vs/base/common/strings","vs/base/common/winjs.base","vs/base/parts/quickopen/browser/quickOpenModel","vs/base/parts/quickopen/common/quickOpen","vs/editor/common/modes","./editorQuickOpen","vs/editor/contrib/quickOpen/common/quickOpen","vs/css!./quickOutline"],function(e,t,r,o,n,i,s,a,u,c,l,p){"use strict";var h=":",d=function(e){function t(t,r,o,n,i,s,a){e.call(this),this.name=t,this.type=r,this.description=o,this.range=n,this.setHighlights(i),this.editor=s,this.decorator=a}return __extends(t,e),t.prototype.getLabel=function(){return this.name},t.prototype.getAriaLabel=function(){return r.localize("entryAriaLabel","{0}, symbols",this.name)},t.prototype.getIcon=function(){return this.type},t.prototype.getDescription=function(){return this.description},t.prototype.getType=function(){return this.type},t.prototype.getRange=function(){return this.range},t.prototype.run=function(e,t){return e===u.Mode.OPEN?this.runOpen(t):this.runPreview()},t.prototype.runOpen=function(e){var t=this.toSelection();return this.editor.setSelection(t),this.editor.revealRangeInCenter(t),this.editor.focus(),!0},t.prototype.runPreview=function(){var e=this.toSelection();return this.editor.revealRangeInCenter(e),this.decorator.decorateLine(this.range,this.editor),!1},t.prototype.toSelection=function(){return{startLineNumber:this.range.startLineNumber,startColumn:this.range.startColumn||1,endLineNumber:this.range.startLineNumber,endColumn:this.range.startColumn||1}},t}(a.QuickOpenEntryGroup),m=function(e){function t(t,o){e.call(this,t,o,r.localize("QuickOutlineAction.label","Go to Symbol..."))}return __extends(t,e),t.prototype.isSupported=function(){return c.DocumentSymbolProviderRegistry.has(this.editor.getModel())&&e.prototype.isSupported.call(this)},t.prototype.run=function(){var t=this,r=this.editor.getModel();if(!c.DocumentSymbolProviderRegistry.has(r))return null;var n=p.getDocumentSymbols(r);return n.then(function(r){return r.entries.length>0?(t.cachedResult=r.entries,e.prototype.run.call(t)):s.TPromise.as(!0)},function(e){return o.onUnexpectedError(e),!1})},t.prototype._getModel=function(e){return new a.QuickOpenModel(this.toQuickOpenEntries(this.cachedResult,e))},t.prototype._getAutoFocus=function(e){return 0===e.indexOf(h)&&(e=e.substr(h.length)),{autoFocusPrefixMatch:e,autoFocusFirstEntry:!!e}},t.prototype._getInputAriaLabel=function(){return r.localize("quickOutlineActionInput","Type the name of an identifier you wish to navigate to")},t.prototype.toQuickOpenEntries=function(e,t){var o=[],s=t;0===t.indexOf(h)&&(s=s.substr(h.length));for(var a=0;a<e.length;a++){var u=e[a],l=i.trim(u.name),p=n.matchesFuzzy(s,l);if(p){var m=null;u.containerName&&(m=u.containerName),o.push(new d(l,c.SymbolKind.from(u.kind),m,u.location.range,p,this.editor,this))}}if(t&&(o=0===t.indexOf(h)?o.sort(this.sortScoped.bind(this,t.toLowerCase())):o.sort(this.sortNormal.bind(this,t.toLowerCase()))),o.length>0&&0===t.indexOf(h)){for(var y=null,f=null,g=0,a=0;a<o.length;a++){var b=o[a];y!==b.getType()?(f&&f.setGroupLabel(this.typeToLabel(y,g)),y=b.getType(),f=b,g=1,b.setShowBorder(a>0)):g++}f&&f.setGroupLabel(this.typeToLabel(y,g))}else o.length>0&&o[0].setGroupLabel(r.localize("symbols","symbols ({0})",o.length));return o},t.prototype.typeToLabel=function(e,t){switch(e){case"module":return r.localize("modules","modules ({0})",t);case"class":return r.localize("class","classes ({0})",t);case"interface":return r.localize("interface","interfaces ({0})",t);case"method":return r.localize("method","methods ({0})",t);case"function":return r.localize("function","functions ({0})",t);case"property":return r.localize("property","properties ({0})",t);case"variable":return r.localize("variable","variables ({0})",t);case"var":return r.localize("variable2","variables ({0})",t);case"constructor":return r.localize("_constructor","constructors ({0})",t);case"call":return r.localize("call","calls ({0})",t)}return e},t.prototype.sortNormal=function(e,t,r){var o=t.getLabel().toLowerCase(),n=r.getLabel().toLowerCase(),i=o.localeCompare(n);if(0!==i)return i;var s=t.getRange(),a=r.getRange();return s.startLineNumber-a.startLineNumber},t.prototype.sortScoped=function(e,t,r){e=e.substr(h.length);var o=t.getType(),n=r.getType(),i=o.localeCompare(n);if(0!==i)return i;if(e){var s=t.getLabel().toLowerCase(),a=r.getLabel().toLowerCase(),u=s.localeCompare(a);if(0!==u)return u}var c=t.getRange(),l=r.getRange();return c.startLineNumber-l.startLineNumber},t.prototype._onClose=function(t){e.prototype._onClose.call(this,t),this.cachedResult=null},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.cachedResult=null},t.ID="editor.action.quickOutline",t}(l.BaseEditorQuickOpenAction);t.QuickOutlineAction=m});