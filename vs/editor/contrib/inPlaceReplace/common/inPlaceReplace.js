var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},__param=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/winjs.base","vs/editor/common/core/range","vs/editor/common/editorAction","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/common/services/editorWorkerService","./inPlaceReplaceCommand"],function(e,t,o,r,n,i,a,c,s,d,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";var u=function(e){function t(t,o,r,i){e.call(this,t,o),this.editorWorkerService=i,this.up=r,this.requestIdPool=0,this.currentRequest=n.TPromise.as(null),this.decorationRemover=n.TPromise.as(null),this.decorationIds=[]}return __extends(t,e),t.prototype.run=function(){var e=this;this.currentRequest.cancel();var o=this.editor.getSelection(),r=this.editor.getModel(),a=r.getMode().inplaceReplaceSupport,s=r.uri;if(o.startLineNumber!==o.endLineNumber)return null;var d=this.editor.captureState(c.CodeEditorStateFlag.Value,c.CodeEditorStateFlag.Position);return this.currentRequest=this.editorWorkerService.navigateValueSet(s,o,this.up),this.currentRequest=this.currentRequest.then(function(t){return t&&t.range&&t.value?t:a?a.navigateValueSet(s,o,e.up):null}),this.currentRequest.then(function(r){if(r&&r.range&&r.value&&d.validate(e.editor)){var a=i.Range.lift(r.range),c=r.range,s=r.value.length-(o.endColumn-o.startColumn);c.endColumn=c.startColumn+r.value.length,o.endColumn+=s>1?s-1:0;var u=new l.InPlaceReplaceCommand(a,o,r.value);return e.editor.executeCommand(e.id,u),e.decorationIds=e.editor.deltaDecorations(e.decorationIds,[{range:c,options:t.DECORATION}]),e.decorationRemover.cancel(),e.decorationRemover=n.TPromise.timeout(350),e.decorationRemover.then(function(){e.editor.changeDecorations(function(t){e.decorationIds=t.deltaDecorations(e.decorationIds,[])})}),!0}})},t.DECORATION={className:"valueSetReplacement"},t=__decorate([__param(3,d.IEditorWorkerService)],t)}(a.EditorAction),m=function(e){function t(t,o,r){e.call(this,t,o,!0,r)}return __extends(t,e),t.ID="editor.action.inPlaceReplace.up",t=__decorate([__param(2,d.IEditorWorkerService)],t)}(u),p=function(e){function t(t,o,r){e.call(this,t,o,!1,r)}return __extends(t,e),t.ID="editor.action.inPlaceReplace.down",t=__decorate([__param(2,d.IEditorWorkerService)],t)}(u);s.CommonEditorRegistry.registerEditorAction(new s.EditorActionDescriptor(m,m.ID,o.localize("InPlaceReplaceAction.previous.label","Replace with Previous Value"),{context:s.ContextKey.EditorTextFocus,primary:r.KeyMod.CtrlCmd|r.KeyMod.Shift|r.KeyCode.US_COMMA},"Replace with Previous Value")),s.CommonEditorRegistry.registerEditorAction(new s.EditorActionDescriptor(p,p.ID,o.localize("InPlaceReplaceAction.next.label","Replace with Next Value"),{context:s.ContextKey.EditorTextFocus,primary:r.KeyMod.CtrlCmd|r.KeyMod.Shift|r.KeyCode.US_DOT},"Replace with Next Value"))});