{"version":3,"sources":["vs/editor/contrib/quickFix/browser/quickFix.ts"],"names":[],"mappings":"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","file":"vs/editor/contrib/quickFix/browser/quickFix.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport {KeyCode, KeyMod} from 'vs/base/common/keyCodes';\nimport Severity from 'vs/base/common/severity';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IEditorService} from 'vs/platform/editor/common/editor';\nimport {IEventService} from 'vs/platform/event/common/event';\nimport {IKeybindingContextKey, IKeybindingService} from 'vs/platform/keybinding/common/keybindingService';\nimport {IMarkerService} from 'vs/platform/markers/common/markers';\nimport {IMessageService} from 'vs/platform/message/common/message';\nimport {ITelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {EditorAction} from 'vs/editor/common/editorAction';\nimport {ICommonCodeEditor, IEditorActionDescriptorData, IEditorContribution, IRange} from 'vs/editor/common/editorCommon';\nimport {CommonEditorRegistry, ContextKey, EditorActionDescriptor} from 'vs/editor/common/editorCommonExtensions';\nimport {bulkEdit} from 'vs/editor/common/services/bulkEdit';\nimport {ICodeEditor} from 'vs/editor/browser/editorBrowser';\nimport {QuickFixRegistry} from 'vs/editor/common/modes';\nimport {EditorBrowserRegistry} from 'vs/editor/browser/editorBrowserExtensions';\nimport {IQuickFix2} from '../common/quickFix';\nimport {QuickFixModel} from './quickFixModel';\nimport {QuickFixSelectionWidget} from './quickFixSelectionWidget';\n\nexport class QuickFixController implements IEditorContribution {\n\n\tstatic ID = 'editor.contrib.quickFixController';\n\n\tstatic getQuickFixController(editor:ICommonCodeEditor): QuickFixController {\n\t\treturn <QuickFixController>editor.getContribution(QuickFixController.ID);\n\t}\n\n\tprivate eventService: IEventService;\n\tprivate editorService: IEditorService;\n\tprivate messageService: IMessageService;\n\n\tprivate editor:ICodeEditor;\n\tprivate model:QuickFixModel;\n\tprivate suggestWidget: QuickFixSelectionWidget;\n\tprivate quickFixWidgetVisible: IKeybindingContextKey<boolean>;\n\n\tconstructor(editor: ICodeEditor,\n\t\t@IMarkerService markerService: IMarkerService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IEventService eventService: IEventService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IMessageService messageService: IMessageService\n\t) {\n\t\tthis.editor = editor;\n\t\tthis.model = new QuickFixModel(this.editor, markerService, this.onAccept.bind(this));\n\t\tthis.eventService = eventService;\n\t\tthis.editorService = editorService;\n\t\tthis.messageService = messageService;\n\n\t\tthis.quickFixWidgetVisible = keybindingService.createKey(CONTEXT_QUICK_FIX_WIDGET_VISIBLE, false);\n\t\tthis.suggestWidget = new QuickFixSelectionWidget(this.editor, telemetryService,() => {\n\t\t\tthis.quickFixWidgetVisible.set(true);\n\t\t},() => {\n\t\t\tthis.quickFixWidgetVisible.reset();\n\t\t});\n\t\tthis.suggestWidget.setModel(this.model);\n\t}\n\n\tpublic getId(): string {\n\t\treturn QuickFixController.ID;\n\t}\n\n\tprivate onAccept(fix: IQuickFix2, range: IRange): void {\n\t\tvar model = this.editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tfix.support.runQuickFixAction(this.editor.getModel().getAssociatedResource(), range, { command: fix.command, score: fix.score }).then(result => {\n\t\t\tif (result) {\n\t\t\t\tif (result.message) {\n\t\t\t\t\tthis.messageService.show(Severity.Info, result.message);\n\t\t\t\t}\n\t\t\t\tif (result.edits) {\n\t\t\t\t\treturn bulkEdit(this.eventService, this.editorService, this.editor, result.edits);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn TPromise.as(0);\n\t\t}).done(undefined, err => {\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n\n\tpublic run():TPromise<boolean> {\n\t\tthis.model.triggerDialog(false, this.editor.getPosition());\n\t\tthis.editor.focus();\n\n\t\treturn TPromise.as(false);\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.destroy();\n\t\t\tthis.suggestWidget = null;\n\t\t}\n\t\tif (this.model) {\n\t\t\tthis.model.dispose();\n\t\t\tthis.model = null;\n\t\t}\n\t}\n\n\tpublic acceptSelectedSuggestion(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.acceptSelectedSuggestion();\n\t\t}\n\t}\n\tpublic closeWidget(): void {\n\t\tif (this.model) {\n\t\t\tthis.model.cancelDialog();\n\t\t}\n\t}\n\tpublic selectNextSuggestion(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.selectNext();\n\t\t}\n\t}\n\tpublic selectNextPageSuggestion(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.selectNextPage();\n\t\t}\n\t}\n\tpublic selectPrevSuggestion(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.selectPrevious();\n\t\t}\n\t}\n\tpublic selectPrevPageSuggestion(): void {\n\t\tif (this.suggestWidget) {\n\t\t\tthis.suggestWidget.selectPreviousPage();\n\t\t}\n\t}\n}\n\nexport class QuickFixAction extends EditorAction {\n\n\tstatic ID = 'editor.action.quickFix';\n\n\tconstructor(descriptor:IEditorActionDescriptorData, editor:ICommonCodeEditor) {\n\t\tsuper(descriptor, editor);\n\t}\n\n\tpublic isSupported(): boolean {\n\t\tvar model = this.editor.getModel();\n\t\treturn QuickFixRegistry.has(model) && !this.editor.getConfiguration().readOnly;\n\t}\n\n\tpublic run():TPromise<boolean> {\n\t\treturn QuickFixController.getQuickFixController(this.editor).run();\n\t}\n}\n\nvar CONTEXT_QUICK_FIX_WIDGET_VISIBLE = 'quickFixWidgetVisible';\n\nvar weight = CommonEditorRegistry.commandWeight(80);\n\n// register action\nCommonEditorRegistry.registerEditorAction(new EditorActionDescriptor(QuickFixAction, QuickFixAction.ID, nls.localize('quickfix.trigger.label', \"Quick Fix\"), {\n\tcontext: ContextKey.EditorTextFocus,\n\tprimary: KeyMod.CtrlCmd | KeyCode.US_DOT\n}));\nCommonEditorRegistry.registerEditorCommand('acceptQuickFixSuggestion', weight, { primary: KeyCode.Enter, secondary: [KeyCode.Tab] }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.acceptSelectedSuggestion();\n});\nCommonEditorRegistry.registerEditorCommand('closeQuickFixWidget', weight, { primary: KeyCode.Escape, secondary: [KeyMod.Shift | KeyCode.Escape] }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.closeWidget();\n});\nCommonEditorRegistry.registerEditorCommand('selectNextQuickFix', weight, { primary: KeyCode.DownArrow }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.selectNextSuggestion();\n});\nCommonEditorRegistry.registerEditorCommand('selectNextPageQuickFix', weight, { primary: KeyCode.PageDown }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.selectNextPageSuggestion();\n});\nCommonEditorRegistry.registerEditorCommand('selectPrevQuickFix', weight, { primary: KeyCode.UpArrow }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.selectPrevSuggestion();\n});\nCommonEditorRegistry.registerEditorCommand('selectPrevPageQuickFix', weight, { primary: KeyCode.PageUp }, false, CONTEXT_QUICK_FIX_WIDGET_VISIBLE,(ctx, editor, args) => {\n\tvar controller = QuickFixController.getQuickFixController(editor);\n\tcontroller.selectPrevPageSuggestion();\n});\n\nEditorBrowserRegistry.registerEditorContribution(QuickFixController);"]}