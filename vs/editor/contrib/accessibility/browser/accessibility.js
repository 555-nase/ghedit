/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,i){var s,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(n=(r<3?s(n):r>3?s(t,o,n):s(t,o))||n);return r>3&&n&&Object.defineProperty(t,o,n),n},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/lifecycle","vs/base/common/strings","vs/base/common/winjs.base","vs/base/browser/dom","vs/base/browser/htmlContentRenderer","vs/base/browser/styleMutator","vs/base/browser/ui/widget","vs/platform/keybinding/common/keybinding","vs/platform/keybinding/common/keybindingsRegistry","vs/editor/common/config/commonEditorConfig","vs/editor/common/editorAction","vs/editor/common/editorActionEnablement","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/browser/editorBrowserExtensions","vs/editor/contrib/toggleTabFocusMode/common/toggleTabFocusMode","vs/css!./accessibility"],function(e,t,o,i,s,r,n,d,c,a,l,h,u,m,b,y,g,p,_,f){"use strict";var v=o.localize("ShowAccessibilityHelpAction","Show Accessibility Help"),C="accessibilityHelpWidgetVisible",w="toggleExperimentalScreenReaderSupport",N=function(e){function t(t,o){e.call(this),this._editor=t,this._widget=this._register(new T(this._editor,o))}return __extends(t,e),t.get=function(e){return e.getContribution(t.ID)},t.prototype.getId=function(){return t.ID},t.prototype.show=function(){this._widget.show()},t.prototype.hide=function(){this._widget.hide()},t.ID="editor.contrib.accessibilityHelpController",t=__decorate([__param(1,h.IKeybindingService)],t)}(s.Disposable),T=function(e){function t(o,i){var s=this;e.call(this),this._editor=o,this._keybindingService=i,this._isVisibleKey=i.createKey(C,!1),this._domNode=document.createElement("div"),this._domNode.className="accessibilityHelpWidget",a.StyleMutator.setWidth(this._domNode,t.WIDTH),a.StyleMutator.setHeight(this._domNode,t.HEIGHT),this._domNode.style.display="none",this._domNode.setAttribute("role","tooltip"),this._domNode.setAttribute("aria-hidden","true"),this._isVisible=!1,this._register(this._editor.onDidLayoutChange(function(){s._isVisible&&s._layout()})),this.onblur(this._domNode,function(){s.hide()}),this._editor.addOverlayWidget(this)}return __extends(t,e),t.prototype.dispose=function(){this._editor.removeOverlayWidget(this),e.prototype.dispose.call(this)},t.prototype.getId=function(){return t.ID},t.prototype.getDomNode=function(){return this._domNode},t.prototype.getPosition=function(){return{preference:null}},t.prototype.show=function(){this._isVisible||(this._isVisible=!0,this._isVisibleKey.set(!0),this._layout(),this._domNode.style.display="block",this._domNode.setAttribute("aria-hidden","false"),this._domNode.tabIndex=0,this._buildContent(),this._domNode.focus())},t.prototype._descriptionForCommand=function(e,t,o){var i=this._keybindingService.lookupKeybindings(e);return i.length>0?r.format(t,this._keybindingService.getAriaLabelFor(i[0])):r.format(o,e)},t.prototype._buildContent=function(){var e=this._editor.getConfiguration(),t=o.localize("introMsg","Thank you for trying out VS Code's experimental accessibility options.");t+="\n\n"+o.localize("status","Status:");var i=o.localize("tabFocusModeOnMsg","Pressing Tab in this editor will move focus to the next focusable element. Toggle this behaviour by pressing {0}."),s=o.localize("tabFocusModeOnMsgNoKb","Pressing Tab in this editor will move focus to the next focusable element. The command {0} is currently not triggerable by a keybinding."),r=o.localize("tabFocusModeOffMsg","Pressing Tab in this editor will insert the tab character. Toggle this behaviour by pressing {0}."),n=o.localize("tabFocusModeOffMsgNoKb","Pressing Tab in this editor will move focus to the next focusable element. The command {0} is currently not triggerable by a keybinding.");t+=e.tabFocusMode?"\n\n - "+this._descriptionForCommand(f.ToggleTabFocusModeAction.ID,i,s):"\n\n - "+this._descriptionForCommand(f.ToggleTabFocusModeAction.ID,r,n),t+="\n\n"+o.localize("outroMsg","You can dismiss this tooltip and return to the editor by pressing Escape."),this._domNode.appendChild(c.renderHtml({formattedText:t}))},t.prototype.hide=function(){this._isVisible&&(this._isVisible=!1,this._isVisibleKey.reset(),this._domNode.style.display="none",this._domNode.setAttribute("aria-hidden","true"),this._domNode.tabIndex=-1,d.clearNode(this._domNode),this._editor.focus())},t.prototype._layout=function(){var e=this._editor.getLayoutInfo(),o=Math.round((e.height-t.HEIGHT)/2);a.StyleMutator.setTop(this._domNode,o);var i=Math.round((e.width-t.WIDTH)/2);a.StyleMutator.setLeft(this._domNode,i)},t.ID="editor.contrib.accessibilityHelpWidget",t.WIDTH=500,t.HEIGHT=300,t}(l.Widget),E=function(e){function t(t,o){e.call(this,t,o,y.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype.run=function(){var e=N.get(this.editor);return e.show(),n.TPromise.as(!0)},t}(b.EditorAction);_.EditorBrowserRegistry.registerEditorContribution(N),p.CommonEditorRegistry.registerEditorAction(new p.EditorActionDescriptor(E,g.SHOW_ACCESSIBILITY_HELP_ACTION_ID,v,{context:p.ContextKey.EditorFocus,primary:i.KeyMod.Alt|i.KeyCode.F1},"Show Accessibility Help")),p.CommonEditorRegistry.registerEditorCommand("closeAccessibilityHelp",p.CommonEditorRegistry.commandWeight(100),{primary:i.KeyCode.Escape,secondary:[i.KeyMod.Shift|i.KeyCode.Escape]},!1,C,function(e,t,o){N.get(t).hide()}),u.KeybindingsRegistry.registerCommandDesc({id:w,handler:function(e){var t=m.GlobalScreenReaderNVDA.getValue();m.GlobalScreenReaderNVDA.setValue(!t)},weight:u.KeybindingsRegistry.WEIGHT.workbenchContrib(),when:null,primary:i.KeyMod.CtrlCmd|i.KeyMod.Shift|i.KeyCode.KEY_R})});