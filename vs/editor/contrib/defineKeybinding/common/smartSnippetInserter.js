/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/base/common/json","vs/editor/common/core/position","vs/editor/common/core/range"],function(n,e,t,o,i){"use strict";var a=function(){function n(){}return n.hasOpenBrace=function(n){for(;n.scan()!==t.SyntaxKind.EOF;){var e=n.getToken();if(e===t.SyntaxKind.OpenBraceToken)return!0}return!1},n.offsetToPosition=function(n,e){for(var t=0,i=n.getEOL().length,a=n.getLineCount(),r=1;r<=a;r++){var s=n.getLineContent(r).length+i,c=t+s;if(c>e)return new o.Position(r,e-t+1);t=c}return new o.Position(a,n.getLineMaxColumn(a))},n.insertSnippet=function(n,e){var a,r=n.getValueLengthInRange(new i.Range(1,1,e.lineNumber,e.column));!function(n){n[n.INVALID=0]="INVALID",n[n.AFTER_OBJECT=1]="AFTER_OBJECT",n[n.BEFORE_OBJECT=2]="BEFORE_OBJECT"}(a||(a={}));for(var s=a.INVALID,c=-1,T=a.INVALID,p=t.createScanner(n.getValue()),f=0,u=0,I=function(n,e){e!==a.INVALID&&1===f&&0===u?(s=e,c=n,T=e):s!==a.INVALID&&(s=a.INVALID,c=p.getTokenOffset())};p.scan()!==t.SyntaxKind.EOF;){var E=p.getPosition(),O=p.getToken(),d=!1;switch(O){case t.SyntaxKind.OpenBracketToken:d=!0,f++,I(E,a.BEFORE_OBJECT);break;case t.SyntaxKind.CloseBracketToken:d=!0,f--,I(E,a.INVALID);break;case t.SyntaxKind.CommaToken:d=!0,I(E,a.BEFORE_OBJECT);break;case t.SyntaxKind.OpenBraceToken:d=!0,u++,I(E,a.INVALID);break;case t.SyntaxKind.CloseBraceToken:d=!0,u--,I(E,a.AFTER_OBJECT);break;case t.SyntaxKind.Trivia:case t.SyntaxKind.LineBreakTrivia:d=!0}if(E>=r&&(s!==a.INVALID||c!==-1)){var B=void 0,g=void 0;return s!==a.INVALID?(B=d?E:p.getTokenOffset(),g=s):(B=c,g=T),g===a.AFTER_OBJECT?{position:this.offsetToPosition(n,B),prepend:",",append:""}:(p.setPosition(B),{position:this.offsetToPosition(n,B),prepend:"",append:this.hasOpenBrace(p)?",":""})}}var L=n.getLineCount();return{position:new o.Position(L,n.getLineMaxColumn(L)),prepend:"\n[",append:"]"}},n}();e.SmartSnippetInserter=a});