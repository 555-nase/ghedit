/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/lifecycle","vs/base/common/winjs.base","vs/editor/common/core/range","vs/editor/browser/editorBrowser","vs/css!./renameInputField"],function(t,e,n,i,o,r,s,u){"use strict";var p=function(){function t(t){var e=this;this._disposables=[],this.allowEditorOverflow=!0,this._currentAcceptInput=null,this._currentCancelInput=null,this._editor=t,this._editor.addContentWidget(this),this._disposables.push(t.onDidChangeConfiguration(function(t){t.fontInfo&&e.updateFont()}))}return t.prototype.dispose=function(){this._disposables=o.dispose(this._disposables),this._editor.removeContentWidget(this)},t.prototype.getId=function(){return"__renameInputWidget"},t.prototype.getDomNode=function(){return this._domNode||(this._inputField=document.createElement("input"),this._inputField.className="rename-input",this._inputField.type="text",this._inputField.setAttribute("aria-label",n.localize("renameAriaLabel","Rename input. Type new name and press Enter to commit.")),this._domNode=document.createElement("div"),this._domNode.style.height=this._editor.getConfiguration().lineHeight+"px",this._domNode.className="monaco-editor rename-box",this._domNode.appendChild(this._inputField),this.updateFont()),this._domNode},t.prototype.updateFont=function(){if(this._inputField){var t=this._editor.getConfiguration().fontInfo;this._inputField.style.fontFamily=t.fontFamily,this._inputField.style.fontSize=t.fontSize+"px"}},t.prototype.getPosition=function(){return this._visible?{position:this._position,preference:[u.ContentWidgetPositionPreference.BELOW,u.ContentWidgetPositionPreference.ABOVE]}:null},t.prototype.acceptInput=function(){this._currentAcceptInput&&this._currentAcceptInput()},t.prototype.cancelInput=function(){this._currentCancelInput&&this._currentCancelInput()},t.prototype.getInput=function(t,e,n,u){var p=this;this._position={lineNumber:t.startLineNumber,column:t.startColumn},this._inputField.value=e,this._inputField.setAttribute("selectionStart",n.toString()),this._inputField.setAttribute("selectionEnd",u.toString()),this._inputField.size=Math.max(1.1*(t.endColumn-t.startColumn),20);var l,c=[];return l=function(){o.dispose(c),p._hide()},new r.TPromise(function(n,o){p._currentCancelInput=function(){return p._currentAcceptInput=null,p._currentCancelInput=null,o(i.canceled()),!0},p._currentAcceptInput=function(){return 0===p._inputField.value.trim().length||p._inputField.value===e?void p._currentCancelInput():(p._currentAcceptInput=null,p._currentCancelInput=null,void n(p._inputField.value))};var r=function(){s.Range.containsPosition(t,p._editor.getPosition())||p._currentCancelInput()};c.push(p._editor.onDidChangeCursorSelection(r)),c.push(p._editor.onDidBlurEditor(p._currentCancelInput)),p._show()},this._currentCancelInput).then(function(t){return l(),t},function(t){return l(),r.TPromise.wrapError(t)})},t.prototype._show=function(){var t=this;this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber),this._visible=!0,this._editor.layoutContentWidget(this),setTimeout(function(){t._inputField.focus(),t._inputField.setSelectionRange(parseInt(t._inputField.getAttribute("selectionStart")),parseInt(t._inputField.getAttribute("selectionEnd")))},25)},t.prototype._hide=function(){this._visible=!1,this._editor.layoutContentWidget(this)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=p});