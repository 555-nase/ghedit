{"version":3,"sources":["vs/editor/contrib/rename/browser/rename2.ts"],"names":[],"mappings":"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","file":"vs/editor/contrib/rename/browser/rename2.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport 'vs/css!./rename';\nimport * as nls from 'vs/nls';\nimport {isPromiseCanceledError} from 'vs/base/common/errors';\nimport {KeyMod, KeyCode} from 'vs/base/common/keyCodes';\nimport Severity from 'vs/base/common/severity';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IEditorService} from 'vs/platform/editor/common/editor';\nimport {IEventService} from 'vs/platform/event/common/event';\nimport {IKeybindingContextKey, IKeybindingService} from 'vs/platform/keybinding/common/keybindingService';\nimport {IMessageService} from 'vs/platform/message/common/message';\nimport {EditorAction} from 'vs/editor/common/editorAction';\nimport {Behaviour} from 'vs/editor/common/editorActionEnablement';\nimport {IEditorActionDescriptorData, IRange} from 'vs/editor/common/editorCommon';\nimport {CommonEditorRegistry, ContextKey, EditorActionDescriptor} from 'vs/editor/common/editorCommonExtensions';\nimport {isLineToken} from 'vs/editor/common/modes/supports';\nimport {RenameRegistry} from 'vs/editor/common/modes';\nimport {BulkEdit, createBulkEdit} from 'vs/editor/common/services/bulkEdit';\nimport {ICodeEditor} from 'vs/editor/browser/editorBrowser';\nimport {rename} from '../common/rename';\nimport RenameInputField from './renameInputField';\n\n// ---  register actions and commands\n\nconst CONTEXT_RENAME_INPUT_VISIBLE = 'renameInputVisible';\n\n// ---- action implementation\n\nexport class RenameAction extends EditorAction {\n\n\tpublic static ID: string = 'editor.action.rename';\n\n\tprivate _messageService: IMessageService;\n\tprivate _eventService: IEventService;\n\tprivate _editorService: IEditorService;\n\tprivate _renameInputField: RenameInputField;\n\tprivate _renameInputVisible: IKeybindingContextKey<boolean>;\n\n\tconstructor(descriptor: IEditorActionDescriptorData, editor: ICodeEditor,\n\t\t@IMessageService messageService: IMessageService, @IKeybindingService keybindingService: IKeybindingService,\n\t\t@IEventService eventService: IEventService, @IEditorService editorService: IEditorService) {\n\t\tsuper(descriptor, editor, Behaviour.WidgetFocus | Behaviour.Writeable | Behaviour.ShowInContextMenu | Behaviour.UpdateOnCursorPositionChange);\n\n\t\tthis._messageService = messageService;\n\t\tthis._eventService = eventService;\n\t\tthis._editorService = editorService;\n\t\tthis._renameInputField = new RenameInputField(editor);\n\t\tthis._renameInputVisible = keybindingService.createKey(CONTEXT_RENAME_INPUT_VISIBLE, false);\n\t}\n\n\tpublic getGroupId(): string {\n\t\treturn '2_change/1_rename2';\n\t}\n\n\tpublic isSupported(): boolean {\n\t\treturn RenameRegistry.has(this.editor.getModel()) && !this.editor.getModel().hasEditableRange() && super.isSupported();\n\t}\n\n\tpublic getEnablementState(): boolean {\n\n\t\tlet model = this.editor.getModel();\n\t\tlet position = this.editor.getSelection().getStartPosition();\n\t\tlet lineContext = model.getLineContext(position.lineNumber);\n\n\t\treturn RenameRegistry.ordered(model).some(support => {\n\t\t\tif (!support.filter) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (isLineToken(lineContext, position.column - 1, support.filter)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (position.column > 1 && isLineToken(lineContext, position.column - 2, support.filter)) {\n\t\t\t\t// in case we are in between two tokens\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic run(event?: any): TPromise<any> {\n\n\t\tconst selection = this.editor.getSelection(),\n\t\t\tword = this.editor.getModel().getWordAtPosition(selection.getStartPosition());\n\n\t\tif (!word) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet lineNumber = selection.startLineNumber,\n\t\t\tselectionStart = 0,\n\t\t\tselectionEnd = word.word.length,\n\t\t\twordRange: IRange;\n\n\t\twordRange = {\n\t\t\tstartLineNumber: lineNumber,\n\t\t\tstartColumn: word.startColumn,\n\t\t\tendLineNumber: lineNumber,\n\t\t\tendColumn: word.endColumn\n\t\t};\n\n\t\tif (!selection.isEmpty() && selection.startLineNumber === selection.endLineNumber) {\n\t\t\tselectionStart = Math.max(0, selection.startColumn - word.startColumn);\n\t\t\tselectionEnd = Math.min(word.endColumn, selection.endColumn) - word.startColumn;\n\t\t}\n\n\t\tthis._renameInputVisible.set(true);\n\t\treturn this._renameInputField.getInput(wordRange, word.word, selectionStart, selectionEnd).then(newName => {\n\t\t\tthis._renameInputVisible.reset();\n\t\t\treturn this._prepareRename(newName).then(edit => {\n\n\t\t\t\treturn edit.finish().then(selection => {\n\t\t\t\t\tthis.editor.focus();\n\t\t\t\t\tif (selection) {\n\t\t\t\t\t\tthis.editor.setSelection(selection);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}, err => {\n\t\t\t\tif (typeof err === 'string') {\n\t\t\t\t\tthis._messageService.show(Severity.Info, err);\n\t\t\t\t} else {\n\t\t\t\t\treturn TPromise.wrapError(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}, err => {\n\t\t\tthis._renameInputVisible.reset();\n\t\t\tthis.editor.focus();\n\n\t\t\tif (!isPromiseCanceledError(err)) {\n\t\t\t\treturn TPromise.wrapError(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic acceptRenameInput(): void {\n\t\tthis._renameInputField.acceptInput();\n\t}\n\n\tpublic cancelRenameInput(): void {\n\t\tthis._renameInputField.cancelInput();\n\t}\n\n\tprivate _prepareRename(newName: string): TPromise<BulkEdit> {\n\n\t\t// start recording of file changes so that we can figure out if a file that\n\t\t// is to be renamed conflicts with another (concurrent) modification\n\t\tlet edit = createBulkEdit(this._eventService, this._editorService, <ICodeEditor>this.editor);\n\n\t\treturn rename(this.editor.getModel(), this.editor.getPosition(), newName).then(result => {\n\t\t\tif (result.rejectReason) {\n\t\t\t\treturn TPromise.wrapError(result.rejectReason);\n\t\t\t}\n\t\t\tedit.add(result.edits);\n\t\t\treturn edit;\n\t\t});\n\t}\n}\n\nconst weight = CommonEditorRegistry.commandWeight(99);\n\nCommonEditorRegistry.registerEditorAction(new EditorActionDescriptor(RenameAction, RenameAction.ID, nls.localize('rename.label', \"Rename Symbol\"), {\n\tcontext: ContextKey.EditorTextFocus,\n\tprimary: KeyCode.F2\n}));\n\nCommonEditorRegistry.registerEditorCommand('acceptRenameInput', weight, { primary: KeyCode.Enter }, false, CONTEXT_RENAME_INPUT_VISIBLE, (ctx, editor, args) => {\n\tconst action = <RenameAction>editor.getAction(RenameAction.ID);\n\taction.acceptRenameInput();\n});\n\nCommonEditorRegistry.registerEditorCommand('cancelRenameInput', weight, { primary: KeyCode.Escape, secondary: [KeyMod.Shift | KeyCode.Escape] }, false, CONTEXT_RENAME_INPUT_VISIBLE, (ctx, editor, args) => {\n\tconst action = <RenameAction>editor.getAction(RenameAction.ID);\n\taction.cancelRenameInput();\n});\n"]}