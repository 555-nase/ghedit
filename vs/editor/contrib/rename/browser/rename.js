/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},__param=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/keyCodes","vs/base/common/severity","vs/base/common/winjs.base","vs/platform/editor/common/editor","vs/platform/event/common/event","vs/platform/keybinding/common/keybinding","vs/platform/message/common/message","vs/platform/progress/common/progress","vs/editor/common/editorAction","vs/editor/common/editorActionEnablement","vs/editor/common/editorCommonExtensions","vs/editor/common/editorCommon","vs/editor/common/services/bulkEdit","vs/editor/common/modes","../common/rename","./renameInputField"],function(e,t,r,o,n,i,s,a,m,c,d,p,u,l,v,h,f,_,g,y){"use strict";var b="renameInputVisible",E=function(e){function t(t,r,o,n,i,s,a){e.call(this,t,r,l.Behaviour.WidgetFocus|l.Behaviour.Writeable),this._messageService=o,this._eventService=n,this._editorService=i,this._progressService=s,this._renameInputField=new y["default"](r),this._renameInputVisible=a.createKey(b,!1)}return __extends(t,e),t.prototype.isSupported=function(){return _.RenameProviderRegistry.has(this.editor.getModel())&&!this.editor.getModel().hasEditableRange()&&e.prototype.isSupported.call(this)},t.prototype.getEnablementState=function(){return _.RenameProviderRegistry.has(this.editor.getModel())},t.prototype.run=function(e){var t=this,n=this.editor.getSelection(),a=this.editor.getModel().getWordAtPosition(n.getStartPosition());if(a){var m,c=n.startLineNumber,d=0,p=a.word.length;return m={startLineNumber:c,startColumn:a.startColumn,endLineNumber:c,endColumn:a.endColumn},n.isEmpty()||n.startLineNumber!==n.endLineNumber||(d=Math.max(0,n.startColumn-a.startColumn),p=Math.min(a.endColumn,n.endColumn)-a.startColumn),this._renameInputVisible.set(!0),this._renameInputField.getInput(m,a.word,d,p).then(function(e){t._renameInputVisible.reset(),t.editor.focus();var o=t._prepareRename(e).then(function(e){return e.finish().then(function(e){e&&t.editor.setSelection(e)})},function(e){return"string"!=typeof e?(t._messageService.show(i["default"].Error,r.localize("rename.failed","Sorry, rename failed to execute.")),s.TPromise.wrapError(e)):void t._messageService.show(i["default"].Info,e)});return t._progressService.showWhile(o,250),o},function(e){if(t._renameInputVisible.reset(),t.editor.focus(),!o.isPromiseCanceledError(e))return s.TPromise.wrapError(e)})}},t.prototype.acceptRenameInput=function(){this._renameInputField.acceptInput()},t.prototype.cancelRenameInput=function(){this._renameInputField.cancelInput()},t.prototype._prepareRename=function(e){var t=f.createBulkEdit(this._eventService,this._editorService,this.editor);return g.rename(this.editor.getModel(),this.editor.getPosition(),e).then(function(e){return e.rejectReason?s.TPromise.wrapError(e.rejectReason):(t.add(e.edits),t)})},t.ID="editor.action.rename",t=__decorate([__param(2,d.IMessageService),__param(3,m.IEventService),__param(4,a.IEditorService),__param(5,p.IProgressService),__param(6,c.IKeybindingService)],t)}(u.EditorAction);t.RenameAction=E;var I=v.CommonEditorRegistry.commandWeight(99);v.CommonEditorRegistry.registerEditorAction({ctor:E,id:E.ID,label:r.localize("rename.label","Rename Symbol"),alias:"Rename Symbol",kbOpts:{context:v.ContextKey.EditorTextFocus,primary:n.KeyCode.F2},menuOpts:{group:"1_modification",order:1.1,kbExpr:c.KbExpr.and(c.KbExpr.has(h.ModeContextKeys.hasRenameProvider),c.KbExpr.not(h.KEYBINDING_CONTEXT_EDITOR_READONLY))}}),v.CommonEditorRegistry.registerEditorCommand("acceptRenameInput",I,{primary:n.KeyCode.Enter},!1,b,function(e,t,r){var o=t.getAction(E.ID);o.acceptRenameInput()}),v.CommonEditorRegistry.registerEditorCommand("cancelRenameInput",I,{primary:n.KeyCode.Escape,secondary:[n.KeyMod.Shift|n.KeyCode.Escape]},!1,b,function(e,t,r){var o=t.getAction(E.ID);o.cancelRenameInput()})});