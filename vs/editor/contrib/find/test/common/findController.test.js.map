{"version":3,"file":"vs/editor/contrib/find/test/common/findController.test.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/editor/contrib/find/test/common/findController.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as assert from 'assert';\nimport {EditOperation} from 'vs/editor/common/core/editOperation';\nimport {Position} from 'vs/editor/common/core/position';\nimport {Range} from 'vs/editor/common/core/range';\nimport {IRange} from 'vs/editor/common/editorCommon';\nimport {CommonFindController, FindStartFocusAction, IFindStartOptions, NextMatchFindAction, StartFindAction} from 'vs/editor/contrib/find/common/findController';\nimport {withMockCodeEditor} from 'vs/editor/test/common/mocks/mockCodeEditor';\n\nclass TestFindController extends CommonFindController {\n\n\tpublic hasFocus: boolean;\n\n\tprotected _start(opts:IFindStartOptions): void {\n\t\tsuper._start(opts);\n\n\t\tif (opts.shouldFocus !== FindStartFocusAction.NoFocusChange) {\n\t\t\tthis.hasFocus = true;\n\t\t}\n\t}\n}\n\nsuite('FindController', () => {\n\n\tfunction fromRange(rng:IRange): number[] {\n\t\treturn [rng.startLineNumber, rng.startColumn, rng.endLineNumber, rng.endColumn];\n\t}\n\n\ttest('issue #1857: F3, Find Next, acts like \"Find Under Cursor\"', () => {\n\t\twithMockCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], {}, (editor, cursor) => {\n\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tlet findController = editor.registerAndInstantiateContribution<TestFindController>(TestFindController);\n\t\t\tlet findState = findController.getState();\n\t\t\tlet startFindAction = new StartFindAction({id:'',label:''}, editor);\n\t\t\tlet nextMatchFindAction = new NextMatchFindAction({id:'',label:''}, editor);\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tstartFindAction.run();\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'A' }, true);\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\t// The first ABC is highlighted.\n\t\t\tassert.deepEqual(fromRange(editor.getSelection()), [1, 1, 1, 4]);\n\n\t\t\t// I hit Esc to exit the Find dialog.\n\t\t\tfindController.closeFindWidget();\n\t\t\tfindController.hasFocus = false;\n\n\t\t\t// The cursor is now at end of the first line, with ABC on that line highlighted.\n\t\t\tassert.deepEqual(fromRange(editor.getSelection()), [1, 1, 1, 4]);\n\n\t\t\t// I hit delete to remove it and change the text to XYZ.\n\t\t\teditor.executeEdits('test', [EditOperation.delete(new Range(1, 1, 1, 4))]);\n\t\t\teditor.executeEdits('test', [EditOperation.insert(new Position(1, 1), 'XYZ')]);\n\n\t\t\t// At this point the text editor looks like this:\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\tassert.equal(editor.getModel().getLineContent(1), 'XYZ');\n\n\t\t\t// The cursor is at end of the first line.\n\t\t\tassert.deepEqual(fromRange(editor.getSelection()), [1, 4, 1, 4]);\n\n\t\t\t// I hit F3 to \"Find Next\" to find the next occurrence of ABC, but instead it searches for XYZ.\n\t\t\tnextMatchFindAction.run();\n\n\t\t\tassert.equal(findState.searchString, 'ABC');\n\t\t\tassert.equal(findController.hasFocus, false);\n\n\t\t\tfindController.dispose();\n\t\t\tstartFindAction.dispose();\n\t\t\tnextMatchFindAction.dispose();\n\t\t});\n\t});\n\n\ttest('issue #3090: F3 does not loop with two matches on a single line', () => {\n\t\twithMockCodeEditor([\n\t\t\t'import nls = require(\\'vs/nls\\');'\n\t\t], {}, (editor, cursor) => {\n\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tlet findController = editor.registerAndInstantiateContribution<TestFindController>(TestFindController);\n\t\t\tlet nextMatchFindAction = new NextMatchFindAction({id:'',label:''}, editor);\n\n\t\t\teditor.setPosition({\n\t\t\t\tlineNumber: 1,\n\t\t\t\tcolumn: 9\n\t\t\t});\n\n\t\t\tnextMatchFindAction.run();\n\t\t\tassert.deepEqual(fromRange(editor.getSelection()), [1, 26, 1, 29]);\n\n\t\t\tnextMatchFindAction.run();\n\t\t\tassert.deepEqual(fromRange(editor.getSelection()), [1, 8, 1, 11]);\n\n\t\t\tfindController.dispose();\n\t\t\tnextMatchFindAction.dispose();\n\t\t});\n\t});\n});\n"]}