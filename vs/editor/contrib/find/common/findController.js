var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};define(["require","exports","vs/nls","vs/base/common/keyCodes","vs/base/common/lifecycle","vs/base/common/winjs.base","vs/platform/keybinding/common/keybinding","vs/editor/common/core/range","vs/editor/common/core/selection","vs/editor/common/editorAction","vs/editor/common/editorActionEnablement","vs/base/common/strings","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/contrib/find/common/findModel","vs/editor/contrib/find/common/findState","vs/editor/common/modes","vs/base/common/async"],function(e,t,o,i,r,n,s,c,a,d,l,u,h,g,m,p,_,f){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function v(e,t){var o,i,r=S.getFindController(e),n=r.getState(),s=n.wholeWord,c=n.matchCase;if(!e.isFocused()&&n.isRevealed&&n.searchString.length>0)o=n.searchString;else{var d=e.getSelection();if(d.startLineNumber!==d.endLineNumber)return null;if(d.isEmpty()){var l=e.getModel().getWordAtPosition(d.getStartPosition());if(!l)return null;o=l.word,i=new a.Selection(d.startLineNumber,l.startColumn,d.startLineNumber,l.endColumn)}else o=e.getModel().getValueInRange(d);t&&r.setSearchString(o)}return{searchText:o,matchCase:c,wholeWord:s,currentMatch:i}}function y(e,t,o,i){void 0===i&&(i=null),g.CommonEditorRegistry.registerEditorCommand(e,g.CommonEditorRegistry.commandWeight(5),o,!1,i,function(e,o,i){t(S.getFindController(o))})}!function(e){e[e.NoFocusChange=0]="NoFocusChange",e[e.FocusFindInput=1]="FocusFindInput",e[e.FocusReplaceInput=2]="FocusReplaceInput"}(t.FindStartFocusAction||(t.FindStartFocusAction={}));var C=t.FindStartFocusAction;t.CONTEXT_FIND_WIDGET_VISIBLE="findWidgetVisible";var S=function(e){function o(o,i){var r=this;e.call(this),this._editor=o,this._findWidgetVisible=i.createKey(t.CONTEXT_FIND_WIDGET_VISIBLE,!1),this._state=this._register(new p.FindReplaceState),this._register(this._state.addChangeListener(function(e){return r._onStateChanged(e)})),this._model=null,this._register(this._editor.onDidChangeModel(function(){var e=r._editor.getModel()&&r._state.isRevealed;r.disposeModel(),r._state.change({searchScope:null},!1),e&&r._start({forceRevealReplace:!1,seedSearchStringFromSelection:!1,shouldFocus:C.NoFocusChange,shouldAnimate:!1})}))}return __extends(o,e),o.getFindController=function(e){return e.getContribution(o.ID)},o.prototype.dispose=function(){this.disposeModel(),e.prototype.dispose.call(this)},o.prototype.disposeModel=function(){this._model&&(this._model.dispose(),this._model=null)},o.prototype.getId=function(){return o.ID},o.prototype._onStateChanged=function(e){e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel()))},o.prototype.getState=function(){return this._state},o.prototype.closeFindWidget=function(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()},o.prototype.toggleCaseSensitive=function(){this._state.change({matchCase:!this._state.matchCase},!1)},o.prototype.toggleWholeWords=function(){this._state.change({wholeWord:!this._state.wholeWord},!1)},o.prototype.toggleRegex=function(){this._state.change({isRegex:!this._state.isRegex},!1)},o.prototype.setSearchString=function(e){this._state.change({searchString:e},!1)},o.prototype.getSelectionSearchString=function(){var e=this._editor.getSelection();if(e.startLineNumber===e.endLineNumber){if(!e.isEmpty())return this._editor.getModel().getValueInRange(e);var t=this._editor.getModel().getWordAtPosition(e.getStartPosition());if(t)return t.word}return null},o.prototype._start=function(e){if(this.disposeModel(),this._editor.getModel()){var t={isRevealed:!0};if(e.seedSearchStringFromSelection){var o=this.getSelectionSearchString();o&&(this._state.isRegex?t.searchString=u.escapeRegExpCharacters(o):t.searchString=o)}e.forceRevealReplace&&(t.isReplaceRevealed=!0),this._state.change(t,!1),this._model||(this._model=new m.FindModelBoundToEditorModel(this._editor,this._state))}},o.prototype.start=function(e){this._start(e)},o.prototype.moveToNextMatch=function(){return!!this._model&&(this._model.moveToNextMatch(),!0)},o.prototype.moveToPrevMatch=function(){return!!this._model&&(this._model.moveToPrevMatch(),!0)},o.prototype.replace=function(){return!!this._model&&(this._model.replace(),!0)},o.prototype.replaceAll=function(){return!!this._model&&(this._model.replaceAll(),!0)},o.prototype.selectAllMatches=function(){return!!this._model&&(this._model.selectAllMatches(),this._editor.focus(),!0)},o.ID="editor.contrib.findController",o=__decorate([__param(1,s.IKeybindingService)],o)}(r.Disposable);t.CommonFindController=S;var F=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype.run=function(){var e=S.getFindController(this.editor);return e.start({forceRevealReplace:!1,seedSearchStringFromSelection:!0,shouldFocus:C.FocusFindInput,shouldAnimate:!0}),n.TPromise.as(!0)},t}(d.EditorAction);t.StartFindAction=F;var M=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype.run=function(){var e=S.getFindController(this.editor);return this._run(e)||(e.start({forceRevealReplace:!1,seedSearchStringFromSelection:0===e.getState().searchString.length,shouldFocus:C.NoFocusChange,shouldAnimate:!0}),this._run(e)),n.TPromise.as(!0)},t}(d.EditorAction);t.MatchFindAction=M;var A=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._run=function(e){return e.moveToNextMatch()},t}(M);t.NextMatchFindAction=A;var E=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._run=function(e){return e.moveToPrevMatch()},t}(M);t.PreviousMatchFindAction=E;var I=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype.run=function(){var e=S.getFindController(this.editor),t=e.getSelectionSearchString();return t&&e.setSearchString(t),this._run(e)||(e.start({forceRevealReplace:!1,seedSearchStringFromSelection:!1,shouldFocus:C.NoFocusChange,shouldAnimate:!0}),this._run(e)),n.TPromise.as(!0)},t}(d.EditorAction);t.SelectionMatchFindAction=I;var D=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._run=function(e){return e.moveToNextMatch()},t}(I);t.NextSelectionMatchFindAction=D;var K=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._run=function(e){return e.moveToPrevMatch()},t}(I);t.PreviousSelectionMatchFindAction=K;var x=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus|l.Behaviour.Writeable)}return __extends(t,e),t.prototype.run=function(){var e=S.getFindController(this.editor);return e.start({forceRevealReplace:!0,seedSearchStringFromSelection:!0,shouldFocus:C.FocusReplaceInput,shouldAnimate:!0}),n.TPromise.as(!0)},t}(d.EditorAction);t.StartFindReplaceAction=x;var N=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype._getNextMatch=function(){var e=v(this.editor,!0);if(!e)return null;if(e.currentMatch)return e.currentMatch;var t=this.editor.getSelections(),o=t[t.length-1],i=this.editor.getModel().findNextMatch(e.searchText,o.getEndPosition(),!1,e.matchCase,e.wholeWord);return i?new a.Selection(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn):null},t}(d.EditorAction);t.SelectNextFindMatchAction=N;var R=function(e){function t(t,o){e.call(this,t,o,l.Behaviour.WidgetFocus)}return __extends(t,e),t.prototype._getPreviousMatch=function(){var e=v(this.editor,!0);if(!e)return null;if(e.currentMatch)return e.currentMatch;var t=this.editor.getSelections(),o=t[t.length-1],i=this.editor.getModel().findPreviousMatch(e.searchText,o.getStartPosition(),!1,e.matchCase,e.wholeWord);return i?new a.Selection(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn):null},t}(d.EditorAction);t.SelectPreviousFindMatchAction=R;var T=function(e){function t(t,o){e.call(this,t,o)}return __extends(t,e),t.prototype.run=function(){var e=this._getNextMatch();if(!e)return n.TPromise.as(!1);var t=this.editor.getSelections();return this.editor.setSelections(t.concat(e)),this.editor.revealRangeInCenterIfOutsideViewport(e),n.TPromise.as(!0)},t.ID=m.FIND_IDS.AddSelectionToNextFindMatchAction,t}(N);t.AddSelectionToNextFindMatchAction=T;var P=function(e){function t(t,o){e.call(this,t,o)}return __extends(t,e),t.prototype.run=function(){var e=this._getPreviousMatch();if(!e)return n.TPromise.as(!1);var t=this.editor.getSelections();return this.editor.setSelections(t.concat(e)),this.editor.revealRangeInCenterIfOutsideViewport(e),n.TPromise.as(!0)},t.ID=m.FIND_IDS.AddSelectionToPreviousFindMatchAction,t}(R);t.AddSelectionToPreviousFindMatchAction=P;var W=function(e){function t(t,o){e.call(this,t,o)}return __extends(t,e),t.prototype.run=function(){var e=this._getNextMatch();if(!e)return n.TPromise.as(!1);var t=this.editor.getSelections();return this.editor.setSelections(t.slice(0,t.length-1).concat(e)),this.editor.revealRangeInCenterIfOutsideViewport(e),n.TPromise.as(!0)},t.ID=m.FIND_IDS.MoveSelectionToNextFindMatchAction,t}(N);t.MoveSelectionToNextFindMatchAction=W;var b=function(e){function t(t,o){e.call(this,t,o)}return __extends(t,e),t.prototype.run=function(){var e=this._getPreviousMatch();if(!e)return n.TPromise.as(!1);var t=this.editor.getSelections();return this.editor.setSelections(t.slice(0,t.length-1).concat(e)),this.editor.revealRangeInCenterIfOutsideViewport(e),n.TPromise.as(!0)},t.ID=m.FIND_IDS.MoveSelectionToPreviousFindMatchAction,t}(R);t.MoveSelectionToPreviousFindMatchAction=b;var w=function(e){function t(t,o){var i=l.Behaviour.WidgetFocus|l.Behaviour.Writeable;e.call(this,t,o,i)}return __extends(t,e),t.prototype.run=function(){var e=v(this.editor,!0);if(!e)return n.TPromise.as(!1);var t=this.editor.getModel().findMatches(e.searchText,!0,!1,e.matchCase,e.wholeWord);if(t.length>0){for(var o=this.editor.getSelection(),i=0,r=t.length;i<r;i++){var s=t[i],c=s.intersectRanges(o);if(c){t.splice(i,1),t.unshift(s);break}}this.editor.setSelections(t.map(function(e){return new a.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}))}return n.TPromise.as(!0)},t.ID="editor.action.selectHighlights",t.COMPAT_ID="editor.action.changeAll",t}(d.EditorAction);t.SelectHighlightsAction=w;var O=function(e){function t(t){var o=this;e.call(this),this.editor=t,this.decorations=[],this.updateSoon=this._register(new f.RunOnceScheduler(function(){return o._update()},300)),this.lastWordUnderCursor=null,this._register(t.onDidChangeCursorSelection(function(e){e.selection.isEmpty()?e.reason===h.CursorChangeReason.Explicit?(o.lastWordUnderCursor&&o.lastWordUnderCursor.containsPosition(e.selection.getStartPosition())||o.removeDecorations(),o.updateSoon.schedule()):o.removeDecorations():o._update()})),this._register(t.onDidChangeModel(function(e){o.removeDecorations()})),this._register(S.getFindController(t).getState().addChangeListener(function(e){o._update()}))}return __extends(t,e),t.prototype.getId=function(){return t.ID},t.prototype.removeDecorations=function(){this.lastWordUnderCursor=null,this.decorations.length>0&&(this.decorations=this.editor.deltaDecorations(this.decorations,[]))},t.prototype._update=function(){var e=this.editor.getModel();if(e&&(this.lastWordUnderCursor=null,this.editor.getConfiguration().contribInfo.selectionHighlight)){var t=v(this.editor,!1);if(!t)return void this.removeDecorations();var o=_.DocumentHighlightProviderRegistry.has(e);if(t.currentMatch){if(o)return void this.removeDecorations();this.lastWordUnderCursor=t.currentMatch}if(/^[ \t]+$/.test(t.searchText))return void this.removeDecorations();if(t.searchText.length>200)return void this.removeDecorations();for(var i=this.editor.getSelections(),r=e.getValueInRange(i[0]),n=1;n<i.length;n++){var s=e.getValueInRange(i[n]);if(r!==s)return void this.removeDecorations()}var a=e.findMatches(t.searchText,!0,!1,t.matchCase,t.wholeWord);a.sort(c.Range.compareRangesUsingStarts),i.sort(c.Range.compareRangesUsingStarts);for(var d=[],n=0,l=0,u=a.length,g=i.length;n<u;){var m=a[n];if(l>=g)d.push(m),n++;else{var p=c.Range.compareRangesUsingStarts(m,i[l]);p<0?(d.push(m),n++):p>0?l++:(n++,l++)}}var f=d.map(function(e){return{range:e,options:{stickiness:h.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,className:"selectionHighlight",overviewRuler:o?void 0:{color:"#A0A0A0",darkColor:"#A0A0A0",position:h.OverviewRulerLane.Center}}}});this.decorations=this.editor.deltaDecorations(this.decorations,f)}},t.prototype.dispose=function(){this.removeDecorations(),e.prototype.dispose.call(this)},t.ID="editor.contrib.selectionHighlighter",t}(r.Disposable);t.SelectionHighlighter=O,g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(w,w.ID,o.localize("selectAllOccurencesOfFindMatch","Select All Occurences of Find Match"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.CtrlCmd|i.KeyMod.Shift|i.KeyCode.KEY_L},"Select All Occurences of Find Match")),g.CommonEditorRegistry.registerEditorAction({ctor:w,id:w.COMPAT_ID,label:o.localize("changeAll.label","Change All Occurrences"),alias:"Change All Occurrences",kbOpts:{context:g.ContextKey.EditorTextFocus,primary:i.KeyMod.CtrlCmd|i.KeyCode.F2},menuOpts:{group:"1_modification",order:1.2,kbExpr:s.KbExpr.not(h.KEYBINDING_CONTEXT_EDITOR_READONLY)}}),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(F,m.FIND_IDS.StartFindAction,o.localize("startFindAction","Find"),{context:g.ContextKey.None,primary:i.KeyMod.CtrlCmd|i.KeyCode.KEY_F},"Find")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(A,m.FIND_IDS.NextMatchFindAction,o.localize("findNextMatchAction","Find Next"),{context:g.ContextKey.EditorFocus,primary:i.KeyCode.F3,mac:{primary:i.KeyMod.CtrlCmd|i.KeyCode.KEY_G,secondary:[i.KeyCode.F3]}},"Find Next")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(E,m.FIND_IDS.PreviousMatchFindAction,o.localize("findPreviousMatchAction","Find Previous"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.Shift|i.KeyCode.F3,mac:{primary:i.KeyMod.CtrlCmd|i.KeyMod.Shift|i.KeyCode.KEY_G,secondary:[i.KeyMod.Shift|i.KeyCode.F3]}},"Find Previous")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(D,m.FIND_IDS.NextSelectionMatchFindAction,o.localize("nextSelectionMatchFindAction","Find Next Selection"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.CtrlCmd|i.KeyCode.F3},"Find Next Selection")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(K,m.FIND_IDS.PreviousSelectionMatchFindAction,o.localize("previousSelectionMatchFindAction","Find Previous Selection"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.CtrlCmd|i.KeyMod.Shift|i.KeyCode.F3},"Find Previous Selection")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(x,m.FIND_IDS.StartFindReplaceAction,o.localize("startReplace","Replace"),{context:g.ContextKey.None,primary:i.KeyMod.CtrlCmd|i.KeyCode.KEY_H,mac:{primary:i.KeyMod.CtrlCmd|i.KeyMod.Alt|i.KeyCode.KEY_F}},"Replace")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(W,W.ID,o.localize("moveSelectionToNextFindMatch","Move Last Selection To Next Find Match"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.chord(i.KeyMod.CtrlCmd|i.KeyCode.KEY_K,i.KeyMod.CtrlCmd|i.KeyCode.KEY_D)},"Move Last Selection To Next Find Match")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(b,b.ID,o.localize("moveSelectionToPreviousFindMatch","Move Last Selection To Previous Find Match"),{context:g.ContextKey.EditorFocus,primary:0},"Move Last Selection To Previous Find Match")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(T,T.ID,o.localize("addSelectionToNextFindMatch","Add Selection To Next Find Match"),{context:g.ContextKey.EditorFocus,primary:i.KeyMod.CtrlCmd|i.KeyCode.KEY_D},"Add Selection To Next Find Match")),g.CommonEditorRegistry.registerEditorAction(new g.EditorActionDescriptor(P,P.ID,o.localize("addSelectionToPreviousFindMatch","Add Selection To Previous Find Match"),{context:g.ContextKey.EditorFocus,primary:0},"Add Selection To Previous Find Match")),y(m.FIND_IDS.CloseFindWidgetCommand,function(e){return e.closeFindWidget()},{primary:i.KeyCode.Escape,secondary:[i.KeyMod.Shift|i.KeyCode.Escape]},t.CONTEXT_FIND_WIDGET_VISIBLE),y(m.FIND_IDS.ToggleCaseSensitiveCommand,function(e){return e.toggleCaseSensitive()},{primary:i.KeyMod.Alt|i.KeyCode.KEY_C,mac:{primary:i.KeyMod.CtrlCmd|i.KeyMod.Alt|i.KeyCode.KEY_C}}),y(m.FIND_IDS.ToggleWholeWordCommand,function(e){return e.toggleWholeWords()},{primary:i.KeyMod.Alt|i.KeyCode.KEY_W,mac:{primary:i.KeyMod.CtrlCmd|i.KeyMod.Alt|i.KeyCode.KEY_W}}),y(m.FIND_IDS.ToggleRegexCommand,function(e){return e.toggleRegex()},{primary:i.KeyMod.Alt|i.KeyCode.KEY_R,mac:{primary:i.KeyMod.CtrlCmd|i.KeyMod.Alt|i.KeyCode.KEY_R}}),y(m.FIND_IDS.ReplaceOneAction,function(e){return e.replace()},{primary:i.KeyMod.CtrlCmd|i.KeyMod.Shift|i.KeyCode.KEY_1},t.CONTEXT_FIND_WIDGET_VISIBLE),y(m.FIND_IDS.ReplaceAllAction,function(e){return e.replaceAll()},{primary:i.KeyMod.CtrlCmd|i.KeyMod.Alt|i.KeyCode.Enter},t.CONTEXT_FIND_WIDGET_VISIBLE),y(m.FIND_IDS.SelectAllMatchesAction,function(e){return e.selectAllMatches()},{primary:i.KeyMod.Alt|i.KeyCode.Enter},t.CONTEXT_FIND_WIDGET_VISIBLE)});