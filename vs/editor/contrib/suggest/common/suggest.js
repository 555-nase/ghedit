define(["require","exports","vs/base/common/async","vs/base/common/arrays","vs/base/common/strings","vs/base/common/errors","vs/base/common/winjs.base","vs/editor/common/editorCommonExtensions","vs/editor/common/modes","vs/editor/common/modes/snippetsRegistry","vs/platform/platform"],function(e,t,n,s,o,i,r,u,g,p,f){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function m(e,t,o){void 0===o&&(o={});var u=[],p=a(o),f=y(o),m={suggestions:[],currentWord:""};l.getSnippetCompletions(e,t,m.suggestions),c(u,m,void 0,p);var v=!1,d=(o.groups||g.SuggestRegistry.orderedGroups(e)).map(function(o){return function(){if(!v)return r.TPromise.join(o.map(function(o){return n.asWinJsPromise(function(n){return o.provideCompletionItems(e,t,n)}).then(function(e){if(!s.isFalsyOrEmpty(e))for(var t=0,n=e;t<n.length;t++){var i=n[t];v=c(u,i,o,p)||v}},i.onUnexpectedError)}))}});return n.sequence(d).then(function(){return u.sort(f)})}function c(e,t,n,s){if(!t)return!1;if(!t.suggestions)return!1;for(var o=e.length,i=0,r=t.suggestions;i<r.length;i++){var u=r[i];s(u)&&e.push({support:n,suggestion:u,container:t})}return o!==e.length}function a(e){return"only"===e.snippetConfig?function(e){return"snippet"===e.type}:"none"===e.snippetConfig?function(e){return"snippet"!==e.type}:function(e){return!0}}function y(e){function t(e,t){var n=0;return"string"==typeof e.suggestion.sortText&&"string"==typeof t.suggestion.sortText&&(n=o.compare(e.suggestion.sortText.toLowerCase(),t.suggestion.sortText.toLowerCase())),n||(n=o.compare(e.suggestion.label.toLowerCase(),t.suggestion.label.toLowerCase())),n||e.suggestion.type===t.suggestion.type||("snippet"===e.suggestion.type?n=1:"snippet"===t.suggestion.type&&(n=-1)),n}function n(e,n){if(e.suggestion.type!==n.suggestion.type){if("snippet"===e.suggestion.type)return-1;if("snippet"===n.suggestion.type)return 1}return t(e,n)}function s(e,n){if(e.suggestion.type!==n.suggestion.type){if("snippet"===e.suggestion.type)return 1;if("snippet"===n.suggestion.type)return-1}return t(e,n)}return"top"===e.snippetConfig?n:"bottom"===e.snippetConfig?s:t}t.Context={Visible:"suggestWidgetVisible",MultipleSuggestions:"suggestWidgetMultipleSuggestions",AcceptOnKey:"suggestionSupportsAcceptOnKey"};var l=f.Registry.as(p.Extensions.Snippets);t.provideSuggestionItems=m,u.CommonEditorRegistry.registerDefaultLanguageCommand("_executeCompletionItemProvider",function(e,t,n){return m(e,t)})});