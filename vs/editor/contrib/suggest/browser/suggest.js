var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var g=e.length-1;g>=0;g--)(r=e[g])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/keyCodes","vs/base/common/lifecycle","vs/base/common/winjs.base","vs/platform/instantiation/common/instantiation","vs/platform/keybinding/common/keybinding","vs/editor/common/editorAction","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/common/modes","vs/editor/browser/editorBrowserExtensions","vs/editor/contrib/snippet/common/snippet","vs/editor/contrib/suggest/common/suggest","vs/platform/keybinding/common/keybindingsRegistry","vs/editor/common/config/config","../common/suggestModel","./suggestWidget"],function(e,t,i,o,r,n,s,g,d,a,c,u,p,h,l,y,C,m,E,K){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function f(e,t){return function(i){return m.withCodeEditorFromCommandHandler(e,i,function(e){t(S.getController(e))})}}var S=function(){function e(e,t){var i=this;this.editor=e,this.model=new E.SuggestModel(this.editor),this.widget=t.createInstance(K.SuggestWidget,this.editor,this.model),this.triggerCharacterListeners=[],this.toDispose=[],this.toDispose.push(e.onDidChangeConfiguration(function(){return i.update()})),this.toDispose.push(e.onDidChangeModel(function(){return i.update()})),this.toDispose.push(e.onDidChangeModelMode(function(){return i.update()})),this.toDispose.push(p.SuggestRegistry.onDidChange(this.update,this)),this.toDispose.push(this.model.onDidAccept(function(e){return l.getSnippetController(i.editor).run(e.snippet,e.overwriteBefore,e.overwriteAfter)})),this.update()}return e.getController=function(t){return t.getContribution(e.ID)},e.prototype.getId=function(){return e.ID},e.prototype.dispose=function(){this.toDispose=n.dispose(this.toDispose),this.triggerCharacterListeners=n.dispose(this.triggerCharacterListeners),this.widget&&(this.widget.dispose(),this.widget=null),this.model&&(this.model.dispose(),this.model=null)},e.prototype.update=function(){var e=this;if(this.triggerCharacterListeners=n.dispose(this.triggerCharacterListeners),!this.editor.getConfiguration().readOnly&&this.editor.getModel()&&this.editor.getConfiguration().contribInfo.suggestOnTriggerCharacters){var t=p.SuggestRegistry.orderedGroups(this.editor.getModel());if(0!==t.length){var i=Object.create(null);t.forEach(function(e){var t=Object.create(null);e.forEach(function(e){var o=e.triggerCharacters;if(o)for(var r=0,n=o;r<n.length;r++){var s=n[r],g=t[s];g?g.push(e):(g=[e],t[s]=g,i[s]?i[s].push(g):i[s]=[g])}})}),Object.keys(i).forEach(function(t){e.triggerCharacterListeners.push(e.editor.addTypingListener(t,function(){e.triggerSuggest(t,i[t]).done(null,o.onUnexpectedError)}))})}}},e.prototype.triggerSuggest=function(e,t){return this.model.trigger(!1,e,!1,t),this.editor.focus(),s.TPromise.as(!1)},e.prototype.acceptSelectedSuggestion=function(){this.widget&&this.widget.acceptSelectedSuggestion()},e.prototype.cancelSuggestWidget=function(){this.widget&&this.widget.cancel()},e.prototype.selectNextSuggestion=function(){this.widget&&this.widget.selectNext()},e.prototype.selectNextPageSuggestion=function(){this.widget&&this.widget.selectNextPage()},e.prototype.selectPrevSuggestion=function(){this.widget&&this.widget.selectPrevious()},e.prototype.selectPrevPageSuggestion=function(){this.widget&&this.widget.selectPreviousPage()},e.prototype.toggleSuggestionDetails=function(){this.widget&&this.widget.toggleDetails()},e.ID="editor.contrib.suggestController",e=__decorate([__param(1,g.IInstantiationService)],e)}();t.SuggestController=S;var b=function(e){function t(t,i){e.call(this,t,i)}return __extends(t,e),t.prototype.isSupported=function(){return p.SuggestRegistry.has(this.editor.getModel())&&!this.editor.getConfiguration().readOnly},t.prototype.run=function(){return S.getController(this.editor).triggerSuggest()},t.ID="editor.action.triggerSuggest",t}(a.EditorAction);t.TriggerSuggestAction=b,u.CommonEditorRegistry.registerEditorAction(new u.EditorActionDescriptor(b,b.ID,i.localize("suggest.trigger.label","Trigger Suggest"),{context:u.ContextKey.EditorTextFocus,primary:r.KeyMod.CtrlCmd|r.KeyCode.Space,mac:{primary:r.KeyMod.WinCtrl|r.KeyCode.Space}},"Trigger Suggest"));var x=u.CommonEditorRegistry.commandWeight(90);C.KeybindingsRegistry.registerCommandDesc({id:"acceptSelectedSuggestion",handler:f("acceptSelectedSuggestion",function(e){return e.acceptSelectedSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible)),primary:r.KeyCode.Tab}),C.KeybindingsRegistry.registerCommandDesc({id:"acceptSelectedSuggestionOnEnter",handler:f("acceptSelectedSuggestionOnEnter",function(e){return e.acceptSelectedSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible),d.KbExpr.has("config.editor.acceptSuggestionOnEnter")),primary:r.KeyCode.Enter}),C.KeybindingsRegistry.registerCommandDesc({id:"hideSuggestWidget",handler:f("hideSuggestWidget",function(e){return e.cancelSuggestWidget()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible)),primary:r.KeyCode.Escape,secondary:[r.KeyMod.Shift|r.KeyCode.Escape]}),C.KeybindingsRegistry.registerCommandDesc({id:"selectNextSuggestion",handler:f("selectNextSuggestion",function(e){return e.selectNextSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible),d.KbExpr.has(y.Context.MultipleSuggestions)),primary:r.KeyCode.DownArrow,secondary:[r.KeyMod.Alt|r.KeyCode.DownArrow],mac:{primary:r.KeyCode.DownArrow,secondary:[r.KeyMod.Alt|r.KeyCode.DownArrow,r.KeyMod.WinCtrl|r.KeyCode.KEY_N]}}),C.KeybindingsRegistry.registerCommandDesc({id:"selectNextPageSuggestion",handler:f("selectNextPageSuggestion",function(e){return e.selectNextPageSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible),d.KbExpr.has(y.Context.MultipleSuggestions)),primary:r.KeyCode.PageDown,secondary:[r.KeyMod.Alt|r.KeyCode.PageDown]}),C.KeybindingsRegistry.registerCommandDesc({id:"selectPrevSuggestion",handler:f("selectPrevSuggestion",function(e){return e.selectPrevSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible),d.KbExpr.has(y.Context.MultipleSuggestions)),primary:r.KeyCode.UpArrow,secondary:[r.KeyMod.Alt|r.KeyCode.UpArrow],mac:{primary:r.KeyCode.UpArrow,secondary:[r.KeyMod.Alt|r.KeyCode.UpArrow,r.KeyMod.WinCtrl|r.KeyCode.KEY_P]}}),C.KeybindingsRegistry.registerCommandDesc({id:"selectPrevPageSuggestion",handler:f("selectPrevPageSuggestion",function(e){return e.selectPrevPageSuggestion()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible),d.KbExpr.has(y.Context.MultipleSuggestions)),primary:r.KeyCode.PageUp,secondary:[r.KeyMod.Alt|r.KeyCode.PageUp]}),C.KeybindingsRegistry.registerCommandDesc({id:"toggleSuggestionDetails",handler:f("toggleSuggestionDetails",function(e){return e.toggleSuggestionDetails()}),weight:x,when:d.KbExpr.and(d.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),d.KbExpr.has(y.Context.Visible)),primary:r.KeyMod.CtrlCmd|r.KeyCode.Space,mac:{primary:r.KeyMod.WinCtrl|r.KeyCode.Space}}),h.EditorBrowserRegistry.registerEditorContribution(S)});