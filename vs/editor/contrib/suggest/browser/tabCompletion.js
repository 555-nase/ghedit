/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var p=e.length-1;p>=0;p--)(i=e[p])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},__param=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}};define(["require","exports","vs/base/common/keyCodes","vs/editor/common/services/codeEditorService","vs/platform/keybinding/common/keybinding","vs/platform/keybinding/common/keybindingsRegistry","vs/editor/common/modes/snippetsRegistry","vs/platform/platform","vs/editor/common/editorCommon","vs/editor/common/editorCommonExtensions","vs/editor/contrib/snippet/common/snippet"],function(e,t,n,o,i,r,s,p,c,d,a){"use strict";var m=p.Registry.as(s.Extensions.Snippets),g=function(){function e(t,n){var o=this;this._currentSnippets=[],this._snippetController=a.getSnippetController(t);var i=n.createKey(e.ContextKey,void 0);this._cursorChangeSubscription=t.onDidChangeCursorSelection(function(e){o._currentSnippets.length=0;var n=e.selection.isEmpty()?s.getNonWhitespacePrefix(t.getModel(),t.getPosition()):t.getModel().getValueInRange(e.selection);n&&m.visitSnippets(t.getModel().getModeId(),function(e){return n===e.prefix&&o._currentSnippets.push(e),!0}),i.set(1===o._currentSnippets.length)})}return e.prototype.dispose=function(){this._cursorChangeSubscription.dispose()},e.prototype.performSnippetCompletions=function(){if(1===this._currentSnippets.length){var e=this._currentSnippets[0],t=new a.CodeSnippet(e.codeSnippet);this._snippetController.run(t,e.prefix.length,0)}},e.prototype.getId=function(){return e.Id},e.Id="editor.tabCompletionController",e.ContextKey="hasSnippetCompletions",e=__decorate([__param(1,i.IKeybindingService)],e)}();d.CommonEditorRegistry.registerEditorContribution(g),r.KeybindingsRegistry.registerCommandDesc({id:"insertSnippet",weight:r.KeybindingsRegistry.WEIGHT.editorContrib(),primary:n.KeyCode.Tab,when:i.KbExpr.and(i.KbExpr.has(g.ContextKey),i.KbExpr.has(c.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS),i.KbExpr.not(c.KEYBINDING_CONTEXT_EDITOR_TAB_MOVES_FOCUS),i.KbExpr.has("config.editor.tabCompletion")),handler:function(e){var t=e.get(o.ICodeEditorService).getFocusedCodeEditor();t&&t.getContribution(g.Id).performSnippetCompletions()}})});