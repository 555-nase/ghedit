{"version":3,"sources":["vs/editor/contrib/contextmenu/browser/contextmenu.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;IAAA;;;oGAGgG;IAChG,YAAY,CAAC;IAyBb;QAYC,+BAAY,MAAkB,EAAuB,kBAAuC,EAAuB,kBAAuC,EAAsB,iBAAqC;YAZtN,iBA+NC;YAlNC,IAAI,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAC7C,IAAI,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAC7C,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;YAC3C,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;YAEtB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YAErB,IAAI,CAAC,6BAA6B,GAAG,CAAC,CAAC;YAEvC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,wBAAS,CAAC,WAAW,EAAE,UAAC,CAAmB,IAAG,OAAA,KAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAtB,CAAsB,CAAC,CAAC,CAAC;YACtH,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,wBAAS,CAAC,OAAO,EAAE,UAAC,CAAgB;gBAClF,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,kBAAO,CAAC,WAAW,CAAC,CAAC,CAAC;oBACvC,4BAA4B;oBAC5B,CAAC,CAAC,cAAc,EAAE,CAAC;oBACnB,CAAC,CAAC,eAAe,EAAE,CAAC;oBACpB,KAAI,CAAC,eAAe,EAAE,CAAC;gBACxB,CAAC;YACF,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAEO,8CAAc,GAAtB,UAAuB,CAAmB;YACzC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClD,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACrB,0DAA0D;gBAC1D,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,gBAAgB,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;oBAC3F,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAC7C,CAAC;gBACD,MAAM,CAAC,CAAC,mDAAmD;YAC5D,CAAC;YAED,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,8BAAe,CAAC,cAAc,CAAC,CAAC,CAAC;gBACtD,MAAM,CAAC,CAAC,yFAAyF;YAClG,CAAC;YAED,CAAC,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC;YAEzB,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,8BAAe,CAAC,YAAY,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,8BAAe,CAAC,aAAa,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,8BAAe,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACrJ,MAAM,CAAC,CAAC,wEAAwE;YACjF,CAAC;YAED,uGAAuG;YACvG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;YAErB,0DAA0D;YAC1D,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,gBAAgB,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC3F,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC7C,CAAC;YAED,uGAAuG;YACvG,IAAI,cAAwB,CAAC;YAC7B,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,8BAAe,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAChD,cAAc,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC;YAC3D,CAAC;YAED,wBAAwB;YACxB,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACtC,CAAC;QAEM,+CAAe,GAAtB,UAAuB,cAAyB;YAC/C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClD,MAAM,CAAC,CAAC,mDAAmD;YAC5D,CAAC;YAED,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACrB,MAAM,CAAC,CAAC,+CAA+C;YACxD,CAAC;YAED,IAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YAC1C,IAAI,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YAC1C,EAAE,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;gBAC/B,MAAM,CAAC;YACR,CAAC;YAED,kCAAkC;YAClC,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;YAEzC,uCAAuC;YACvC,EAAE,CAAC,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC5B,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,cAAc,CAAC,CAAC;YACtD,CAAC;QACF,CAAC;QAEO,+CAAe,GAAvB;YACC,IAAI,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YAC1C,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClB,MAAM,CAAC,EAAE,CAAC;YACX,CAAC;YAED,IAAI,UAAU,GAAmB,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;YAC3D,IAAI,kBAAkB,GAAG,UAAU,CAAC,MAAM,CAAC,UAAC,MAAM,IAAG,OAAA,CAAC,OAAO,MAAM,CAAC,uBAAuB,KAAK,UAAU,CAAC,IAAI,MAAM,CAAC,uBAAuB,EAAE,IAAI,MAAM,CAAC,WAAW,EAAE,EAAlH,CAAkH,CAAC,CAAC;YAEzK,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;QACjD,CAAC;QAEO,+CAAe,GAAvB,UAAwB,OAAsB;YAC7C,IAAI,IAAI,GAAG,IAAI,uBAAU,EAA4C,CAAC;YAEtE,OAAO,CAAC,OAAO,CAAC,UAAC,MAAM;gBACtB,IAAI,MAAM,GAAG,MAAM,CAAC,UAAU,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBAC5C,IAAI,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC/C,EAAE,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;oBACtB,eAAe,GAAG,IAAI,uBAAU,EAAwB,CAAC;oBACzD,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC,CAAC;gBACtC,CAAC;gBAED,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;YACrD,CAAC,CAAC,CAAC;YAEH,IAAI,uBAAuB,GAAa,EAAE,CAAC;YAC3C,IAAI,aAAa,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YACvC,OAAM,aAAa,CAAC,QAAQ,EAAE,EAAE,CAAC;gBAChC,IAAI,KAAK,GAAG,aAAa,CAAC,OAAO,CAAC,KAAK,CAAC;gBACxC,IAAI,eAAe,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;gBAC1C,OAAM,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;oBAClC,IAAI,MAAM,GAAG,eAAe,CAAC,OAAO,CAAC,KAAK,CAAC;oBAC3C,uBAAuB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACtC,CAAC;gBAED,EAAE,CAAC,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;oBAC7B,uBAAuB,CAAC,IAAI,CAAC,IAAI,qBAAS,EAAE,CAAC,CAAC;gBAC/C,CAAC;YACF,CAAC;YAED,MAAM,CAAC,uBAAuB,CAAC;QAChC,CAAC;QAEO,kDAAkB,GAA1B,UAA2B,OAAiB,EAAE,cAA+B;YAA7E,iBA8DC;YA9D6C,8BAA+B,GAA/B,qBAA+B;YAE5E,wDAAwD;YACxD,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;YAEtC,gBAAgB;YAChB,IAAI,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC,KAAK,CAAC;YAC5D,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC;gBAC1B,KAAK,EAAE,KAAK;aACZ,CAAC,CAAC;YAEH,IAAI,YAAY,GAAG,cAAc,CAAC;YAClC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;gBACnB,8BAA8B;gBAC9B,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;gBAExD,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;gBACtB,IAAI,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,0BAA0B,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;gBAEvF,wCAAwC;gBACxC,IAAI,YAAY,GAAG,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,CAAC;gBACrE,IAAI,IAAI,GAAG,YAAY,CAAC,IAAI,GAAG,YAAY,CAAC,IAAI,CAAC;gBACjD,IAAI,IAAI,GAAG,YAAY,CAAC,GAAG,GAAG,YAAY,CAAC,GAAG,GAAG,YAAY,CAAC,MAAM,CAAC;gBAErE,YAAY,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC;YACrC,CAAC;YAED,YAAY;YACZ,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC;gBACvC,SAAS,EAAE,cAAM,OAAA,YAAY,EAAZ,CAAY;gBAE7B,UAAU,EAAE;oBACX,MAAM,CAAC,qBAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;gBAC7B,CAAC;gBAED,aAAa,EAAE,UAAC,MAAM;oBACrB,IAAI,UAAU,GAAG,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;oBAC7C,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;wBAChB,MAAM,CAAC,IAAI,sBAAU,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,UAAU,EAAE,KAAI,CAAC,iBAAiB,CAAC,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;oBACpH,CAAC;oBAED,IAAI,gBAAgB,GAAQ,MAAM,CAAC;oBACnC,EAAE,CAAC,CAAC,OAAO,gBAAgB,CAAC,aAAa,KAAK,UAAU,CAAC,CAAC,CAAC;wBAC1D,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAE,CAAC;oBACzC,CAAC;oBAED,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;gBAED,aAAa,EAAE,UAAC,MAAM;oBACrB,MAAM,CAAC,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;gBACpC,CAAC;gBAED,MAAM,EAAE,UAAC,YAAoB;oBAC5B,KAAI,CAAC,6BAA6B,EAAE,CAAC;oBACrC,KAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;oBACrB,KAAI,CAAC,OAAO,CAAC,oBAAoB,EAAE,CAAC;oBACpC,KAAI,CAAC,OAAO,CAAC,aAAa,CAAC;wBAC1B,KAAK,EAAE,eAAe;qBACtB,CAAC,CAAC;gBACJ,CAAC;aACD,CAAC,CAAC;QACJ,CAAC;QAEO,8CAAc,GAAtB,UAAuB,MAAe;YACrC,IAAI,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YAC/D,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,0BAA0B;YAC3C,CAAC;YACD,MAAM,CAAC,IAAI,CAAC;QACb,CAAC;QAEM,qCAAK,GAAZ;YACC,MAAM,CAAC,qBAAqB,CAAC,EAAE,CAAC;QACjC,CAAC;QAEM,uCAAO,GAAd;YACC,EAAE,CAAC,CAAC,IAAI,CAAC,6BAA6B,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC5C,IAAI,CAAC,kBAAkB,CAAC,eAAe,EAAE,CAAC;YAC3C,CAAC;YAED,IAAI,CAAC,UAAU,GAAG,mBAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC5C,CAAC;QA5Na,wBAAE,GAAG,4BAA4B,CAAC;QAUhB;uBAAC,iCAAmB;uBAA2C,iCAAmB;uBAA2C,sCAAkB;iCAA3H;QAmNrD,4BAAC;IAAD,CA/NA,AA+NC,IAAA;IAED;QAA8B,mCAAY;QAIzC,yBAAY,UAAsC,EAAE,MAAwB;YAC3E,kBAAM,UAAU,EAAE,MAAM,EAAE,kCAAS,CAAC,SAAS,CAAC,CAAC;QAChD,CAAC;QAEM,6BAAG,GAAV;YACC,IAAI,YAAY,GAA0B,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,qBAAqB,CAAC,EAAE,CAAC,CAAC;YAChG,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;gBACnB,MAAM,CAAC,qBAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;YAC1B,CAAC;YAED,YAAY,CAAC,eAAe,EAAE,CAAC;YAE/B,MAAM,CAAC,qBAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QAC1B,CAAC;QAfa,kBAAE,GAAG,+BAA+B,CAAC;QAgBpD,sBAAC;IAAD,CAlBA,AAkBC,CAlB6B,2BAAY,GAkBzC;IAED,+CAAqB,CAAC,0BAA0B,CAAC,qBAAqB,CAAC,CAAC;IACxE,6CAAoB,CAAC,oBAAoB,CAAC,IAAI,+CAAsB,CAAC,eAAe,EAAE,eAAe,CAAC,EAAE,EAAE,GAAG,CAAC,QAAQ,CAAC,CAA8B,EAAE,IAA0B,CAAC,EAAE;QACnL,OAAO,EAAE,mCAAU,CAAC,eAAe;QACnC,OAAO,EAAE,iBAAM,CAAC,KAAK,GAAG,kBAAO,CAAC,GAAG;KACnC,CAAC,CAAC,CAAC","file":"vs/editor/contrib/contextmenu/browser/contextmenu.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {IAction} from 'vs/base/common/actions';\nimport {KeyCode, KeyMod, Keybinding} from 'vs/base/common/keyCodes';\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport {SortedList} from 'vs/base/common/sortedList';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport * as dom from 'vs/base/browser/dom';\nimport {IKeyboardEvent} from 'vs/base/browser/keyboardEvent';\nimport {ActionItem, Separator} from 'vs/base/browser/ui/actionbar/actionbar';\nimport {IContextMenuService, IContextViewService} from 'vs/platform/contextview/browser/contextView';\nimport {IKeybindingService} from 'vs/platform/keybinding/common/keybindingService';\nimport {EditorAction} from 'vs/editor/common/editorAction';\nimport {Behaviour} from 'vs/editor/common/editorActionEnablement';\nimport {EventType, ICommonCodeEditor, IEditorActionDescriptorData, IEditorContribution, MouseTargetType} from 'vs/editor/common/editorCommon';\nimport {CommonEditorRegistry, ContextKey, EditorActionDescriptor} from 'vs/editor/common/editorCommonExtensions';\nimport {ICodeEditor, IEditorMouseEvent} from 'vs/editor/browser/editorBrowser';\nimport {EditorBrowserRegistry} from 'vs/editor/browser/editorBrowserExtensions';\n\ninterface IPosition {\n\tx:number;\n\ty:number;\n}\n\nclass ContextMenuController implements IEditorContribution {\n\n\tpublic static ID = 'editor.contrib.contextmenu';\n\n\tprivate contextMenuService:IContextMenuService;\n\tprivate contextViewService: IContextViewService;\n\tprivate keybindingService: IKeybindingService;\n\n\tprivate _editor:ICodeEditor;\n\tprivate _toDispose:IDisposable[];\n\tprivate _contextMenuIsBeingShownCount:number;\n\n\tconstructor(editor:ICodeEditor, @IContextMenuService contextMenuService: IContextMenuService, @IContextViewService contextViewService: IContextViewService, @IKeybindingService keybindingService: IKeybindingService) {\n\t\tthis.contextMenuService = contextMenuService;\n\t\tthis.contextViewService = contextViewService;\n\t\tthis.keybindingService = keybindingService;\n\t\tthis._editor = editor;\n\n\t\tthis._toDispose = [];\n\n\t\tthis._contextMenuIsBeingShownCount = 0;\n\n\t\tthis._toDispose.push(this._editor.addListener2(EventType.ContextMenu, (e:IEditorMouseEvent)=>this._onContextMenu(e)));\n\t\tthis._toDispose.push(this._editor.addListener2(EventType.KeyDown, (e:IKeyboardEvent)=> {\n\t\t\tif (e.keyCode === KeyCode.ContextMenu) {\n\t\t\t\t// Chrome is funny like that\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.showContextMenu();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onContextMenu(e:IEditorMouseEvent): void {\n\t\tif (!this._editor.getConfiguration().contextmenu) {\n\t\t\tthis._editor.focus();\n\t\t\t// Ensure the cursor is at the position of the mouse click\n\t\t\tif (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) {\n\t\t\t\tthis._editor.setPosition(e.target.position);\n\t\t\t}\n\t\t\treturn; // Context menu is turned off through configuration\n\t\t}\n\n\t\tif (e.target.type === MouseTargetType.OVERLAY_WIDGET) {\n\t\t\treturn; // allow native menu on widgets to support right click on input field for example in find\n\t\t}\n\n\t\te.event.preventDefault();\n\n\t\tif (e.target.type !== MouseTargetType.CONTENT_TEXT && e.target.type !== MouseTargetType.CONTENT_EMPTY && e.target.type !== MouseTargetType.TEXTAREA) {\n\t\t\treturn; // only support mouse click into text or native context menu key for now\n\t\t}\n\n\t\t// Ensure the editor gets focus if it hasn't, so the right events are being sent to other contributions\n\t\tthis._editor.focus();\n\n\t\t// Ensure the cursor is at the position of the mouse click\n\t\tif (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) {\n\t\t\tthis._editor.setPosition(e.target.position);\n\t\t}\n\n\t\t// Unless the user triggerd the context menu through Shift+F10, use the mouse position as menu position\n\t\tvar forcedPosition:IPosition;\n\t\tif (e.target.type !== MouseTargetType.TEXTAREA) {\n\t\t\tforcedPosition = { x: e.event.posx, y: e.event.posy + 1 };\n\t\t}\n\n\t\t// Show the context menu\n\t\tthis.showContextMenu(forcedPosition);\n\t}\n\n\tpublic showContextMenu(forcedPosition?:IPosition): void {\n\t\tif (!this._editor.getConfiguration().contextmenu) {\n\t\t\treturn; // Context menu is turned off through configuration\n\t\t}\n\n\t\tif (!this.contextMenuService) {\n\t\t\tthis._editor.focus();\n\t\t\treturn;\t// We need the context menu service to function\n\t\t}\n\n\t\tvar position = this._editor.getPosition();\n\t\tvar editorModel = this._editor.getModel();\n\t\tif (!position || !editorModel) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Find actions available for menu\n\t\tvar menuActions = this._getMenuActions();\n\n\t\t// Show menu if we have actions to show\n\t\tif (menuActions.length > 0) {\n\t\t\tthis._doShowContextMenu(menuActions, forcedPosition);\n\t\t}\n\t}\n\n\tprivate _getMenuActions(): IAction[] {\n\t\tvar editorModel = this._editor.getModel();\n\t\tif (!editorModel) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar allActions = <EditorAction[]>this._editor.getActions();\n\t\tvar contributedActions = allActions.filter((action)=>(typeof action.shouldShowInContextMenu === 'function') && action.shouldShowInContextMenu() && action.isSupported());\n\n\t\treturn this._prepareActions(contributedActions);\n\t}\n\n\tprivate _prepareActions(actions:EditorAction[]):IAction[] {\n\t\tvar list = new SortedList<string, SortedList<string, EditorAction>>();\n\n\t\tactions.forEach((action)=>{\n\t\t\tvar groups = action.getGroupId().split('/');\n\t\t\tvar actionsForGroup = list.getValue(groups[0]);\n\t\t\tif (!actionsForGroup) {\n\t\t\t\tactionsForGroup = new SortedList<string, EditorAction>();\n\t\t\t\tlist.add(groups[0], actionsForGroup);\n\t\t\t}\n\n\t\t\tactionsForGroup.add(groups[1] || groups[0], action);\n\t\t});\n\n\t\tvar sortedAndGroupedActions:IAction[] = [];\n\t\tvar groupIterator = list.getIterator();\n\t\twhile(groupIterator.moveNext()) {\n\t\t\tvar group = groupIterator.current.value;\n\t\t\tvar actionsIterator = group.getIterator();\n\t\t\twhile(actionsIterator.moveNext()) {\n\t\t\t\tvar action = actionsIterator.current.value;\n\t\t\t\tsortedAndGroupedActions.push(action);\n\t\t\t}\n\n\t\t\tif (groupIterator.hasNext()) {\n\t\t\t\tsortedAndGroupedActions.push(new Separator());\n\t\t\t}\n\t\t}\n\n\t\treturn sortedAndGroupedActions;\n\t}\n\n\tprivate _doShowContextMenu(actions:IAction[], forcedPosition:IPosition = null): void {\n\n\t\t// Make the editor believe one of its widgets is focused\n\t\tthis._editor.beginForcedWidgetFocus();\n\n\t\t// Disable hover\n\t\tvar oldHoverSetting = this._editor.getConfiguration().hover;\n\t\tthis._editor.updateOptions({\n\t\t\thover: false\n\t\t});\n\n\t\tvar menuPosition = forcedPosition;\n\t\tif (!menuPosition) {\n\t\t\t// Ensure selection is visible\n\t\t\tthis._editor.revealPosition(this._editor.getPosition());\n\n\t\t\tthis._editor.render();\n\t\t\tvar cursorCoords = this._editor.getScrolledVisiblePosition(this._editor.getPosition());\n\n\t\t\t// Translate to absolute editor position\n\t\t\tvar editorCoords = dom.getDomNodePosition(this._editor.getDomNode());\n\t\t\tvar posx = editorCoords.left + cursorCoords.left;\n\t\t\tvar posy = editorCoords.top + cursorCoords.top + cursorCoords.height;\n\n\t\t\tmenuPosition = { x: posx, y: posy };\n\t\t}\n\n\t\t// Show menu\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => menuPosition,\n\n\t\t\tgetActions: () => {\n\t\t\t\treturn TPromise.as(actions);\n\t\t\t},\n\n\t\t\tgetActionItem: (action) => {\n\t\t\t\tvar keybinding = this._keybindingFor(action);\n\t\t\t\tif (keybinding) {\n\t\t\t\t\treturn new ActionItem(action, action, { label: true, keybinding: this.keybindingService.getLabelFor(keybinding) });\n\t\t\t\t}\n\n\t\t\t\tvar customActionItem = <any>action;\n\t\t\t\tif (typeof customActionItem.getActionItem === 'function') {\n\t\t\t\t\treturn customActionItem.getActionItem();\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tgetKeyBinding: (action): Keybinding => {\n\t\t\t\treturn this._keybindingFor(action);\n\t\t\t},\n\n\t\t\tonHide: (wasCancelled:boolean) => {\n\t\t\t\tthis._contextMenuIsBeingShownCount--;\n\t\t\t\tthis._editor.focus();\n\t\t\t\tthis._editor.endForcedWidgetFocus();\n\t\t\t\tthis._editor.updateOptions({\n\t\t\t\t\thover: oldHoverSetting\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _keybindingFor(action: IAction): Keybinding {\n\t\tvar opts = this.keybindingService.lookupKeybindings(action.id);\n\t\tif (opts.length > 0) {\n\t\t\treturn opts[0]; // only take the first one\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic getId(): string {\n\t\treturn ContextMenuController.ID;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._contextMenuIsBeingShownCount > 0) {\n\t\t\tthis.contextViewService.hideContextView();\n\t\t}\n\n\t\tthis._toDispose = dispose(this._toDispose);\n\t}\n}\n\nclass ShowContextMenu extends EditorAction {\n\n\tpublic static ID = 'editor.action.showContextMenu';\n\n\tconstructor(descriptor:IEditorActionDescriptorData, editor:ICommonCodeEditor) {\n\t\tsuper(descriptor, editor, Behaviour.TextFocus);\n\t}\n\n\tpublic run(): TPromise<boolean> {\n\t\tvar contribution = <ContextMenuController>this.editor.getContribution(ContextMenuController.ID);\n\t\tif (!contribution) {\n\t\t\treturn TPromise.as(null);\n\t\t}\n\n\t\tcontribution.showContextMenu();\n\n\t\treturn TPromise.as(null);\n\t}\n}\n\nEditorBrowserRegistry.registerEditorContribution(ContextMenuController);\nCommonEditorRegistry.registerEditorAction(new EditorActionDescriptor(ShowContextMenu, ShowContextMenu.ID, nls.localize('action.showContextMenu.label', \"Show Editor Context Menu\"), {\n\tcontext: ContextKey.EditorTextFocus,\n\tprimary: KeyMod.Shift | KeyCode.F10\n}));"]}