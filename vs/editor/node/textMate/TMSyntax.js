var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},__param=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}};define(["require","exports","vs/nls","vs/base/common/errors","vs/base/common/paths","vs/platform/extensions/common/extensionsRegistry","vs/editor/common/modes/TMState","vs/editor/common/modes/supports","vs/editor/common/services/modeService","vscode-textmate","vs/editor/common/core/modeTransition","vs/platform/configuration/common/configuration"],function(e,t,n,o,i,r,a,s,c,d,u,l){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function p(e,t){var n=new k(e.getId(),t);return{getInitialState:function(){return new a.TMState(e,null,null)},tokenize:function(e,t,o,i){return n.tokenize(e,t,o,i)}}}function g(e){for(var t=0;e;)t++,e=e._parent;return t}function m(e,t){for(var n=e.prevToken.scopes,o=n.length,i=e.prevToken.scopeTokensMaps,r=[],a=[],s=!0,c=1;c<t.length;c++){var d=t[c];if(s){if(c<o&&n[c]===d){a=i[c],r[c]=a;continue}s=!1}var u=e.getTokenIds(d);a=a.slice(0);for(var l=0;l<u.length;l++)a[u[l]]=!0;r[c]=a}return e.prevToken=new T(t,r),e.getToken(a)}var h=r.ExtensionsRegistry.registerExtensionPoint("grammars",{description:n.localize("vscode.extension.contributes.grammars","Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"{{id}}",scopeName:"source.{{id}}",path:"./syntaxes/{{id}}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"{{id}}",scopeName:"source.{{id}}",path:"./syntaxes/{{id}}.tmLanguage."}}],properties:{language:{description:n.localize("vscode.extension.contributes.grammars.language","Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:n.localize("vscode.extension.contributes.grammars.scopeName","Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:n.localize("vscode.extension.contributes.grammars.path","Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},injectTo:{description:n.localize("vscode.extension.contributes.grammars.injectTo","List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}}},require:["scopeName","path"]}}),f=function(){function e(e,t){var n=this;this._modeService=e,this._scopeNameToFilePath={},this._injections={};var o=t.getConfiguration("editor"),i=!0;"undefined"!=typeof o.useExperimentalParser&&Boolean(o.useExperimentalParser)===!1&&(i=!1),this._grammarRegistry=new d.Registry({getFilePath:function(e){return n._scopeNameToFilePath[e]},getInjections:function(e){return n._injections[e]}},i),h.setHandler(function(e){for(var t=0;t<e.length;t++)for(var o=e[t].value,i=0;i<o.length;i++)n._handleGrammarExtensionPointUser(e[t].description.extensionFolderPath,o[i],e[t].collector)})}return e.prototype._handleGrammarExtensionPointUser=function(e,t,o){var r=this;if(t.language&&("string"!=typeof t.language||!this._modeService.isRegisteredMode(t.language)))return void o.error(n.localize("invalid.language","Unknown language in `contributes.{0}.language`. Provided value: {1}",h.name,String(t.language)));if(!t.scopeName||"string"!=typeof t.scopeName)return void o.error(n.localize("invalid.scopeName","Expected string in `contributes.{0}.scopeName`. Provided value: {1}",h.name,String(t.scopeName)));if(!t.path||"string"!=typeof t.path)return void o.error(n.localize("invalid.path.0","Expected string in `contributes.{0}.path`. Provided value: {1}",h.name,String(t.path)));if(t.injectTo&&(!Array.isArray(t.injectTo)||t.injectTo.some(function(e){return"string"!=typeof e})))return void o.error(n.localize("invalid.injectTo","Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",h.name,JSON.stringify(t.injectTo)));var a=i.normalize(i.join(e,t.path));if(0!==a.indexOf(e)&&o.warn(n.localize("invalid.path.1","Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",h.name,a,e)),this._scopeNameToFilePath[t.scopeName]=a,t.injectTo)for(var s=0,c=t.injectTo;s<c.length;s++){var d=c[s],u=this._injections[d];u||(this._injections[d]=u=[]),u.push(t.scopeName)}var l=t.language;if(l)var p=this._modeService.onDidCreateMode(function(e){e.getId()===l&&(r.registerDefinition(l,t.scopeName),p.dispose())})},e.prototype.registerDefinition=function(e,t){var n=this;this._grammarRegistry.loadGrammar(t,function(t,i){return t?void o.onUnexpectedError(t):void n._modeService.registerTokenizationSupport(e,function(e){return p(e,i)})})},e=__decorate([__param(0,c.IModeService),__param(1,l.IConfigurationService)],e)}();t.MainProcessTextMateSyntax=f;var v=function(){function e(){this.lastAssignedId=0,this.scopeToTokenIds=Object.create(null),this.tokenToTokenId=Object.create(null),this.tokenIdToToken=[null],this.prevToken=new T([],[])}return e.prototype.getTokenIds=function(e){var t=this.scopeToTokenIds[e];if(t)return t;var n=e.split(".");t=[];for(var o=0;o<n.length;o++){var i=n[o],r=this.tokenToTokenId[i];r||(r=++this.lastAssignedId,this.tokenToTokenId[i]=r,this.tokenIdToToken[r]=i),t.push(r)}return this.scopeToTokenIds[e]=t,t},e.prototype.getToken=function(e){for(var t="",n=!0,o=1;o<=this.lastAssignedId;o++)e[o]&&(n?(n=!1,t+=this.tokenIdToToken[o]):(t+=".",t+=this.tokenIdToToken[o]));return t},e}();t.DecodeMap=v;var T=function(){function e(e,t){this.scopes=e,this.scopeTokensMaps=t}return e}();t.TMTokenDecodeData=T;var k=function(){function e(e,t){this._modeId=e,this._grammar=t,this._decodeMap=new v}return e.prototype.tokenize=function(e,t,n,o){if(void 0===n&&(n=0),e.length>=2e4||g(t.getRuleStack())>30)return new s.LineTokens([new s.Token(n,"")],[new u.ModeTransition(n,t.getMode())],n,t);var i=t.clone(),r=this._grammar.tokenizeLine(e,i.getRuleStack());i.setRuleStack(r.ruleStack);for(var a=[],c=null,d=0,l=r.tokens.length;d<l;d++){var p=r.tokens[d],h=p.startIndex,f=m(this._decodeMap,p.scopes);f!==c&&(a.push(new s.Token(h+n,f)),c=f)}return new s.LineTokens(a,[new u.ModeTransition(n,i.getMode())],n+e.length,i)},e}();t.decodeTextMateToken=m});