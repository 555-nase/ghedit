define(["require","exports","crypto","vs/editor/common/editorCommon","vs/base/common/strings","vs/editor/common/model/indentationGuesser","vs/base/common/winjs.base"],function(t,e,n,i,s,r,o){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function h(t){for(var e=n.createHash("sha1"),i=0,s=t.lines.length;i<s;i++)e.update(t.lines[i]+"\n");return e.digest("hex")}var a=function(){function t(){}return t}();e.ModelBuilderResult=a;var u=function(){function t(){this.hash=n.createHash("sha1"),this.BOM="",this.lines=[],this.currLineIndex=0}return t.prototype.acceptLines=function(t){0===this.currLineIndex&&s.startsWithUTF8BOM(t[0])&&(this.BOM=s.UTF8_BOM_CHARACTER,t[0]=t[0].substr(1));for(var e=0,n=t.length;e<n;e++)this.lines[this.currLineIndex++]=t[e];this.hash.update(t.join("\n")+"\n")},t.prototype.finish=function(t,e,n){var s=this.lines.length-1,o="";o=0===s?n.defaultEOL===i.DefaultEndOfLine.LF?"\n":"\r\n":e>s/2?"\r\n":"\n";var h;if(n.detectIndentation){var a=r.guessIndentation(this.lines,n.tabSize,n.insertSpaces);h={tabSize:a.tabSize,insertSpaces:a.insertSpaces,trimAutoWhitespace:n.trimAutoWhitespace,defaultEOL:n.defaultEOL}}else h={tabSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:n.trimAutoWhitespace,defaultEOL:n.defaultEOL};return{rawText:{BOM:this.BOM,EOL:o,lines:this.lines,length:t,options:h},hash:this.hash.digest("hex")}},t}();e.computeHash=h;var l=function(){function t(){this.leftoverPrevChunk="",this.leftoverEndsInCR=!1,this.totalCRCount=0,this.lineBasedBuilder=new u,this.totalLength=0}return t.fromStringStream=function(e,n){return new o.TPromise(function(i,s,r){var o=!1,h=new t;e.on("data",function(t){h.acceptChunk(t)}),e.on("error",function(t){o||(o=!0,s(t))}),e.on("end",function(){o||(o=!0,i(h.finish(n)))})})},t.prototype._updateCRCount=function(t){for(var e=0,n=-1;(n=t.indexOf("\r",n+1))!==-1;)e++;this.totalCRCount+=e},t.prototype.acceptChunk=function(t){if(0!==t.length){this.totalLength+=t.length,this._updateCRCount(t),this.leftoverEndsInCR&&(t="\r"+t),13===t.charCodeAt(t.length-1)?(this.leftoverEndsInCR=!0,t=t.substr(0,t.length-1)):this.leftoverEndsInCR=!1;var e=t.split(/\r\n|\r|\n/);if(1===e.length)return void(this.leftoverPrevChunk+=e[0]);e[0]=this.leftoverPrevChunk+e[0],this.lineBasedBuilder.acceptLines(e.slice(0,e.length-1)),this.leftoverPrevChunk=e[e.length-1]}},t.prototype.finish=function(t){var e=[this.leftoverPrevChunk];return this.leftoverEndsInCR&&e.push(""),this.lineBasedBuilder.acceptLines(e),this.lineBasedBuilder.finish(this.totalLength,this.totalCRCount,t)},t}();e.ModelBuilder=l});