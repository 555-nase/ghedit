/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(e,n,t,o){var i,r=arguments.length,s=r<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,t,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(n,t,s):i(n,t))||s);return r>3&&s&&Object.defineProperty(n,t,s),s},__param=this&&this.__param||function(e,n){return function(t,o){n(t,o,e)}};define(["require","exports","vs/nls","vs/platform/product","vs/platform/package","path","vs/base/common/winjs.base","vs/base/common/async","vs/platform/instantiation/common/serviceCollection","vs/platform/instantiation/common/descriptors","vs/platform/instantiation/common/instantiationService","vs/platform/environment/common/environment","vs/platform/environment/node/environmentService","vs/platform/event/common/event","vs/platform/event/common/eventService","vs/platform/extensionManagement/common/extensionManagement","vs/platform/extensionManagement/node/extensionManagementService","vs/platform/extensionManagement/node/extensionGalleryService","vs/platform/telemetry/common/telemetry","vs/platform/telemetry/common/telemetryService","vs/platform/telemetry/node/commonProperties","vs/platform/request/common/request","vs/platform/request/node/nodeRequestService","vs/platform/configuration/common/configuration","vs/platform/configuration/node/nodeConfigurationService","vs/platform/telemetry/node/appInsightsAppender"],function(e,n,t,o,i,r,s,a,l,c,u,m,f,v,p,d,g,x,y,S,h,E,I,w,M,P){"use strict";function C(e){return e.publisher+"."+e.name}function _(e){var n=new l.ServiceCollection;n.set(m.IEnvironmentService,new c.SyncDescriptor(f.EnvironmentService));var t=new u.InstantiationService(n);return t.invokeFunction(function(n){var r=n.get(m.IEnvironmentService);return r.createPaths().then(function(){var n=r.appRoot,s=r.extensionsPath,a=r.extensionDevelopmentPath,u=r.isBuilt,m=new l.ServiceCollection;if(m.set(v.IEventService,new c.SyncDescriptor(p.EventService)),m.set(w.IConfigurationService,new c.SyncDescriptor(M.NodeConfigurationService)),m.set(E.IRequestService,new c.SyncDescriptor(I.NodeRequestService)),m.set(d.IExtensionManagementService,new c.SyncDescriptor(g.ExtensionManagementService)),m.set(d.IExtensionGalleryService,new c.SyncDescriptor(x.ExtensionGalleryService)),u&&!a&&o["default"].enableTelemetry){var f=[];o["default"].aiConfig&&o["default"].aiConfig.key&&f.push(new P.AppInsightsAppender(D,null,o["default"].aiConfig.key)),o["default"].aiConfig&&o["default"].aiConfig.asimovKey&&f.push(new P.AppInsightsAppender(D,null,o["default"].aiConfig.asimovKey)),process.once("exit",function(){return f.forEach(function(e){return e.dispose()})});var C={appender:y.combinedAppender.apply(void 0,f),commonProperties:h.resolveCommonProperties(o["default"].commit,i["default"].version),piiPaths:[n,s]};m.set(y.ITelemetryService,new c.SyncDescriptor(S.TelemetryService,C))}else m.set(y.ITelemetryService,y.NullTelemetryService);var _=t.createChild(m),b=_.createInstance(z);return b.run(e)})})}var b=function(e){return t.localize("notFound","Extension '{0}' not found.",e)},T=function(e){return t.localize("notInstalled","Extension '{0}' is not installed.",e)},q=t.localize("useId","Make sure you use the full extension ID, including the publisher, eg: {0}","ms-vscode.csharp"),z=function(){function e(e,n){this.extensionManagementService=e,this.extensionGalleryService=n}return e.prototype.run=function(e){if(e["list-extensions"])return this.listExtensions();if(e["install-extension"]){var n=e["install-extension"],t="string"==typeof n?[n]:n;return this.installExtension(t)}if(e["uninstall-extension"]){var n=e["uninstall-extension"],t="string"==typeof n?[n]:n;return this.uninstallExtension(t)}},e.prototype.listExtensions=function(){return this.extensionManagementService.getInstalled().then(function(e){e.forEach(function(e){return console.log(C(e.manifest))})})},e.prototype.installExtension=function(e){var n=this,o=e.filter(function(e){return/\.vsix$/i.test(e)}).map(function(e){return function(){var o=r.isAbsolute(e)?e:r.join(process.cwd(),e);return n.extensionManagementService.install(o).then(function(){console.log(t.localize("successVsixInstall","Extension '{0}' was successfully installed!",r.basename(o)))})}}),i=e.filter(function(e){return!/\.vsix$/i.test(e)}).map(function(e){return function(){return n.extensionManagementService.getInstalled().then(function(o){var i=o.some(function(n){return C(n.manifest)===e});return i?(console.log(t.localize("alreadyInstalled","Extension '{0}' is already installed.",e)),s.TPromise.as(null)):n.extensionGalleryService.query({names:[e]}).then(null,function(e){if(e.responseText)try{var n=JSON.parse(e.responseText);return s.TPromise.wrapError(n.message)}catch(t){return s.TPromise.wrapError(e)}}).then(function(o){var i=o.firstPage[0];return i?(console.log(t.localize("foundExtension","Found '{0}' in the marketplace.",e)),console.log(t.localize("installing","Installing...")),n.extensionManagementService.install(i).then(function(){console.log(t.localize("successInstall","Extension '{0}' v{1} was successfully installed!",e,i.versions[0].version))})):s.TPromise.wrapError(b(e)+"\n"+q)})})}});return a.sequence(o.concat(i))},e.prototype.uninstallExtension=function(e){var n=this;return a.sequence(e.map(function(e){return function(){return n.extensionManagementService.getInstalled(!0).then(function(o){var i=o.filter(function(n){return C(n.manifest)===e});if(0===i.length)return s.TPromise.wrapError(T(e)+"\n"+q);console.log(t.localize("uninstalling","Uninstalling {0}...",e));var r=i.map(function(e){return n.extensionManagementService.uninstall(e)});return s.TPromise.join(r).then(function(){return console.log(t.localize("successUninstall","Extension '{0}' was successfully uninstalled!",e))})})}}))},e=__decorate([__param(0,d.IExtensionManagementService),__param(1,d.IExtensionGalleryService)],e)}(),D="monacoworkbench";n.main=_});