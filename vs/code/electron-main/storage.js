/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate=this&&this.__decorate||function(t,e,a,i){var r,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,a,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(n<3?r(o):n>3?r(e,a,o):r(e,a))||o);return n>3&&o&&Object.defineProperty(e,a,o),o},__param=this&&this.__param||function(t,e){return function(a,i){e(a,i,t)}};define(["require","exports","path","original-fs","events","vs/code/electron-main/env","vs/platform/instantiation/common/instantiation"],function(t,e,a,i,r,n,o){"use strict";var s={STORE:"store"};e.IStorageService=o.createDecorator("storageService");var c=function(){function t(t){this.envService=t,this.database=null,this.eventEmitter=new r.EventEmitter,this.dbPath=a.join(t.appHome,"storage.json")}return t.prototype.onStore=function(t){var e=this;return this.eventEmitter.addListener(s.STORE,t),function(){return e.eventEmitter.removeListener(s.STORE,t)}},t.prototype.getItem=function(t,e){this.database||(this.database=this.load());var a=this.database[t];return"undefined"==typeof a?e:this.database[t]},t.prototype.setItem=function(t,e){if(this.database||(this.database=this.load()),"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||this.database[t]!==e){var a=this.database[t];this.database[t]=e,this.save(),this.eventEmitter.emit(s.STORE,t,a,e)}},t.prototype.removeItem=function(t){if(this.database||(this.database=this.load()),this.database[t]){var e=this.database[t];delete this.database[t],this.save(),this.eventEmitter.emit(s.STORE,t,e,null)}},t.prototype.load=function(){try{return JSON.parse(i.readFileSync(this.dbPath).toString())}catch(t){return this.envService.cliArgs.verboseLogging&&console.error(t),{}}},t.prototype.save=function(){i.writeFileSync(this.dbPath,JSON.stringify(this.database,null,4))},t=__decorate([__param(0,n.IEnvironmentService)],t)}();e.StorageService=c});