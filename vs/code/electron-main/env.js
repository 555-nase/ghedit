/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
define(["require","exports","crypto","original-fs","path","os","electron","vs/base/node/pfs","vs/base/common/arrays","vs/base/common/strings","vs/base/common/paths","vs/base/common/winjs.base","vs/base/common/platform","vs/base/common/uri","vs/base/common/types","vs/platform/instantiation/common/instantiation","vs/platform/product","vs/code/node/argv","vs/platform/package"],function(e,t,n,r,o,i,s,a,u,p,c,l,m,f,g,d,b,h,v){"use strict";function y(e,t,n){void 0===n&&(n=void 0);var r=parseInt(e);return g.isNumber(r)?r:e?t:n}function P(e,t,n){var i=t.map(function(t){var i,s=String(t);n&&(i=x(s),s=i.path),s&&(s=H(e,s));var a;try{a=r.realpathSync(s)}catch(u){a=o.normalize(o.isAbsolute(s)?s:o.join(e,s))}var p=o.basename(a);return p&&!c.isValidBasename(p)?null:n?(i.path=a,S(i)):a}),s=m.isWindows||m.isMacintosh,a=u.distinct(i,function(e){return e&&s?e.toLowerCase():e});return u.coalesce(a)}function H(e,t){return m.isWindows&&(t=p.rtrim(t,'"')),t=p.trim(p.trim(t," "),"\t"),m.isWindows&&(t=o.resolve(e,t),t=p.rtrim(t,".")),t}function _(e){return e?o.normalize(e):e}function j(){return"linux"===process.platform?"linux-"+process.arch:process.platform}function x(e){var t,n=e.split(":"),r=null,o=null;return n.forEach(function(e){var n=Number(e);g.isNumber(n)?null===r?r=n:null===o&&(o=n):t=t?[t,e].join(":"):e}),{path:t,line:null!==r?r:void 0,column:null!==o?o:null!==r?1:void 0}}function S(e){var t=[e.path];return g.isNumber(e.line)&&t.push(String(e.line)),g.isNumber(e.column)&&t.push(String(e.column)),t.join(":")}t.IEnvironmentService=d.createDecorator("mainEnvironmentService");var w=function(){function t(){this._appRoot=o.dirname(f["default"].parse(e.toUrl("")).fsPath),this._currentWorkingDirectory=process.env.VSCODE_CWD||process.cwd(),this._appHome=s.app.getPath("userData"),this._appSettingsHome=o.join(this._appHome,"User"),this._appSettingsPath=o.join(this._appSettingsHome,"settings.json"),this._appKeybindingsPath=o.join(this._appSettingsHome,"keybindings.json");var t=process.argv,n=t.slice(1);if(!this.isBuilt){var a=u.firstIndex(n,function(e){return!/^-/.test(e)});a>-1&&n.splice(a,1)}if(r.existsSync(o.join(this._appRoot,"argv"))){var p=JSON.parse(r.readFileSync(o.join(this._appRoot,"argv"),"utf8"));n=p.concat(n)}var c=h.parseArgs(n),l=y(c.debugBrkPluginHost,5870),m=y(c.debugPluginHost,5870,this.isBuilt?void 0:5870),d=P(this._currentWorkingDirectory,c._,c["goto"]),H=parseInt(c.timestamp),j=y(c.debugBrkFileWatcherPort,void 0);this._cliArgs=Object.freeze({pathArguments:d,programStart:g.isNumber(H)?H:0,enablePerformance:c.performance,verboseLogging:c.verbose,debugExtensionHostPort:l||m,debugBrkExtensionHost:!!l,logExtensionHostCommunication:c.logExtensionHostCommunication,debugBrkFileWatcherPort:j,openNewWindow:c["new-window"],openInSameWindow:c["reuse-window"],gotoLineMode:c["goto"],diffMode:c.diff&&2===d.length,extensionsHomePath:_(c.extensionHomePath),extensionDevelopmentPath:_(c.extensionDevelopmentPath),extensionTestsPath:_(c.extensionTestsPath),disableExtensions:c["disable-extensions"],locale:c.locale,waitForWindowClose:c.wait}),this._isTestingFromCli=this.cliArgs.extensionTestsPath&&!this.cliArgs.debugBrkExtensionHost,this._userHome=o.join(i.homedir(),b["default"].dataFolderName),this._userExtensionsHome=this.cliArgs.extensionsHomePath||o.join(this._userHome,"extensions");var x=this.getIPCHandleBaseName(),S="win32"===process.platform?"-sock":".sock";this._mainIPCHandle=x+"-"+v["default"].version+S,this._sharedIPCHandle=x+"-"+v["default"].version+"-shared"+S}return Object.defineProperty(t.prototype,"cliArgs",{get:function(){return this._cliArgs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userExtensionsHome",{get:function(){return this._userExtensionsHome},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTestingFromCli",{get:function(){return this._isTestingFromCli},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBuilt",{get:function(){return!process.env.VSCODE_DEV},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"product",{get:function(){return b["default"]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateUrl",{get:function(){return b["default"].updateUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return b["default"].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userHome",{get:function(){return this._userHome},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appRoot",{get:function(){return this._appRoot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentWorkingDirectory",{get:function(){return this._currentWorkingDirectory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appHome",{get:function(){return this._appHome},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appSettingsHome",{get:function(){return this._appSettingsHome},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appSettingsPath",{get:function(){return this._appSettingsPath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appKeybindingsPath",{get:function(){return this._appKeybindingsPath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mainIPCHandle",{get:function(){return this._mainIPCHandle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharedIPCHandle",{get:function(){return this._sharedIPCHandle},enumerable:!0,configurable:!0}),t.prototype.getIPCHandleBaseName=function(){var e=v["default"].name,n=t.getUniqueUserId();return n&&(e+="-"+n),"win32"===process.platform?"\\\\.\\pipe\\"+e:o.join(i.tmpdir(),e)},t.getUniqueUserId=function(){var e;return e=m.isWindows?process.env.USERNAME:process.env.USER,e?n.createHash("sha256").update(e).digest("hex").substr(0,6):""},t.prototype.createPaths=function(){var e=[this.appSettingsHome,this.userHome,this.userExtensionsHome].map(function(e){return a.mkdirp(e)});return l.TPromise.join(e)},t}();t.EnvService=w,t.getPlatformIdentifier=j,t.parseLineAndColumnAware=x,t.toLineAndColumnPath=S});