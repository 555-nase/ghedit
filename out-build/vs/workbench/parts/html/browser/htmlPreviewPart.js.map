{"version":3,"sources":["vs/workbench/parts/html/browser/htmlPreviewPart.ts"],"names":[],"mappings":"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","file":"vs/workbench/parts/html/browser/htmlPreviewPart.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport 'vs/text!./webview.html';\nimport {localize} from 'vs/nls';\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IModel, EventType} from 'vs/editor/common/editorCommon';\nimport {Dimension, Builder} from 'vs/base/browser/builder';\nimport {empty as EmptyDisposable, IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport {addDisposableListener, addClass} from 'vs/base/browser/dom';\nimport {EditorOptions, EditorInput} from 'vs/workbench/common/editor';\nimport {BaseEditor} from 'vs/workbench/browser/parts/editor/baseEditor';\nimport {Position} from 'vs/platform/editor/common/editor';\nimport {ITelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\nimport {isLightTheme} from 'vs/platform/theme/common/themes';\nimport {IWorkbenchEditorService} from 'vs/workbench/services/editor/common/editorService';\nimport {BaseTextEditorModel} from 'vs/workbench/common/editor/textEditorModel';\nimport {HtmlInput} from 'vs/workbench/parts/html/common/htmlInput';\nimport {IThemeService} from 'vs/workbench/services/themes/common/themeService';\nimport {KeybindingsRegistry} from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport {IOpenerService} from 'vs/platform/opener/common/opener';\n\nKeybindingsRegistry.registerCommandDesc({\n\tid: '_webview.openDevTools',\n\tcontext: null,\n\tweight: KeybindingsRegistry.WEIGHT.workbenchContrib(0),\n\tprimary: null,\n\thandler() {\n\t\tconst elements = document.querySelectorAll('webview.ready');\n\t\tfor (let i = 0; i < elements.length; i++) {\n\t\t\ttry {\n\t\t\t\t(<Webview>elements.item(i)).openDevTools();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n});\n\ndeclare interface Webview extends HTMLElement {\n\tsrc: string;\n\tautoSize: 'on';\n\tnodeintegration: 'on';\n\tdisablewebsecurity: 'on';\n\n\tgetURL(): string;\n\tgetTitle(): string;\n\texecuteJavaScript(code: string, userGesture?: boolean, callback?: (result: any) => any);\n\tsend(channel: string, ...args: any[]);\n\topenDevTools(): any;\n\tcloseDevTools(): any;\n}\n\nclass ManagedWebview {\n\n\tprivate _webview: Webview;\n\tprivate _ready: TPromise<this>;\n\tprivate _disposables: IDisposable[];\n\n\tconstructor(private _parent: HTMLElement, private _styleElement: Element, onDidClickLink:(uri:URI)=>any) {\n\t\tthis._webview = <Webview>document.createElement('webview');\n\n\t\tthis._webview.style.width = '100%';\n\t\tthis._webview.style.height = '100%';\n\t\tthis._webview.autoSize = 'on';\n\t\tthis._webview.nodeintegration = 'on';\n\t\tthis._webview.src = require.toUrl('./webview.html');\n\n\t\tthis._ready = new TPromise<this>(resolve => {\n\t\t\tconst subscription = addDisposableListener(this._webview, 'ipc-message', (event) => {\n\t\t\t\tif (event.channel === 'webview-ready') {\n\n\t\t\t\t\t// console.info('[PID Webview] ' + event.args[0]);\n\t\t\t\t\taddClass(this._webview, 'ready'); // can be found by debug command\n\n\t\t\t\t\tsubscription.dispose();\n\t\t\t\t\tresolve(this);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._disposables = [\n\t\t\taddDisposableListener(this._webview, 'console-message', function (e: { level: number; message: string; line: number; sourceId: string; }) {\n\t\t\t\tconsole.log(`[Embedded Page] ${e.message}`);\n\t\t\t}),\n\t\t\taddDisposableListener(this._webview, 'crashed', function () {\n\t\t\t\tconsole.error('embedded page crashed');\n\t\t\t}),\n\t\t\taddDisposableListener(this._webview, 'ipc-message', (event) => {\n\t\t\t\tif (event.channel === 'did-click-link') {\n\t\t\t\t\tlet [uri] = event.args;\n\t\t\t\t\tonDidClickLink(URI.parse(uri));\n\t\t\t\t}\n\t\t\t})\n\t\t];\n\n\t\tthis._parent.appendChild(this._webview);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables = dispose(this._disposables);\n\t\tthis._webview.parentElement.removeChild(this._webview);\n\t}\n\n\tprivate _send(channel: string, ...args: any[]): void {\n\t\tthis._ready\n\t\t\t.then(() => this._webview.send(channel, ...args))\n\t\t\t.done(void 0, console.error);\n\t}\n\n\tset contents(value: string[]) {\n\t\tthis._send('content', value);\n\t}\n\n\tset baseUrl(value: string) {\n\t\tthis._send('baseUrl', value);\n\t}\n\n\tfocus(): void {\n\t\tthis._send('focus');\n\t}\n\n\tstyle(themeId: string): void {\n\t\tconst {color, backgroundColor, fontFamily, fontSize} = window.getComputedStyle(this._styleElement);\n\n\t\tlet value = `\n\t\tbody {\n\t\t\tmargin: 0;\n\t\t}\n\t\t* {\n\t\t\tcolor: ${color};\n\t\t\tbackground-color: ${backgroundColor};\n\t\t\tfont-family: ${fontFamily};\n\t\t\tfont-size: ${fontSize};\n\t\t}\n\t\timg {\n\t\t\tmax-width: 100%;\n\t\t\tmax-height: 100%;\n\t\t}\n\t\ta:focus,\n\t\tinput:focus,\n\t\tselect:focus,\n\t\ttextarea:focus {\n\t\t\toutline: 1px solid -webkit-focus-ring-color;\n\t\t\toutline-offset: -1px;\n\t\t}\n\t\t::-webkit-scrollbar {\n\t\t\twidth: 14px;\n\t\t\theight: 10px;\n\t\t}\n\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\tbackground-color: rgba(100, 100, 100, 0.7);\n\t\t}`;\n\n\t\tif (isLightTheme(themeId)) {\n\t\t\tvalue += `\n\t\t\t::-webkit-scrollbar-thumb {\n\t\t\t\tbackground-color: rgba(100, 100, 100, 0.4);\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb:active {\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.6);\n\t\t\t}`;\n\t\t} else {\n\t\t\tvalue += `\n\t\t\t::-webkit-scrollbar-thumb {\n\t\t\t\tbackground-color: rgba(121, 121, 121, 0.4);\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb:active {\n\t\t\t\tbackground-color: rgba(85, 85, 85, 0.8);\n\t\t\t}`;\n\t\t}\n\n\t\tthis._send('styles', value);\n\t}\n}\n\n/**\n * An implementation of editor for showing HTML content in an IFrame by leveraging the IFrameEditorInput.\n */\nexport class HtmlPreviewPart extends BaseEditor {\n\n\tstatic ID: string = 'workbench.editor.htmlPreviewPart';\n\n\tprivate _editorService: IWorkbenchEditorService;\n\tprivate _themeService: IThemeService;\n\tprivate _openerService: IOpenerService;\n\tprivate _webview: ManagedWebview;\n\tprivate _container: HTMLDivElement;\n\n\tprivate _baseUrl: URI;\n\n\tprivate _model: IModel;\n\tprivate _modelChangeSubscription = EmptyDisposable;\n\tprivate _themeChangeSubscription = EmptyDisposable;\n\n\tconstructor(\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IWorkbenchEditorService editorService: IWorkbenchEditorService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IWorkspaceContextService contextService: IWorkspaceContextService\n\t) {\n\t\tsuper(HtmlPreviewPart.ID, telemetryService);\n\n\t\tthis._editorService = editorService;\n\t\tthis._themeService = themeService;\n\t\tthis._openerService = openerService;\n\t\tthis._baseUrl = contextService.toResource('/');\n\t}\n\n\tdispose(): void {\n\t\t// remove from dom\n\t\tthis._webview.dispose();\n\n\t\t// unhook listeners\n\t\tthis._themeChangeSubscription.dispose();\n\t\tthis._modelChangeSubscription.dispose();\n\t\tthis._model = undefined;\n\t\tsuper.dispose();\n\t}\n\n\tpublic createEditor(parent: Builder): void {\n\t\tthis._container = document.createElement('div');\n\t\tparent.getHTMLElement().appendChild(this._container);\n\t}\n\n\tprivate get webview(): ManagedWebview {\n\t\tif (!this._webview) {\n\t\t\tthis._webview = new ManagedWebview(this._container,\n\t\t\t\tdocument.querySelector('.monaco-editor-background'),\n\t\t\t\turi => this._openerService.open(uri));\n\n\t\t\tthis._webview.baseUrl = this._baseUrl && this._baseUrl.toString();\n\t\t}\n\t\treturn this._webview;\n\t}\n\n\tpublic changePosition(position: Position): void {\n\t\t// what this actually means is that we got reparented. that\n\t\t// has caused the webview to stop working and we need to reset it\n\t\tthis._doSetVisible(false);\n\t\tthis._doSetVisible(true);\n\n\t\tsuper.changePosition(position);\n\t}\n\n\tpublic setVisible(visible: boolean, position?: Position): TPromise<void> {\n\t\tthis._doSetVisible(visible);\n\t\treturn super.setVisible(visible, position);\n\t}\n\n\tprivate _doSetVisible(visible: boolean):void {\n\t\tif (!visible) {\n\t\t\tthis._themeChangeSubscription.dispose();\n\t\t\tthis._modelChangeSubscription.dispose();\n\t\t\tthis._webview.dispose();\n\t\t\tthis._webview = undefined;\n\t\t} else {\n\t\t\tthis._themeChangeSubscription = this._themeService.onDidThemeChange(themeId => this.webview.style(themeId));\n\t\t\tthis.webview.style(this._themeService.getTheme());\n\n\t\t\tif (this._model) {\n\t\t\t\tthis._modelChangeSubscription = this._model.addListener2(EventType.ModelContentChanged2, () => this.webview.contents = this._model.getLinesContent());\n\t\t\t\tthis.webview.contents = this._model.getLinesContent();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic layout(dimension: Dimension): void {\n\t\tconst {width, height} = dimension;\n\t\tthis._container.style.width = `${width}px`;\n\t\tthis._container.style.height = `${height}px`;\n\t}\n\n\tpublic focus(): void {\n\t\tthis.webview.focus();\n\t}\n\n\tpublic setInput(input: EditorInput, options: EditorOptions): TPromise<void> {\n\n\t\tif (this.input === input) {\n\t\t\treturn TPromise.as(undefined);\n\t\t}\n\n\t\tthis._model = undefined;\n\t\tthis._modelChangeSubscription.dispose();\n\n\t\tif (!(input instanceof HtmlInput)) {\n\t\t\treturn TPromise.wrapError<void>('Invalid input');\n\t\t}\n\n\t\treturn this._editorService.resolveEditorModel({ resource: (<HtmlInput>input).getResource() }).then(model => {\n\t\t\tif (model instanceof BaseTextEditorModel) {\n\t\t\t\tthis._model = model.textEditorModel;\n\t\t\t}\n\t\t\tif (!this._model) {\n\t\t\t\treturn TPromise.wrapError<void>(localize('html.voidInput', \"Invalid editor input.\"));\n\t\t\t}\n\t\t\tthis._modelChangeSubscription = this._model.addListener2(EventType.ModelContentChanged2, () => this.webview.contents = this._model.getLinesContent());\n\t\t\tthis.webview.contents = this._model.getLinesContent();\n\t\t\treturn super.setInput(input, options);\n\t\t});\n\t}\n}\n"]}