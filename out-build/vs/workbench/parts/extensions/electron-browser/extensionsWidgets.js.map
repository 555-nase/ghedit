{"version":3,"sources":["vs/workbench/parts/extensions/electron-browser/extensionsWidgets.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;IAwBhG,IAAM,YAAY,GAAW;QAC5B,MAAM,EAAE,EAAE;QACV,UAAU,EAAE,EAAE;QACd,QAAQ,EAAE,EAAE;KACZ,CAAC;IAEF,yBAAyB,GAAuB,EAAE,KAAyB;QAC1E,MAAM,CAAC,GAAG,CAAC,SAAS,KAAK,KAAK,CAAC,SAAS,IAAI,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC;IACrE,CAAC;IAED,IAAM,cAAc,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,kBAAkB;IAExD;QAMC,iCAC4B,gBAAmC,EACtC,aAA6B,EACvB,iBAAqC,EAClC,oBAA2C,EAC/C,gBAAmC;YAJrC,qBAAgB,GAAhB,gBAAgB,CAAmB;YACtC,kBAAa,GAAb,aAAa,CAAgB;YACvB,sBAAiB,GAAjB,iBAAiB,CAAoB;YAClC,yBAAoB,GAApB,oBAAoB,CAAuB;YAC/C,qBAAgB,GAAhB,gBAAgB,CAAmB;YARzD,UAAK,GAAW,YAAY,CAAC;YAC7B,oBAAe,GAAG,IAAI,wBAAgB,CAAO,cAAc,CAAC,CAAC;QAQlE,CAAC;QAEJ,wCAAM,GAAN,UAAO,SAAsB;YAA7B,iBAcC;YAbA,IAAI,CAAC,OAAO,GAAG,YAAM,CAAC,SAAS,EAAE,WAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC;YAC9D,YAAM,CAAC,IAAI,CAAC,OAAO,EAAE,WAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACjC,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,cAAM,OAAA,KAAI,CAAC,OAAO,EAAE,EAAd,CAAc,CAAC;YAE5C,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,IAAI,CAAC,aAAa,EAAE,CAAC;YAErB,IAAM,WAAW,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;YACtF,IAAI,CAAC,iBAAiB,CAAC,qBAAqB,CAAC,IAAI,CAAC,qBAAqB,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;YAC5F,IAAI,CAAC,iBAAiB,CAAC,uBAAuB,CAAC,IAAI,CAAC,uBAAuB,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;YAEhG,MAAM,CAAC,8BAAkB,CAAC,WAAW,CAAC,CAAC;QACxC,CAAC;QAEO,6CAAW,GAAnB,UAAoB,GAAQ;YAC3B,IAAI,CAAC,KAAK,GAAG,gBAAM,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,aAAa,EAAE,CAAC;QACtB,CAAC;QAED,sBAAY,8CAAS;iBAArB,cAA0B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;;;WAAA;QAChE,sBAAY,iDAAY;iBAAxB,cAA6B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;;;WAAA;QACvE,sBAAY,+CAAU;iBAAtB,cAA2B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;;;WAAA;QAE3D,+CAAa,GAArB;YACC,iBAAW,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YACxD,iBAAW,CAAC,IAAI,CAAC,OAAO,EAAE,eAAe,EAAE,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC;YACjF,iBAAW,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,EAAE,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC;YAEnG,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;gBACpB,IAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAU,EAAE,IAAsB,CAAC,CAAC;gBAClE,IAAM,MAAM,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAgB,EAAE,IAAyB,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACnG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,MAAM,GAAG,QAAQ,CAAC;YACvE,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAsB,EAAE,IAAgC,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YAC3H,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gBAC5B,IAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAW,EAAE,IAAiC,CAAC,CAAC;gBAC9E,IAAM,MAAM,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAiB,EAAE,IAAoC,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBACjH,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,GAAG,MAAM,GAAG,QAAQ,CAAC;YACzE,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAY,EAAE,IAAY,CAAC,CAAC;YAC/D,CAAC;QACF,CAAC;QAEO,yCAAO,GAAf;YACC,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;gBACpB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;gBACnC,IAAI,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;YAClC,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gBAC5B,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC3C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAI,4BAAe,OAAI,CAAC,CAAC;YACrD,CAAC;QACF,CAAC;QAEO,4CAAU,GAAlB,UAAmB,MAAkB;YAArC,iBAaC;YAZA,IAAM,OAAO,GAAG,iCAAwB,CAAC,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC,CAAC;YAChF,OAAO,CAAC,IAAI,CAAC,UAAA,SAAS;gBACrB,MAAM,CAAC,OAAO,CAAC,UAAA,CAAC;oBACf,IAAM,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,IAAI,KAAK,CAAC,CAAC,MAAM,EAArB,CAAqB,CAAC,CAAC,GAAG,EAAE,CAAC;oBACvE,IAAM,IAAI,GAAG,SAAS,IAAI,SAAS,CAAC,IAAI,CAAC;oBACzC,IAAM,OAAO,GAAG,IAAI,GAAO,IAAI,UAAO,CAAC,CAAC,OAAU,GAAG,CAAC,CAAC,OAAO,CAAC;oBAE/D,IAAM,aAAa,GAAG,KAAI,CAAC,aAAa,CAAC,UAAU,CAAC,gCAAmB,CAAC,CAAC;oBACzE,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;oBAC9B,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC1B,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,oDAAkB,GAA1B,UAA2B,QAA4B;YACtD,IAAM,UAAU,GAAO,IAAI,CAAC,KAAK,CAAC,UAAU,SAAE,QAAQ,EAAC,CAAC;YACxD,IAAI,CAAC,WAAW,CAAC,EAAE,YAAA,UAAU,EAAE,CAAC,CAAC;QAClC,CAAC;QAEO,uDAAqB,GAA7B,UAA8B,EAAyC;YAAvE,iBAKC;gBAL+B,wBAAS;YACxC,IAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU;iBACtC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,eAAe,CAAC,SAAS,EAAE,CAAC,CAAC,EAA9B,CAA8B,CAAC,CAAC;YAC9C,IAAI,CAAC,WAAW,CAAC,EAAE,YAAA,UAAU,EAAE,CAAC,CAAC;YACjC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,cAAM,OAAA,KAAI,CAAC,aAAa,EAAE,EAApB,CAAoB,EAAE,CAAC,CAAC,CAAC;QAC7D,CAAC;QAEO,yDAAuB,GAA/B;YAAA,iBAEC;YADA,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,cAAM,OAAA,KAAI,CAAC,aAAa,EAAE,EAApB,CAAoB,EAAE,CAAC,CAAC,CAAC;QAC7D,CAAC;QAEO,6CAAW,GAAnB;YAAA,iBAWC;YAVA,IAAM,OAAO,GAAG,iCAAwB,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,CAAC;YAC1E,OAAO,CAAC,IAAI,CAAC;gBACZ,IAAM,MAAM,GAAG,KAAI,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,CAAC;gBAC3D,IAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;qBAChC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAlB,CAAkB,CAAC;qBAC5B,MAAM,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAX,CAAW,EAAE,EAAE,CAAC;qBACjC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,GAAG,kBAAQ,CAAC,IAAI,EAAtB,CAAsB,CAAC,CAAC;gBAEtC,KAAI,CAAC,WAAW,CAAC,EAAE,QAAA,MAAM,EAAE,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,+CAAa,GAArB;YAAA,iBASC;YARA,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,sCAAqB,CAAC;iBACpE,IAAI,CAAC,IAAI,EAAE,UAAA,CAAC,IAAI,OAAA,EAAE,EAAF,CAAE,CAAC,CAAC,gBAAgB;iBACpC,IAAI,CAAC,UAAA,QAAQ;gBACb,KAAI,CAAC,WAAW,CAAC,EAAE,UAAA,QAAQ,EAAE,CAAC,CAAC;gBAE/B,oBAAoB;gBACpB,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,cAAM,OAAA,KAAI,CAAC,aAAa,EAAE,EAApB,CAAoB,CAAC,CAAC;YAC1D,CAAC,CAAC,CAAC;QACL,CAAC;QApHA;uBAAC,8BAAiB;uBACjB,uBAAc;uBACd,+BAAkB;uBAClB,qCAAqB;uBACrB,oCAAiB;mCAJA;QAqHpB,8BAAC;IAAD,CA5HA,AA4HC,IAAA;IA5HY,+BAAuB,0BA4HnC,CAAA","file":"vs/workbench/parts/extensions/electron-browser/extensionsWidgets.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport Severity from 'vs/base/common/severity';\nimport { ThrottledDelayer } from 'vs/base/common/async';\nimport { TPromise } from 'vs/base/common/winjs.base';\nimport { emmet as $, append, toggleClass } from 'vs/base/browser/dom';\nimport { IDisposable, combinedDisposable } from 'vs/base/common/lifecycle';\nimport { onUnexpectedPromiseError } from 'vs/base/common/errors';\nimport { assign } from 'vs/base/common/objects';\nimport { IStatusbarItem } from 'vs/workbench/browser/parts/statusbar/statusbar';\nimport { IOutputService } from 'vs/workbench/parts/output/common/output';\nimport { IExtensionService, IMessage } from 'vs/platform/extensions/common/extensions';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtensionsService, ExtensionsLabel, ExtensionsChannelId, IExtension, IExtensionManifest } from 'vs/workbench/parts/extensions/common/extensions';\nimport { IQuickOpenService } from 'vs/workbench/services/quickopen/common/quickOpenService';\nimport { getOutdatedExtensions } from 'vs/workbench/parts/extensions/common/extensionsUtil';\n\ninterface IState {\n\terrors: IMessage[];\n\tinstalling: IExtensionManifest[];\n\toutdated: IExtension[];\n}\n\nconst InitialState: IState = {\n\terrors: [],\n\tinstalling: [],\n\toutdated: []\n};\n\nfunction extensionEquals(one: IExtensionManifest, other: IExtensionManifest): boolean {\n\treturn one.publisher === other.publisher && one.name === other.name;\n}\n\nconst OutdatedPeriod = 5 * 60 * 1000; // every 5 minutes\n\nexport class ExtensionsStatusbarItem implements IStatusbarItem {\n\n\tprivate domNode: HTMLElement;\n\tprivate state: IState = InitialState;\n\tprivate outdatedDelayer = new ThrottledDelayer<void>(OutdatedPeriod);\n\n\tconstructor(\n\t\t@IExtensionService private extensionService: IExtensionService,\n\t\t@IOutputService private outputService: IOutputService,\n\t\t@IExtensionsService protected extensionsService: IExtensionsService,\n\t\t@IInstantiationService protected instantiationService: IInstantiationService,\n\t\t@IQuickOpenService protected quickOpenService: IQuickOpenService\n\t) {}\n\n\trender(container: HTMLElement): IDisposable {\n\t\tthis.domNode = append(container, $('a.extensions-statusbar'));\n\t\tappend(this.domNode, $('.icon'));\n\t\tthis.domNode.onclick = () => this.onClick();\n\n\t\tthis.checkErrors();\n\t\tthis.checkOutdated();\n\n\t\tconst disposables = [];\n\t\tthis.extensionsService.onInstallExtension(this.onInstallExtension, this, disposables);\n\t\tthis.extensionsService.onDidInstallExtension(this.onDidInstallExtension, this, disposables);\n\t\tthis.extensionsService.onDidUninstallExtension(this.onDidUninstallExtension, this, disposables);\n\n\t\treturn combinedDisposable(disposables);\n\t}\n\n\tprivate updateState(obj: any): void {\n\t\tthis.state = assign(this.state, obj);\n\t\tthis.onStateChange();\n\t}\n\n\tprivate get hasErrors() { return this.state.errors.length > 0; }\n\tprivate get isInstalling() { return this.state.installing.length > 0; }\n\tprivate get hasUpdates() { return this.state.outdated.length > 0; }\n\n\tprivate onStateChange(): void {\n\t\ttoggleClass(this.domNode, 'has-errors', this.hasErrors);\n\t\ttoggleClass(this.domNode, 'is-installing', !this.hasErrors && this.isInstalling);\n\t\ttoggleClass(this.domNode, 'has-updates', !this.hasErrors && !this.isInstalling && this.hasUpdates);\n\n\t\tif (this.hasErrors) {\n\t\t\tconst singular = nls.localize('oneIssue', \"Extensions (1 issue)\");\n\t\t\tconst plural = nls.localize('multipleIssues', \"Extensions ({0} issues)\", this.state.errors.length);\n\t\t\tthis.domNode.title = this.state.errors.length > 1 ? plural : singular;\n\t\t} else if (this.isInstalling) {\n\t\t\tthis.domNode.title = nls.localize('extensionsInstalling', \"Extensions ({0} installing...)\", this.state.installing.length);\n\t\t} else if (this.hasUpdates) {\n\t\t\tconst singular = nls.localize('oneUpdate', \"Extensions (1 update available)\");\n\t\t\tconst plural = nls.localize('multipleUpdates', \"Extensions ({0} updates available)\", this.state.outdated.length);\n\t\t\tthis.domNode.title = this.state.outdated.length > 1 ? plural : singular;\n\t\t} else {\n\t\t\tthis.domNode.title = nls.localize('extensions', \"Extensions\");\n\t\t}\n\t}\n\n\tprivate onClick(): void {\n\t\tif (this.hasErrors) {\n\t\t\tthis.showErrors(this.state.errors);\n\t\t\tthis.updateState({ errors: [] });\n\t\t} else if (this.hasUpdates) {\n\t\t\tthis.quickOpenService.show(`ext update `);\n\t\t} else {\n\t\t\tthis.quickOpenService.show(`>${ExtensionsLabel}: `);\n\t\t}\n\t}\n\n\tprivate showErrors(errors: IMessage[]): void {\n\t\tconst promise = onUnexpectedPromiseError(this.extensionsService.getInstalled());\n\t\tpromise.done(installed => {\n\t\t\terrors.forEach(m => {\n\t\t\t\tconst extension = installed.filter(ext => ext.path === m.source).pop();\n\t\t\t\tconst name = extension && extension.name;\n\t\t\t\tconst message = name ? `${ name }: ${ m.message }` : m.message;\n\n\t\t\t\tconst outputChannel = this.outputService.getChannel(ExtensionsChannelId);\n\t\t\t\toutputChannel.append(message);\n\t\t\t\toutputChannel.show(true);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate onInstallExtension(manifest: IExtensionManifest): void {\n\t\tconst installing = [...this.state.installing, manifest];\n\t\tthis.updateState({ installing });\n\t}\n\n\tprivate onDidInstallExtension({ extension }: { extension: IExtension; }): void {\n\t\tconst installing = this.state.installing\n\t\t\t.filter(e => !extensionEquals(extension, e));\n\t\tthis.updateState({ installing });\n\t\tthis.outdatedDelayer.trigger(() => this.checkOutdated(), 0);\n\t}\n\n\tprivate onDidUninstallExtension(): void {\n\t\tthis.outdatedDelayer.trigger(() => this.checkOutdated(), 0);\n\t}\n\n\tprivate checkErrors(): void {\n\t\tconst promise = onUnexpectedPromiseError(this.extensionService.onReady());\n\t\tpromise.done(() => {\n\t\t\tconst status = this.extensionService.getExtensionsStatus();\n\t\t\tconst errors = Object.keys(status)\n\t\t\t\t.map(k => status[k].messages)\n\t\t\t\t.reduce((r, m) => r.concat(m), [])\n\t\t\t\t.filter(m => m.type > Severity.Info);\n\n\t\t\tthis.updateState({ errors });\n\t\t});\n\t}\n\n\tprivate checkOutdated(): TPromise<void> {\n\t\treturn this.instantiationService.invokeFunction(getOutdatedExtensions)\n\t\t\t.then(null, _ => []) // ignore errors\n\t\t\t.then(outdated => {\n\t\t\t\tthis.updateState({ outdated });\n\n\t\t\t\t// repeat this later\n\t\t\t\tthis.outdatedDelayer.trigger(() => this.checkOutdated());\n\t\t\t});\n\t}\n}"]}