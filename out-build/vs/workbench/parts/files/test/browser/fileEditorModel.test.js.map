{"version":3,"file":"vs/workbench/parts/files/test/browser/fileEditorModel.test.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/workbench/parts/files/test/browser/fileEditorModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport * as assert from 'assert';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport URI from 'vs/base/common/uri';\nimport paths = require('vs/base/common/paths');\nimport {FileEditorInput} from 'vs/workbench/parts/files/browser/editors/fileEditorInput';\nimport {TextFileEditorModel, CACHE} from 'vs/workbench/parts/files/common/editors/textFileEditorModel';\nimport {IInstantiationService} from 'vs/platform/instantiation/common/instantiation';\nimport {NullTelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {createInstantiationService} from 'vs/platform/instantiation/common/instantiationService';\nimport {TextFileService} from 'vs/workbench/parts/files/browser/textFileServices';\nimport {EventType} from 'vs/workbench/parts/files/common/files';\nimport {TestFileService, TestLifecycleService, TestPartService, TestEditorService, TestConfigurationService, TestUntitledEditorService, TestStorageService, TestContextService, TestMessageService, TestEventService} from 'vs/workbench/test/browser/servicesTestUtils';\nimport {createMockModelService, createMockModeService} from 'vs/editor/test/common/servicesTestUtils';\n\nfunction toResource(path) {\n\treturn URI.file(paths.join('C:\\\\', path));\n}\n\nlet baseInstantiationService: IInstantiationService;\nlet messageService: TestMessageService;\nlet eventService: TestEventService;\nlet textFileService: TextFileService;\n\nsuite('Files - TextFileEditorModel', () => {\n\n\tsetup(() => {\n\t\teventService = new TestEventService();\n\t\tmessageService = new TestMessageService();\n\n\t\tbaseInstantiationService = createInstantiationService({\n\t\t\teventService: eventService,\n\t\t\tmessageService: messageService,\n\t\t\tfileService: TestFileService,\n\t\t\tcontextService: new TestContextService(),\n\t\t\ttelemetryService: NullTelemetryService,\n\t\t\tstorageService: new TestStorageService(),\n\t\t\tuntitledEditorService: new TestUntitledEditorService(),\n\t\t\teditorService: new TestEditorService(),\n\t\t\tpartService: new TestPartService(),\n\t\t\tmodeService: createMockModeService(),\n\t\t\tmodelService: createMockModelService(),\n\t\t\tlifecycleService: new TestLifecycleService(),\n\t\t\tconfigurationService: new TestConfigurationService()\n\t\t});\n\n\t\ttextFileService = <TextFileService>baseInstantiationService.createInstance(<any>TextFileService);\n\n\t\tbaseInstantiationService.registerService('textFileService', textFileService);\n\t});\n\n\tteardown(() => {\n\t\teventService.dispose();\n\t\tCACHE.clear();\n\t});\n\n\ttest('Resolves from cache and disposes when last input disposed', function (done) {\n\t\tlet c1 = baseInstantiationService.createInstance(FileEditorInput, toResource('/path/index.txt'), 'text/plain', 'utf8');\n\t\tlet c2 = baseInstantiationService.createInstance(FileEditorInput, toResource('/path/index.txt'), 'text/plain', 'utf8');\n\t\tlet c3 = baseInstantiationService.createInstance(FileEditorInput, toResource('/path/index.txt'), 'text/plain', 'utf8');\n\n\t\tc1.resolve(true).then((model1) => {\n\t\t\tc2.resolve(true).then((model2) => {\n\t\t\t\tassert.equal(model1, model2);\n\n\t\t\t\tc2.dispose(false);\n\t\t\t\tc1.resolve(true).then((model3) => {\n\t\t\t\t\tassert.equal(model1, model3);\n\n\t\t\t\t\tc1.dispose(true);\n\t\t\t\t\tc3.resolve(true).then((model4) => {\n\t\t\t\t\t\tassert.ok(model4 !== model1);\n\n\t\t\t\t\t\tc1.dispose(true);\n\t\t\t\t\t\tc2.dispose(true);\n\t\t\t\t\t\tc3.dispose(true);\n\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Load does not trigger save', function (done) {\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index.txt'), 'utf8');\n\n\t\teventService.addListener('files:internalFileChanged', () => {\n\t\t\tassert.ok(false);\n\t\t});\n\n\t\teventService.addListener(EventType.FILE_DIRTY, () => {\n\t\t\tassert.ok(false);\n\t\t});\n\n\t\teventService.addListener(EventType.FILE_SAVED, () => {\n\t\t\tassert.ok(false);\n\t\t});\n\n\t\tm1.load().then(() => {\n\t\t\tassert.ok(m1.isResolved());\n\n\t\t\tm1.dispose();\n\n\t\t\tdone();\n\t\t});\n\t});\n\n\ttest('Load returns dirty model as long as model is dirty', function (done) {\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index_async.txt'), 'utf8');\n\n\t\tm1.load().then(() => {\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\tassert.ok(m1.isDirty());\n\t\t\tm1.load().then(() => {\n\t\t\t\tassert.ok(m1.isDirty());\n\n\t\t\t\tm1.dispose();\n\n\t\t\t\tdone();\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Revert', function (done) {\n\t\tlet eventCounter = 0;\n\n\t\teventService.addListener('files:fileReverted', () => {\n\t\t\teventCounter++;\n\t\t});\n\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index_async.txt'), 'utf8');\n\n\t\tm1.load().then(() => {\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\tassert.ok(m1.isDirty());\n\n\t\t\tm1.revert().then(() => {\n\t\t\t\tassert.ok(!m1.isDirty());\n\t\t\t\tassert.equal(m1.textEditorModel.getValue(), 'Hello Html');\n\t\t\t\tassert.equal(eventCounter, 1);\n\n\t\t\t\tm1.dispose();\n\n\t\t\t\tdone();\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Conflict Resolution Mode', function (done) {\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index_async.txt'), 'utf8');\n\n\t\tm1.load().then(() => {\n\t\t\tm1.setConflictResolutionMode();\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\tassert.ok(m1.isDirty());\n\t\t\tassert.ok(m1.isInConflictResolutionMode());\n\n\t\t\tm1.revert().then(() => {\n\t\t\t\tm1.textEditorModel.setValue('bar');\n\t\t\t\tassert.ok(m1.isDirty());\n\n\t\t\t\treturn m1.save().then(() => {\n\t\t\t\t\tassert.ok(!m1.isDirty());\n\n\t\t\t\t\tm1.dispose();\n\n\t\t\t\t\tdone();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Auto Save triggered when model changes', function (done) {\n\t\tlet eventCounter = 0;\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index.txt'), 'utf8');\n\n\t\t(<any>m1).autoSaveAfterMillies = 10;\n\t\t(<any>m1).autoSaveAfterMilliesEnabled = true;\n\n\t\teventService.addListener(EventType.FILE_DIRTY, () => {\n\t\t\teventCounter++;\n\t\t});\n\n\t\teventService.addListener(EventType.FILE_SAVED, () => {\n\t\t\teventCounter++;\n\t\t});\n\n\t\tm1.load().then(() => {\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\treturn TPromise.timeout(50).then(() => {\n\t\t\t\tassert.ok(!m1.isDirty());\n\t\t\t\tassert.equal(eventCounter, 2);\n\n\t\t\t\tm1.dispose();\n\n\t\t\t\tdone();\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Dirty tracking', function (done) {\n\t\tlet resource = toResource('/path/index_async.txt');\n\t\tlet i1 = baseInstantiationService.createInstance(FileEditorInput, resource, 'text/plain', 'utf8');\n\n\t\ti1.resolve().then((m1: TextFileEditorModel) => {\n\t\t\tlet dirty = m1.getLastDirtyTime();\n\t\t\tassert.ok(!dirty);\n\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\tassert.ok(m1.isDirty());\n\t\t\tassert.ok(m1.getLastDirtyTime() > dirty);\n\n\t\t\tassert.ok(textFileService.isDirty(resource));\n\t\t\tassert.equal(textFileService.getDirty().length, 1);\n\n\t\t\tm1.dispose();\n\n\t\t\tdone();\n\t\t});\n\t});\n\n\ttest('save() and isDirty() - proper with check for mtimes', function (done) {\n\t\tlet c1 = baseInstantiationService.createInstance(FileEditorInput, toResource('/path/index_async2.txt'), 'text/plain', 'utf8');\n\t\tlet c2 = baseInstantiationService.createInstance(FileEditorInput, toResource('/path/index_async.txt'), 'text/plain', 'utf8');\n\n\t\tc1.resolve().then((m1: TextFileEditorModel) => {\n\t\t\tc2.resolve().then((m2: TextFileEditorModel) => {\n\t\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\t\tlet m1Mtime = m1.getLastModifiedTime();\n\t\t\t\tlet m2Mtime = m2.getLastModifiedTime();\n\t\t\t\tassert.ok(m1Mtime > 0);\n\t\t\t\tassert.ok(m2Mtime > 0);\n\n\t\t\t\tassert.ok(textFileService.isDirty());\n\t\t\t\tassert.ok(textFileService.isDirty(toResource('/path/index_async2.txt')));\n\t\t\t\tassert.ok(!textFileService.isDirty(toResource('/path/index_async.txt')));\n\n\t\t\t\tm2.textEditorModel.setValue('foo');\n\t\t\t\tassert.ok(textFileService.isDirty(toResource('/path/index_async.txt')));\n\n\t\t\t\treturn TPromise.timeout(10).then(() => {\n\t\t\t\t\ttextFileService.saveAll().then(() => {\n\t\t\t\t\t\tassert.ok(!textFileService.isDirty(toResource('/path/index_async.txt')));\n\t\t\t\t\t\tassert.ok(!textFileService.isDirty(toResource('/path/index_async2.txt')));\n\t\t\t\t\t\tassert.ok(m1.getLastModifiedTime() > m1Mtime);\n\t\t\t\t\t\tassert.ok(m2.getLastModifiedTime() > m2Mtime);\n\n\t\t\t\t\t\tc1.dispose(true);\n\t\t\t\t\t\tc2.dispose(true);\n\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('Save Participant', function (done) {\n\t\tlet eventCounter = 0;\n\t\tlet m1 = baseInstantiationService.createInstance(TextFileEditorModel, toResource('/path/index_async.txt'), 'utf8');\n\n\t\teventService.addListener(EventType.FILE_SAVED, (e) => {\n\t\t\tassert.equal(m1.getValue(), 'bar');\n\t\t\tassert.ok(!m1.isDirty());\n\t\t\teventCounter++;\n\t\t});\n\n\t\teventService.addListener(EventType.FILE_SAVING, (e) => {\n\t\t\tassert.ok(m1.isDirty());\n\t\t\tm1.textEditorModel.setValue('bar');\n\t\t\tassert.ok(m1.isDirty());\n\t\t\teventCounter++;\n\t\t});\n\n\t\tm1.load().then(() => {\n\t\t\tm1.textEditorModel.setValue('foo');\n\n\t\t\tm1.save().then(() => {\n\t\t\t\tm1.dispose();\n\n\t\t\t\tassert.equal(eventCounter, 2);\n\n\t\t\t\tdone();\n\t\t\t});\n\t\t});\n\t});\n});"]}