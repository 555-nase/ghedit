{"version":3,"file":"vs/workbench/parts/search/test/common/searchModel.test.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/workbench/parts/search/test/common/searchModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as assert from 'assert';\nimport {Match, FileMatch, SearchResult} from 'vs/workbench/parts/search/common/searchModel';\nimport model = require('vs/editor/common/model/model');\nimport {Emitter} from 'vs/base/common/event';\nimport {IModel} from 'vs/editor/common/editorCommon';\nimport URI from 'vs/base/common/uri';\nimport {createInstantiationService} from 'vs/platform/instantiation/common/instantiationService';\nimport {TestContextService} from 'vs/workbench/test/browser/servicesTestUtils';\nimport {IInstantiationService} from 'vs/platform/instantiation/common/instantiation';\nimport {IFileMatch} from 'vs/platform/search/common/search';\n\nfunction toUri(path: string): URI {\n\treturn URI.file('C:\\\\' + path);\n}\n\nsuite('Search - Model', () => {\n\tlet instantiation: IInstantiationService;\n\tlet oneModel: IModel;\n\n\tsetup(() => {\n\t\tlet emitter = new Emitter<any>();\n\n\t\toneModel = new model.Model('line1\\nline2\\nline3', model.Model.DEFAULT_CREATION_OPTIONS, null, URI.parse('file:///folder/file.txt'));\n\t\tinstantiation = createInstantiationService({\n\t\t\tmodelService: {\n\t\t\t\tgetModel: () => oneModel,\n\t\t\t\tonModelAdded: emitter.event\n\t\t\t},\n\t\t\trequestService: {\n\t\t\t\tgetRequestUrl: () => 'file:///folder/file.txt'\n\t\t\t},\n\t\t\tcontextService: new TestContextService()\n\t\t});\n\t});\n\n\tteardown(() => {\n\t\toneModel.dispose();\n\t});\n\n\ttest('Line Match', function () {\n\t\tlet fileMatch = new FileMatch(null, toUri('folder\\\\file.txt'));\n\t\tlet lineMatch = new Match(fileMatch, 'foo bar', 1, 0, 3);\n\t\tassert.equal(lineMatch.text(), 'foo bar');\n\t\tassert.equal(lineMatch.range().startLineNumber, 2);\n\t\tassert.equal(lineMatch.range().endLineNumber, 2);\n\t\tassert.equal(lineMatch.range().startColumn, 1);\n\t\tassert.equal(lineMatch.range().endColumn, 4);\n\t});\n\n\ttest('Line Match - Remove', function () {\n\n\t\tlet fileMatch = new FileMatch(null, toUri('folder\\\\file.txt'));\n\t\tlet lineMatch = new Match(fileMatch, 'foo bar', 1, 0, 3);\n\t\tfileMatch.add(lineMatch);\n\t\tassert.equal(fileMatch.matches().length, 1);\n\t\tfileMatch.remove(lineMatch);\n\t\tassert.equal(fileMatch.matches().length, 0);\n\t});\n\n\ttest('File Match', function () {\n\n\t\tlet fileMatch = new FileMatch(null, toUri('folder\\\\file.txt'));\n\t\tassert.equal(fileMatch.matches(), 0);\n\t\tassert.equal(fileMatch.resource().toString(), 'file:///c%3A/folder/file.txt');\n\t\tassert.equal(fileMatch.name(), 'file.txt');\n\n\t\tfileMatch = new FileMatch(null, toUri('file.txt'));\n\t\tassert.equal(fileMatch.matches(), 0);\n\t\tassert.equal(fileMatch.resource().toString(), 'file:///c%3A/file.txt');\n\t\tassert.equal(fileMatch.name(), 'file.txt');\n\t});\n\n\ttest('Search Result', function () {\n\n\t\tlet searchResult = instantiation.createInstance(SearchResult, null);\n\t\tassert.equal(searchResult.isEmpty(), true);\n\n\t\tlet raw: IFileMatch[] = [];\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\traw.push({\n\t\t\t\tresource: URI.parse('file://c:/' + i),\n\t\t\t\tlineMatches: [{\n\t\t\t\t\tpreview: String(i),\n\t\t\t\t\tlineNumber: 1,\n\t\t\t\t\toffsetAndLengths: [[0, 1]]\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\tsearchResult.append(raw);\n\n\t\tassert.equal(searchResult.isEmpty(), false);\n\t\tassert.equal(searchResult.matches().length, 10);\n\t});\n\n\ttest('Alle Drei Zusammen', function () {\n\n\t\tlet searchResult = instantiation.createInstance(SearchResult, null);\n\t\tlet fileMatch = new FileMatch(searchResult, toUri('far\\\\boo'));\n\t\tlet lineMatch = new Match(fileMatch, 'foo bar', 1, 0, 3);\n\n\t\tassert(lineMatch.parent() === fileMatch);\n\t\tassert(fileMatch.parent() === searchResult);\n\t});\n\n\t//// ----- utils\n\t//function lineHasDecorations(model: editor.IModel, lineNumber: number, decorations: { start: number; end: number; }[]): void {\n\t//    let lineDecorations:typeof decorations = [];\n\t//    let decs = model.getLineDecorations(lineNumber);\n\t//    for (let i = 0, len = decs.length; i < len; i++) {\n\t//        lineDecorations.push({\n\t//            start: decs[i].range.startColumn,\n\t//            end: decs[i].range.endColumn\n\t//        });\n\t//    }\n\t//    assert.deepEqual(lineDecorations, decorations);\n\t//}\n\t//\n\t//function lineHasNoDecoration(model: editor.IModel, lineNumber: number): void {\n\t//    lineHasDecorations(model, lineNumber, []);\n\t//}\n\t//\n\t//function lineHasDecoration(model: editor.IModel, lineNumber: number, start: number, end: number): void {\n\t//    lineHasDecorations(model, lineNumber, [{\n\t//        start: start,\n\t//        end: end\n\t//    }]);\n\t//}\n\t//// ----- end utils\n\t//\n\t//test('Model Highlights', function () {\n\t//\n\t//    let fileMatch = instantiation.createInstance(FileMatch, null, toUri('folder\\\\file.txt'));\n\t//    fileMatch.add(new Match(fileMatch, 'line2', 1, 0, 2));\n\t//    fileMatch.connect();\n\t//    lineHasDecoration(oneModel, 2, 1, 3);\n\t//});\n\t//\n\t//test('Dispose', function () {\n\t//\n\t//    let fileMatch = instantiation.createInstance(FileMatch, null, toUri('folder\\\\file.txt'));\n\t//    fileMatch.add(new Match(fileMatch, 'line2', 1, 0, 2));\n\t//    fileMatch.connect();\n\t//    lineHasDecoration(oneModel, 2, 1, 3);\n\t//\n\t//    fileMatch.dispose();\n\t//    lineHasNoDecoration(oneModel, 2);\n\t//});\n});"]}