{"version":3,"sources":["vs/workbench/parts/search/browser/openSymbolHandler.ts"],"names":[],"mappings":"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","file":"vs/workbench/parts/search/browser/openSymbolHandler.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport nls = require('vs/nls');\nimport {ThrottledDelayer} from 'vs/base/common/async';\nimport URI from 'vs/base/common/uri';\nimport {QuickOpenHandler, EditorQuickOpenEntry} from 'vs/workbench/browser/quickopen';\nimport {QuickOpenModel, QuickOpenEntry, IHighlight} from 'vs/base/parts/quickopen/browser/quickOpenModel';\nimport {IAutoFocus} from 'vs/base/parts/quickopen/common/quickOpen';\nimport filters = require('vs/base/common/filters');\nimport {IRange} from 'vs/editor/common/editorCommon';\nimport {EditorInput} from 'vs/workbench/common/editor';\nimport labels = require('vs/base/common/labels');\nimport {IResourceInput} from 'vs/platform/editor/common/editor';\nimport {IWorkbenchEditorService} from 'vs/workbench/services/editor/common/editorService';\nimport {IInstantiationService} from 'vs/platform/instantiation/common/instantiation';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\nimport {IModeService} from 'vs/editor/common/services/modeService';\nimport {ITypeBearing, getNavigateToItems} from 'vs/workbench/parts/search/common/search';\n\nclass SymbolEntry extends EditorQuickOpenEntry {\n\tprivate name: string;\n\tprivate parameters: string;\n\tprivate description: string;\n\tprivate resource: URI;\n\tprivate type: string;\n\tprivate range: IRange;\n\n\tconstructor(name: string, parameters: string, description: string, resource: URI, type: string, range: IRange, highlights: IHighlight[], editorService: IWorkbenchEditorService) {\n\t\tsuper(editorService);\n\n\t\tthis.name = name;\n\t\tthis.parameters = parameters;\n\t\tthis.description = description;\n\t\tthis.resource = resource;\n\t\tthis.type = type;\n\t\tthis.range = range;\n\t\tthis.setHighlights(highlights);\n\t}\n\n\tpublic getLabel(): string {\n\t\treturn this.name + this.parameters;\n\t}\n\n\tpublic getAriaLabel(): string {\n\t\treturn nls.localize('entryAriaLabel', \"{0}, symbols picker\", this.getLabel());\n\t}\n\n\tpublic getName(): string {\n\t\treturn this.name;\n\t}\n\n\tpublic getParameters(): string {\n\t\treturn this.parameters;\n\t}\n\n\tpublic getDescription(): string {\n\t\treturn this.description;\n\t}\n\n\tpublic getType(): string {\n\t\treturn this.type;\n\t}\n\n\tpublic getIcon(): string {\n\t\treturn this.type;\n\t}\n\n\tpublic getInput(): IResourceInput | EditorInput {\n\t\tlet input: IResourceInput = {\n\t\t\tresource: this.resource,\n\t\t};\n\n\t\tif (this.range) {\n\t\t\tinput.options = {\n\t\t\t\tselection: {\n\t\t\t\t\tstartLineNumber: this.range.startLineNumber,\n\t\t\t\t\tstartColumn: this.range.startColumn\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn input;\n\t}\n}\n\nexport class OpenSymbolHandler extends QuickOpenHandler {\n\n\tprivate static SUPPORTED_OPEN_TYPES = ['class', 'interface', 'enum', 'function', 'method'];\n\tprivate static SEARCH_DELAY = 500; // This delay accommodates for the user typing a word and then stops typing to start searching\n\n\tprivate delayer: ThrottledDelayer<QuickOpenEntry[]>;\n\tprivate isStandalone: boolean;\n\n\tconstructor(\n\t\t@IWorkbenchEditorService private editorService: IWorkbenchEditorService,\n\t\t@IModeService private modeService: IModeService,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@IWorkspaceContextService private contextService: IWorkspaceContextService\n\t) {\n\t\tsuper();\n\n\t\tthis.delayer = new ThrottledDelayer<QuickOpenEntry[]>(OpenSymbolHandler.SEARCH_DELAY);\n\t\tthis.isStandalone = true;\n\t}\n\n\tpublic setStandalone(standalone: boolean) {\n\t\tthis.delayer = standalone ? new ThrottledDelayer<QuickOpenEntry[]>(OpenSymbolHandler.SEARCH_DELAY) : null;\n\t\tthis.isStandalone = standalone;\n\t}\n\n\tpublic canRun(): boolean | string {\n\t\treturn true;\n\t}\n\n\tpublic getResults(searchValue: string): TPromise<QuickOpenModel> {\n\t\tsearchValue = searchValue.trim();\n\n\t\tlet promise: TPromise<QuickOpenEntry[]>;\n\n\t\t// Respond directly to empty search\n\t\tif (!searchValue) {\n\t\t\tpromise = TPromise.as([]);\n\t\t} else if (this.delayer) {\n\t\t\tpromise = this.delayer.trigger(() => this.doGetResults(searchValue)); // Run search with delay as needed\n\t\t} else {\n\t\t\tpromise = this.doGetResults(searchValue);\n\t\t}\n\n\t\treturn promise.then(e => new QuickOpenModel(e));\n\t}\n\n\tprivate doGetResults(searchValue: string): TPromise<QuickOpenEntry[]> {\n\n\t\treturn getNavigateToItems(searchValue).then(bearings => {\n\t\t\treturn this.toQuickOpenEntries(bearings, searchValue);\n\t\t});\n\t}\n\n\tprivate toQuickOpenEntries(types: ITypeBearing[], searchValue: string): SymbolEntry[] {\n\t\tlet results: SymbolEntry[] = [];\n\n\t\t// Convert to Entries\n\t\ttypes.forEach(element => {\n\t\t\tif (!OpenSymbolHandler.SUPPORTED_OPEN_TYPES.some((type: string) => element.type === type)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Find Highlights\n\t\t\tlet highlights = filters.matchesFuzzy(searchValue, element.name);\n\t\t\tif (highlights) {\n\t\t\t\tlet resource = element.resourceUri;\n\t\t\t\tif (resource.scheme === 'file') {\n\t\t\t\t\tlet path = labels.getPathLabel(resource, this.contextService);\n\n\t\t\t\t\tlet container: string = void (0);\n\n\t\t\t\t\t// Type is top level in module with path spec, use path info then (/folder/file.ts)\n\t\t\t\t\tif (element.containerName === path) {\n\t\t\t\t\t\tcontainer = path;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Type is top level in module with url spec, find last segment to produce a short description (http://.../file.ts)\n\t\t\t\t\telse if (element.containerName === resource.toString() && element.containerName.indexOf('/') >= 0) {\n\t\t\t\t\t\tcontainer = element.containerName.substr(element.containerName.lastIndexOf('/') + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Type is inside a module or other type, find last segment to produce a short description (.../folder/file.ts.CompResult)\n\t\t\t\t\telse if (element.containerName && element.containerName.indexOf('.') >= 0) {\n\t\t\t\t\t\tcontainer = element.containerName.substr(element.containerName.lastIndexOf('.') + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Fallback\n\t\t\t\t\telse {\n\t\t\t\t\t\tcontainer = element.containerName || path;\n\t\t\t\t\t}\n\n\t\t\t\t\tresults.push(new SymbolEntry(element.name, element.parameters, container, resource, element.type, element.range, highlights, this.editorService));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Sort (Standalone only)\n\t\tif (this.isStandalone) {\n\t\t\treturn results.sort(this.sort.bind(this, searchValue.toLowerCase()));\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tprivate sort(searchValue: string, elementA: SymbolEntry, elementB: SymbolEntry): number {\n\n\t\t// Sort by Type if name is identical\n\t\tlet elementAName = elementA.getName().toLowerCase();\n\t\tlet elementBName = elementB.getName().toLowerCase();\n\t\tif (elementAName === elementBName) {\n\t\t\tlet elementAType = elementA.getType();\n\t\t\tlet elementBType = elementB.getType();\n\t\t\tif (elementAType !== elementBType) {\n\t\t\t\treturn OpenSymbolHandler.SUPPORTED_OPEN_TYPES.indexOf(elementAType) < OpenSymbolHandler.SUPPORTED_OPEN_TYPES.indexOf(elementBType) ? -1 : 1;\n\t\t\t}\n\t\t}\n\n\t\treturn QuickOpenEntry.compare(elementA, elementB, searchValue);\n\t}\n\n\tpublic getGroupLabel(): string {\n\t\treturn nls.localize('symbols', \"symbol results\");\n\t}\n\n\tpublic getEmptyLabel(searchString: string): string {\n\t\tif (searchString.length > 0) {\n\t\t\treturn nls.localize('noSymbolsMatching', \"No symbols matching\");\n\t\t}\n\t\treturn nls.localize('noSymbolsWithoutInput', \"Type to search for symbols\");\n\t}\n\n\tpublic getAutoFocus(searchValue: string): IAutoFocus {\n\t\treturn {\n\t\t\tautoFocusFirstEntry: true,\n\t\t\tautoFocusPrefixMatch: searchValue.trim()\n\t\t};\n\t}\n}\n"]}