{"version":3,"sources":["vs/workbench/browser/parts/editor/iframeEditor.ts"],"names":[],"mappings":"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","file":"vs/workbench/browser/parts/editor/iframeEditor.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport 'vs/css!./media/iframeeditor';\nimport nls = require('vs/nls');\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport URI from 'vs/base/common/uri';\nimport DOM = require('vs/base/browser/dom');\nimport {Dimension, Builder, $} from 'vs/base/browser/builder';\nimport errors = require('vs/base/common/errors');\nimport {EditorOptions, EditorInput} from 'vs/workbench/common/editor';\nimport {BaseEditor} from 'vs/workbench/browser/parts/editor/baseEditor';\nimport {IFrameEditorInput} from 'vs/workbench/common/editor/iframeEditorInput';\nimport {IFrameEditorModel} from 'vs/workbench/common/editor/iframeEditorModel';\nimport {IStorageService} from 'vs/platform/storage/common/storage';\nimport {Position} from 'vs/platform/editor/common/editor';\nimport {ITelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {IWorkbenchEditorService} from 'vs/workbench/services/editor/common/editorService';\n\n/**\n * An implementation of editor for showing HTML content in an IFrame by leveraging the IFrameEditorInput.\n */\nexport class IFrameEditor extends BaseEditor {\n\n\tpublic static ID = 'workbench.editors.iFrameEditor';\n\n\tprivate static RESOURCE_PROPERTY = 'resource';\n\n\tprivate iframeContainer: Builder;\n\tprivate iframeBuilder: Builder;\n\tprivate focusTracker: DOM.IFocusTracker;\n\n\tconstructor(\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IWorkbenchEditorService private editorService: IWorkbenchEditorService,\n\t\t@IStorageService private storageService: IStorageService\n\t) {\n\t\tsuper(IFrameEditor.ID, telemetryService);\n\t}\n\n\tpublic getTitle(): string {\n\t\treturn this.getInput() ? this.getInput().getName() : nls.localize('iframeEditor', \"IFrame Viewer\");\n\t}\n\n\tpublic createEditor(parent: Builder): void {\n\n\t\t// Container for IFrame\n\t\tlet iframeContainerElement = document.createElement('div');\n\t\tiframeContainerElement.className = 'iframe-container';\n\t\tthis.iframeContainer = $(iframeContainerElement);\n\t\tthis.iframeContainer.tabindex(0); // enable focus support from the editor part (do not remove)\n\n\t\t// IFrame\n\t\tthis.iframeBuilder = $(this.iframeContainer).element('iframe').addClass('iframe');\n\t\tthis.iframeBuilder.attr({ 'frameborder': '0' });\n\t\tthis.iframeBuilder.removeProperty(IFrameEditor.RESOURCE_PROPERTY);\n\n\t\tparent.getHTMLElement().appendChild(iframeContainerElement);\n\t}\n\n\tpublic setInput(input: EditorInput, options: EditorOptions): TPromise<void> {\n\t\tlet oldInput = this.getInput();\n\t\tsuper.setInput(input, options);\n\n\t\t// Detect options\n\t\tlet forceOpen = options && options.forceOpen;\n\n\t\t// Same Input\n\t\tif (!forceOpen && input.matches(oldInput)) {\n\t\t\treturn TPromise.as<void>(null);\n\t\t}\n\n\t\t// Assert Input\n\t\tif (!(input instanceof IFrameEditorInput)) {\n\t\t\treturn TPromise.wrapError<void>('Invalid editor input. IFrame editor requires an input instance of IFrameEditorInput.');\n\t\t}\n\n\t\t// Different Input (Reload)\n\t\treturn this.doSetInput(input, true /* isNewInput */);\n\t}\n\n\tprivate doSetInput(input: EditorInput, isNewInput?: boolean): TPromise<void> {\n\t\treturn this.editorService.resolveEditorModel(input, true /* Reload */).then((resolvedModel) => {\n\n\t\t\t// Assert Model interface\n\t\t\tif (!(resolvedModel instanceof IFrameEditorModel)) {\n\t\t\t\treturn TPromise.wrapError<void>('Invalid editor input. IFrame editor requires a model instance of IFrameEditorModel.');\n\t\t\t}\n\n\t\t\t// Assert that the current input is still the one we expect. This prevents a race condition when loading takes long and another input was set meanwhile\n\t\t\tif (!this.getInput() || this.getInput() !== input) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Set IFrame contents\n\t\t\tlet iframeModel = <IFrameEditorModel>resolvedModel;\n\t\t\tlet isUpdate = !isNewInput && !!this.iframeBuilder.getProperty(IFrameEditor.RESOURCE_PROPERTY);\n\t\t\tlet contents = iframeModel.getContents();\n\n\t\t\t// Crazy hack to get keybindings to bubble out of the iframe to us\n\t\t\tcontents.body = contents.body + this.enableKeybindings();\n\n\t\t\t// Set Contents\n\t\t\ttry {\n\t\t\t\tthis.setFrameContents(iframeModel.resource, isUpdate ? contents.body : [contents.head, contents.body, contents.tail].join('\\n'), isUpdate /* body only */);\n\t\t\t} catch (error) {\n\t\t\t\tsetTimeout(() => this.reload(true /* clear */), 1000); // retry in case of an error which indicates the iframe (only) might be on a different URL\n\t\t\t}\n\n\t\t\t// When content is fully replaced, we also need to recreate the focus tracker\n\t\t\tif (!isUpdate) {\n\t\t\t\tthis.clearFocusTracker();\n\t\t\t}\n\n\t\t\t// Track focus on contents and make the editor active when focus is received\n\t\t\tif (!this.focusTracker) {\n\t\t\t\tthis.focusTracker = DOM.trackFocus((<HTMLIFrameElement>this.iframeBuilder.getHTMLElement()).contentWindow);\n\t\t\t\tthis.focusTracker.addFocusListener(() => {\n\t\t\t\t\tthis.editorService.activateEditor(this.position);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate setFrameContents(resource: URI, contents: string, isUpdate: boolean): void {\n\t\tlet iframeWindow = (<HTMLIFrameElement>this.iframeBuilder.getHTMLElement()).contentWindow;\n\n\t\t// Update body only if this is an update of the same resource (preserves scroll position and does not flicker)\n\t\tif (isUpdate) {\n\t\t\tiframeWindow.document.body.innerHTML = contents;\n\t\t}\n\n\t\t// Write directly to iframe document replacing any previous content\n\t\telse {\n\t\t\tiframeWindow.document.open('text/html', 'replace');\n\t\t\tiframeWindow.document.write(contents);\n\t\t\tiframeWindow.document.close();\n\n\t\t\t// Reset scroll\n\t\t\tiframeWindow.scrollTo(0, 0);\n\n\t\t\t// Associate resource with iframe\n\t\t\tthis.iframeBuilder.setProperty(IFrameEditor.RESOURCE_PROPERTY, resource.toString());\n\t\t}\n\t}\n\n\tprivate enableKeybindings(): string {\n\t\treturn [\n\t\t\t'<script>',\n\t\t\t'var ignoredKeys = [9 /* tab */, 32 /* space */, 33 /* page up */, 34 /* page down */, 38 /* up */, 40 /* down */];',\n\t\t\t'var ignoredCtrlCmdKeys = [65 /* a */, 67 /* c */];',\n\t\t\t'var ignoredShiftKeys = [9 /* tab */];',\n\t\t\t'window.document.body.addEventListener(\"keydown\", function(event) {',\t\t// Listen to keydown events in the iframe\n\t\t\t'\ttry {',\n\t\t\t'\t\tif (ignoredKeys.some(function(i) { return i === event.keyCode; })) {',\n\t\t\t'\t\t\tif (!event.ctrlKey && !event.altKey && !event.shiftKey && !event.metaKey) {',\n\t\t\t'\t\t\t\treturn;',\t\t\t\t\t\t\t\t\t\t\t\t\t// we want some single keys to be supported (e.g. Page Down for scrolling)\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t}',\n\t\t\t'',\n\t\t\t'\t\tif (ignoredCtrlCmdKeys.some(function(i) { return i === event.keyCode; })) {',\n\t\t\t'\t\t\tif (event.ctrlKey || event.metaKey) {',\n\t\t\t'\t\t\t\treturn;',\t\t\t\t\t\t\t\t\t\t\t\t\t// we want some ctrl/cmd keys to be supported (e.g. Ctrl+C for copy)\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t}',\n\t\t\t'',\n\t\t\t'\t\tif (ignoredShiftKeys.some(function(i) { return i === event.keyCode; })) {',\n\t\t\t'\t\t\tif (event.shiftKey) {',\n\t\t\t'\t\t\t\treturn;',\t\t\t\t\t\t\t\t\t\t\t\t\t// we want some shift keys to be supported (e.g. Shift+Tab for copy)\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t}',\n\t\t\t'',\n\t\t\t'\t\tevent.preventDefault();',\t\t\t\t\t\t\t\t\t\t\t// very important to not get duplicate actions when this one bubbles up!\n\t\t\t'',\n\t\t\t'\t\tvar fakeEvent = document.createEvent(\"KeyboardEvent\");',\t\t\t// create a keyboard event\n\t\t\t'\t\tObject.defineProperty(fakeEvent, \"keyCode\", {',\t\t\t\t\t\t// we need to set some properties that Chrome wants\n\t\t\t'\t\t\tget : function() {',\n\t\t\t'\t\t\t\treturn event.keyCode;',\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t});',\n\t\t\t'\t\tObject.defineProperty(fakeEvent, \"which\", {',\n\t\t\t'\t\t\tget : function() {',\n\t\t\t'\t\t\t\treturn event.keyCode;',\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t});',\n\t\t\t'\t\tObject.defineProperty(fakeEvent, \"target\", {',\n\t\t\t'\t\t\tget : function() {',\n\t\t\t'\t\t\t\treturn window && window.parent.document.body;',\n\t\t\t'\t\t\t}',\n\t\t\t'\t\t});',\n\t\t\t'',\n\t\t\t'\t\tfakeEvent.initKeyboardEvent(\"keydown\", true, true, document.defaultView, null, null, event.ctrlKey, event.altKey, event.shiftKey, event.metaKey);', // the API shape of this method is not clear to me, but it works ;)\n\t\t\t'',\n\t\t\t'\t\twindow.parent.document.dispatchEvent(fakeEvent);',\t\t\t\t\t// dispatch the event onto the parent\n\t\t\t'\t} catch (error) {}',\n\t\t\t'});',\n\n\t\t\t// disable dropping into iframe!\n\t\t\t'window.document.addEventListener(\"dragover\", function (e) {',\n\t\t\t'\te.preventDefault();',\n\t\t\t'});',\n\t\t\t'window.document.addEventListener(\"drop\", function (e) {',\n\t\t\t'\te.preventDefault();',\n\t\t\t'});',\n\t\t\t'window.document.body.addEventListener(\"dragover\", function (e) {',\n\t\t\t'\te.preventDefault();',\n\t\t\t'});',\n\t\t\t'window.document.body.addEventListener(\"drop\", function (e) {',\n\t\t\t'\te.preventDefault();',\n\t\t\t'});',\n\t\t\t'</script>'\n\t\t].join('\\n');\n\t}\n\n\tpublic clearInput(): void {\n\n\t\t// Reset IFrame\n\t\tthis.clearIFrame();\n\n\t\tsuper.clearInput();\n\t}\n\n\tprivate clearIFrame(): void {\n\t\tthis.iframeBuilder.src('about:blank');\n\t\tthis.iframeBuilder.removeProperty(IFrameEditor.RESOURCE_PROPERTY);\n\n\t\t// Focus Listener\n\t\tthis.clearFocusTracker();\n\t}\n\n\tprivate clearFocusTracker(): void {\n\t\tif (this.focusTracker) {\n\t\t\tthis.focusTracker.dispose();\n\t\t\tthis.focusTracker = null;\n\t\t}\n\t}\n\n\tpublic layout(dimension: Dimension): void {\n\n\t\t// Pass on to IFrame Container and IFrame\n\t\tthis.iframeContainer.size(dimension.width, dimension.height);\n\t\tthis.iframeBuilder.size(dimension.width, dimension.height);\n\t}\n\n\tpublic focus(): void {\n\t\tthis.iframeContainer.domFocus();\n\t}\n\n\tpublic changePosition(position: Position): void {\n\t\tsuper.changePosition(position);\n\n\t\t// reparenting an IFRAME into another DOM element yields weird results when the contents are made\n\t\t// of a string and not a URL. to be on the safe side we reload the iframe when the position changes\n\t\t// and we do it using a timeout of 0 to reload only after the position has been changed in the DOM\n\t\tsetTimeout(() => this.reload(true));\n\t}\n\n\tpublic supportsSplitEditor(): boolean {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Reloads the contents of the iframe in this editor by reapplying the input.\n\t */\n\tpublic reload(clearIFrame?: boolean): void {\n\t\tif (this.input) {\n\t\t\tif (clearIFrame) {\n\t\t\t\tthis.clearIFrame();\n\t\t\t}\n\n\t\t\tthis.doSetInput(this.input).done(null, errors.onUnexpectedError);\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\n\t\t// Destroy Container\n\t\tthis.iframeContainer.destroy();\n\n\t\t// Focus Listener\n\t\tthis.clearFocusTracker();\n\n\t\tsuper.dispose();\n\t}\n}"]}