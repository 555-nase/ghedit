{"version":3,"file":"cancellation.js","sourceRoot":"","sources":["../../../../src/vs/base/common/cancellation.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;IAEhG,YAAY,CAAC;IASb,IAAiB,iBAAiB,CAWjC;IAXD,WAAiB,iBAAiB,EAAC,CAAC;QAEtB,sBAAI,GAAsB,MAAM,CAAC,MAAM,CAAC;YACpD,uBAAuB,EAAE,KAAK;YAC9B,uBAAuB,EAAE,eAAK,CAAC,IAAI;SACnC,CAAC,CAAC;QAEU,2BAAS,GAAsB,MAAM,CAAC,MAAM,CAAC;YACzD,uBAAuB,EAAE,IAAI;YAC7B,uBAAuB,EAAE,eAAK,CAAC,IAAI;SACnC,CAAC,CAAC;IACJ,CAAC,EAXgB,iBAAiB,GAAjB,yBAAiB,KAAjB,yBAAiB,QAWjC;IAED,IAAM,aAAa,GAAe,MAAM,CAAC,MAAM,CAAC,UAAS,QAAQ,EAAE,OAAQ;QAC1E,IAAI,MAAM,GAAG,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QACnD,MAAM,CAAC,EAAE,OAAO,gBAAK,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAChD,CAAC,CAAC,CAAC;IAEH;QAAA;YAES,iBAAY,GAAY,KAAK,CAAC;QA0BvC,CAAC;QAvBO,6BAAM,GAAb;YACC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBACxB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACnB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;oBAC9B,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;gBAC3B,CAAC;YACF,CAAC;QACF,CAAC;QAED,sBAAI,iDAAuB;iBAA3B;gBACC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;YAC1B,CAAC;;;WAAA;QAED,sBAAI,iDAAuB;iBAA3B;gBACC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;oBACvB,MAAM,CAAC,aAAa,CAAC;gBACtB,CAAC;gBACD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACpB,IAAI,CAAC,QAAQ,GAAG,IAAI,eAAO,EAAO,CAAC;gBACpC,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;YAC5B,CAAC;;;WAAA;QACF,mBAAC;IAAD,CAAC,AA5BD,IA4BC;IAED;QAAA;QA2BA,CAAC;QAvBA,sBAAI,0CAAK;iBAAT;gBACC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;oBAClB,yCAAyC;oBACzC,kBAAkB;oBAClB,IAAI,CAAC,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;gBAClC,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpB,CAAC;;;WAAA;QAED,wCAAM,GAAN;YACC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBAClB,0CAA0C;gBAC1C,4CAA4C;gBAC5C,oCAAoC;gBACpC,IAAI,CAAC,MAAM,GAAG,iBAAiB,CAAC,SAAS,CAAC;YAC3C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACQ,IAAI,CAAC,MAAO,CAAC,MAAM,EAAE,CAAC;YACtC,CAAC;QACF,CAAC;QAED,yCAAO,GAAP;YACC,IAAI,CAAC,MAAM,EAAE,CAAC;QACf,CAAC;QACF,8BAAC;IAAD,CAAC,AA3BD,IA2BC;IA3BY,+BAAuB,0BA2BnC,CAAA","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport Event, {Emitter} from 'vs/base/common/event';\n\nexport interface CancellationToken {\n\tisCancellationRequested: boolean;\n\tonCancellationRequested: Event<any>;\n}\n\nexport namespace CancellationToken {\n\n\texport const None: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: false,\n\t\tonCancellationRequested: Event.None\n\t});\n\n\texport const Cancelled: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: true,\n\t\tonCancellationRequested: Event.None\n\t});\n}\n\nconst shortcutEvent: Event<any> = Object.freeze(function(callback, context?) {\n\tlet handle = setTimeout(callback.bind(context), 0);\n\treturn { dispose() { clearTimeout(handle); } };\n});\n\nclass MutableToken implements CancellationToken {\n\n\tprivate _isCancelled: boolean = false;\n\tprivate _emitter: Emitter<any>;\n\n\tpublic cancel() {\n\t\tif (!this._isCancelled) {\n\t\t\tthis._isCancelled = true;\n\t\t\tif (this._emitter) {\n\t\t\t\tthis._emitter.fire(undefined);\n\t\t\t\tthis._emitter = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCancellationRequested(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tget onCancellationRequested(): Event<any> {\n\t\tif (this._isCancelled) {\n\t\t\treturn shortcutEvent;\n\t\t}\n\t\tif (!this._emitter) {\n\t\t\tthis._emitter = new Emitter<any>();\n\t\t}\n\t\treturn this._emitter.event;\n\t}\n}\n\nexport class CancellationTokenSource {\n\n\tprivate _token: CancellationToken;\n\n\tget token(): CancellationToken {\n\t\tif (!this._token) {\n\t\t\t// be lazy and create the token only when\n\t\t\t// actually needed\n\t\t\tthis._token = new MutableToken();\n\t\t}\n\t\treturn this._token;\n\t}\n\n\tcancel(): void {\n\t\tif (!this._token) {\n\t\t\t// save an object by returning the default\n\t\t\t// cancelled token when cancellation happens\n\t\t\t// before someone asks for the token\n\t\t\tthis._token = CancellationToken.Cancelled;\n\t\t} else {\n\t\t\t(<MutableToken>this._token).cancel();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t}\n}\n"]}