{"version":3,"file":"vs/base/browser/globalMouseMoveMonitor.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/base/browser/globalMouseMoveMonitor.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {Disposable, IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport * as dom from 'vs/base/browser/dom';\nimport {IframeUtils} from 'vs/base/browser/iframe';\nimport {StandardMouseEvent} from 'vs/base/browser/mouseEvent';\n\nexport interface IStandardMouseMoveEventData {\n\tleftButton:boolean;\n\tposx:number;\n\tposy:number;\n}\n\nexport interface IEventMerger<R> {\n\t(lastEvent:R, currentEvent:MouseEvent):R;\n}\n\nexport interface IMouseMoveCallback<R> {\n\t(mouseMoveData:R):void;\n}\n\nexport interface IOnStopCallback {\n\t():void;\n}\n\nexport function standardMouseMoveMerger(lastEvent:IStandardMouseMoveEventData, currentEvent:MouseEvent):IStandardMouseMoveEventData {\n\tlet ev = new StandardMouseEvent(currentEvent);\n\tev.preventDefault();\n\treturn {\n\t\tleftButton: ev.leftButton,\n\t\tposx: ev.posx,\n\t\tposy: ev.posy\n\t};\n}\n\nexport class GlobalMouseMoveMonitor<R> extends Disposable {\n\n\tprivate hooks:IDisposable[];\n\tprivate mouseMoveEventMerger:IEventMerger<R>;\n\tprivate mouseMoveCallback:IMouseMoveCallback<R>;\n\tprivate onStopCallback:IOnStopCallback;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.hooks = [];\n\t\tthis.mouseMoveEventMerger = null;\n\t\tthis.mouseMoveCallback = null;\n\t\tthis.onStopCallback = null;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.stopMonitoring(false);\n\t\tsuper.dispose();\n\t}\n\n\tpublic stopMonitoring(invokeStopCallback:boolean): void {\n\t\tif (!this.isMonitoring()) {\n\t\t\t// Not monitoring\n\t\t\treturn;\n\t\t}\n\n\t\t// Unhook\n\t\tthis.hooks = dispose(this.hooks);\n\t\tthis.mouseMoveEventMerger = null;\n\t\tthis.mouseMoveCallback = null;\n\t\tlet onStopCallback = this.onStopCallback;\n\t\tthis.onStopCallback = null;\n\n\t\tif (invokeStopCallback) {\n\t\t\tonStopCallback();\n\t\t}\n\t}\n\n\tpublic isMonitoring() {\n\t\treturn this.hooks.length > 0;\n\t}\n\n\tpublic startMonitoring(\n\t\t\t\tmouseMoveEventMerger:IEventMerger<R>,\n\t\t\t\tmouseMoveCallback:IMouseMoveCallback<R>,\n\t\t\t\tonStopCallback:IOnStopCallback\n\t\t\t): void {\n\t\tif (this.isMonitoring()) {\n\t\t\t// I am already hooked\n\t\t\treturn;\n\t\t}\n\t\tthis.mouseMoveEventMerger = mouseMoveEventMerger;\n\t\tthis.mouseMoveCallback = mouseMoveCallback;\n\t\tthis.onStopCallback = onStopCallback;\n\n\t\tlet windowChain = IframeUtils.getSameOriginWindowChain();\n\t\tfor (let i = 0; i < windowChain.length; i++) {\n\t\t\tthis.hooks.push(dom.addDisposableThrottledListener(windowChain[i].window.document, 'mousemove',\n\t\t\t\t(data:R) => this.mouseMoveCallback(data),\n\t\t\t\t(lastEvent:R, currentEvent:MouseEvent) => this.mouseMoveEventMerger(lastEvent, currentEvent)\n\t\t\t));\n\t\t\tthis.hooks.push(dom.addDisposableListener(windowChain[i].window.document, 'mouseup', (e:MouseEvent) => this.stopMonitoring(true)));\n\t\t}\n\n\t\tif (IframeUtils.hasDifferentOriginAncestor()) {\n\t\t\tlet lastSameOriginAncestor = windowChain[windowChain.length - 1];\n\t\t\t// We might miss a mouse up if it happens outside the iframe\n\t\t\t// This one is for Chrome\n\t\t\tthis.hooks.push(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseout', (browserEvent:MouseEvent) => {\n\t\t\t\tlet e = new StandardMouseEvent(browserEvent);\n\t\t\t\tif (e.target.tagName.toLowerCase() === 'html') {\n\t\t\t\t\tthis.stopMonitoring(true);\n\t\t\t\t}\n\t\t\t}));\n\t\t\t// This one is for FF\n\t\t\tthis.hooks.push(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseover', (browserEvent:MouseEvent) => {\n\t\t\t\tlet e = new StandardMouseEvent(browserEvent);\n\t\t\t\tif (e.target.tagName.toLowerCase() === 'html') {\n\t\t\t\t\tthis.stopMonitoring(true);\n\t\t\t\t}\n\t\t\t}));\n\t\t\t// This one is for IE\n\t\t\tthis.hooks.push(dom.addDisposableListener(lastSameOriginAncestor.window.document.body, 'mouseleave', (browserEvent:MouseEvent) => {\n\t\t\t\tthis.stopMonitoring(true);\n\t\t\t}));\n\t\t}\n\t}\n}\n"]}