{"version":3,"file":"vs/base/parts/tree/browser/treeModel.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/base/parts/tree/browser/treeModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Assert = require('vs/base/common/assert');\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { IDisposable, combinedDisposable } from 'vs/base/common/lifecycle';\nimport arrays = require('vs/base/common/arrays');\nimport { INavigator } from 'vs/base/common/iterator';\nimport Events = require('vs/base/common/eventEmitter');\nimport WinJS = require('vs/base/common/winjs.base');\nimport _ = require('./tree');\n\ninterface IMap<T> { [id: string]: T; }\ninterface IItemMap extends IMap<Item> {}\ninterface ITraitMap extends IMap<IItemMap> {}\n\nexport class LockData extends Events.EventEmitter {\n\n\tprivate _item: Item;\n\n\tconstructor(item: Item) {\n\t\tsuper();\n\n\t\tthis._item = item;\n\t}\n\n\tpublic get item(): Item {\n\t\treturn this._item;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.emit('unlock');\n\t\tsuper.dispose();\n\t}\n}\n\nexport class Lock {\n\n\t/* When refreshing tree items, the tree's structured can be altered, by\n\t\tinserting and removing sub-items. This lock helps to manage several\n\t\tpossibly-structure-changing calls.\n\n\t\tAPI-wise, there are two possibly-structure-changing: refresh(...),\n\t\texpand(...) and collapse(...). All these calls must call Lock#run(...).\n\n\t\tAny call to Lock#run(...) needs to provide the affecting item and a\n\t\tcallback to execute when unlocked. It must also return a promise\n\t\twhich fulfills once the operation ends. Once it is called, there\n\t\tare three possibilities:\n\n\t\t- Nothing is currently running. The affecting item is remembered, and\n\t\tthe callback is executed.\n\n\t\t- Or, there are on-going operations. There are two outcomes:\n\n\t\t\t- The affecting item intersects with any other affecting items\n\t\t\tof on-going run calls. In such a case, the given callback should\n\t\t\tbe executed only when the on-going one completes.\n\n\t\t\t- Or, it doesn't. In such a case, both operations can be run in\n\t\t\tparallel.\n\n\t\tNote: two items A and B intersect if A is a descendant of B, or\n\t\tvice-versa.\n\t*/\n\n\tprivate locks: { [id: string]: LockData; };\n\n\tconstructor() {\n\t\tthis.locks = Object.create({});\n\t}\n\n\tpublic isLocked(item: Item): boolean {\n\t\treturn !!this.locks[item.id];\n\t}\n\n\tpublic run(item: Item, fn: () => WinJS.Promise): WinJS.Promise {\n\t\tvar lock = this.getLock(item);\n\n\t\tif (lock) {\n\t\t\tvar unbindListener: Events.ListenerUnbind;\n\n\t\t\treturn new WinJS.Promise((c, e) => {\n\t\t\t\tunbindListener = lock.addOneTimeListener('unlock', () => {\n\t\t\t\t\treturn this.run(item, fn).then(c, e);\n\t\t\t\t});\n\t\t\t}, () => unbindListener());\n\t\t}\n\n\t\tvar result: WinJS.Promise;\n\n\t\treturn new WinJS.Promise((c, e) => {\n\n\t\t\tif (item.isDisposed()) {\n\t\t\t\treturn e(new Error('Item is disposed.'));\n\t\t\t}\n\n\t\t\tvar lock = this.locks[item.id] = new LockData(item);\n\n\t\t\tresult = fn().then((r) => {\n\t\t\t\tdelete this.locks[item.id];\n\t\t\t\tlock.dispose();\n\n\t\t\t\treturn r;\n\t\t\t}).then(c, e);\n\n\t\t\treturn result;\n\t\t}, () => result.cancel());\n\t}\n\n\tprivate getLock(item: Item): LockData {\n\t\tvar key: string;\n\n\t\tfor (key in this.locks) {\n\t\t\tvar lock = this.locks[key];\n\n\t\t\tif (item.intersects(lock.item)) {\n\t\t\t\treturn lock;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nexport class ItemRegistry extends Events.EventEmitter {\n\n\tprivate items: IMap<{ item: Item; disposable: IDisposable; }>;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = {};\n\t}\n\n\tpublic register(item: Item): void {\n\t\tAssert.ok(!this.isRegistered(item.id), 'item already registered: ' + item.id);\n\t\tthis.items[item.id] = { item, disposable: this.addEmitter2(item) };\n\t}\n\n\tpublic deregister(item: Item): void {\n\t\tAssert.ok(this.isRegistered(item.id), 'item not registered: ' + item.id);\n\t\tthis.items[item.id].disposable.dispose();\n\t\tdelete this.items[item.id];\n\t}\n\n\tpublic isRegistered(id: string): boolean {\n\t\treturn this.items.hasOwnProperty(id);\n\t}\n\n\tpublic getItem(id: string): Item {\n\t\tconst result = this.items[id];\n\t\treturn result ? result.item : null;\n\t}\n\n\tpublic dispose(): void {\n\t\tsuper.dispose();\n\t\tthis.items = null;\n\t}\n}\n\nexport interface IBaseItemEvent {\n\titem: Item;\n}\n\nexport interface IItemRefreshEvent extends IBaseItemEvent { }\nexport interface IItemExpandEvent extends IBaseItemEvent { }\nexport interface IItemCollapseEvent extends IBaseItemEvent { }\nexport interface IItemDisposeEvent extends IBaseItemEvent { }\n\nexport interface IItemTraitEvent extends IBaseItemEvent {\n\ttrait: string;\n}\n\nexport interface IItemRevealEvent extends IBaseItemEvent {\n\trelativeTop: number;\n}\n\nexport interface IItemChildrenRefreshEvent extends IBaseItemEvent {\n\tisNested: boolean;\n}\n\nexport class Item extends Events.EventEmitter {\n\n\tprivate registry: ItemRegistry;\n\tprivate context: _.ITreeContext;\n\tprivate element: any;\n\tprivate lock: Lock;\n\n\tpublic id: string;\n\n\tprivate needsChildrenRefresh: boolean;\n\tprivate doesHaveChildren: boolean;\n\n\tpublic parent: Item;\n\tpublic previous: Item;\n\tpublic next: Item;\n\tpublic firstChild: Item;\n\tpublic lastChild: Item;\n\n\tprivate userContent: HTMLElement;\n\n\tprivate height: number;\n\tprivate depth: number;\n\n\tprivate visible: boolean;\n\tprivate expanded: boolean;\n\n\tprivate traits: { [trait: string]: boolean; };\n\n\tprivate _isDisposed: boolean;\n\n\tconstructor(id: string, registry: ItemRegistry, context: _.ITreeContext, lock: Lock, element: any) {\n\t\tsuper();\n\n\t\tthis.registry = registry;\n\t\tthis.context = context;\n\t\tthis.lock = lock;\n\t\tthis.element = element;\n\n\t\tthis.id = id;\n\t\tthis.registry.register(this);\n\n\t\tthis.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\n\t\tthis.needsChildrenRefresh = true;\n\n\t\tthis.parent = null;\n\t\tthis.previous = null;\n\t\tthis.next = null;\n\t\tthis.firstChild = null;\n\t\tthis.lastChild = null;\n\n\t\tthis.userContent = null;\n\t\tthis.traits = {};\n\t\tthis.depth = 0;\n\t\tthis.expanded = false;\n\n\t\tthis.emit('item:create', { item: this });\n\n\t\tthis.visible = this._isVisible();\n\t\tthis.height = this._getHeight();\n\n\t\tthis._isDisposed = false;\n\t}\n\n\tpublic getElement(): any {\n\t\treturn this.element;\n\t}\n\n\tpublic hasChildren(): boolean {\n\t\treturn this.doesHaveChildren;\n\t}\n\n\tpublic getDepth(): number {\n\t\treturn this.depth;\n\t}\n\n\tpublic isVisible(): boolean {\n\t\treturn this.visible;\n\t}\n\n\tpublic setVisible(value: boolean): void {\n\t\tthis.visible = value;\n\t}\n\n\tpublic isExpanded(): boolean {\n\t\treturn this.expanded;\n\t}\n\n\t/* protected */ public _setExpanded(value: boolean): void {\n\t\tthis.expanded = value;\n\t}\n\n\tpublic reveal(relativeTop: number = null): void {\n\t\tvar eventData: IItemRevealEvent = { item: this, relativeTop: relativeTop };\n\t\tthis.emit('item:reveal', eventData);\n\t}\n\n\tpublic expand(): WinJS.Promise {\n\t\tif (this.isExpanded() || !this.doesHaveChildren || this.lock.isLocked(this)) {\n\t\t\treturn WinJS.TPromise.as(false);\n\t\t}\n\n\t\tvar result = this.lock.run(this, () => {\n\t\t\tvar eventData: IItemExpandEvent = { item: this };\n\t\t\tvar result: WinJS.Promise;\n\t\t\tthis.emit('item:expanding', eventData);\n\n\t\t\tif (this.needsChildrenRefresh) {\n\t\t\t\tresult = this.refreshChildren(false, true, true);\n\t\t\t} else {\n\t\t\t\tresult = WinJS.TPromise.as(null);\n\t\t\t}\n\n\t\t\treturn result.then(() => {\n\t\t\t\tthis._setExpanded(true);\n\t\t\t\tthis.emit('item:expanded', eventData);\n\t\t\t\treturn true;\n\t\t\t});\n\t\t});\n\n\t\treturn result.then((r) => {\n\t\t\tif (this.isDisposed()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Auto expand single child folders\n\t\t\tif (this.context.options.autoExpandSingleChildren && r && this.firstChild !== null && this.firstChild === this.lastChild && this.firstChild.isVisible()) {\n\t\t\t\treturn this.firstChild.expand().then(() => { return true; });\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\tpublic collapse(recursive: boolean = false): WinJS.Promise {\n\t\tif (recursive) {\n\t\t\tvar collapseChildrenPromise = WinJS.TPromise.as(null);\n\t\t\tthis.forEachChild((child) => {\n\t\t\t\tcollapseChildrenPromise = collapseChildrenPromise.then(() => child.collapse(true));\n\t\t\t});\n\t\t\treturn collapseChildrenPromise.then(() => {\n\t\t\t\treturn this.collapse(false);\n\t\t\t});\n\t\t} else {\n\t\t\tif (!this.isExpanded() || this.lock.isLocked(this)) {\n\t\t\t\treturn WinJS.TPromise.as(false);\n\t\t\t}\n\n\t\t\treturn this.lock.run(this, () => {\n\t\t\t\tvar eventData: IItemCollapseEvent = { item: this };\n\t\t\t\tthis.emit('item:collapsing', eventData);\n\t\t\t\tthis._setExpanded(false);\n\t\t\t\tthis.emit('item:collapsed', eventData);\n\n\t\t\t\treturn WinJS.TPromise.as(true);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic addTrait(trait: string): void {\n\t\tvar eventData: IItemTraitEvent = { item: this, trait: trait };\n\t\tthis.traits[trait] = true;\n\t\tthis.emit('item:addTrait', eventData);\n\t}\n\n\tpublic removeTrait(trait: string): void {\n\t\tvar eventData: IItemTraitEvent = { item: this, trait: trait };\n\t\tdelete this.traits[trait];\n\t\tthis.emit('item:removeTrait', eventData);\n\t}\n\n\tpublic hasTrait(trait: string): boolean {\n\t\treturn this.traits[trait] || false;\n\t}\n\n\tpublic getAllTraits(): string[] {\n\t\tvar result: string[] = [];\n\t\tvar trait: string;\n\t\tfor (trait in this.traits) {\n\t\t\tif (this.traits.hasOwnProperty(trait) && this.traits[trait]) {\n\t\t\t\tresult.push(trait);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic getHeight(): number {\n\t\treturn this.height;\n\t}\n\n\tprivate refreshChildren(recursive: boolean, safe: boolean = false, force: boolean = false): WinJS.Promise {\n\t\tif (!force && !this.isExpanded()) {\n\t\t\tthis.needsChildrenRefresh = true;\n\t\t\treturn WinJS.TPromise.as(this);\n\t\t}\n\n\t\tthis.needsChildrenRefresh = false;\n\n\t\tvar doRefresh = () => {\n\t\t\tvar eventData: IItemChildrenRefreshEvent = { item: this, isNested: safe };\n\t\t\tthis.emit('item:childrenRefreshing', eventData);\n\n\t\t\tvar childrenPromise: WinJS.Promise;\n\t\t\tif (this.doesHaveChildren) {\n\t\t\t\tchildrenPromise = this.context.dataSource.getChildren(this.context.tree, this.element);\n\t\t\t} else {\n\t\t\t\tchildrenPromise = WinJS.TPromise.as([]);\n\t\t\t}\n\n\t\t\tconst result = childrenPromise.then((elements: any[]) => {\n\t\t\t\telements = !elements ? [] : elements.slice(0);\n\t\t\t\telements = this.sort(elements);\n\n\t\t\t\tvar staleItems: IItemMap = {};\n\t\t\t\twhile (this.firstChild !== null) {\n\t\t\t\t\tstaleItems[this.firstChild.id] = this.firstChild;\n\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\t\t\tvar element = elements[i];\n\t\t\t\t\tvar id = this.context.dataSource.getId(this.context.tree, element);\n\t\t\t\t\tvar item = staleItems[id] || new Item(id, this.registry, this.context, this.lock, element);\n\t\t\t\t\titem.element = element;\n\t\t\t\t\tif (recursive) {\n\t\t\t\t\t\titem.needsChildrenRefresh = recursive;\n\t\t\t\t\t}\n\t\t\t\t\tdelete staleItems[id];\n\t\t\t\t\tthis.addChild(item);\n\t\t\t\t}\n\n\t\t\t\tfor (var staleItemId in staleItems) {\n\t\t\t\t\tif (staleItems.hasOwnProperty(staleItemId)) {\n\t\t\t\t\t\tstaleItems[staleItemId].dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (recursive) {\n\t\t\t\t\treturn WinJS.Promise.join(this.mapEachChild((child) => {\n\t\t\t\t\t\treturn child.doRefresh(recursive, true);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\treturn WinJS.TPromise.as(null);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result\n\t\t\t\t.then(null, onUnexpectedError)\n\t\t\t\t.then(() => this.emit('item:childrenRefreshed', eventData));\n\t\t};\n\n\t\treturn safe ? doRefresh() : this.lock.run(this, doRefresh);\n\t}\n\n\tprivate doRefresh(recursive: boolean, safe: boolean = false): WinJS.Promise {\n\t\tvar eventData: IItemRefreshEvent = { item: this };\n\n\t\tthis.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\n\t\tthis.height = this._getHeight();\n\t\tthis.setVisible(this._isVisible());\n\n\t\tthis.emit('item:refresh', eventData);\n\n\t\treturn this.refreshChildren(recursive, safe);\n\t}\n\n\tpublic refresh(recursive: boolean): WinJS.Promise {\n\t\treturn this.doRefresh(recursive);\n\t}\n\n\tpublic getNavigator(): INavigator<Item> {\n\t\treturn new TreeNavigator(this);\n\t}\n\n\tpublic intersects(other: Item): boolean {\n\t\treturn this.isAncestorOf(other) || other.isAncestorOf(this);\n\t}\n\n\tpublic getHierarchy(): Item[] {\n\t\tvar result: Item[] = [];\n\t\tvar node: Item = this;\n\n\t\tdo {\n\t\t\tresult.push(node);\n\t\t\tnode = node.parent;\n\t\t} while (node);\n\n\t\tresult.reverse();\n\t\treturn result;\n\t}\n\n\tprivate isAncestorOf(item: Item): boolean {\n\t\twhile (item) {\n\t\t\tif (item.id === this.id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\titem = item.parent;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate addChild(item: Item, afterItem: Item = this.lastChild): void {\n\t\tvar isEmpty = this.firstChild === null;\n\t\tvar atHead = afterItem === null;\n\t\tvar atTail = afterItem === this.lastChild;\n\n\t\tif (isEmpty) {\n\t\t\tthis.firstChild = this.lastChild = item;\n\t\t\titem.next = item.previous = null;\n\t\t} else if (atHead) {\n\t\t\tthis.firstChild.previous = item;\n\t\t\titem.next = this.firstChild;\n\t\t\titem.previous = null;\n\t\t\tthis.firstChild = item;\n\t\t} else if (atTail) {\n\t\t\tthis.lastChild.next = item;\n\t\t\titem.next = null;\n\t\t\titem.previous = this.lastChild;\n\t\t\tthis.lastChild = item;\n\t\t} else {\n\t\t\titem.previous = afterItem;\n\t\t\titem.next = afterItem.next;\n\t\t\tafterItem.next.previous = item;\n\t\t\tafterItem.next = item;\n\t\t}\n\n\t\titem.parent = this;\n\t\titem.depth = this.depth + 1;\n\t}\n\n\tprivate removeChild(item: Item): void {\n\t\tvar isFirstChild = this.firstChild === item;\n\t\tvar isLastChild = this.lastChild === item;\n\n\t\tif (isFirstChild && isLastChild) {\n\t\t\tthis.firstChild = this.lastChild = null;\n\t\t} else if (isFirstChild) {\n\t\t\titem.next.previous = null;\n\t\t\tthis.firstChild = item.next;\n\t\t} else if (isLastChild) {\n\t\t\titem.previous.next = null;\n\t\t\tthis.lastChild = item.previous;\n\t\t} else {\n\t\t\titem.next.previous = item.previous;\n\t\t\titem.previous.next = item.next;\n\t\t}\n\n\t\titem.parent = null;\n\t\titem.depth = null;\n\t}\n\n\tprivate forEachChild(fn: (child: Item) => void): void {\n\t\tvar child = this.firstChild, next: Item;\n\t\twhile (child) {\n\t\t\tnext = child.next;\n\t\t\tfn(child);\n\t\t\tchild = next;\n\t\t}\n\t}\n\n\tprivate mapEachChild<T>(fn: (child: Item) => T): T[] {\n\t\tvar result = [];\n\t\tthis.forEachChild((child) => {\n\t\t\tresult.push(fn(child));\n\t\t});\n\t\treturn result;\n\t}\n\n\tprivate sort(elements: any[]): any[] {\n\t\tif (this.context.sorter) {\n\t\t\treturn elements.sort((element, otherElement) => {\n\t\t\t\treturn this.context.sorter.compare(this.context.tree, element, otherElement);\n\t\t\t});\n\t\t}\n\n\t\treturn elements;\n\t}\n\n\t/* protected */ public _getHeight(): number {\n\t\treturn this.context.renderer.getHeight(this.context.tree, this.element);\n\t}\n\n\t/* protected */ public _isVisible(): boolean {\n\t\treturn this.context.filter.isVisible(this.context.tree, this.element);\n\t}\n\n\tpublic isDisposed(): boolean {\n\t\treturn this._isDisposed;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.forEachChild((child) => child.dispose());\n\n\t\tthis.parent = null;\n\t\tthis.previous = null;\n\t\tthis.next = null;\n\t\tthis.firstChild = null;\n\t\tthis.lastChild = null;\n\n\t\tvar eventData: IItemDisposeEvent = { item: this };\n\t\tthis.emit('item:dispose', eventData);\n\n\t\tthis.registry.deregister(this);\n\t\tsuper.dispose();\n\n\t\tthis._isDisposed = true;\n\t}\n}\n\nclass RootItem extends Item {\n\n\tconstructor(id: string, registry: ItemRegistry, context: _.ITreeContext, lock: Lock, element: any) {\n\t\tsuper(id, registry, context, lock, element);\n\t}\n\n\tpublic isVisible(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic setVisible(value: boolean): void {\n\t\t// no-op\n\t}\n\n\tpublic isExpanded(): boolean {\n\t\treturn true;\n\t}\n\n\t/* protected */ public _setExpanded(value: boolean): void {\n\t\t// no-op\n\t}\n\n\tpublic render(): void {\n\t\t// no-op\n\t}\n\n\t/* protected */ public _getHeight(): number {\n\t\treturn 0;\n\t}\n\n\t/* protected */ public _isVisible(): boolean {\n\t\treturn false;\n\t}\n}\n\nexport class TreeNavigator implements INavigator<Item> {\n\n\tprivate start: Item;\n\tprivate item: Item;\n\n\tstatic lastDescendantOf(item: Item): Item {\n\t\tif (!item) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\tif (!item.isVisible() || !item.isExpanded() || item.lastChild === null) {\n\t\t\t\treturn item;\n\t\t\t} else {\n\t\t\t\treturn TreeNavigator.lastDescendantOf(item.lastChild);\n\t\t\t}\n\t\t}\n\t}\n\n\tconstructor(item: Item, subTreeOnly: boolean = true) {\n\t\tthis.item = item;\n\t\tthis.start = subTreeOnly ? item : null;\n\t}\n\n\tpublic current(): Item {\n\t\treturn this.item || null;\n\t}\n\n\tpublic next(): Item {\n\t\tif (this.item) {\n\t\t\tdo {\n\t\t\t\tif ((this.item instanceof RootItem || (this.item.isVisible() && this.item.isExpanded())) && this.item.firstChild) {\n\t\t\t\t\tthis.item = this.item.firstChild;\n\t\t\t\t} else if (this.item === this.start) {\n\t\t\t\t\tthis.item = null;\n\t\t\t\t} else {\n\t\t\t\t\t// select next brother, next uncle, next great-uncle, etc...\n\t\t\t\t\twhile (this.item && this.item !== this.start && !this.item.next) {\n\t\t\t\t\t\tthis.item = this.item.parent;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.item === this.start) {\n\t\t\t\t\t\tthis.item = null;\n\t\t\t\t\t}\n\t\t\t\t\tthis.item = !this.item ? null : this.item.next;\n\t\t\t\t}\n\t\t\t} while (this.item && !this.item.isVisible());\n\t\t}\n\t\treturn this.item || null;\n\t}\n\n\tpublic previous(): Item {\n\t\tif (this.item) {\n\t\t\tdo {\n\t\t\t\tvar previous = TreeNavigator.lastDescendantOf(this.item.previous);\n\t\t\t\tif (previous) {\n\t\t\t\t\tthis.item = previous;\n\t\t\t\t} else if (this.item.parent && this.item.parent !== this.start && this.item.parent.isVisible()) {\n\t\t\t\t\tthis.item = this.item.parent;\n\t\t\t\t} else {\n\t\t\t\t\tthis.item = null;\n\t\t\t\t}\n\t\t\t} while (this.item && !this.item.isVisible());\n\t\t}\n\t\treturn this.item || null;\n\t}\n\n\tpublic parent(): Item {\n\t\tif (this.item) {\n\t\t\tvar parent = this.item.parent;\n\t\t\tif (parent && parent !== this.start && parent.isVisible()) {\n\t\t\t\tthis.item = parent;\n\t\t\t} else {\n\t\t\t\tthis.item = null;\n\t\t\t}\n\t\t}\n\t\treturn this.item || null;\n\t}\n\n\tpublic first(): Item {\n\t\tthis.item = this.start;\n\t\tthis.next();\n\t\treturn this.item || null;\n\t}\n\n\tpublic last(): Item {\n\t\tif (this.start && this.start.isExpanded()) {\n\t\t\tthis.item = this.start.lastChild;\n\n\t\t\tif (this.item && !this.item.isVisible()) {\n\t\t\t\tthis.previous();\n\t\t\t}\n\t\t}\n\n\t\treturn this.item || null;\n\t}\n}\n\nfunction getRange(one: Item, other: Item): Item[] {\n\tvar oneHierarchy = one.getHierarchy();\n\tvar otherHierarchy = other.getHierarchy();\n\tvar length = arrays.commonPrefixLength(oneHierarchy, otherHierarchy);\n\tvar item = oneHierarchy[length - 1];\n\tvar nav = item.getNavigator();\n\n\tvar oneIndex: number = null;\n\tvar otherIndex: number = null;\n\n\tvar index = 0;\n\tvar result: Item[] = [];\n\n\twhile (item && (oneIndex === null || otherIndex === null)) {\n\t\tresult.push(item);\n\n\t\tif (item === one) {\n\t\t\toneIndex = index;\n\t\t}\n\t\tif (item === other) {\n\t\t\totherIndex = index;\n\t\t}\n\n\t\tindex++;\n\t\titem = nav.next();\n\t}\n\n\tif (oneIndex === null || otherIndex === null) {\n\t\treturn [];\n\t}\n\n\tvar min = Math.min(oneIndex, otherIndex);\n\tvar max = Math.max(oneIndex, otherIndex);\n\treturn result.slice(min, max + 1);\n}\n\nexport interface IBaseEvent {\n\titem: Item;\n}\n\nexport interface IInputEvent extends IBaseEvent { }\n\nexport interface IRefreshEvent extends IBaseEvent {\n\trecursive: boolean;\n}\n\nexport class TreeModel extends Events.EventEmitter {\n\n\tprivate context: _.ITreeContext;\n\tprivate lock: Lock;\n\tprivate input: Item;\n\tprivate registry: ItemRegistry;\n\tprivate registryDisposable: IDisposable;\n\tprivate traitsToItems: ITraitMap;\n\n\tconstructor(context: _.ITreeContext) {\n\t\tsuper();\n\n\t\tthis.context = context;\n\t\tthis.input = null;\n\t\tthis.traitsToItems = {};\n\t}\n\n\tpublic setInput(element: any): WinJS.Promise {\n\t\tvar eventData: IInputEvent = { item: this.input };\n\t\tthis.emit('clearingInput', eventData);\n\n\t\tthis.setSelection([]);\n\t\tthis.setFocus();\n\t\tthis.setHighlight();\n\n\t\tthis.lock = new Lock();\n\n\t\tif (this.input) {\n\t\t\tthis.input.dispose();\n\t\t}\n\n\t\tif (this.registry) {\n\t\t\tthis.registry.dispose();\n\t\t\tthis.registryDisposable.dispose();\n\t\t}\n\n\t\tthis.registry = new ItemRegistry();\n\n\t\tthis.registryDisposable = combinedDisposable([\n\t\t\tthis.addEmitter2(this.registry),\n\t\t\tthis.registry.addListener2('item:dispose', (event: IItemDisposeEvent) => {\n\t\t\t\tevent.item.getAllTraits()\n\t\t\t\t\t.forEach(trait => delete this.traitsToItems[trait][event.item.id]);\n\t\t\t})\n\t\t]);\n\n\t\tvar id = this.context.dataSource.getId(this.context.tree, element);\n\t\tthis.input = new RootItem(id, this.registry, this.context, this.lock, element);\n\t\teventData = { item: this.input };\n\t\tthis.emit('setInput', eventData);\n\t\treturn this.refresh(this.input);\n\t}\n\n\tpublic getInput(): any {\n\t\treturn this.input ? this.input.getElement() : null;\n\t}\n\n\tpublic refresh(element: any = null, recursive: boolean = true): WinJS.Promise {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn WinJS.TPromise.as(null);\n\t\t}\n\n\t\tvar eventData: IRefreshEvent = { item: item, recursive: recursive };\n\t\tthis.emit('refreshing', eventData);\n\t\treturn item.refresh(recursive).then(() => {\n\t\t\tthis.emit('refreshed', eventData);\n\t\t});\n\t}\n\n\tpublic refreshAll(elements: any[], recursive: boolean = true): WinJS.Promise {\n\t\tvar promises = [];\n\t\tthis.deferredEmit(() => {\n\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\t\tpromises.push(this.refresh(elements[i], recursive));\n\t\t\t}\n\t\t});\n\t\treturn WinJS.Promise.join(promises);\n\t}\n\n\tpublic expand(element: any): WinJS.Promise {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn WinJS.TPromise.as(false);\n\t\t}\n\n\t\treturn item.expand();\n\t}\n\n\tpublic expandAll(elements?: any[]): WinJS.Promise {\n\t\tif (!elements) {\n\t\t\telements = [];\n\n\t\t\tvar item: Item;\n\t\t\tvar nav = this.getNavigator();\n\n\t\t\twhile (item = nav.next()) {\n\t\t\t\telements.push(item);\n\t\t\t}\n\t\t}\n\n\t\tvar promises = [];\n\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\tpromises.push(this.expand(elements[i]));\n\t\t}\n\t\treturn WinJS.Promise.join(promises);\n\t}\n\n\tpublic collapse(element: any, recursive: boolean = false): WinJS.Promise {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn WinJS.TPromise.as(false);\n\t\t}\n\n\t\treturn item.collapse(recursive);\n\t}\n\n\tpublic collapseAll(elements: any[] = null, recursive: boolean = false): WinJS.Promise {\n\t\tif (!elements) {\n\t\t\telements = [this.input];\n\t\t\trecursive = true;\n\t\t}\n\t\tvar promises = [];\n\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\tpromises.push(this.collapse(elements[i], recursive));\n\t\t}\n\t\treturn WinJS.Promise.join(promises);\n\t}\n\n\tpublic toggleExpansion(element: any): WinJS.Promise {\n\t\treturn this.isExpanded(element) ? this.collapse(element) : this.expand(element);\n\t}\n\n\tpublic toggleExpansionAll(elements: any[]): WinJS.Promise {\n\t\tvar promises = [];\n\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\tpromises.push(this.toggleExpansion(elements[i]));\n\t\t}\n\t\treturn WinJS.Promise.join(promises);\n\t}\n\n\tpublic isExpanded(element: any): boolean {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn item.isExpanded();\n\t}\n\n\tpublic getExpandedElements(): any[] {\n\t\tvar result: any[] = [];\n\t\tvar item: Item;\n\t\tvar nav = this.getNavigator();\n\n\t\twhile (item = nav.next()) {\n\t\t\tif (item.isExpanded()) {\n\t\t\t\tresult.push(item.getElement());\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic reveal(element: any, relativeTop: number = null): WinJS.Promise {\n\t\treturn this.resolveUnknownParentChain(element).then((chain: any[]) => {\n\t\t\tvar result = WinJS.TPromise.as(null);\n\n\t\t\tchain.forEach((e) => {\n\t\t\t\tresult = result.then(() => this.expand(e));\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}).then(() => {\n\t\t\tvar item = this.getItem(element);\n\n\t\t\tif (item) {\n\t\t\t\treturn item.reveal(relativeTop);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate resolveUnknownParentChain(element: any): WinJS.Promise {\n\t\treturn this.context.dataSource.getParent(this.context.tree, element).then((parent) => {\n\t\t\tif (!parent) {\n\t\t\t\treturn WinJS.TPromise.as([]);\n\t\t\t}\n\n\t\t\treturn this.resolveUnknownParentChain(parent).then((result) => {\n\t\t\t\tresult.push(parent);\n\t\t\t\treturn result;\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic setHighlight(element?: any, eventPayload?: any): void {\n\t\tthis.setTraits('highlighted', element ? [element] : []);\n\t\tvar eventData: _.IHighlightEvent = { highlight: this.getHighlight(), payload: eventPayload };\n\t\tthis.emit('highlight', eventData);\n\t}\n\n\tpublic getHighlight(includeHidden?: boolean): any {\n\t\tvar result = this.getElementsWithTrait('highlighted', includeHidden);\n\t\treturn result.length === 0 ? null : result[0];\n\t}\n\n\tpublic isHighlighted(element: any): boolean {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn item.hasTrait('highlighted');\n\t}\n\n\tpublic select(element: any, eventPayload?: any): void {\n\t\tthis.selectAll([element], eventPayload);\n\t}\n\n\tpublic selectRange(fromElement: any, toElement: any, eventPayload?: any): void {\n\t\tvar fromItem = this.getItem(fromElement);\n\t\tvar toItem = this.getItem(toElement);\n\n\t\tif (!fromItem || !toItem) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectAll(getRange(fromItem, toItem), eventPayload);\n\t}\n\n\tpublic deselectRange(fromElement: any, toElement: any, eventPayload?: any): void {\n\t\tvar fromItem = this.getItem(fromElement);\n\t\tvar toItem = this.getItem(toElement);\n\n\t\tif (!fromItem || !toItem) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deselectAll(getRange(fromItem, toItem), eventPayload);\n\t}\n\n\tpublic selectAll(elements: any[], eventPayload?: any): void {\n\t\tthis.addTraits('selected', elements);\n\t\tvar eventData: _.ISelectionEvent = { selection: this.getSelection(), payload: eventPayload };\n\t\tthis.emit('selection', eventData);\n\t}\n\n\tpublic deselect(element: any, eventPayload?: any): void {\n\t\tthis.deselectAll([element], eventPayload);\n\t}\n\n\tpublic deselectAll(elements: any[], eventPayload?: any): void {\n\t\tthis.removeTraits('selected', elements);\n\t\tvar eventData: _.ISelectionEvent = { selection: this.getSelection(), payload: eventPayload };\n\t\tthis.emit('selection', eventData);\n\t}\n\n\tpublic setSelection(elements: any[], eventPayload?: any): void {\n\t\tthis.setTraits('selected', elements);\n\t\tvar eventData: _.ISelectionEvent = { selection: this.getSelection(), payload: eventPayload };\n\t\tthis.emit('selection', eventData);\n\t}\n\n\tpublic toggleSelection(element: any, eventPayload?: any): void {\n\t\tthis.toggleTrait('selected', element);\n\t\tvar eventData: _.ISelectionEvent = { selection: this.getSelection(), payload: eventPayload };\n\t\tthis.emit('selection', eventData);\n\t}\n\n\tpublic isSelected(element: any): boolean {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn item.hasTrait('selected');\n\t}\n\n\tpublic getSelection(includeHidden?: boolean): any[] {\n\t\treturn this.getElementsWithTrait('selected', includeHidden);\n\t}\n\n\tpublic selectNext(count: number = 1, clearSelection: boolean = true, eventPayload?: any): void {\n\t\tvar selection = this.getSelection();\n\t\tvar item: Item = selection.length > 0 ? selection[0] : this.input;\n\t\tvar nextItem: Item;\n\t\tvar nav = this.getNavigator(item, false);\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tnextItem = nav.next();\n\t\t\tif (!nextItem) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\titem = nextItem;\n\t\t}\n\n\t\tif (clearSelection) {\n\t\t\tthis.setSelection([item], eventPayload);\n\t\t} else {\n\t\t\tthis.select(item, eventPayload);\n\t\t}\n\t}\n\n\tpublic selectPrevious(count: number = 1, clearSelection: boolean = true, eventPayload?: any): void {\n\t\tvar selection = this.getSelection(),\n\t\t\titem: Item = null,\n\t\t\tpreviousItem: Item = null;\n\n\t\tif (selection.length === 0) {\n\t\t\tvar nav = this.getNavigator(this.input);\n\n\t\t\twhile (item = nav.next()) {\n\t\t\t\tpreviousItem = item;\n\t\t\t}\n\n\t\t\titem = previousItem;\n\n\t\t} else {\n\t\t\titem = selection[0];\n\t\t\tvar nav = this.getNavigator(item, false);\n\n\t\t\tfor (var i = 0; i < count; i++) {\n\t\t\t\tpreviousItem = nav.previous();\n\t\t\t\tif (!previousItem) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\titem = previousItem;\n\t\t\t}\n\t\t}\n\n\t\tif (clearSelection) {\n\t\t\tthis.setSelection([item], eventPayload);\n\t\t} else {\n\t\t\tthis.select(item, eventPayload);\n\t\t}\n\t}\n\n\tpublic selectParent(eventPayload?: any, clearSelection: boolean = true): void {\n\t\tvar selection = this.getSelection();\n\t\tvar item: Item = selection.length > 0 ? selection[0] : this.input;\n\t\tvar nav = this.getNavigator(item, false);\n\t\tvar parent = nav.parent();\n\n\t\tif (parent) {\n\t\t\tif (clearSelection) {\n\t\t\t\tthis.setSelection([parent], eventPayload);\n\t\t\t} else {\n\t\t\t\tthis.select(parent, eventPayload);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic setFocus(element?: any, eventPayload?: any): void {\n\t\tthis.setTraits('focused', element ? [element] : []);\n\t\tvar eventData: _.IFocusEvent = { focus: this.getFocus(), payload: eventPayload };\n\t\tthis.emit('focus', eventData);\n\t}\n\n\tpublic isFocused(element: any): boolean {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn item.hasTrait('focused');\n\t}\n\n\tpublic getFocus(includeHidden?: boolean): any {\n\t\tvar result = this.getElementsWithTrait('focused', includeHidden);\n\t\treturn result.length === 0 ? null : result[0];\n\t}\n\n\tpublic focusNext(count: number = 1, eventPayload?: any): void {\n\t\tvar item: Item = this.getFocus() || this.input;\n\t\tvar nextItem: Item;\n\t\tvar nav = this.getNavigator(item, false);\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tnextItem = nav.next();\n\t\t\tif (!nextItem) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\titem = nextItem;\n\t\t}\n\n\t\tthis.setFocus(item, eventPayload);\n\t}\n\n\tpublic focusPrevious(count: number = 1, eventPayload?: any): void {\n\t\tvar item: Item = this.getFocus() || this.input;\n\t\tvar previousItem: Item;\n\t\tvar nav = this.getNavigator(item, false);\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tpreviousItem = nav.previous();\n\t\t\tif (!previousItem) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\titem = previousItem;\n\t\t}\n\n\t\tthis.setFocus(item, eventPayload);\n\t}\n\n\tpublic focusParent(eventPayload?: any): void {\n\t\tvar item: Item = this.getFocus() || this.input;\n\t\tvar nav = this.getNavigator(item, false);\n\t\tvar parent = nav.parent();\n\n\t\tif (parent) {\n\t\t\tthis.setFocus(parent, eventPayload);\n\t\t}\n\t}\n\n\tpublic focusFirst(eventPayload?: any): void {\n\t\tthis.focusNth(0, eventPayload);\n\t}\n\n\tpublic focusNth(index: number, eventPayload?: any): void {\n\t\tvar nav = this.getNavigator(this.input);\n\t\tvar item = nav.first();\n\t\tfor (var i = 0; i < index; i++) {\n\t\t\titem = nav.next();\n\t\t}\n\n\t\tif (item) {\n\t\t\tthis.setFocus(item, eventPayload);\n\t\t}\n\t}\n\n\tpublic focusLast(eventPayload?: any): void {\n\t\tvar nav = this.getNavigator(this.input);\n\t\tvar item = nav.last();\n\n\t\tif (item) {\n\t\t\tthis.setFocus(item, eventPayload);\n\t\t}\n\t}\n\n\tpublic getNavigator(element: any = null, subTreeOnly: boolean = true): INavigator<Item> {\n\t\treturn new TreeNavigator(this.getItem(element), subTreeOnly);\n\t}\n\n\tprivate getItem(element: any = null): Item {\n\t\tif (element === null) {\n\t\t\treturn this.input;\n\t\t} else if (element instanceof Item) {\n\t\t\treturn element;\n\t\t} else if (typeof element === 'string') {\n\t\t\treturn this.registry.getItem(element);\n\t\t} else {\n\t\t\treturn this.registry.getItem(this.context.dataSource.getId(this.context.tree, element));\n\t\t}\n\t}\n\n\tpublic addTraits(trait: string, elements: any[]): void {\n\t\tvar items: IItemMap = this.traitsToItems[trait] || <IItemMap> {};\n\t\tvar item: Item;\n\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\titem = this.getItem(elements[i]);\n\n\t\t\tif (item) {\n\t\t\t\titem.addTrait(trait);\n\t\t\t\titems[item.id] = item;\n\t\t\t}\n\t\t}\n\t\tthis.traitsToItems[trait] = items;\n\t}\n\n\tpublic removeTraits(trait: string, elements: any[]): void {\n\t\tvar items: IItemMap = this.traitsToItems[trait] || <IItemMap> {};\n\t\tvar item: Item;\n\t\tvar id: string;\n\n\t\tif (elements.length === 0) {\n\t\t\tfor (id in items) {\n\t\t\t\tif (items.hasOwnProperty(id)) {\n\t\t\t\t\titem = items[id];\n\t\t\t\t\titem.removeTrait(trait);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelete this.traitsToItems[trait];\n\n\t\t} else {\n\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\t\titem = this.getItem(elements[i]);\n\n\t\t\t\tif (item) {\n\t\t\t\t\titem.removeTrait(trait);\n\t\t\t\t\tdelete items[item.id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hasTrait(trait: string, element: any): boolean {\n\t\tvar item = this.getItem(element);\n\t\treturn item && item.hasTrait(trait);\n\t}\n\n\tprivate toggleTrait(trait: string, element: any): void {\n\t\tvar item = this.getItem(element);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (item.hasTrait(trait)) {\n\t\t\tthis.removeTraits(trait, [element]);\n\t\t} else {\n\t\t\tthis.addTraits(trait, [element]);\n\t\t}\n\t}\n\n\tprivate setTraits(trait: string, elements: any[]): void {\n\t\tif (elements.length === 0) {\n\t\t\tthis.removeTraits(trait, elements);\n\t\t} else {\n\t\t\tvar items: { [id: string]: Item; } = {};\n\t\t\tvar item: Item;\n\n\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {\n\t\t\t\titem = this.getItem(elements[i]);\n\n\t\t\t\tif (item) {\n\t\t\t\t\titems[item.id] = item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar traitItems: IItemMap = this.traitsToItems[trait] || <IItemMap> {};\n\t\t\tvar itemsToRemoveTrait: Item[] = [];\n\t\t\tvar id: string;\n\n\t\t\tfor (id in traitItems) {\n\t\t\t\tif (traitItems.hasOwnProperty(id)) {\n\t\t\t\t\tif (items.hasOwnProperty(id)) {\n\t\t\t\t\t\tdelete items[id];\n\t\t\t\t\t} else {\n\t\t\t\t\t\titemsToRemoveTrait.push(traitItems[id]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0, len = itemsToRemoveTrait.length; i < len; i++) {\n\t\t\t\titem = itemsToRemoveTrait[i];\n\t\t\t\titem.removeTrait(trait);\n\t\t\t\tdelete traitItems[item.id];\n\t\t\t}\n\n\t\t\tfor (id in items) {\n\t\t\t\tif (items.hasOwnProperty(id)) {\n\t\t\t\t\titem = items[id];\n\t\t\t\t\titem.addTrait(trait);\n\t\t\t\t\ttraitItems[id] = item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.traitsToItems[trait] = traitItems;\n\t\t}\n\t}\n\n\tprivate getElementsWithTrait(trait: string, includeHidden: boolean): any[] {\n\t\tvar elements = [];\n\t\tvar items = this.traitsToItems[trait] || {};\n\t\tvar id: string;\n\t\tfor (id in items) {\n\t\t\tif (items.hasOwnProperty(id) && (items[id].isVisible() || includeHidden)) {\n\t\t\t\telements.push(items[id].getElement());\n\t\t\t}\n\t\t}\n\t\treturn elements;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this.registry) {\n\t\t\tthis.registry.dispose();\n\t\t\tthis.registry = null;\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n"]}