{"version":3,"file":"pointerHandler.js","sourceRoot":"","sources":["../../../../../src/vs/editor/browser/controller/pointerHandler.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport * as dom from 'vs/base/browser/dom';\nimport {StandardMouseEvent} from 'vs/base/browser/mouseEvent';\nimport {EventType, Gesture, GestureEvent} from 'vs/base/browser/touch';\nimport {IScrollEvent} from 'vs/editor/common/editorCommon';\nimport {MouseHandler} from 'vs/editor/browser/controller/mouseHandler';\nimport {IPointerHandlerHelper, IViewContext, IViewController} from 'vs/editor/browser/editorBrowser';\n\ninterface IThrottledGestureEvent {\n\ttranslationX: number;\n\ttranslationY: number;\n}\n\nvar gestureChangeEventMerger = (lastEvent:IThrottledGestureEvent, currentEvent:MSGestureEvent): IThrottledGestureEvent => {\n\tvar r = {\n\t\ttranslationY: currentEvent.translationY,\n\t\ttranslationX: currentEvent.translationX\n\t};\n\tif (lastEvent) {\n\t\tr.translationY += lastEvent.translationY;\n\t\tr.translationX += lastEvent.translationX;\n\t}\n\treturn r;\n};\n\n/**\n * Basically IE10 and IE11\n */\nclass MsPointerHandler extends MouseHandler implements IDisposable {\n\n\tprivate _lastPointerType: string;\n\tprivate _installGestureHandlerTimeout: number;\n\n\tconstructor(context:IViewContext, viewController:IViewController, viewHelper:IPointerHandlerHelper) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis.viewHelper.linesContentDomNode.style.msTouchAction = 'none';\n\t\tthis.viewHelper.linesContentDomNode.style.msContentZooming = 'none';\n\n\t\t// TODO@Alex -> this expects that the view is added in 100 ms, might not be the case\n\t\t// This handler should be added when the dom node is in the dom tree\n\t\tthis._installGestureHandlerTimeout = window.setTimeout(() => {\n\t\t\tthis._installGestureHandlerTimeout = -1;\n\t\t\tif((<any>window).MSGesture) {\n\t\t\t\tvar touchGesture = new MSGesture();\n\t\t\t\tvar penGesture = new MSGesture();\n\t\t\t\ttouchGesture.target = this.viewHelper.linesContentDomNode;\n\t\t\t\tpenGesture.target = this.viewHelper.linesContentDomNode;\n\t\t\t\tthis.viewHelper.linesContentDomNode.addEventListener('MSPointerDown', (e:MSPointerEvent) => {\n\t\t\t\t\t// Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\n\t\t\t\t\tvar pointerType = <any>e.pointerType;\n\t\t\t\t\tif (pointerType === ((<any>e).MSPOINTER_TYPE_MOUSE || 'mouse')) {\n\t\t\t\t\t\tthis._lastPointerType = 'mouse';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (pointerType === ((<any>e).MSPOINTER_TYPE_TOUCH || 'touch')) {\n\t\t\t\t\t\tthis._lastPointerType = 'touch';\n\t\t\t\t\t\ttouchGesture.addPointer(e.pointerId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._lastPointerType = 'pen';\n\t\t\t\t\t\tpenGesture.addPointer(e.pointerId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.listenersToRemove.push(dom.addDisposableThrottledListener<IThrottledGestureEvent>(this.viewHelper.linesContentDomNode, 'MSGestureChange', (e) => this._onGestureChange(e), gestureChangeEventMerger));\n\t\t\t\tthis.listenersToRemove.push(dom.addDisposableListener(this.viewHelper.linesContentDomNode, 'MSGestureTap', (e) => this._onCaptureGestureTap(e), true));\n\t\t\t}\n\t\t}, 100);\n\t\tthis._lastPointerType = 'mouse';\n\t}\n\n\tpublic _onMouseDown(e:MouseEvent): void {\n\t\tif (this._lastPointerType === 'mouse') {\n\t\t\tsuper._onMouseDown(e);\n\t\t}\n\t}\n\n\tprivate _onCaptureGestureTap(rawEvent: MSGestureEvent): void {\n\t\tvar e = new StandardMouseEvent(<MouseEvent><any>rawEvent);\n\t\tvar t = this._createMouseTarget(e, false);\n\t\tif (t.position) {\n\t\t\tthis.viewController.moveTo('mouse', t.position);\n\t\t}\n\t\t// IE does not want to focus when coming in from the browser's address bar\n\t\tif ((<any>e.browserEvent).fromElement) {\n\t\t\te.preventDefault();\n\t\t\tthis.viewHelper.focusTextArea();\n\t\t} else {\n\t\t\t// TODO@Alex -> cancel this is focus is lost\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.viewHelper.focusTextArea();\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _onGestureChange(e:IThrottledGestureEvent): void {\n\t\tthis.viewHelper.setScrollTop(this.viewHelper.getScrollTop() - e.translationY);\n\t\tthis.viewHelper.setScrollLeft(this.viewHelper.getScrollLeft() - e.translationX);\n\t}\n\n\tpublic dispose(): void {\n\t\twindow.clearTimeout(this._installGestureHandlerTimeout);\n\t\tsuper.dispose();\n\t}\n}\n\n/**\n * Basically Edge but should be modified to handle any pointerEnabled, even without support of MSGesture\n */\nclass StandardPointerHandler extends MouseHandler implements IDisposable {\n\n\tprivate _lastPointerType: string;\n\tprivate _installGestureHandlerTimeout: number;\n\n\tconstructor(context:IViewContext, viewController:IViewController, viewHelper:IPointerHandlerHelper) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis.viewHelper.linesContentDomNode.style.touchAction = 'none';\n\n\t\t// TODO@Alex -> this expects that the view is added in 100 ms, might not be the case\n\t\t// This handler should be added when the dom node is in the dom tree\n\t\tthis._installGestureHandlerTimeout = window.setTimeout(() => {\n\t\t\tthis._installGestureHandlerTimeout = -1;\n\n\t\t\t// TODO@Alex: replace the usage of MSGesture here with something that works across all browsers\n\t\t\tif((<any>window).MSGesture) {\n\t\t\t\tvar touchGesture = new MSGesture();\n\t\t\t\tvar penGesture = new MSGesture();\n\t\t\t\ttouchGesture.target = this.viewHelper.linesContentDomNode;\n\t\t\t\tpenGesture.target = this.viewHelper.linesContentDomNode;\n\t\t\t\tthis.viewHelper.linesContentDomNode.addEventListener('pointerdown', (e:MSPointerEvent) => {\n\t\t\t\t\tvar pointerType = <any>e.pointerType;\n\t\t\t\t\tif (pointerType === 'mouse') {\n\t\t\t\t\t\tthis._lastPointerType = 'mouse';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (pointerType === 'touch') {\n\t\t\t\t\t\tthis._lastPointerType = 'touch';\n\t\t\t\t\t\ttouchGesture.addPointer(e.pointerId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._lastPointerType = 'pen';\n\t\t\t\t\t\tpenGesture.addPointer(e.pointerId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.listenersToRemove.push(dom.addDisposableThrottledListener<IThrottledGestureEvent>(this.viewHelper.linesContentDomNode, 'MSGestureChange', (e) => this._onGestureChange(e), gestureChangeEventMerger));\n\t\t\t\tthis.listenersToRemove.push(dom.addDisposableListener(this.viewHelper.linesContentDomNode, 'MSGestureTap', (e) => this._onCaptureGestureTap(e), true));\n\t\t\t}\n\t\t}, 100);\n\t\tthis._lastPointerType = 'mouse';\n\t}\n\n\tpublic _onMouseDown(e:MouseEvent): void {\n\t\tif (this._lastPointerType === 'mouse') {\n\t\t\tsuper._onMouseDown(e);\n\t\t}\n\t}\n\n\tprivate _onCaptureGestureTap(rawEvent: MSGestureEvent): void {\n\t\tvar e = new StandardMouseEvent(<MouseEvent><any>rawEvent);\n\t\tvar t = this._createMouseTarget(e, false);\n\t\tif (t.position) {\n\t\t\tthis.viewController.moveTo('mouse', t.position);\n\t\t}\n\t\t// IE does not want to focus when coming in from the browser's address bar\n\t\tif ((<any>e.browserEvent).fromElement) {\n\t\t\te.preventDefault();\n\t\t\tthis.viewHelper.focusTextArea();\n\t\t} else {\n\t\t\t// TODO@Alex -> cancel this is focus is lost\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.viewHelper.focusTextArea();\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _onGestureChange(e:IThrottledGestureEvent): void {\n\t\tthis.viewHelper.setScrollTop(this.viewHelper.getScrollTop() - e.translationY);\n\t\tthis.viewHelper.setScrollLeft(this.viewHelper.getScrollLeft() - e.translationX);\n\t}\n\n\tpublic dispose(): void {\n\t\twindow.clearTimeout(this._installGestureHandlerTimeout);\n\t\tsuper.dispose();\n\t}\n}\n\nclass TouchHandler extends MouseHandler {\n\n\tprivate gesture:Gesture;\n\n\tconstructor(context:IViewContext, viewController:IViewController, viewHelper:IPointerHandlerHelper) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis.gesture = new Gesture(this.viewHelper.linesContentDomNode);\n\n\t\tthis.listenersToRemove.push(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Tap, (e) => this.onTap(e)));\n\t\tthis.listenersToRemove.push(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Change, (e) => this.onChange(e)));\n\t\tthis.listenersToRemove.push(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Contextmenu, (e: MouseEvent) => this._onContextMenu(e, false)));\n\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.gesture.dispose();\n\t\tsuper.dispose();\n\t}\n\n\tprivate onTap(event:GestureEvent): void {\n\t\tevent.preventDefault();\n\n\t\tthis.viewHelper.focusTextArea();\n\n\t\tvar mouseEvent = new StandardMouseEvent(event);\n\t\tvar target = this._createMouseTarget(mouseEvent, false);\n\n\t\tif (target.position) {\n\t\t\tthis.viewController.moveTo('mouse', target.position);\n\t\t}\n\t}\n\n\tprivate onChange(event:GestureEvent): void {\n\t\tthis.viewHelper.setScrollTop(this.viewHelper.getScrollTop() - event.translationY);\n\t\tthis.viewHelper.setScrollLeft(this.viewHelper.getScrollLeft() - event.translationX);\n\t}\n}\n\nexport class PointerHandler implements IDisposable {\n\tprivate handler:MouseHandler;\n\n\tconstructor(context:IViewContext, viewController:IViewController, viewHelper:IPointerHandlerHelper) {\n\t\tif (window.navigator.msPointerEnabled) {\n\t\t\tthis.handler = new MsPointerHandler(context, viewController, viewHelper);\n\t\t} else if((<any> window).TouchEvent) {\n\t\t\tthis.handler = new TouchHandler(context, viewController, viewHelper);\n\t\t} else if (window.navigator.pointerEnabled) {\n\t\t\tthis.handler = new StandardPointerHandler(context, viewController, viewHelper);\n\t\t} else {\n\t\t\tthis.handler = new MouseHandler(context, viewController, viewHelper);\n\t\t}\n\t}\n\n\tpublic onScrollChanged(e:IScrollEvent): void {\n\t\tthis.handler.onScrollChanged(e);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.handler.dispose();\n\t}\n}\n"]}