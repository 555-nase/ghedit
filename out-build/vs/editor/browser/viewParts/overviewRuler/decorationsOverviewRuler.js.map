{"version":3,"file":"decorationsOverviewRuler.js","sourceRoot":"","sources":["../../../../../../src/vs/editor/browser/viewParts/overviewRuler/decorationsOverviewRuler.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as themes from 'vs/platform/theme/common/themes';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {OverviewRulerZone, IRenderingContext, IRestrictedRenderingContext, IViewContext} from 'vs/editor/browser/editorBrowser';\nimport {ViewPart} from 'vs/editor/browser/view/viewPart';\nimport {OverviewRulerImpl} from 'vs/editor/browser/viewParts/overviewRuler/overviewRulerImpl';\n\nexport class DecorationsOverviewRuler extends ViewPart {\n\n\tstatic DECORATION_HEIGHT = 6;\n\n\tprivate static _CURSOR_COLOR = 'rgba(0, 0, 102, 0.8)';\n\tprivate static _CURSOR_COLOR_DARK = 'rgba(152, 152, 152, 0.8)';\n\n\tprivate _overviewRuler:OverviewRulerImpl;\n\n\tprivate _shouldUpdateDecorations:boolean;\n\tprivate _shouldUpdateCursorPosition:boolean;\n\n\tprivate _hideCursor:boolean;\n\tprivate _cursorPositions: editorCommon.IEditorPosition[];\n\n\tprivate _zonesFromDecorations: OverviewRulerZone[];\n\tprivate _zonesFromCursors: OverviewRulerZone[];\n\n\tconstructor(context:IViewContext, scrollHeight:number, getVerticalOffsetForLine:(lineNumber:number)=>number) {\n\t\tsuper(context);\n\t\tthis._overviewRuler = new OverviewRulerImpl(\n\t\t\t1,\n\t\t\t'decorationsOverviewRuler',\n\t\t\tscrollHeight,\n\t\t\tthis._context.configuration.editor.lineHeight,\n\t\t\tDecorationsOverviewRuler.DECORATION_HEIGHT,\n\t\t\tDecorationsOverviewRuler.DECORATION_HEIGHT,\n\t\t\tgetVerticalOffsetForLine\n\t\t);\n\t\tthis._overviewRuler.setLanesCount(this._context.configuration.editor.overviewRulerLanes, false);\n\t\tlet theme = this._context.configuration.editor.theme;\n\t\tthis._overviewRuler.setUseDarkColor(!themes.isLightTheme(theme), false);\n\n\t\tthis._shouldUpdateDecorations = true;\n\t\tthis._zonesFromDecorations = [];\n\n\t\tthis._shouldUpdateCursorPosition = true;\n\t\tthis._hideCursor = this._context.configuration.editor.hideCursorInOverviewRuler;\n\n\t\tthis._zonesFromCursors = [];\n\t\tthis._cursorPositions = [];\n\t}\n\n\tpublic dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._overviewRuler.dispose();\n\t}\n\n\t// ---- begin view event handlers\n\n\tpublic onCursorPositionChanged(e:editorCommon.IViewCursorPositionChangedEvent): boolean {\n\t\tthis._shouldUpdateCursorPosition = true;\n\t\tthis._cursorPositions = [ e.position ];\n\t\tthis._cursorPositions = this._cursorPositions.concat(e.secondaryPositions);\n\t\treturn true;\n\t}\n\n\tpublic onConfigurationChanged(e:editorCommon.IConfigurationChangedEvent): boolean {\n\t\tvar prevLanesCount = this._overviewRuler.getLanesCount();\n\t\tvar newLanesCount = this._context.configuration.editor.overviewRulerLanes;\n\n\t\tvar shouldRender = false;\n\n\t\tif (e.lineHeight) {\n\t\t\tthis._overviewRuler.setLineHeight(this._context.configuration.editor.lineHeight, false);\n\t\t\tshouldRender = true;\n\t\t}\n\n\t\tif (prevLanesCount !== newLanesCount) {\n\t\t\tthis._overviewRuler.setLanesCount(newLanesCount, false);\n\t\t\tshouldRender = true;\n\t\t}\n\n\t\tif (e.hideCursorInOverviewRuler) {\n\t\t\tthis._hideCursor = this._context.configuration.editor.hideCursorInOverviewRuler;\n\t\t\tthis._shouldUpdateCursorPosition = true;\n\t\t\tshouldRender = true;\n\t\t}\n\n\t\tif (e.theme) {\n\t\t\tlet theme = this._context.configuration.editor.theme;\n\t\t\tthis._overviewRuler.setUseDarkColor(!themes.isLightTheme(theme), false);\n\t\t\tshouldRender = true;\n\t\t}\n\n\t\treturn shouldRender;\n\t}\n\n\tpublic onLayoutChanged(layoutInfo:editorCommon.IEditorLayoutInfo): boolean {\n\t\tthis._overviewRuler.setLayout(layoutInfo.overviewRuler, false);\n\t\treturn true;\n\t}\n\n\tpublic onZonesChanged(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic onModelFlushed(): boolean {\n\t\tthis._shouldUpdateCursorPosition = true;\n\t\tthis._shouldUpdateDecorations = true;\n\t\treturn true;\n\t}\n\n\tpublic onModelDecorationsChanged(e:editorCommon.IViewDecorationsChangedEvent): boolean {\n\t\tthis._shouldUpdateDecorations = true;\n\t\treturn true;\n\t}\n\n\tpublic onScrollHeightChanged(scrollHeight:number): boolean {\n\t\tthis._overviewRuler.setScrollHeight(scrollHeight, false);\n\t\treturn true;\n\t}\n\n\t// ---- end view event handlers\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._overviewRuler.getDomNode();\n\t}\n\n\tprivate _createZonesFromDecorations(): OverviewRulerZone[] {\n\t\tlet decorations = this._context.model.getAllDecorations();\n\t\tlet zones:OverviewRulerZone[] = [];\n\n\t\tfor (let i = 0, len = decorations.length; i < len; i++) {\n\t\t\tlet dec = decorations[i];\n\t\t\tif (dec.options.overviewRuler.color) {\n\t\t\t\tzones.push(new OverviewRulerZone(\n\t\t\t\t\tdec.range.startLineNumber,\n\t\t\t\t\tdec.range.endLineNumber,\n\t\t\t\t\tdec.options.overviewRuler.position,\n\t\t\t\t\t0,\n\t\t\t\t\tdec.options.overviewRuler.color,\n\t\t\t\t\tdec.options.overviewRuler.darkColor\n\t\t\t\t));\n\t\t\t}\n\t\t}\n\n\t\treturn zones;\n\t}\n\n\tprivate _createZonesFromCursors(): OverviewRulerZone[] {\n\t\tlet zones:OverviewRulerZone[] = [];\n\n\t\tfor (let i = 0, len = this._cursorPositions.length; i < len; i++) {\n\t\t\tlet cursor = this._cursorPositions[i];\n\n\t\t\tzones.push(new OverviewRulerZone(\n\t\t\t\t\tcursor.lineNumber,\n\t\t\t\t\tcursor.lineNumber,\n\t\t\t\t\teditorCommon.OverviewRulerLane.Full,\n\t\t\t\t\t2,\n\t\t\t\t\tDecorationsOverviewRuler._CURSOR_COLOR,\n\t\t\t\t\tDecorationsOverviewRuler._CURSOR_COLOR_DARK\n\t\t\t));\n\t\t}\n\n\t\treturn zones;\n\t}\n\n\tpublic prepareRender(ctx:IRenderingContext): void {\n\t\t// Nothing to read\n\t\tif (!this.shouldRender()) {\n\t\t\tthrow new Error('I did not ask to render!');\n\t\t}\n\t}\n\n\tpublic render(ctx:IRestrictedRenderingContext): void {\n\t\tif (this._shouldUpdateDecorations || this._shouldUpdateCursorPosition) {\n\n\t\t\tif (this._shouldUpdateDecorations) {\n\t\t\t\tthis._shouldUpdateDecorations = false;\n\t\t\t\tthis._zonesFromDecorations = this._createZonesFromDecorations();\n\t\t\t}\n\n\t\t\tif (this._shouldUpdateCursorPosition) {\n\t\t\t\tthis._shouldUpdateCursorPosition = false;\n\t\t\t\tif (this._hideCursor) {\n\t\t\t\t\tthis._zonesFromCursors = [];\n\t\t\t\t} else {\n\t\t\t\t\tthis._zonesFromCursors = this._createZonesFromCursors();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar allZones:OverviewRulerZone[] = [];\n\t\t\tallZones = allZones.concat(this._zonesFromCursors);\n\t\t\tallZones = allZones.concat(this._zonesFromDecorations);\n\n\t\t\tthis._overviewRuler.setZones(allZones, false);\n\t\t}\n\n\t\tvar hasRendered = this._overviewRuler.render(false);\n\n\t\tif (hasRendered && OverviewRulerImpl.hasCanvas && this._overviewRuler.getLanesCount() > 0 && (this._zonesFromDecorations.length > 0 || this._zonesFromCursors.length > 0)) {\n\t\t\tvar ctx2 = this._overviewRuler.getDomNode().getContext('2d');\n\t\t\tctx2.beginPath();\n\t\t\tctx2.lineWidth = 1;\n\t\t\tctx2.strokeStyle = 'rgba(197,197,197,0.8)';\n\t\t\tctx2.moveTo(0, 0);\n\t\t\tctx2.lineTo(0, this._overviewRuler.getHeight());\n\t\t\tctx2.stroke();\n\n\t\t\tctx2.moveTo(0, 0);\n\t\t\tctx2.lineTo(this._overviewRuler.getWidth(), 0);\n\t\t\tctx2.stroke();\n\t\t}\n\t}\n}\n"]}