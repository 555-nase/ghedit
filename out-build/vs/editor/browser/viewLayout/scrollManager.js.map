{"version":3,"file":"scrollManager.js","sourceRoot":"","sources":["../../../../../src/vs/editor/browser/viewLayout/scrollManager.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport * as dom from 'vs/base/browser/dom';\nimport {IOverviewRulerLayoutInfo, IScrollableElement, IScrollableElementCreationOptions} from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport {ScrollableElement} from 'vs/base/browser/ui/scrollbar/scrollableElementImpl';\nimport {EventType, IConfiguration, IConfigurationChangedEvent, IScrollEvent, IViewEventBus} from 'vs/editor/common/editorCommon';\nimport {EditorScrollable} from 'vs/editor/common/viewLayout/editorScrollable';\nimport {ClassNames} from 'vs/editor/browser/editorBrowser';\n\nfunction addPropertyIfPresent(src:any, dst:any, prop:string): void {\n\tif (src.hasOwnProperty(prop)) {\n\t\tdst[prop] = src[prop];\n\t}\n}\n\nexport class ScrollManager implements IDisposable {\n\n\tprivate configuration: IConfiguration;\n\tprivate privateViewEventBus:IViewEventBus;\n\n\tprivate toDispose:IDisposable[];\n\tprivate scrollable: EditorScrollable;\n\tprivate linesContent: HTMLElement;\n\tprivate scrollbar: IScrollableElement;\n\n\tconstructor(scrollable:EditorScrollable, configuration:IConfiguration, privateViewEventBus:IViewEventBus, linesContent:HTMLElement, viewDomNode:HTMLElement, overflowGuardDomNode:HTMLElement) {\n\t\tthis.toDispose = [];\n\t\tthis.scrollable = scrollable;\n\t\tthis.configuration = configuration;\n\t\tthis.privateViewEventBus = privateViewEventBus;\n\t\tthis.linesContent = linesContent;\n\n\t\tthis.toDispose.push(this.scrollable.addScrollListener((e:IScrollEvent) => {\n\t\t\tthis.privateViewEventBus.emit(EventType.ViewScrollChanged, e);\n\t\t}));\n\n\t\tvar configScrollbarOpts = this.configuration.editor.scrollbar;\n\n\t\tvar scrollbarOptions:IScrollableElementCreationOptions = {\n\t\t\tlistenOnDomNode: viewDomNode,\n\t\t\tvertical: configScrollbarOpts.vertical,\n\t\t\thorizontal: configScrollbarOpts.horizontal,\n\t\t\tclassName: ClassNames.SCROLLABLE_ELEMENT + ' ' + this.configuration.editor.theme,\n\t\t\tuseShadows: false,\n\t\t\tlazyRender: true,\n\t\t\tsaveLastScrollTimeOnClassName: ClassNames.VIEW_LINE\n\t\t};\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'verticalHasArrows');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'horizontalHasArrows');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'verticalScrollbarSize');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'verticalSliderSize');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'horizontalScrollbarSize');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'horizontalSliderSize');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'handleMouseWheel');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'arrowSize');\n\t\taddPropertyIfPresent(configScrollbarOpts, scrollbarOptions, 'mouseWheelScrollSensitivity');\n\n\n\t\tthis.scrollbar = new ScrollableElement(linesContent, this.scrollable, scrollbarOptions, {\n\t\t\twidth: this.configuration.editor.layoutInfo.contentWidth,\n\t\t\theight: this.configuration.editor.layoutInfo.contentHeight,\n\t\t});\n\t\tthis.toDispose.push(this.scrollbar);\n\n\t\tthis.toDispose.push(this.configuration.onDidChange((e:IConfigurationChangedEvent) => {\n\t\t\tthis.scrollbar.updateClassName(this.configuration.editor.theme);\n\t\t\tif (e.scrollbar) {\n\t\t\t\tthis.scrollbar.updateOptions(this.configuration.editor.scrollbar);\n\t\t\t}\n\t\t}));\n\n\t\t// When having a zone widget that calls .focus() on one of its dom elements,\n\t\t// the browser will try desperately to reveal that dom node, unexpectedly\n\t\t// changing the .scrollTop of this.linesContent\n\n\t\tvar onBrowserDesperateReveal = (domNode:HTMLElement, lookAtScrollTop:boolean, lookAtScrollLeft:boolean) => {\n\t\t\tif (lookAtScrollTop) {\n\t\t\t\tvar deltaTop = domNode.scrollTop;\n\t\t\t\tif (deltaTop) {\n\t\t\t\t\tthis.scrollable.setScrollTop(this.scrollable.getScrollTop() + deltaTop);\n\t\t\t\t\tdomNode.scrollTop = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (lookAtScrollLeft) {\n\t\t\t\tvar deltaLeft = domNode.scrollLeft;\n\t\t\t\tif (deltaLeft) {\n\t\t\t\t\tthis.scrollable.setScrollLeft(this.scrollable.getScrollLeft() + deltaLeft);\n\t\t\t\t\tdomNode.scrollLeft = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// I've seen this happen both on the view dom node & on the lines content dom node.\n\t\tthis.toDispose.push(dom.addDisposableListener(viewDomNode, 'scroll', (e:Event) => onBrowserDesperateReveal(viewDomNode, true, true)));\n\t\tthis.toDispose.push(dom.addDisposableListener(linesContent, 'scroll', (e:Event) => onBrowserDesperateReveal(linesContent, true, false)));\n\t\tthis.toDispose.push(dom.addDisposableListener(overflowGuardDomNode, 'scroll', (e:Event) => onBrowserDesperateReveal(overflowGuardDomNode, true, false)));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.toDispose = dispose(this.toDispose);\n\t}\n\n\tpublic renderScrollbar(): void {\n\t\tthis.scrollbar.renderNow();\n\t}\n\n\tpublic onSizeProviderLayoutChanged(): void {\n\t\tif (this.scrollbar) {\n\t\t\tthis.scrollbar.onElementDimensions({\n\t\t\t\twidth: this.configuration.editor.layoutInfo.contentWidth,\n\t\t\t\theight: this.configuration.editor.layoutInfo.contentHeight,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic getOverviewRulerLayoutInfo(): IOverviewRulerLayoutInfo {\n\t\tif (this.scrollbar) {\n\t\t\treturn this.scrollbar.getOverviewRulerLayoutInfo();\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic getScrollbarContainerDomNode(): HTMLElement {\n\t\tif (this.scrollbar) {\n\t\t\treturn this.scrollbar.getDomNode();\n\t\t}\n\t\treturn this.linesContent;\n\t}\n\n\tpublic delegateVerticalScrollbarMouseDown(browserEvent:MouseEvent): void {\n\t\tif (this.scrollbar) {\n\t\t\tthis.scrollbar.delegateVerticalScrollbarMouseDown(browserEvent);\n\t\t}\n\t}\n}\n"]}