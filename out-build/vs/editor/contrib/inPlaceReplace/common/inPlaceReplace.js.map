{"version":3,"sources":["vs/editor/contrib/inPlaceReplace/common/inPlaceReplace.ts"],"names":[],"mappings":"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","file":"vs/editor/contrib/inPlaceReplace/common/inPlaceReplace.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {KeyCode, KeyMod} from 'vs/base/common/keyCodes';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {Range} from 'vs/editor/common/core/range';\nimport {EditorAction} from 'vs/editor/common/editorAction';\nimport {CodeEditorStateFlag, ICommonCodeEditor, IEditorActionDescriptorData, IModelDecorationsChangeAccessor} from 'vs/editor/common/editorCommon';\nimport {CommonEditorRegistry, ContextKey, EditorActionDescriptor} from 'vs/editor/common/editorCommonExtensions';\nimport {IInplaceReplaceSupportResult} from 'vs/editor/common/modes';\nimport {IEditorWorkerService} from 'vs/editor/common/services/editorWorkerService';\nimport {InPlaceReplaceCommand} from './inPlaceReplaceCommand';\n\nclass InPlaceReplace extends EditorAction {\n\n\tprivate static DECORATION = {\n\t\tclassName: 'valueSetReplacement'\n\t};\n\n\tprivate up:boolean;\n\tprivate requestIdPool:number;\n\tprivate currentRequest:TPromise<IInplaceReplaceSupportResult>;\n\tprivate decorationRemover:TPromise<void>;\n\tprivate decorationIds:string[];\n\tprivate editorWorkerService:IEditorWorkerService;\n\n\tconstructor(\n\t\tdescriptor:IEditorActionDescriptorData,\n\t\teditor:ICommonCodeEditor,\n\t\tup:boolean,\n\t\t@IEditorWorkerService editorWorkerService:IEditorWorkerService\n\t) {\n\t\tsuper(descriptor, editor);\n\t\tthis.editorWorkerService = editorWorkerService;\n\t\tthis.up = up;\n\t\tthis.requestIdPool = 0;\n\t\tthis.currentRequest = TPromise.as(<IInplaceReplaceSupportResult>null);\n\t\tthis.decorationRemover = TPromise.as(<void>null);\n\t\tthis.decorationIds = [];\n\t}\n\n\tpublic run():TPromise<boolean> {\n\n\t\t// cancel any pending request\n\t\tthis.currentRequest.cancel();\n\n\t\tvar selection = this.editor.getSelection(),\n\t\t\tmodel = this.editor.getModel(),\n\t\t\tsupport = model.getMode().inplaceReplaceSupport,\n\t\t\tmodelURI = model.getAssociatedResource();\n\n\t\tif(selection.startLineNumber !== selection.endLineNumber) {\n\t\t\t// Can't accept multiline selection\n\t\t\treturn null;\n\t\t}\n\n\t\tvar state = this.editor.captureState(CodeEditorStateFlag.Value, CodeEditorStateFlag.Position);\n\n\t\tthis.currentRequest = this.editorWorkerService.navigateValueSet(modelURI, selection, this.up);\n\t\tthis.currentRequest = this.currentRequest.then((basicResult) => {\n\t\t\tif (basicResult && basicResult.range && basicResult.value) {\n\t\t\t\treturn basicResult;\n\t\t\t}\n\n\t\t\tif (support) {\n\t\t\t\treturn support.navigateValueSet(modelURI, selection, this.up);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\n\t\treturn this.currentRequest.then((result:IInplaceReplaceSupportResult) => {\n\n\t\t\tif(!result || !result.range || !result.value) {\n\t\t\t\t// No proper result\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(!state.validate(this.editor)) {\n\t\t\t\t// state has changed\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Selection\n\t\t\tvar editRange = Range.lift(result.range),\n\t\t\t\thighlightRange = result.range,\n\t\t\t\tdiff = result.value.length - (selection.endColumn - selection.startColumn);\n\n\t\t\t// highlight\n\t\t\thighlightRange.endColumn = highlightRange.startColumn + result.value.length;\n\t\t\tselection.endColumn += diff > 1 ? (diff - 1) : 0;\n\n\t\t\t// Insert new text\n\t\t\tvar command = new InPlaceReplaceCommand(editRange, selection, result.value);\n\t\t\tthis.editor.executeCommand(this.id, command);\n\n\t\t\t// add decoration\n\t\t\tthis.decorationIds = this.editor.deltaDecorations(this.decorationIds, [{\n\t\t\t\trange: highlightRange,\n\t\t\t\toptions: InPlaceReplace.DECORATION\n\t\t\t}]);\n\n\t\t\t// remove decoration after delay\n\t\t\tthis.decorationRemover.cancel();\n\t\t\tthis.decorationRemover = TPromise.timeout(350);\n\t\t\tthis.decorationRemover.then(() => {\n\t\t\t\tthis.editor.changeDecorations((accessor:IModelDecorationsChangeAccessor) => {\n\t\t\t\t\tthis.decorationIds = accessor.deltaDecorations(this.decorationIds, []);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn true;\n\t\t});\n\t}\n}\n\nclass InPlaceReplaceUp extends InPlaceReplace {\n\n\tpublic static ID = 'editor.action.inPlaceReplace.up';\n\n\tconstructor(\n\t\tdescriptor:IEditorActionDescriptorData,\n\t\teditor:ICommonCodeEditor,\n\t\t@IEditorWorkerService editorWorkerService:IEditorWorkerService\n\t) {\n\t\tsuper(descriptor, editor, true, editorWorkerService);\n\t}\n}\n\nclass InPlaceReplaceDown extends InPlaceReplace {\n\n\tpublic static ID = 'editor.action.inPlaceReplace.down';\n\n\tconstructor(\n\t\tdescriptor:IEditorActionDescriptorData,\n\t\teditor:ICommonCodeEditor,\n\t\t@IEditorWorkerService editorWorkerService:IEditorWorkerService\n\t) {\n\t\tsuper(descriptor, editor, false, editorWorkerService);\n\t}\n}\n\n// register actions\nCommonEditorRegistry.registerEditorAction(new EditorActionDescriptor(InPlaceReplaceUp, InPlaceReplaceUp.ID, nls.localize('InPlaceReplaceAction.previous.label', \"Replace with Previous Value\"), {\n\tcontext: ContextKey.EditorTextFocus,\n\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.US_COMMA\n}));\nCommonEditorRegistry.registerEditorAction(new EditorActionDescriptor(InPlaceReplaceDown, InPlaceReplaceDown.ID, nls.localize('InPlaceReplaceAction.next.label', \"Replace with Next Value\"), {\n\tcontext: ContextKey.EditorTextFocus,\n\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.US_DOT\n}));\n"]}