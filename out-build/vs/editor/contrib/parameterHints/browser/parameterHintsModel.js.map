{"version":3,"file":"vs/editor/contrib/parameterHints/browser/parameterHintsModel.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/editor/contrib/parameterHints/browser/parameterHintsModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {ThrottledDelayer} from 'vs/base/common/async';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport {EventEmitter, IEventEmitter, ListenerCallback} from 'vs/base/common/eventEmitter';\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {EventType, ICommonCodeEditor, ICursorSelectionChangedEvent, IModeSupportChangedEvent} from 'vs/editor/common/editorCommon';\nimport {ParameterHintsRegistry, IParameterHints} from 'vs/editor/common/modes';\nimport {getParameterHints} from '../common/parameterHints';\n\nexport interface IHintEvent {\n\thints: IParameterHints;\n}\n\nexport class ParameterHintsModel extends EventEmitter {\n\n\tstatic DELAY = 120; // ms\n\n\tprivate editor: ICommonCodeEditor;\n\tprivate toDispose: IDisposable[];\n\tprivate triggerCharactersListeners: IDisposable[];\n\n\tprivate active: boolean;\n\tprivate prevResult: IParameterHints;\n\tprivate throttledDelayer: ThrottledDelayer<boolean>;\n\n\tconstructor(editor:ICommonCodeEditor) {\n\t\tsuper(['cancel', 'hint', 'destroy']);\n\n\t\tthis.editor = editor;\n\t\tthis.toDispose = [];\n\t\tthis.triggerCharactersListeners = [];\n\n\t\tthis.throttledDelayer = new ThrottledDelayer<boolean>(ParameterHintsModel.DELAY);\n\n\t\tthis.active = false;\n\t\tthis.prevResult = null;\n\n\t\tthis.event(this.editor, EventType.ModelChanged, e => this.onModelChanged());\n\t\tthis.event(this.editor, EventType.ModelModeChanged, encodeURI => this.onModelChanged());\n\t\tthis.event(this.editor, EventType.ModelModeSupportChanged, e => this.onModeChanged(e));\n\t\tthis.event(this.editor, EventType.CursorSelectionChanged, e => this.onCursorChange(e));\n\t\tthis.toDispose.push(ParameterHintsRegistry.onDidChange(this.onModelChanged, this));\n\t\tthis.onModelChanged();\n\t}\n\n\tpublic cancel(silent: boolean = false, refresh: boolean = false): void {\n\t\tthis.active = false;\n\n\t\tif (!refresh) {\n\t\t\tthis.prevResult = null;\n\t\t}\n\n\t\tthis.throttledDelayer.cancel();\n\n\t\tif (!silent) {\n\t\t\tthis.emit('cancel');\n\t\t}\n\t}\n\n\tpublic trigger(triggerCharacter?: string, delay: number = ParameterHintsModel.DELAY): TPromise<boolean> {\n\t\tif (!ParameterHintsRegistry.has(this.editor.getModel())) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cancel(true, true);\n\t\treturn this.throttledDelayer.trigger(() => this.doTrigger(triggerCharacter), delay);\n\t}\n\n\tpublic doTrigger(triggerCharacter: string): TPromise<boolean> {\n\t\treturn getParameterHints(this.editor.getModel(), this.editor.getPosition(), triggerCharacter)\n\t\t\t.then<IParameterHints>(null, onUnexpectedError)\n\t\t\t.then(result => {\n\t\t\t\tif (!result || result.signatures.length === 0) {\n\t\t\t\t\tthis.cancel();\n\t\t\t\t\tthis.emit('cancel');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.active = true;\n\t\t\t\tthis.prevResult = result;\n\n\t\t\t\tvar event:IHintEvent = { hints: result };\n\t\t\t\tthis.emit('hint', event);\n\t\t\t\treturn true;\n\t\t\t});\n\t}\n\n\tpublic isTriggered():boolean {\n\t\treturn this.active || this.throttledDelayer.isTriggered();\n\t}\n\n\tprivate onModelChanged(): void {\n\t\tthis.triggerCharactersListeners = dispose(this.triggerCharactersListeners);\n\n\t\tvar model = this.editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet support = ParameterHintsRegistry.ordered(model)[0];\n\t\tif (!support) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.triggerCharactersListeners = support.getParameterHintsTriggerCharacters().map((ch) => {\n\t\t\tlet listener = this.editor.addTypingListener(ch, () => {\n\t\t\t\tlet position = this.editor.getPosition();\n\t\t\t\tlet lineContext = model.getLineContext(position.lineNumber);\n\n\t\t\t\tif (!support.shouldTriggerParameterHints(lineContext, position.column - 1)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.trigger(ch);\n\t\t\t});\n\n\t\t\treturn { dispose: listener };\n\t\t});\n\t}\n\n\tprivate onModeChanged(e: IModeSupportChangedEvent): void {\n\t\tif (e.parameterHintsSupport) {\n\t\t\tthis.onModelChanged();\n\t\t}\n\t}\n\n\tprivate onCursorChange(e: ICursorSelectionChangedEvent): void {\n\t\tif (e.source === 'mouse') {\n\t\t\tthis.cancel();\n\t\t} else if (this.isTriggered()) {\n\t\t\tthis.trigger();\n\t\t}\n\t}\n\n\tprivate event(emitter: IEventEmitter, eventType: string, cb: ListenerCallback): void {\n\t\tthis.toDispose.push(emitter.addListener2(eventType, cb));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.cancel(true);\n\n\t\tthis.triggerCharactersListeners = dispose(this.triggerCharactersListeners);\n\t\tthis.toDispose = dispose(this.toDispose);\n\n\t\tthis.emit('destroy', null);\n\n\t\tsuper.dispose();\n\t}\n}\n"]}