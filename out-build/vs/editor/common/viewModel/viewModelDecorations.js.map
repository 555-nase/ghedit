{"version":3,"file":"viewModelDecorations.js","sourceRoot":"","sources":["../../../../../src/vs/editor/common/viewModel/viewModelDecorations.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {Range} from 'vs/editor/common/core/range';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\n\nexport interface IModelRangeToViewRangeConverter {\n\tconvertModelRangeToViewRange(modelRange:editorCommon.IRange, isWholeLine:boolean): editorCommon.IEditorRange;\n}\n\ninterface IViewModelDecoration extends editorCommon.IModelDecoration {\n\tmodelRange: editorCommon.IRange;\n}\n\ninterface IViewModelDecorationSource {\n\tid: string;\n\townerId: number;\n\trange: editorCommon.IRange;\n\toptions: editorCommon.IModelDecorationOptions;\n}\n\nclass ViewModelDecoration implements IViewModelDecoration {\n\tid: string;\n\townerId: number;\n\trange: editorCommon.IEditorRange;\n\toptions: editorCommon.IModelDecorationOptions;\n\tmodelRange: editorCommon.IRange;\n\n\tconstructor(source:IViewModelDecorationSource, range:editorCommon.IEditorRange) {\n\t\tthis.id = source.id;\n\t\tthis.options = source.options;\n\t\tthis.ownerId = source.ownerId;\n\t\tthis.modelRange = source.range;\n\t\tthis.range = range;\n\t}\n}\n\nexport class ViewModelDecorations implements IDisposable {\n\n\tprivate editorId:number;\n\tprivate configuration:editorCommon.IConfiguration;\n\tprivate converter:IModelRangeToViewRangeConverter;\n\tprivate decorations:IViewModelDecoration[];\n\n\tprivate _cachedModelDecorationsResolver:editorCommon.IDecorationsViewportData;\n\tprivate _cachedModelDecorationsResolverStartLineNumber:number;\n\tprivate _cachedModelDecorationsResolverEndLineNumber:number;\n\n\tconstructor(editorId:number, configuration:editorCommon.IConfiguration, converter:IModelRangeToViewRangeConverter) {\n\t\tthis.editorId = editorId;\n\t\tthis.configuration = configuration;\n\t\tthis.converter = converter;\n\t\tthis.decorations = [];\n\n\t\tthis._clearCachedModelDecorationsResolver();\n\t}\n\n\tprivate _clearCachedModelDecorationsResolver(): void {\n\t\tthis._cachedModelDecorationsResolver = null;\n\t\tthis._cachedModelDecorationsResolverStartLineNumber = 0;\n\t\tthis._cachedModelDecorationsResolverEndLineNumber = 0;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.converter = null;\n\t\tthis.decorations = null;\n\t\tthis._clearCachedModelDecorationsResolver();\n\t}\n\n\tpublic static compareDecorations(a:editorCommon.IModelDecoration, b:editorCommon.IModelDecoration): number {\n\t\treturn Range.compareRangesUsingStarts(a.range, b.range);\n\t}\n\n\tpublic reset(model:editorCommon.IModel): void {\n\t\tvar decorations = model.getAllDecorations(this.editorId, this.configuration.editor.readOnly),\n\t\t\ti:number,\n\t\t\tlen:number,\n\t\t\ttheirDecoration:editorCommon.IModelDecoration,\n\t\t\tmyDecoration:IViewModelDecoration;\n\n\t\tthis.decorations = [];\n\t\tfor (i = 0, len = decorations.length; i < len; i++) {\n\t\t\ttheirDecoration = decorations[i];\n\t\t\tmyDecoration = new ViewModelDecoration(theirDecoration, this.converter.convertModelRangeToViewRange(theirDecoration.range, theirDecoration.options.isWholeLine));\n\t\t\tthis.decorations[i] = myDecoration;\n\t\t}\n\t\tthis._clearCachedModelDecorationsResolver();\n\t\tthis.decorations.sort(ViewModelDecorations.compareDecorations);\n\t}\n\n\tpublic onModelDecorationsChanged(e:editorCommon.IModelDecorationsChangedEvent, emit:(eventType:string, payload:any)=>void): void {\n\n\t\tvar somethingChanged = false,\n\t\t\tinlineDecorationsChanged = false;\n\n\t\t// -----------------------------------\n\t\t// Interpret addedOrChangedDecorations\n\n\t\tvar removedMap:{[id:string]:boolean;} = {},\n\t\t\taddedOrChangedMap:{[id:string]:editorCommon.IModelDecorationsChangedEventDecorationData;} = {},\n\t\t\ttheirDecoration:editorCommon.IModelDecorationsChangedEventDecorationData,\n\t\t\ti:number,\n\t\t\tskipValidation = this.configuration.editor.readOnly,\n\t\t\tlen:number;\n\n\t\tfor (i = 0, len = e.addedOrChangedDecorations.length; i < len; i++) {\n\t\t\ttheirDecoration = e.addedOrChangedDecorations[i];\n\t\t\tif (skipValidation && theirDecoration.isForValidation) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (theirDecoration.ownerId && theirDecoration.ownerId !== this.editorId) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\taddedOrChangedMap[theirDecoration.id] = theirDecoration;\n\t\t}\n\n\t\tfor (i = 0, len = e.removedDecorations.length; i < len; i++) {\n\t\t\tremovedMap[e.removedDecorations[i]] = true;\n\t\t}\n\n\t\t// Interpret changed decorations\n\t\tvar usedMap:{[id:string]:boolean;} = {},\n\t\t\tmyDecoration:IViewModelDecoration;\n\n\t\tfor (i = 0, len = this.decorations.length; i < len; i++) {\n\t\t\tmyDecoration = this.decorations[i];\n\n\t\t\tif (addedOrChangedMap.hasOwnProperty(myDecoration.id)) {\n\t\t\t\tusedMap[myDecoration.id] = true;\n\t\t\t\ttheirDecoration = addedOrChangedMap[myDecoration.id];\n\n\t\t\t\tmyDecoration.options = theirDecoration.options;\n\t\t\t\tmyDecoration.modelRange = theirDecoration.range;\n\t\t\t\tmyDecoration.range = this.converter.convertModelRangeToViewRange(theirDecoration.range, theirDecoration.options.isWholeLine);\n//\t\t\t\tconsole.log(theirDecoration.range.toString() + '--->' + myDecoration.range.toString());\n\n\t\t\t\tif (myDecoration.options.inlineClassName) {\n\t\t\t\t\tinlineDecorationsChanged = true;\n\t\t\t\t}\n\t\t\t\tsomethingChanged = true;\n\t\t\t}\n\n\t\t\tif (removedMap.hasOwnProperty(myDecoration.id)) {\n\t\t\t\tif (this.decorations[i].options.inlineClassName) {\n\t\t\t\t\tinlineDecorationsChanged = true;\n\t\t\t\t}\n\t\t\t\tthis.decorations.splice(i, 1);\n\t\t\t\tlen--;\n\t\t\t\ti--;\n\t\t\t\tsomethingChanged = true;\n\t\t\t}\n\t\t}\n\n\t\t// Interpret new decorations\n\t\tlet keys = Object.keys(addedOrChangedMap);\n\t\tfor (let i = 0, len = keys.length; i < len; i++) {\n\t\t\tlet id = keys[i];\n\t\t\tif (!usedMap.hasOwnProperty(id)) {\n\t\t\t\ttheirDecoration = addedOrChangedMap[id];\n\n\t\t\t\tmyDecoration = new ViewModelDecoration(theirDecoration, this.converter.convertModelRangeToViewRange(theirDecoration.range, theirDecoration.options.isWholeLine));\n//\t\t\t\tconsole.log(theirDecoration.range.toString() + '--->' + myDecoration.range.toString());\n\t\t\t\tthis.decorations.push(myDecoration);\n\t\t\t\tif (myDecoration.options.inlineClassName) {\n\t\t\t\t\tinlineDecorationsChanged = true;\n\t\t\t\t}\n\t\t\t\tsomethingChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._clearCachedModelDecorationsResolver();\n\t\t\tthis.decorations.sort(ViewModelDecorations.compareDecorations);\n\t\t\tvar newEvent:editorCommon.IViewDecorationsChangedEvent = {\n\t\t\t\tinlineDecorationsChanged: inlineDecorationsChanged\n\t\t\t};\n\t\t\temit(editorCommon.ViewEventNames.DecorationsChangedEvent, newEvent);\n\t\t}\n\t}\n\n\tpublic onLineMappingChanged(emit:(eventType:string, payload:any)=>void): void {\n\t\tvar decorations = this.decorations,\n\t\t\td:IViewModelDecoration,\n\t\t\ti:number,\n\t\t\tnewRange:editorCommon.IEditorRange,\n\t\t\tsomethingChanged:boolean = false,\n\t\t\tinlineDecorationsChanged = false,\n\t\t\tlen:number;\n\n\t\tfor (i = 0, len = decorations.length; i < len; i++) {\n\t\t\td = decorations[i];\n\t\t\tnewRange = this.converter.convertModelRangeToViewRange(d.modelRange, d.options.isWholeLine);\n\t\t\tif (!inlineDecorationsChanged && d.options.inlineClassName && !Range.equalsRange(newRange, d.range)) {\n\t\t\t\tinlineDecorationsChanged = true;\n\t\t\t}\n\t\t\tif (!somethingChanged && !Range.equalsRange(newRange, d.range)) {\n\t\t\t\tsomethingChanged = true;\n\t\t\t}\n\t\t\td.range = newRange;\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._clearCachedModelDecorationsResolver();\n\t\t\tthis.decorations.sort(ViewModelDecorations.compareDecorations);\n\t\t\tvar newEvent:editorCommon.IViewDecorationsChangedEvent = {\n\t\t\t\tinlineDecorationsChanged: inlineDecorationsChanged\n\t\t\t};\n\t\t\temit(editorCommon.ViewEventNames.DecorationsChangedEvent, newEvent);\n\t\t}\n\t}\n\n\tpublic getAllDecorations(): editorCommon.IModelDecoration[] {\n\t\treturn this.decorations;\n\t}\n\n\tpublic getDecorationsViewportData(startLineNumber: number, endLineNumber: number): editorCommon.IDecorationsViewportData {\n\t\tvar cacheIsValid = true;\n\t\tcacheIsValid = cacheIsValid && (this._cachedModelDecorationsResolver !== null);\n\t\tcacheIsValid = cacheIsValid && (this._cachedModelDecorationsResolverStartLineNumber === startLineNumber);\n\t\tcacheIsValid = cacheIsValid && (this._cachedModelDecorationsResolverEndLineNumber === endLineNumber);\n\t\tif (!cacheIsValid) {\n\t\t\tthis._cachedModelDecorationsResolver = this._getDecorationsViewportData(startLineNumber, endLineNumber);\n\t\t\tthis._cachedModelDecorationsResolverStartLineNumber = startLineNumber;\n\t\t\tthis._cachedModelDecorationsResolverEndLineNumber = endLineNumber;\n\t\t}\n\t\treturn this._cachedModelDecorationsResolver;\n\t}\n\n\tprivate _getDecorationsViewportData(startLineNumber: number, endLineNumber: number): editorCommon.IDecorationsViewportData {\n\t\tvar decorationsInViewport: editorCommon.IModelDecoration[] = [],\n\t\t\tinlineDecorations: editorCommon.IModelDecoration[][] = [],\n\t\t\tj: number,\n\t\t\tintersectedStartLineNumber: number,\n\t\t\tintersectedEndLineNumber: number,\n\t\t\tdecorations = this.decorations,\n\t\t\td:editorCommon.IModelDecoration,\n\t\t\tr:editorCommon.IRange,\n\t\t\ti:number,\n\t\t\tlen:number;\n\n\t\tfor (j = startLineNumber; j <= endLineNumber; j++) {\n\t\t\tinlineDecorations[j - startLineNumber] = [];\n\t\t}\n\n\t\tfor (i = 0, len = decorations.length; i < len; i++) {\n\t\t\td = decorations[i];\n\t\t\tr = d.range;\n\t\t\tif (r.startLineNumber > endLineNumber) {\n\t\t\t\t// Decorations are sorted ascending by line number, it is safe to stop now\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (r.endLineNumber < startLineNumber) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tdecorationsInViewport.push(d);\n\n\t\t\tif (d.options.inlineClassName) {\n\t\t\t\tintersectedStartLineNumber = Math.max(startLineNumber, r.startLineNumber);\n\t\t\t\tintersectedEndLineNumber = Math.min(endLineNumber, r.endLineNumber);\n\t\t\t\tfor (j = intersectedStartLineNumber; j <= intersectedEndLineNumber; j++) {\n\t\t\t\t\tinlineDecorations[j - startLineNumber].push(d);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdecorations: decorationsInViewport,\n\t\t\tinlineDecorations: inlineDecorations\n\t\t};\n\t}\n\n\n}"]}