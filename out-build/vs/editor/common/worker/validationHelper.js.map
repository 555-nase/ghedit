{"version":3,"file":"vs/editor/common/worker/validationHelper.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/editor/common/worker/validationHelper.ts"],"names":[],"mappings":";IAAA;;;oGAGgG;IAChG,YAAY,CAAC;IAiBb;QAOC,yBAAmB,KAAmB,EAAE,cAA4C;YAPrF,iBAiDC;YAzCC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;YACtC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;YACpB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YACtB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;gBACpB,OAAO,EAAE,KAAK,CAAC,eAAe,CAAC,UAAC,MAAM,IAAK,OAAA,KAAI,CAAC,eAAe,CAAC,MAAM,CAAC,EAA5B,CAA4B,CAAC;aACxE,CAAC,CAAC;QACJ,CAAC;QAEM,iCAAO,GAAd;YACC,IAAI,CAAC,UAAU,GAAG,mBAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC3C,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC7B,CAAC;QAEM,qCAAW,GAAlB;YACC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACvB,CAAC;QAEM,qCAAW,GAAlB;YACC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACtB,CAAC;QAEM,iCAAO,GAAd;YACC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;QACtB,CAAC;QAEM,wCAAc,GAArB;YACC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QACpB,CAAC;QAEO,yCAAe,GAAvB,UAAwB,MAAsB;YAC7C,IAAI,eAAe,GAAG,KAAK,CAAC;YAC5B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,eAAe,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC5D,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,SAAS,CAAC,CAAC,CAAC;oBACvC,eAAe,GAAG,IAAI,CAAC;gBACxB,CAAC;YACF,CAAC;YACD,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;gBACrB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAC5B,CAAC;QACF,CAAC;QACF,sBAAC;IAAD,CAAC,AAjDD,IAiDC;IAED;QAaC,0BAAmB,eAAgC,EAAE,MAAc,EAAE,QAAkC;YAbxG,iBA0HC;YA5GC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;YACxC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;YAC1B,IAAI,CAAC,OAAO,GAAG,UAAC,QAAQ,IAAK,OAAA,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,KAAK,MAAM,CAAC,EAAvC,CAAuC,CAAC;YACrE,IAAI,CAAC,gBAAgB,GAAG,GAAG,CAAC;YAC5B,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;YAClB,IAAI,CAAC,2BAA2B,GAAG,KAAK,CAAC;YAEzC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,gCAAc,CAAC,KAAK,EAAE,UAAC,CAAC;gBAChF,KAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;YAC1B,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,gCAAc,CAAC,OAAO,EAAE,UAAC,CAAC;gBAClF,KAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;YAC5B,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,SAAS,GAAG,IAAI,wBAAgB,CAAC,cAAM,OAAA,KAAI,CAAC,eAAe,EAAE,EAAtB,CAAsB,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC3F,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAErC,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,UAAC,OAAO,IAAK,OAAA,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAzB,CAAyB,CAAC,CAAC;QAC7E,CAAC;QAEM,kCAAO,GAAd;YAAA,iBAKC;YAJA,IAAI,CAAC,UAAU,GAAG,mBAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAE3C,mBAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,UAAC,QAAQ,IAAK,OAAA,KAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAtB,CAAsB,CAAC,CAAC,CAAC;YAC7E,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACrB,CAAC;QAEM,kCAAO,GAAd;YACC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QAC3B,CAAC;QAEM,0DAA+B,GAAtC;YACC,IAAI,CAAC,2BAA2B,GAAG,IAAI,CAAC;YACxC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QAC3B,CAAC;QAEO,sCAAW,GAAnB,UAAoB,OAAoB;YAAxC,iBAUC;YATA,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAC5B,MAAM,CAAC;YACR,CAAC;YAED,IAAI,KAAK,GAAiB,OAAO,CAAC;YAElC,IAAI,eAAe,GAAG,IAAI,eAAe,CAAC,KAAK,EAAE,UAAC,KAAK,IAAK,OAAA,KAAI,CAAC,UAAU,CAAC,KAAK,CAAC,EAAtB,CAAsB,CAAC,CAAC;YACpF,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC,QAAQ,EAAE,CAAC,GAAG,eAAe,CAAC;YACzE,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QAClC,CAAC;QAEO,2CAAgB,GAAxB,UAAyB,CAAqB;YAC7C,IAAI,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;YAEjC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC5C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE,CAAC;YACnC,CAAC;YAED,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC;QAClC,CAAC;QAEO,6CAAkB,GAA1B,UAA2B,CAAuB;YACjD,IAAI,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;YAEjC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC5C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE,CAAC;gBAClC,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YAChC,CAAC;QACF,CAAC;QAEO,qCAAU,GAAlB,UAAmB,KAAqB;YACvC,KAAK,CAAC,WAAW,EAAE,CAAC;YACpB,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QAC3B,CAAC;QAEO,0CAAe,GAAvB;YAAA,iBA4BC;YA3BA,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gBACtB,MAAM,CAAC;YACR,CAAC;YAED,IAAI,WAAW,GAAU,EAAE,CAAC;YAC5B,IAAI,WAAW,GAAU,EAAE,CAAC;YAE5B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC;iBACvB,GAAG,CAAC,UAAC,QAAQ,IAAK,OAAA,KAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAtB,CAAsB,CAAC;iBACzC,OAAO,CAAC,UAAC,KAAK;gBACd,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;oBACrB,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC,qBAAqB,EAAE,CAAC,CAAC;oBACjE,KAAK,CAAC,WAAW,EAAE,CAAC;gBACrB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC,qBAAqB,EAAE,CAAC,CAAC;gBAClE,CAAC;YACF,CAAC,CAAC,CAAC;YAEJ,IAAI,0BAA0B,GAAG,IAAI,CAAC,2BAA2B,CAAC;YAClE,IAAI,CAAC,2BAA2B,GAAG,KAAK,CAAC;YAEzC,IAAI,UAAU,GAAU,WAAW,CAAC;YACpC,EAAE,CAAC,CAAC,0BAA0B,CAAC,CAAC,CAAC;gBAChC,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;YAC7C,CAAC;YAED,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QAC5B,CAAC;QAEM,iCAAM,GAAb;YACC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,IAAI,CAAC,OAAO,EAAE,CAAC;QAChB,CAAC;QACF,uBAAC;IAAD,CAAC,AA1HD,IA0HC;IA1HY,wBAAgB,mBA0H5B,CAAA","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {RunOnceScheduler} from 'vs/base/common/async';\nimport {IEmitterEvent} from 'vs/base/common/eventEmitter';\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport URI from 'vs/base/common/uri';\nimport {IMirrorModel} from 'vs/editor/common/editorCommon';\nimport {IResourceAddedEvent, IResourceRemovedEvent, IResourceService, ResourceEvents} from 'vs/editor/common/services/resourceService';\n\ninterface IValidationHelperFilter {\n\t(resource:IMirrorModel): boolean;\n}\n\nexport interface IValidationHelperCallback {\n\t(toValidate:URI[]): void;\n}\n\nclass ValidationModel implements IDisposable {\n\n\tprivate _toDispose: IDisposable[];\n\tprivate _changeCallback: (model:ValidationModel)=>void;\n\tprivate _model: IMirrorModel;\n\tprivate _isDirty: boolean;\n\n\tpublic constructor(model: IMirrorModel, changeCallback:(model:ValidationModel)=>void) {\n\t\tthis._toDispose = [];\n\t\tthis._changeCallback = changeCallback;\n\t\tthis._model = model;\n\t\tthis._isDirty = false;\n\t\tthis._toDispose.push({\n\t\t\tdispose: model.addBulkListener((events) => this._onModelChanged(events))\n\t\t});\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toDispose = dispose(this._toDispose);\n\t\tthis._changeCallback = null;\n\t}\n\n\tpublic markAsClean(): void {\n\t\tthis._isDirty = false;\n\t}\n\n\tpublic markAsDirty(): void {\n\t\tthis._isDirty = true;\n\t}\n\n\tpublic isDirty(): boolean {\n\t\treturn this._isDirty;\n\t}\n\n\tpublic getMirrorModel(): IMirrorModel {\n\t\treturn this._model;\n\t}\n\n\tprivate _onModelChanged(events:IEmitterEvent[]): void {\n\t\tvar containsChanged = false;\n\t\tfor (var i = 0; !containsChanged && i < events.length; i++) {\n\t\t\tif (events[i].getType() === 'changed') {\n\t\t\t\tcontainsChanged = true;\n\t\t\t}\n\t\t}\n\t\tif (containsChanged) {\n\t\t\tthis._changeCallback(this);\n\t\t}\n\t}\n}\n\nexport class ValidationHelper implements IDisposable {\n\n\tprivate _toDispose:IDisposable[];\n\n\tprivate _isEnabled:boolean;\n\tprivate _validate:RunOnceScheduler;\n\tprivate _resourceService:IResourceService;\n\tprivate _callback:IValidationHelperCallback;\n\tprivate _filter:IValidationHelperFilter;\n\tprivate _validationDelay:number;\n\tprivate _models:{[url:string]:ValidationModel;};\n\tprivate _isDueToConfigurationChange:boolean;\n\n\tpublic constructor(resourceService:IResourceService, modeId: string, callback:IValidationHelperCallback) {\n\t\tthis._toDispose = [];\n\t\tthis._resourceService = resourceService;\n\t\tthis._callback = callback;\n\t\tthis._filter = (resource) => (resource.getMode().getId() === modeId);\n\t\tthis._validationDelay = 500;\n\t\tthis._models = {};\n\t\tthis._isDueToConfigurationChange = false;\n\n\t\tthis._toDispose.push(this._resourceService.addListener2_(ResourceEvents.ADDED, (e) => {\n\t\t\tthis._onResourceAdded(e);\n\t\t}));\n\n\t\tthis._toDispose.push(this._resourceService.addListener2_(ResourceEvents.REMOVED, (e) => {\n\t\t\tthis._onResourceRemoved(e);\n\t\t}));\n\n\t\tthis._validate = new RunOnceScheduler(() => this._invokeCallback(), this._validationDelay);\n\t\tthis._toDispose.push(this._validate);\n\n\t\tthis._resourceService.all().forEach((element) => this._addElement(element));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toDispose = dispose(this._toDispose);\n\n\t\tdispose(Object.keys(this._models).map((modelUrl) => this._models[modelUrl]));\n\t\tthis._models = null;\n\t}\n\n\tpublic trigger(): void {\n\t\tthis._validate.schedule();\n\t}\n\n\tpublic triggerDueToConfigurationChange(): void {\n\t\tthis._isDueToConfigurationChange = true;\n\t\tthis._validate.schedule();\n\t}\n\n\tprivate _addElement(element:IMirrorModel): void {\n\t\tif (!this._filter(element)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar model = <IMirrorModel>element;\n\n\t\tvar validationModel = new ValidationModel(model, (model) => this._onChanged(model));\n\t\tthis._models[model.getAssociatedResource().toString()] = validationModel;\n\t\tthis._onChanged(validationModel);\n\t}\n\n\tprivate _onResourceAdded(e:IResourceAddedEvent): void {\n\t\tvar stringUrl = e.url.toString();\n\n\t\tif (this._models.hasOwnProperty(stringUrl)) {\n\t\t\tthis._models[stringUrl].dispose();\n\t\t}\n\n\t\tthis._addElement(e.addedElement);\n\t}\n\n\tprivate _onResourceRemoved(e:IResourceRemovedEvent): void {\n\t\tvar stringUrl = e.url.toString();\n\n\t\tif (this._models.hasOwnProperty(stringUrl)) {\n\t\t\tthis._models[stringUrl].dispose();\n\t\t\tdelete this._models[stringUrl];\n\t\t}\n\t}\n\n\tprivate _onChanged(model:ValidationModel): void {\n\t\tmodel.markAsDirty();\n\t\tthis._validate.schedule();\n\t}\n\n\tprivate _invokeCallback(): void {\n\t\tif (!this._isEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar dirtyModels: URI[] = [];\n\t\tvar cleanModels: URI[] = [];\n\n\t\tObject.keys(this._models)\n\t\t\t.map((modelUrl) => this._models[modelUrl])\n\t\t\t.forEach((model) => {\n\t\t\t\tif (model.isDirty()) {\n\t\t\t\t\tdirtyModels.push(model.getMirrorModel().getAssociatedResource());\n\t\t\t\t\tmodel.markAsClean();\n\t\t\t\t} else {\n\t\t\t\t\tcleanModels.push(model.getMirrorModel().getAssociatedResource());\n\t\t\t\t}\n\t\t\t});\n\n\t\tvar isDueToConfigurationChange = this._isDueToConfigurationChange;\n\t\tthis._isDueToConfigurationChange = false;\n\n\t\tlet toValidate: URI[] = dirtyModels;\n\t\tif (isDueToConfigurationChange) {\n\t\t\ttoValidate = toValidate.concat(cleanModels);\n\t\t}\n\n\t\tthis._callback(toValidate);\n\t}\n\n\tpublic enable(): void {\n\t\tthis._isEnabled = true;\n\t\tthis.trigger();\n\t}\n}\n"]}